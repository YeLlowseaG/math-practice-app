<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Â≠óÊØçËÆ§Áü• - ABCÂ≠¶‰π†Ê∏∏Êàè</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- ÈÖçÁΩÆTailwindËá™ÂÆö‰πâÈ¢úËâ≤ÂíåÂ≠ó‰Ωì -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        neutral: '#F7FFF7',
                        text: '#1F2937'
                    },
                    fontFamily: {
                        kids: ['"Comic Sans MS"', '"Marker Felt"', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .bounce-light {
                animation: bounce-light 0.5s ease infinite alternate;
            }
            .pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .scale-hover {
                transition: transform 0.2s;
            }
            .scale-hover:hover {
                transform: scale(1.05);
            }
            .correct-animation {
                animation: correct 0.6s ease-in-out;
            }
            .wrong-animation {
                animation: wrong 0.6s ease-in-out;
            }
            .level-complete {
                animation: levelComplete 1s ease-in-out;
            }
            @keyframes bounce-light {
                from { transform: translateY(0); }
                to { transform: translateY(-5px); }
            }
            @keyframes correct {
                0% { transform: scale(1); background-color: #10B981; }
                50% { transform: scale(1.1); background-color: #34D399; }
                100% { transform: scale(1); background-color: #10B981; }
            }
            @keyframes wrong {
                0% { transform: translateX(0); background-color: #EF4444; }
                25% { transform: translateX(-5px); background-color: #F87171; }
                75% { transform: translateX(5px); background-color: #F87171; }
                100% { transform: translateX(0); background-color: #EF4444; }
            }
            @keyframes levelComplete {
                0% { transform: scale(1) rotate(0deg); }
                25% { transform: scale(1.2) rotate(5deg); }
                75% { transform: scale(1.2) rotate(-5deg); }
                100% { transform: scale(1) rotate(0deg); }
            }
            @keyframes button-press {
                0% { transform: scale(1); }
                50% { transform: scale(0.95); }
                100% { transform: scale(1); }
            }
            
            .button-press {
                animation: button-press 0.2s ease-in-out;
            }
            
            /* ÁßªÂä®Á´Ø‰ºòÂåñ */
            @media (max-width: 768px) {
                .option-btn {
                    min-height: 64px;
                    font-size: 1.1rem;
                    padding: 16px 12px;
                }
                .float-animation {
                    animation: none;
                }
            }
            
            @media (max-width: 480px) {
                .option-btn {
                    min-height: 60px;
                    font-size: 1rem;
                    padding: 12px 8px;
                }
                .main-content {
                    padding: 1rem;
                }
                .game-card {
                    padding: 1.5rem;
                }
                #target-letter {
                    font-size: clamp(4rem, 15vw, 8rem) !important;
                }
                .text-xl {
                    font-size: 1rem;
                }
                .text-2xl {
                    font-size: 1.25rem;
                }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen font-kids text-text overflow-hidden">
    
    <!-- ÂºÄÂßãÁïåÈù¢ -->
    <div id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-8 relative">
        <!-- ËøîÂõûÈ¶ñÈ°µÊåâÈíÆ -->
        <button onclick="window.location.href='index.html'" class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800 z-40">
            <i class="fa fa-home mr-2"></i>È¶ñÈ°µ
        </button>
        <div class="text-center w-full max-w-lg mx-auto bg-white rounded-3xl shadow-2xl p-6 transform transition-all duration-500">
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary mb-3">Â≠óÊØçËÆ§Áü•</h1>
            <p class="text-base mb-4 text-gray-600">Â≠¶‰π†ABCÂ≠óÊØç<br>Âê¨ÂèëÈü≥ÈÄâÂ≠óÊØçÔºÅ</p>
            
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white text-3xl shadow-lg relative overflow-hidden float-animation">
                    <i class="fa fa-font"></i>
                    <div class="absolute inset-0 bg-white opacity-20 rounded-full animate-ping"></div>
                </div>
            </div>
            
            <!-- ÈöæÂ∫¶ÈÄâÊã© -->
            <div class="mb-5">
                <h3 class="text-base font-bold mb-3">ÈÄâÊã©ÈöæÂ∫¶</h3>
                <div class="grid grid-cols-1 gap-3">
                    <button onclick="selectDifficulty('easy')" 
                            class="difficulty-btn bg-secondary/10 border-2 border-secondary/20 hover:border-secondary/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">üåü</div>
                                <div>
                                    <h4 class="font-bold text-secondary text-left">ÁÆÄÂçï</h4>
                                    <p class="text-xs text-gray-600 text-left">A-H Â≠óÊØç</p>
                                </div>
                            </div>
                            <div class="text-sm text-secondary">8‰∏™</div>
                        </div>
                    </button>
                    <button onclick="selectDifficulty('medium')" 
                            class="difficulty-btn bg-accent/10 border-2 border-accent/20 hover:border-accent/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">‚≠ê‚≠ê</div>
                                <div>
                                    <h4 class="font-bold text-accent text-left">‰∏≠Á≠â</h4>
                                    <p class="text-xs text-gray-600 text-left">A-P Â≠óÊØç</p>
                                </div>
                            </div>
                            <div class="text-sm text-accent">16‰∏™</div>
                        </div>
                    </button>
                    <button onclick="selectDifficulty('hard')" 
                            class="difficulty-btn bg-danger/10 border-2 border-danger/20 hover:border-danger/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">‚≠ê‚≠ê‚≠ê</div>
                                <div>
                                    <h4 class="font-bold text-danger text-left">Âõ∞Èöæ</h4>
                                    <p class="text-xs text-gray-600 text-left">A-Z ÂÖ®ÈÉ®</p>
                                </div>
                            </div>
                            <div class="text-sm text-danger">26‰∏™</div>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- ÂÄíËÆ°Êó∂ÂºÄÂÖ≥ -->
            <div class="mb-5 flex items-center justify-center gap-4 bg-gray-50 rounded-2xl p-3">
                <i class="fa fa-clock-o text-gray-600"></i>
                <span class="text-gray-700 font-medium">ÂÄíËÆ°Êó∂Ê®°Âºè</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="timer-toggle" class="sr-only peer" checked>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
                <span class="text-xs text-gray-500">15ÁßíÁ≠îÈ¢ò</span>
            </div>

            <!-- ÂæΩÁ´†È¢ÑËßà -->
            <div id="badge-preview" class="mb-5">
                <h3 class="text-sm font-bold mb-2">ÊàëÁöÑÂæΩÁ´†</h3>
                <div id="badge-preview-grid" class="flex justify-center gap-3 flex-wrap"></div>
                <div class="text-xs text-gray-400 mt-1">Êú¨Ê∏∏ÊàèÂæΩÁ´†È¢ÑËßàÔºàÂ∑≤Ëé∑È´ò‰∫ÆÔºåÊú™Ëé∑ÁÅ∞ÊòæÔºâ</div>
            </div>
            
            <!-- Ê∏∏ÊàèËØ¥Êòé -->
            <div class="mb-5">
                <div class="bg-gradient-to-r from-primary/5 to-secondary/5 rounded-xl p-4 text-sm">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="flex items-center">
                            <span class="text-lg mr-2">üîä</span>
                            <span class="text-gray-700">Âê¨ÂèëÈü≥</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">üëÜ</span>
                            <span class="text-gray-700">ÁÇπÂáªÈÄâÊã©</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">üéØ</span>
                            <span class="text-gray-700">ÈÄâÂØπÂ≠óÊØç</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">üèÜ</span>
                            <span class="text-gray-700">ÈóØÂÖ≥ÊåëÊàò</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÂºÄÂßãÊ∏∏ÊàèÊåâÈíÆ -->
            <button id="start-game-btn" onclick="startGame()" disabled
                    class="w-full bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white font-bold py-3 px-6 rounded-2xl shadow-lg transform transition-all duration-300 scale-hover disabled:opacity-50 disabled:cursor-not-allowed">
                ÂºÄÂßãÂ≠¶‰π† <i class="fa fa-play ml-2"></i>
            </button>
        </div>
        
        <!-- Ë£ÖÈ•∞ÂÖÉÁ¥† -->
        <div class="absolute top-10 left-10 text-5xl text-primary/30">
            <i class="fa fa-star bounce-light"></i>
        </div>
        <div class="absolute bottom-10 right-10 text-5xl text-secondary/30">
            <i class="fa fa-heart bounce-light" style="animation-delay: 0.3s"></i>
        </div>
        <div class="absolute top-1/4 right-20 text-4xl text-accent/30">
            <i class="fa fa-trophy bounce-light" style="animation-delay: 0.6s"></i>
        </div>
    </div>

    <script>
    (function(){
      const GAME_KEY = 'letters';
      const badgeDefs = [
        { id: 'first_correct', name: 'È¶ñÈ¢òÊ≠£Á°Æ', icon: 'üéØ' },
        { id: 'combo_5', name: 'ËøûÂáªËææ‰∫∫', icon: 'üî•' },
        { id: 'speed_round', name: 'ÊûÅÈÄüÁ≠îÈ¢ò', icon: '‚ö°' },
        { id: 'level_reach', name: 'ÈóØÂÖ≥ËÉΩÊâã', icon: 'üèÜ' },
        { id: 'perfect_round', name: 'ÂÆåÁæéÂõûÂêà', icon: 'üíé' }
      ];
      function getEarnedIds(){
        try { return JSON.parse(localStorage.getItem('earnedAchievements_' + GAME_KEY) || '[]'); } catch(_) { return []; }
      }
      function renderBadgePreview(){
        const grid = document.getElementById('badge-preview-grid');
        if(!grid) return;
        const owned = new Set(getEarnedIds());
        grid.innerHTML = badgeDefs.map(a => {
          const earned = owned.has(a.id);
          const base = earned ? 'from-yellow-100 to-orange-100 border-yellow-300 text-amber-900' : 'from-gray-50 to-gray-100 border-gray-200 text-gray-400 opacity-80';
          return `
            <div class=\"relative w-20 h-20 rounded-2xl border-2 bg-gradient-to-br ${base} shadow-sm flex flex-col items-center justify-center overflow-hidden\" title=\"${a.name}\">\n              <div class=\"text-2xl mb-1\">${a.icon}</div>\n              <div class=\"text-[10px] font-bold text-center leading-tight px-1\">${a.name}</div>\n              ${earned ? '<div class=\\"absolute -right-1 -top-1 bg-amber-400 text-white text-[10px] px-1 rounded-full shadow\\">Â∑≤Ëé∑</div>' : ''}\n            </div>`;
        }).join('');
      }
      document.addEventListener('DOMContentLoaded', renderBadgePreview);
    })();
    </script>

    <!-- Ê∏∏ÊàèÁïåÈù¢ -->
    <div id="game-screen" class="hidden h-screen flex flex-col">
        <!-- È°∂ÈÉ®‰ø°ÊÅØÊ†è -->
        <div class="flex justify-between items-center p-3 bg-white/80 backdrop-blur-sm shadow-md">
            <!-- Â∑¶‰æß‰ø°ÊÅØ -->
            <div class="flex items-center gap-3">
                <!-- ËøîÂõûÈ¶ñÈ°µÊåâÈíÆ -->
                <button onclick="window.location.href='index.html'" class="bg-white/90 backdrop-blur-sm px-3 py-2 rounded-full shadow-md transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800">
                    <i class="fa fa-home mr-1"></i><span class="hidden sm:inline">È¶ñÈ°µ</span>
                </button>
                <div class="bg-primary px-4 py-2 rounded-full text-white font-bold shadow-md">
                    <span>ÂÖ≥Âç° </span><span id="level-display">1</span>
                </div>
                <div class="bg-secondary px-4 py-2 rounded-full text-white font-bold shadow-md">
                    <span>ËøûÂáª </span><span id="combo-display">0</span>
                </div>
            </div>
            
            <!-- ‰∏≠Èó¥ËÆ°Êó∂Âô® -->
            <div id="timer" class="bg-accent text-white px-6 py-3 rounded-full shadow-md">
                <i class="fa fa-clock-o mr-2"></i>
                <span id="countdown" class="text-xl font-bold">ÂÄíËÆ°Êó∂ 15.0</span>
            </div>
            
            <!-- Âè≥‰æßÂàÜÊï∞ -->
            <div class="bg-gradient-to-r from-purple-500 to-pink-500 px-4 py-2 rounded-full text-white font-bold shadow-md">
                <i class="fa fa-star mr-2"></i>
                <span id="score-display">0</span>
            </div>
        </div>
        
        <!-- ÂÖ≥Âç°ËøõÂ∫¶Êù° -->
        <div class="bg-gray-100 border-b border-gray-200">
            <div class="px-4 py-2">
                <div class="flex items-center justify-between mb-2">
                    <span id="progress-text" class="text-sm font-medium text-gray-600">Á¨¨1ÂÖ≥</span>
                    <span id="progress-percentage" class="text-sm font-medium text-gray-600">0/10</span>
                </div>
                <div class="bg-gray-200 h-3 rounded-full overflow-hidden">
                    <div id="progress-bar" class="bg-gradient-to-r from-primary to-secondary h-full transition-all duration-500 ease-out"></div>
                </div>
            </div>
        </div>
        
        <!-- ‰∏ªË¶ÅÊ∏∏ÊàèÂå∫Âüü -->
        <div class="flex-1 flex flex-col items-center p-6">
            <!-- ÂèçÈ¶à‰ø°ÊÅØ - ÁßªÂà∞È°∂ÈÉ® -->
            <div id="feedback" class="mb-4 text-center text-3xl font-bold h-16 flex items-center justify-center">
                <!-- ÂèçÈ¶à‰ø°ÊÅØÊòæÁ§∫Âå∫Âüü -->
            </div>
            
            <!-- ÁõÆÊ†áÊòæÁ§∫ -->
            <div class="bg-white rounded-3xl shadow-2xl p-8 text-center mb-6 transform transition-all duration-500">
                <p class="text-gray-500 text-lg mb-4" id="question-type">Âê¨ÂèëÈü≥ÈÄâÊã©Â≠óÊØç</p>
                
                <!-- ÂèëÈü≥Âå∫Âüü - Áªü‰∏ÄÊòæÁ§∫Âú®‰∏äÊñπ -->
                <div id="pronunciation-area" class="mb-6">
                    <div class="flex items-center justify-center mb-4">
                        <div class="text-6xl text-blue-500 mr-4">üîä</div>
                        <button onclick="playCurrentLetterSound()" class="bg-blue-500 hover:bg-blue-600 text-white rounded-2xl px-6 py-4 shadow-lg transition-all duration-300 hover:scale-105">
                            <i class="fa fa-volume-up text-xl mr-2"></i>
                            <span class="font-bold">Êí≠ÊîæÂèëÈü≥</span>
                        </button>
                    </div>
                    <div class="text-center">
                        <p class="text-gray-400 text-lg" id="pronunciation-text">/ei/</p>
                        <p class="text-[clamp(2rem,6vw,4rem)] font-bold text-text mt-2" id="reference-letter">A</p>
                    </div>
                </div>
                
                <p class="text-gray-400 text-sm mt-2" id="target-hint">ÁÇπÂáªÊí≠ÊîæÂèëÈü≥ÔºåÈÄâÊã©ÂØπÂ∫îÁöÑÂ≠óÊØç</p>
            </div>
            
            <!-- ÈÄâÈ°πÂå∫Âüü -->
            <div id="options-container" class="grid grid-cols-2 gap-4 max-w-xl w-full mt-auto mb-4">
                <!-- ÈÄâÈ°π‰ºöÂä®ÊÄÅÁîüÊàê -->
            </div>
        </div>
    </div>
    
    <!-- ÁªìÊûúÁïåÈù¢ -->
    <div id="result-screen" class="hidden flex flex-col items-center justify-center h-screen p-6 bg-white/90 backdrop-blur-md">
        <div class="text-center max-w-lg mx-auto">
            <div id="result-icon" class="text-8xl mb-6">üéâ</div>
            <h2 id="result-title" class="text-[clamp(2rem,5vw,3rem)] font-bold mb-6">ÊÅ≠ÂñúÂÆåÊàêÔºÅ</h2>
            
            <div class="bg-neutral rounded-2xl shadow-lg p-8 mb-8">
                <div class="grid grid-cols-2 gap-6">
                    <div class="text-center">
                        <div class="text-primary text-3xl font-bold" id="final-score">0</div>
                        <div class="text-gray-600">ÊÄªÂàÜÊï∞</div>
                    </div>
                    <div class="text-center">
                        <div class="text-secondary text-3xl font-bold" id="final-level">1</div>
                        <div class="text-gray-600">Âà∞ËææÂÖ≥Âç°</div>
                    </div>
                    <div class="text-center">
                        <div class="text-accent text-3xl font-bold" id="final-accuracy">0%</div>
                        <div class="text-gray-600">ÂáÜÁ°ÆÁéá</div>
                    </div>
                    <div class="text-center">
                        <div class="text-purple-500 text-3xl font-bold" id="max-combo">0</div>
                        <div class="text-gray-600">ÊúÄÈ´òËøûÂáª</div>
                    </div>
                </div>
            </div>
            
            <!-- ÊàêÂ∞±ÊòæÁ§∫ -->
            <div id="achievements" class="mb-8">
                <!-- ÊàêÂ∞±ÂæΩÁ´†‰ºöÂä®ÊÄÅÁîüÊàê -->
            </div>
            
            <!-- Â≠¶‰π†ÁªüËÆ° -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
                <h3 class="text-lg font-bold mb-4 text-primary">üéØ Â≠¶‰π†ÊàêÊûú</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="text-center">
                        <div class="text-green-600 text-2xl font-bold" id="letters-learned">0</div>
                        <div class="text-sm text-gray-600">Â∑≤ÊéåÊè°Â≠óÊØç</div>
                    </div>
                    <div class="text-center">
                        <div class="text-blue-600 text-2xl font-bold" id="words-learned">0</div>
                        <div class="text-sm text-gray-600">Â≠¶‰ºöÂçïËØç</div>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-4">
                <button onclick="restartGame()" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-3 px-6 rounded-2xl shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-refresh mr-2"></i>ÂÜçÊù•‰∏ÄÊ¨°
                </button>
                <button onclick="window.location.href='index.html'" class="bg-gradient-to-r from-gray-500 to-gray-600 text-white font-bold py-3 px-6 rounded-2xl shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-home mr-2"></i>ËøîÂõûÈ¶ñÈ°µ
                </button>
            </div>
        </div>
    </div>

    <script>
        // Ê∏∏ÊàèÁä∂ÊÄÅ
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
        const letterSounds = {
            'A': 'ei', 'B': 'bi:', 'C': 'si:', 'D': 'di:', 'E': 'i:', 'F': 'ef',
            'G': 'd íi:', 'H': 'eit É', 'I': 'ai', 'J': 'd íei', 'K': 'kei', 'L': 'el',
            'M': 'em', 'N': 'en', 'O': '…ôu', 'P': 'pi:', 'Q': 'kju:', 'R': 'a:(r)',
            'S': 'es', 'T': 'ti:', 'U': 'ju:', 'V': 'vi:', 'W': 'd åblju:', 'X': 'eks',
            'Y': 'wai', 'Z': 'zi:'
        };
        
        // ËØ≠Èü≥ÂêàÊàêÁÆ°ÁêÜÂô®
        let voices = [];
        let englishVoice = null;
        const letterWords = {
            'A': 'Apple', 'B': 'Ball', 'C': 'Cat', 'D': 'Dog', 'E': 'Egg', 'F': 'Fish',
            'G': 'Goat', 'H': 'Hat', 'I': 'Ice', 'J': 'Jump', 'K': 'Key', 'L': 'Lion',
            'M': 'Moon', 'N': 'Net', 'O': 'Orange', 'P': 'Pen', 'Q': 'Queen', 'R': 'Red',
            'S': 'Sun', 'T': 'Tree', 'U': 'Up', 'V': 'Van', 'W': 'Water', 'X': 'Box',
            'Y': 'Yellow', 'Z': 'Zoo'
        };
        const letterWordsChinese = {
            'A': 'ËãπÊûú', 'B': 'ÁêÉ', 'C': 'Áå´', 'D': 'Áãó', 'E': 'È∏°Ëõã', 'F': 'È±º',
            'G': 'Â±±Áæä', 'H': 'Â∏ΩÂ≠ê', 'I': 'ÂÜ∞', 'J': 'Ë∑≥', 'K': 'Èí•Âåô', 'L': 'ÁãÆÂ≠ê',
            'M': 'Êúà‰∫Æ', 'N': 'ÁΩë', 'O': 'Ê©ôÂ≠ê', 'P': 'Á¨î', 'Q': 'Â•≥Áéã', 'R': 'Á∫¢Ëâ≤',
            'S': 'Â§™Èò≥', 'T': 'Ê†ë', 'U': 'Âêë‰∏ä', 'V': 'Ë¥ßËΩ¶', 'W': 'Ê∞¥', 'X': 'ÁõíÂ≠ê',
            'Y': 'ÈªÑËâ≤', 'Z': 'Âä®Áâ©Âõ≠'
        };
        
        let currentDifficulty = null;
        let currentLevel = 1;
        let currentQuestion = 0;
        let questionsPerLevel = 10;
        let score = 0;
        let combo = 0;
        let maxCombo = 0;
        let correctAnswers = 0;
        let totalAnswers = 0;
        let timeLeft = 15;
        let timerInterval = null;
        let currentLetter = '';
        let currentQuestionType = 'sound'; // Âõ∫ÂÆö‰∏∫Âê¨ÂèëÈü≥ÈÄâÂ≠óÊØç
        let gameRunning = false;
        
        // Â≠¶‰π†ÁªüËÆ°
        let learnedLetters = new Set();
        let learnedWords = new Set();
        
        // ÈóÆÈ¢òÁ±ªÂûã
        const questionTypes = [
            'sound',     // Âê¨ÂèëÈü≥ÈÄâÂ≠óÊØçÔºà‰∏ªË¶ÅÈ¢òÂûãÔºâ
            'identify',  // ÁúãÂ≠óÊØçÈÄâÂ≠óÊØçÂêçÁß∞
            'next',      // ‰∏ã‰∏Ä‰∏™Â≠óÊØç
            'word',      // Â≠óÊØçÂØπÂ∫îÂçïËØç
            'case'       // Â§ßÂ∞èÂÜôËΩ¨Êç¢
        ];
        
        // ÂàùÂßãÂåñËØ≠Èü≥ÂêàÊàê
        function initSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                const loadVoices = () => {
                    voices = speechSynthesis.getVoices();
                    englishVoice = voices.find(voice => 
                        voice.lang.includes('en') && 
                        (voice.name.includes('English') || voice.lang === 'en-US')
                    ) || voices[0];
                    console.log('ÈÄâÊã©Ëã±ËØ≠ËØ≠Èü≥:', englishVoice?.name);
                };

                if (voices.length === 0) {
                    speechSynthesis.onvoiceschanged = loadVoices;
                } else {
                    loadVoices();
                }
            }
        }

        // Êí≠ÊîæËã±ÊñáÂèëÈü≥
        function speakLetter(text, rate = 0.8) {
            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            }, 100);
        }
        
        // Êí≠ÊîæÂΩìÂâçÈ¢òÁõÆÁöÑÂèëÈü≥
        function playCurrentLetterSound() {
            if (currentLetter) {
                if (currentQuestionType === 'sound') {
                    // Âê¨ÂèëÈü≥È¢òÂûãÔºöÊí≠ÊîæÂ≠óÊØçÂèëÈü≥
                    speakLetter(currentLetter);
                } else if (currentQuestionType === 'word') {
                    // ÂçïËØçÈ¢òÂûãÔºöÊí≠ÊîæÂçïËØçÂèëÈü≥
                    speakLetter(letterWords[currentLetter]);
                } else {
                    // ÂÖ∂‰ªñÈ¢òÂûãÔºöÊí≠ÊîæÂ≠óÊØçÂèëÈü≥
                    speakLetter(currentLetter);
                }
            }
        }

        // ÂàùÂßãÂåñÊ∏∏Êàè
        // ÈÄâÊã©ÈöæÂ∫¶
        function selectDifficulty(difficulty) {
            currentDifficulty = difficulty;
            
            // ÈáçÁΩÆÊâÄÊúâÊåâÈíÆÊ†∑Âºè
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-primary');
            });
            
            // È´ò‰∫ÆÈÄâ‰∏≠ÁöÑÊåâÈíÆ
            event.target.closest('.difficulty-btn').classList.add('ring-4', 'ring-primary');
            
            // ÂêØÁî®ÂºÄÂßãÊåâÈíÆ
            const startBtn = document.getElementById('start-game-btn');
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
        
        function startGame() {
            if (!currentDifficulty) {
                alert('ËØ∑ÂÖàÈÄâÊã©ÈöæÂ∫¶ÔºÅ');
                return;
            }
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            currentLevel = 1;
            currentQuestion = 0;
            score = 0;
            combo = 0;
            maxCombo = 0;
            correctAnswers = 0;
            totalAnswers = 0;
            learnedLetters.clear();
            learnedWords.clear();
            gameRunning = true;
            
            // ÂàùÂßãÂåñËØ≠Èü≥
            initSpeechSynthesis();
            
            updateUI();
            nextQuestion();
            startTimer();
        }
        
        // ÁîüÊàê‰∏ã‰∏Ä‰∏™ÈóÆÈ¢ò
        function nextQuestion() {
            if (!gameRunning) return;
            
            if (currentQuestion >= questionsPerLevel) {
                levelComplete();
                return;
            }
            
            currentQuestion++;
            timeLeft = Math.max(10, 18 - currentLevel); // ÈöèÂÖ≥Âç°Â¢ûÂä†ÈöæÂ∫¶ÔºåÁº©Áü≠Êó∂Èó¥
            
            // Âè™Êúâ‰∏ÄÁßçÈ¢òÂûãÔºöÂê¨ÂèëÈü≥ÈÄâÂ≠óÊØç
            currentQuestionType = 'sound';
            
            // Ê†πÊçÆÈöæÂ∫¶ÈÄâÊã©Â≠óÊØçËåÉÂõ¥
            let letterRange;
            switch (currentDifficulty) {
                case 'easy':
                    letterRange = 8;  // A-H
                    break;
                case 'medium':
                    letterRange = 16; // A-P
                    break;
                case 'hard':
                default:
                    letterRange = 26; // A-Z
                    break;
            }
            
            const letterIndex = Math.floor(Math.random() * letterRange);
            currentLetter = letters[letterIndex];
            
            generateQuestion();
            updateUI();
            
            // ‰∏çËá™Âä®Êí≠ÊîæÔºåËÆ©Áî®Êà∑ÊâãÂä®ÁÇπÂáªÊí≠ÊîæÊåâÈíÆ
        }
        
        // ÁîüÊàêÈóÆÈ¢òÂíåÈÄâÈ°π
        function generateQuestion() {
            const questionElement = document.getElementById('question-type');
            const hintElement = document.getElementById('target-hint');
            const pronunciationText = document.getElementById('pronunciation-text');
            const referenceLetter = document.getElementById('reference-letter');
            const optionsContainer = document.getElementById('options-container');
            
            optionsContainer.innerHTML = '';
            
            let correctAnswer = '';
            let options = [];
            
            // Áªü‰∏ÄÂ∏ÉÂ±ÄÔºö‰∏äÈù¢ÂßãÁªàÊòæÁ§∫ÂèëÈü≥Âå∫ÂüüÔºå‰∏ãÈù¢ÊòæÁ§∫Â≠óÊØçÈÄâÈ°π
            switch (currentQuestionType) {
                case 'sound':
                    // Âê¨ÂèëÈü≥ÈÄâÂ≠óÊØç - ‰∏ªË¶ÅÈ¢òÂûã
                    questionElement.textContent = 'Âê¨ÂèëÈü≥ÔºåÈÄâÊã©ÂØπÂ∫îÁöÑÂ≠óÊØç';
                    pronunciationText.textContent = letterSounds[currentLetter];
                    referenceLetter.style.display = 'none';  // ÈöêËóèÂèÇËÄÉÂ≠óÊØç
                    hintElement.textContent = 'ÁÇπÂáªÊí≠ÊîæÂèëÈü≥ÔºåÁÑ∂Âêé‰ªé‰∏ãÈù¢ÈÄâÊã©ÂØπÂ∫îÁöÑÂ≠óÊØç';
                    correctAnswer = currentLetter;
                    options = generateLetterOptions(currentLetter);
                    break;
                    
                case 'identify':
                    // ÁúãÂ≠óÊØçÈÄâÂ≠óÊØçÂêçÁß∞
                    questionElement.textContent = 'Ëøô‰∏™Â≠óÊØçÂè´‰ªÄ‰πàÔºü';
                    pronunciationText.textContent = 'ÁÇπÂáªÊí≠ÊîæÂê¨Â≠óÊØçÂêçÁß∞';
                    referenceLetter.style.display = 'block';
                    referenceLetter.textContent = currentLetter;
                    hintElement.textContent = '‰∏äÈù¢ÊòæÁ§∫Â≠óÊØçÔºåÁÇπÂáªÊí≠ÊîæÂê¨ÂèëÈü≥ÔºåÁÑ∂Âêé‰ªé‰∏ãÈù¢ÈÄâÊã©Ê≠£Á°ÆÁöÑÂ≠óÊØçÂêçÁß∞';
                    correctAnswer = letterSounds[currentLetter];
                    options = generateSoundOptions(currentLetter);
                    break;
                    
                case 'next':
                    // ‰∏ã‰∏Ä‰∏™Â≠óÊØç
                    questionElement.textContent = '‰∏ã‰∏Ä‰∏™Â≠óÊØçÊòØ‰ªÄ‰πàÔºü';
                    pronunciationText.textContent = 'ÁÇπÂáªÊí≠ÊîæÂê¨ÂΩìÂâçÂ≠óÊØç';
                    referenceLetter.style.display = 'block';
                    referenceLetter.textContent = currentLetter;
                    hintElement.textContent = '‰∏äÈù¢ÊòæÁ§∫ÂΩìÂâçÂ≠óÊØçÔºåÊåâÂ≠óÊØçË°®È°∫Â∫è‰ªé‰∏ãÈù¢ÈÄâÊã©‰∏ã‰∏Ä‰∏™Â≠óÊØç';
                    const nextIndex = letters.indexOf(currentLetter) + 1;
                    correctAnswer = nextIndex < 26 ? letters[nextIndex] : 'Z';
                    options = generateLetterOptions(correctAnswer);
                    break;
                    
                case 'word':
                    // Â≠óÊØçÂØπÂ∫îÂçïËØç
                    questionElement.textContent = 'Ëøô‰∏™Â≠óÊØçÂºÄÂ§¥ÁöÑÂçïËØçÊòØÔºü';
                    pronunciationText.textContent = 'ÁÇπÂáªÊí≠ÊîæÂê¨Â≠óÊØçÂèëÈü≥';
                    referenceLetter.style.display = 'block';
                    referenceLetter.textContent = currentLetter;
                    hintElement.textContent = '‰∏äÈù¢ÊòæÁ§∫Â≠óÊØçÔºåÁÇπÂáªÊí≠ÊîæÂèëÈü≥ÔºåÁÑ∂Âêé‰ªé‰∏ãÈù¢ÈÄâÊã©‰ª•Ëøô‰∏™Â≠óÊØçÂºÄÂ§¥ÁöÑÂçïËØç';
                    correctAnswer = letterWords[currentLetter];
                    options = generateWordOptions(currentLetter);
                    break;
                    
                case 'case':
                    // Â§ßÂ∞èÂÜôËΩ¨Êç¢
                    const isUpper = Math.random() > 0.5;
                    questionElement.textContent = isUpper ? 'ÂØπÂ∫îÁöÑÂ∞èÂÜôÂ≠óÊØçÊòØÔºü' : 'ÂØπÂ∫îÁöÑÂ§ßÂÜôÂ≠óÊØçÊòØÔºü';
                    pronunciationText.textContent = 'ÁÇπÂáªÊí≠ÊîæÂê¨Â≠óÊØçÂèëÈü≥';
                    referenceLetter.style.display = 'block';
                    referenceLetter.textContent = isUpper ? currentLetter : currentLetter.toLowerCase();
                    hintElement.textContent = '‰∏äÈù¢ÊòæÁ§∫Â≠óÊØçÔºå‰ªé‰∏ãÈù¢ÈÄâÊã©ÂØπÂ∫îÁöÑÂ§ßÂ∞èÂÜôÂΩ¢Âºè';
                    correctAnswer = isUpper ? currentLetter.toLowerCase() : currentLetter.toUpperCase();
                    options = generateCaseOptions(currentLetter, isUpper);
                    break;
            }
            
            // ÁîüÊàêÈÄâÈ°πÊåâÈíÆ - Áªü‰∏ÄÊòæÁ§∫Âú®‰∏ãÊñπ
            options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn bg-white hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-300 rounded-2xl p-4 text-center font-bold transition-all duration-300 transform hover:scale-105 active:scale-95 shadow-lg';
                button.innerHTML = `<span class="text-lg">${option}</span>`;
                button.onclick = () => selectOption(option, correctAnswer, button);
                optionsContainer.appendChild(button);
            });
        }
        
        // ÁîüÊàêÂ≠óÊØçÈÄâÈ°π
        function generateLetterOptions(correct) {
            const options = [correct];
            const usedLetters = new Set([correct]);
            
            while (options.length < 4) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                if (!usedLetters.has(randomLetter)) {
                    options.push(randomLetter);
                    usedLetters.add(randomLetter);
                }
            }
            
            return shuffleArray(options);
        }
        
        // ÁîüÊàêÂèëÈü≥ÈÄâÈ°π
        function generateSoundOptions(correct) {
            const correctSound = letterSounds[correct];
            const options = [correctSound];
            const usedSounds = new Set([correctSound]);
            
            while (options.length < 4) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                const randomSound = letterSounds[randomLetter];
                if (!usedSounds.has(randomSound)) {
                    options.push(randomSound);
                    usedSounds.add(randomSound);
                }
            }
            
            return shuffleArray(options);
        }
        
        // ÁîüÊàêÂ≠óÊØçÈÄâÈ°π - Áî®‰∫énextÈ¢òÂûã
        function generateNextOptions(correct) {
            return generateLetterOptions(correct);
        }
        
        // ÁîüÊàêÂçïËØçÈÄâÈ°π
        function generateWordOptions(correct) {
            const correctWord = letterWords[correct];
            const options = [correctWord];
            const usedWords = new Set([correctWord]);
            
            while (options.length < 4) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                const randomWord = letterWords[randomLetter];
                if (!usedWords.has(randomWord)) {
                    options.push(randomWord);
                    usedWords.add(randomWord);
                }
            }
            
            return shuffleArray(options);
        }
        
        // ÁîüÊàêÂ§ßÂ∞èÂÜôÈÄâÈ°π
        function generateCaseOptions(correct, isTargetUpper) {
            const correctAnswer = isTargetUpper ? correct.toLowerCase() : correct.toUpperCase();
            const options = [correctAnswer];
            const usedOptions = new Set([correctAnswer, isTargetUpper ? correct : correct.toLowerCase()]);
            
            while (options.length < 4) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                const option = isTargetUpper ? randomLetter.toLowerCase() : randomLetter.toUpperCase();
                if (!usedOptions.has(option)) {
                    options.push(option);
                    usedOptions.add(option);
                }
            }
            
            return shuffleArray(options);
        }
        
        // Ê¥óÁâåÂáΩÊï∞
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // ÈÄâÊã©ÈÄâÈ°π
        function selectOption(selected, correct, button) {
            if (!gameRunning) return;
            
            totalAnswers++;
            button.classList.add('button-press');
            
            const isCorrect = selected === correct;
            
            if (isCorrect) {
                correctAnswers++;
                combo++;
                maxCombo = Math.max(maxCombo, combo);
                const points = 10 + combo * 2; // ËøûÂáªÂä†ÂàÜ
                score += points;
                
                // ËÆ∞ÂΩïÂ≠¶‰π†ËøõÂ∫¶
                learnedLetters.add(currentLetter);
                if (currentQuestionType === 'word') {
                    learnedWords.add(letterWords[currentLetter]);
                }
                
                button.classList.add('correct-animation');
                showFeedback(`Ê≠£Á°ÆÔºÅ+${points}ÂàÜ`, 'text-green-500');
                
                // ‰∏çËá™Âä®Êí≠ÊîæÂèçÈ¶àÈü≥
                
                setTimeout(() => {
                    nextQuestion();
                }, 1500);
            } else {
                combo = 0;
                button.classList.add('wrong-animation');
                showFeedback(`ÂÜçÊÉ≥ÊÉ≥ÔºÅÊ≠£Á°ÆÁ≠îÊ°àÊòØÔºö${correct}`, 'text-red-500');
                
                // ‰∏çËá™Âä®Êí≠ÊîæÔºåÁî®Êà∑ÂèØÊâãÂä®ÁÇπÂáªÊí≠ÊîæÊåâÈíÆ
                
                setTimeout(() => {
                    nextQuestion();
                }, 2500);
            }
            
            updateUI();
        }
        
        // ÊòæÁ§∫ÂèçÈ¶à
        function showFeedback(message, className) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `mb-4 text-center text-2xl font-bold h-16 flex items-center justify-center ${className}`;
            
            setTimeout(() => {
                feedback.textContent = '';
                feedback.className = 'mb-4 text-center text-3xl font-bold h-16 flex items-center justify-center';
            }, 1500);
        }
        
        // ÂÖ≥Âç°ÂÆåÊàê
        function levelComplete() {
            currentLevel++;
            currentQuestion = 0;
            
            if (currentLevel > 10) { // Ê∏∏ÊàèÁªìÊùü
                gameComplete();
                return;
            }
            
            showFeedback(`ÂÖ≥Âç° ${currentLevel - 1} ÂÆåÊàêÔºÅ`, 'text-purple-500 level-complete');
            
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }
        
        // Ê∏∏ÊàèÁªìÊùü
        function gameComplete() {
            gameRunning = false;
            clearInterval(timerInterval);
            
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            // Êõ¥Êñ∞ÁªìÊûúÁªüËÆ°
            const accuracy = totalAnswers > 0 ? Math.round((correctAnswers / totalAnswers) * 100) : 0;
            
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-level').textContent = currentLevel - 1;
            document.getElementById('final-accuracy').textContent = accuracy + '%';
            document.getElementById('max-combo').textContent = maxCombo;
            document.getElementById('letters-learned').textContent = learnedLetters.size;
            document.getElementById('words-learned').textContent = learnedWords.size;
            
            // ËÆ∞ÂΩïÂ≠¶‰π†ËøõÂ∫¶
            if (window.recordLearningProgress) {
                window.recordLearningProgress('english', 'letters', accuracy, 60);
            }
            
            // ÁîüÊàêÊàêÂ∞±
            generateAchievements();
        }
        
        // ÁîüÊàêÊàêÂ∞±ÂæΩÁ´†
        function generateAchievements() {
            const achievements = document.getElementById('achievements');
            achievements.innerHTML = '';
            
            const achievementList = [];
            
            if (score >= 500) achievementList.push({ icon: 'üèÜ', title: 'È´òÂàÜËææ‰∫∫', desc: 'Ëé∑Âæó500+ÂàÜÊï∞' });
            if (maxCombo >= 10) achievementList.push({ icon: 'üî•', title: 'ËøûÂáªÁéã', desc: 'ËøûÂáªËææÂà∞10Ê¨°' });
            if (learnedLetters.size >= 20) achievementList.push({ icon: 'üìö', title: 'Â≠óÊØçÂ§ßÂ∏à', desc: 'Â≠¶‰ºö20‰∏™Â≠óÊØç' });
            if (correctAnswers / totalAnswers >= 0.9) achievementList.push({ icon: 'üéØ', title: 'ÂÆåÁæé‰∏ª‰πâ', desc: 'Ê≠£Á°ÆÁéáË∂ÖËøá90%' });
            
            if (achievementList.length > 0) {
                const title = document.createElement('h3');
                title.className = 'text-lg font-bold mb-4 text-accent';
                title.innerHTML = 'üèÖ Ëé∑ÂæóÊàêÂ∞±';
                achievements.appendChild(title);
                
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-2 gap-4';
                
                achievementList.forEach(achievement => {
                    const badge = document.createElement('div');
                    badge.className = 'bg-yellow-100 border-2 border-yellow-300 rounded-lg p-4 text-center';
                    badge.innerHTML = `
                        <div class="text-2xl mb-1">${achievement.icon}</div>
                        <div class="font-bold text-sm">${achievement.title}</div>
                        <div class="text-xs text-gray-600">${achievement.desc}</div>
                    `;
                    grid.appendChild(badge);
                });
                
                achievements.appendChild(grid);
            }
        }
        
        // ÈáçÊñ∞ÂºÄÂßãÊ∏∏Êàè
        function restartGame() {
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            
            // ÈáçÁΩÆÈöæÂ∫¶ÈÄâÊã©
            currentDifficulty = null;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-primary');
            });
            const startBtn = document.getElementById('start-game-btn');
            startBtn.disabled = true;
            startBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
        
        // ËÆ°Êó∂Âô®
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                document.getElementById('countdown').textContent = `ÂÄíËÆ°Êó∂ ${timeLeft.toFixed(1)}`;
                
                if (timeLeft <= 0) {
                    combo = 0;
                    totalAnswers++;
                    showFeedback('Êó∂Èó¥Âà∞ÔºÅ', 'text-orange-500');
                    setTimeout(() => {
                        nextQuestion();
                    }, 1500);
                }
            }, 100);
        }
        
        // Êõ¥Êñ∞UI
        function updateUI() {
            document.getElementById('level-display').textContent = currentLevel;
            document.getElementById('combo-display').textContent = combo;
            document.getElementById('score-display').textContent = score;
            document.getElementById('progress-text').textContent = `Á¨¨${currentLevel}ÂÖ≥`;
            document.getElementById('progress-percentage').textContent = `${currentQuestion}/${questionsPerLevel}`;
            
            const progressPercent = (currentQuestion / questionsPerLevel) * 100;
            document.getElementById('progress-bar').style.width = progressPercent + '%';
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Â≠óÊØçËÆ§Áü•Ê∏∏ÊàèÂàùÂßãÂåñÂÆåÊàê');
            initSpeechSynthesis();
            
            // ÂÄíËÆ°Êó∂ÂºÄÂÖ≥ÈÄªËæë
            document.getElementById('timer-toggle').addEventListener('change', function() {
                // ÈªòËÆ§Â∑≤ÂºÄÂêØÂÄíËÆ°Êó∂ÔºåÊó†ÈúÄÈ¢ùÂ§ñÊñáÂ≠óÂàáÊç¢
                console.log('ÂÄíËÆ°Êó∂Ê®°Âºè:', this.checked ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠');
            });
        });
    </script>
</body>
</html>