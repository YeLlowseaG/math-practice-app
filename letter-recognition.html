<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å­—æ¯è®¤çŸ¥ - ABCå­¦ä¹ æ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        neutral: '#F7FFF7',
                        text: '#1F2937'
                    },
                    fontFamily: {
                        kids: ['"Comic Sans MS"', '"Marker Felt"', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .bounce-light {
                animation: bounce-light 0.5s ease infinite alternate;
            }
            .pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .scale-hover {
                transition: transform 0.2s;
            }
            .scale-hover:hover {
                transform: scale(1.05);
            }
            .correct-animation {
                animation: correct 0.6s ease-in-out;
            }
            .wrong-animation {
                animation: wrong 0.6s ease-in-out;
            }
            .level-complete {
                animation: levelComplete 1s ease-in-out;
            }
            @keyframes bounce-light {
                from { transform: translateY(0); }
                to { transform: translateY(-5px); }
            }
            @keyframes correct {
                0% { transform: scale(1); background-color: #10B981; }
                50% { transform: scale(1.1); background-color: #34D399; }
                100% { transform: scale(1); background-color: #10B981; }
            }
            @keyframes wrong {
                0% { transform: translateX(0); background-color: #EF4444; }
                25% { transform: translateX(-5px); background-color: #F87171; }
                75% { transform: translateX(5px); background-color: #F87171; }
                100% { transform: translateX(0); background-color: #EF4444; }
            }
            @keyframes levelComplete {
                0% { transform: scale(1) rotate(0deg); }
                25% { transform: scale(1.2) rotate(5deg); }
                75% { transform: scale(1.2) rotate(-5deg); }
                100% { transform: scale(1) rotate(0deg); }
            }
            @keyframes button-press {
                0% { transform: scale(1); }
                50% { transform: scale(0.95); }
                100% { transform: scale(1); }
            }
            
            .button-press {
                animation: button-press 0.2s ease-in-out;
            }
            
            /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
            @media (max-width: 768px) {
                .option-btn {
                    min-height: 64px;
                    font-size: 1.1rem;
                    padding: 16px 12px;
                }
                .float-animation {
                    animation: none;
                }
            }
            
            @media (max-width: 480px) {
                .option-btn {
                    min-height: 60px;
                    font-size: 1rem;
                    padding: 12px 8px;
                }
                .main-content {
                    padding: 1rem;
                }
                .game-card {
                    padding: 1.5rem;
                }
                #target-letter {
                    font-size: clamp(4rem, 15vw, 8rem) !important;
                }
                .text-xl {
                    font-size: 1rem;
                }
                .text-2xl {
                    font-size: 1.25rem;
                }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen font-kids text-text overflow-hidden">
    
    <!-- å¼€å§‹ç•Œé¢ -->
    <div id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-8 relative">
        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <button onclick="window.location.href='index.html'" class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800 z-40">
            <i class="fa fa-home mr-2"></i>é¦–é¡µ
        </button>
        <div class="text-center w-full max-w-lg mx-auto bg-white rounded-3xl shadow-2xl p-6 transform transition-all duration-500">
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary mb-3">å­—æ¯è®¤çŸ¥</h1>
            <p class="text-base mb-4 text-gray-600">å­¦ä¹ ABCå­—æ¯<br>å¬å‘éŸ³é€‰å­—æ¯ï¼</p>
            
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white text-3xl shadow-lg relative overflow-hidden float-animation">
                    <i class="fa fa-font"></i>
                    <div class="absolute inset-0 bg-white opacity-20 rounded-full animate-ping"></div>
                </div>
            </div>
            
            <!-- éš¾åº¦é€‰æ‹© -->
            <div class="mb-5">
                <h3 class="text-base font-bold mb-3">é€‰æ‹©éš¾åº¦</h3>
                <div class="grid grid-cols-1 gap-3">
                    <button onclick="selectDifficulty('easy')" 
                            class="difficulty-btn bg-secondary/10 border-2 border-secondary/20 hover:border-secondary/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">ğŸŒŸ</div>
                                <div>
                                    <h4 class="font-bold text-secondary text-left">ç®€å•</h4>
                                    <p class="text-xs text-gray-600 text-left">A-H å­—æ¯</p>
                                </div>
                            </div>
                            <div class="text-sm text-secondary">8ä¸ª</div>
                        </div>
                    </button>
                    <button onclick="selectDifficulty('medium')" 
                            class="difficulty-btn bg-accent/10 border-2 border-accent/20 hover:border-accent/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">â­â­</div>
                                <div>
                                    <h4 class="font-bold text-accent text-left">ä¸­ç­‰</h4>
                                    <p class="text-xs text-gray-600 text-left">A-P å­—æ¯</p>
                                </div>
                            </div>
                            <div class="text-sm text-accent">16ä¸ª</div>
                        </div>
                    </button>
                    <button onclick="selectDifficulty('hard')" 
                            class="difficulty-btn bg-danger/10 border-2 border-danger/20 hover:border-danger/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">â­â­â­</div>
                                <div>
                                    <h4 class="font-bold text-danger text-left">å›°éš¾</h4>
                                    <p class="text-xs text-gray-600 text-left">A-Z å…¨éƒ¨</p>
                                </div>
                            </div>
                            <div class="text-sm text-danger">26ä¸ª</div>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- å€’è®¡æ—¶å¼€å…³ -->
            <div class="mb-5 flex items-center justify-center gap-4 bg-gray-50 rounded-2xl p-3">
                <i class="fa fa-clock-o text-gray-600"></i>
                <span class="text-gray-700 font-medium">å€’è®¡æ—¶æ¨¡å¼</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="timer-toggle" class="sr-only peer" checked>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
                <span class="text-xs text-gray-500">15ç§’ç­”é¢˜</span>
            </div>

            <!-- å¾½ç« é¢„è§ˆ -->
            <div id="badge-preview" class="mb-5">
                <h3 class="text-sm font-bold mb-2">æˆ‘çš„å¾½ç« </h3>
                <div id="badge-preview-grid" class="flex justify-center gap-3 flex-wrap"></div>
                <div class="text-xs text-gray-400 mt-1">æœ¬æ¸¸æˆå¾½ç« é¢„è§ˆï¼ˆå·²è·é«˜äº®ï¼Œæœªè·ç°æ˜¾ï¼‰</div>
            </div>
            
            <!-- æ¸¸æˆè¯´æ˜ -->
            <div class="mb-5">
                <div class="bg-gradient-to-r from-primary/5 to-secondary/5 rounded-xl p-4 text-sm">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="flex items-center">
                            <span class="text-lg mr-2">ğŸ”Š</span>
                            <span class="text-gray-700">å¬å‘éŸ³</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">ğŸ‘†</span>
                            <span class="text-gray-700">ç‚¹å‡»é€‰æ‹©</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">ğŸ¯</span>
                            <span class="text-gray-700">é€‰å¯¹å­—æ¯</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">ğŸ†</span>
                            <span class="text-gray-700">é—¯å…³æŒ‘æˆ˜</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å¼€å§‹æ¸¸æˆæŒ‰é’® -->
            <button id="start-game-btn" onclick="startGame()" disabled
                    class="w-full bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white font-bold py-3 px-6 rounded-2xl shadow-lg transform transition-all duration-300 scale-hover disabled:opacity-50 disabled:cursor-not-allowed">
                å¼€å§‹å­¦ä¹  <i class="fa fa-play ml-2"></i>
            </button>
        </div>
        
        <!-- è£…é¥°å…ƒç´  -->
        <div class="absolute top-10 left-10 text-5xl text-primary/30">
            <i class="fa fa-star bounce-light"></i>
        </div>
        <div class="absolute bottom-10 right-10 text-5xl text-secondary/30">
            <i class="fa fa-heart bounce-light" style="animation-delay: 0.3s"></i>
        </div>
        <div class="absolute top-1/4 right-20 text-4xl text-accent/30">
            <i class="fa fa-trophy bounce-light" style="animation-delay: 0.6s"></i>
        </div>
    </div>

    <script>
    (function(){
      const GAME_KEY = 'letters';
      const badgeDefs = [
        { id: 'first_correct', name: 'é¦–é¢˜æ­£ç¡®', icon: 'ğŸ¯' },
        { id: 'combo_5', name: 'è¿å‡»è¾¾äºº', icon: 'ğŸ”¥' },
        { id: 'speed_round', name: 'æé€Ÿç­”é¢˜', icon: 'âš¡' },
        { id: 'level_reach', name: 'é—¯å…³èƒ½æ‰‹', icon: 'ğŸ†' },
        { id: 'perfect_round', name: 'å®Œç¾å›åˆ', icon: 'ğŸ’' }
      ];
      function getEarnedIds(){
        try { return JSON.parse(localStorage.getItem('earnedAchievements_' + GAME_KEY) || '[]'); } catch(_) { return []; }
      }
      function renderBadgePreview(){
        const grid = document.getElementById('badge-preview-grid');
        if(!grid) return;
        const owned = new Set(getEarnedIds());
        grid.innerHTML = badgeDefs.map(a => {
          const earned = owned.has(a.id);
          const base = earned ? 'from-yellow-100 to-orange-100 border-yellow-300 text-amber-900' : 'from-gray-50 to-gray-100 border-gray-200 text-gray-400 opacity-80';
          return `
            <div class=\"relative w-20 h-20 rounded-2xl border-2 bg-gradient-to-br ${base} shadow-sm flex flex-col items-center justify-center overflow-hidden\" title=\"${a.name}\">\n              <div class=\"text-2xl mb-1\">${a.icon}</div>\n              <div class=\"text-[10px] font-bold text-center leading-tight px-1\">${a.name}</div>\n              ${earned ? '<div class=\\"absolute -right-1 -top-1 bg-amber-400 text-white text-[10px] px-1 rounded-full shadow\\">å·²è·</div>' : ''}\n            </div>`;
        }).join('');
      }
      document.addEventListener('DOMContentLoaded', renderBadgePreview);
    })();
    </script>

    <!-- æ¸¸æˆç•Œé¢ -->
    <div id="game-screen" class="hidden h-screen flex flex-col">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div class="flex justify-between items-center p-3 bg-white/80 backdrop-blur-sm shadow-md">
            <!-- å·¦ä¾§ä¿¡æ¯ -->
            <div class="flex items-center gap-3">
                <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
                <button onclick="window.location.href='index.html'" class="bg-white/90 backdrop-blur-sm px-3 py-2 rounded-full shadow-md transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800">
                    <i class="fa fa-home mr-1"></i><span class="hidden sm:inline">é¦–é¡µ</span>
                </button>
                <div class="bg-primary px-4 py-2 rounded-full text-white font-bold shadow-md">
                    <span>å…³å¡ </span><span id="level-display">1</span>
                </div>
                <div class="bg-secondary px-4 py-2 rounded-full text-white font-bold shadow-md">
                    <span>è¿å‡» </span><span id="combo-display">0</span>
                </div>
            </div>
            
            <!-- ä¸­é—´è®¡æ—¶å™¨ -->
            <div id="timer" class="bg-accent text-white px-6 py-3 rounded-full shadow-md">
                <i class="fa fa-clock-o mr-2"></i>
                <span id="countdown" class="text-xl font-bold">å€’è®¡æ—¶ 15.0</span>
            </div>
            
            <!-- å³ä¾§åˆ†æ•° -->
            <div class="bg-gradient-to-r from-purple-500 to-pink-500 px-4 py-2 rounded-full text-white font-bold shadow-md">
                <i class="fa fa-star mr-2"></i>
                <span id="score-display">0</span>
            </div>
        </div>
        
        <!-- å…³å¡è¿›åº¦æ¡ -->
        <div class="bg-gray-100 border-b border-gray-200">
            <div class="px-4 py-2">
                <div class="flex items-center justify-between mb-2">
                    <span id="progress-text" class="text-sm font-medium text-gray-600">ç¬¬1å…³</span>
                    <span id="progress-percentage" class="text-sm font-medium text-gray-600">0/10</span>
                </div>
                <div class="bg-gray-200 h-3 rounded-full overflow-hidden">
                    <div id="progress-bar" class="bg-gradient-to-r from-primary to-secondary h-full transition-all duration-500 ease-out"></div>
                </div>
            </div>
        </div>
        
        <!-- ä¸»è¦æ¸¸æˆåŒºåŸŸ -->
        <div class="flex-1 flex flex-col items-center p-6">
            <!-- åé¦ˆä¿¡æ¯ - ç§»åˆ°é¡¶éƒ¨ -->
            <div id="feedback" class="mb-4 text-center text-3xl font-bold h-16 flex items-center justify-center">
                <!-- åé¦ˆä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
            </div>
            
            <!-- ç›®æ ‡æ˜¾ç¤º -->
            <div class="bg-white rounded-3xl shadow-2xl p-8 text-center mb-6 transform transition-all duration-500">
                <p class="text-gray-500 text-lg mb-4" id="question-type">å¬å‘éŸ³é€‰æ‹©å­—æ¯</p>
                
                <!-- å‘éŸ³åŒºåŸŸ - ç»Ÿä¸€æ˜¾ç¤ºåœ¨ä¸Šæ–¹ -->
                <div id="pronunciation-area" class="mb-6">
                    <div class="flex items-center justify-center mb-4">
                        <div class="text-6xl text-blue-500 mr-4">ğŸ”Š</div>
                        <button onclick="playCurrentLetterSound()" class="bg-blue-500 hover:bg-blue-600 text-white rounded-2xl px-6 py-4 shadow-lg transition-all duration-300 hover:scale-105">
                            <i class="fa fa-volume-up text-xl mr-2"></i>
                            <span class="font-bold">æ’­æ”¾å‘éŸ³</span>
                        </button>
                    </div>
                    <div class="text-center">
                        <p class="text-gray-400 text-lg" id="pronunciation-text">/ei/</p>
                        <p class="text-[clamp(2rem,6vw,4rem)] font-bold text-text mt-2" id="reference-letter">A</p>
                    </div>
                </div>
                
                <p class="text-gray-400 text-sm mt-2" id="target-hint">ç‚¹å‡»æ’­æ”¾å‘éŸ³ï¼Œé€‰æ‹©å¯¹åº”çš„å­—æ¯</p>
            </div>
            
            <!-- é€‰é¡¹åŒºåŸŸ -->
            <div id="options-container" class="grid grid-cols-2 gap-4 max-w-xl w-full mt-auto mb-4">
                <!-- é€‰é¡¹ä¼šåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- ç»“æœç•Œé¢ -->
    <div id="result-screen" class="hidden flex flex-col items-center justify-center h-screen p-6 bg-white/90 backdrop-blur-md">
        <div class="text-center max-w-lg mx-auto">
            <div id="result-icon" class="text-8xl mb-6">ğŸ‰</div>
            <h2 id="result-title" class="text-[clamp(2rem,5vw,3rem)] font-bold mb-6">æ­å–œå®Œæˆï¼</h2>
            
            <div class="bg-neutral rounded-2xl shadow-lg p-8 mb-8">
                <div class="grid grid-cols-2 gap-6">
                    <div class="text-center">
                        <div class="text-primary text-3xl font-bold" id="final-score">0</div>
                        <div class="text-gray-600">æ€»åˆ†æ•°</div>
                    </div>
                    <div class="text-center">
                        <div class="text-secondary text-3xl font-bold" id="final-level">1</div>
                        <div class="text-gray-600">åˆ°è¾¾å…³å¡</div>
                    </div>
                    <div class="text-center">
                        <div class="text-accent text-3xl font-bold" id="final-accuracy">0%</div>
                        <div class="text-gray-600">å‡†ç¡®ç‡</div>
                    </div>
                    <div class="text-center">
                        <div class="text-purple-500 text-3xl font-bold" id="max-combo">0</div>
                        <div class="text-gray-600">æœ€é«˜è¿å‡»</div>
                    </div>
                </div>
            </div>
            
            <!-- æˆå°±æ˜¾ç¤º -->
            <div id="achievements" class="mb-8">
                <!-- æˆå°±å¾½ç« ä¼šåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- å­¦ä¹ ç»Ÿè®¡ -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
                <h3 class="text-lg font-bold mb-4 text-primary">ğŸ¯ å­¦ä¹ æˆæœ</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="text-center">
                        <div class="text-green-600 text-2xl font-bold" id="letters-learned">0</div>
                        <div class="text-sm text-gray-600">å·²æŒæ¡å­—æ¯</div>
                    </div>
                    <div class="text-center">
                        <div class="text-blue-600 text-2xl font-bold" id="words-learned">0</div>
                        <div class="text-sm text-gray-600">å­¦ä¼šå•è¯</div>
                    </div>
                </div>
            </div>
            
            <div class="flex gap-4">
                <button onclick="restartGame()" class="bg-gradient-to-r from-primary to-secondary text-white font-bold py-3 px-6 rounded-2xl shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-refresh mr-2"></i>å†æ¥ä¸€æ¬¡
                </button>
                <button onclick="window.location.href='index.html'" class="bg-gradient-to-r from-gray-500 to-gray-600 text-white font-bold py-3 px-6 rounded-2xl shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-home mr-2"></i>è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
        const letterSounds = {
            'A': 'ei', 'B': 'bi:', 'C': 'si:', 'D': 'di:', 'E': 'i:', 'F': 'ef',
            'G': 'dÊ’i:', 'H': 'eitÊƒ', 'I': 'ai', 'J': 'dÊ’ei', 'K': 'kei', 'L': 'el',
            'M': 'em', 'N': 'en', 'O': 'É™u', 'P': 'pi:', 'Q': 'kju:', 'R': 'a:(r)',
            'S': 'es', 'T': 'ti:', 'U': 'ju:', 'V': 'vi:', 'W': 'dÊŒblju:', 'X': 'eks',
            'Y': 'wai', 'Z': 'zi:'
        };
        
        // è¯­éŸ³åˆæˆç®¡ç†å™¨
        let voices = [];
        let englishVoice = null;
        const letterWords = {
            'A': 'Apple', 'B': 'Ball', 'C': 'Cat', 'D': 'Dog', 'E': 'Egg', 'F': 'Fish',
            'G': 'Goat', 'H': 'Hat', 'I': 'Ice', 'J': 'Jump', 'K': 'Key', 'L': 'Lion',
            'M': 'Moon', 'N': 'Net', 'O': 'Orange', 'P': 'Pen', 'Q': 'Queen', 'R': 'Red',
            'S': 'Sun', 'T': 'Tree', 'U': 'Up', 'V': 'Van', 'W': 'Water', 'X': 'Box',
            'Y': 'Yellow', 'Z': 'Zoo'
        };
        const letterWordsChinese = {
            'A': 'è‹¹æœ', 'B': 'çƒ', 'C': 'çŒ«', 'D': 'ç‹—', 'E': 'é¸¡è›‹', 'F': 'é±¼',
            'G': 'å±±ç¾Š', 'H': 'å¸½å­', 'I': 'å†°', 'J': 'è·³', 'K': 'é’¥åŒ™', 'L': 'ç‹®å­',
            'M': 'æœˆäº®', 'N': 'ç½‘', 'O': 'æ©™å­', 'P': 'ç¬”', 'Q': 'å¥³ç‹', 'R': 'çº¢è‰²',
            'S': 'å¤ªé˜³', 'T': 'æ ‘', 'U': 'å‘ä¸Š', 'V': 'è´§è½¦', 'W': 'æ°´', 'X': 'ç›’å­',
            'Y': 'é»„è‰²', 'Z': 'åŠ¨ç‰©å›­'
        };
        
        let currentDifficulty = null;
        let currentLevel = 1;
        let currentQuestion = 0;
        let questionsPerLevel = 10;
        let score = 0;
        let combo = 0;
        let maxCombo = 0;
        let correctAnswers = 0;
        let totalAnswers = 0;
        let timeLeft = 15;
        let timerInterval = null;
        let currentLetter = '';
        let currentQuestionType = 'sound'; // å›ºå®šä¸ºå¬å‘éŸ³é€‰å­—æ¯
        let gameRunning = false;
        
        // å­¦ä¹ ç»Ÿè®¡
        let learnedLetters = new Set();
        let learnedWords = new Set();
        
        // é—®é¢˜ç±»å‹
        const questionTypes = [
            'sound',     // å¬å‘éŸ³é€‰å­—æ¯ï¼ˆä¸»è¦é¢˜å‹ï¼‰
            'identify',  // çœ‹å­—æ¯é€‰å­—æ¯åç§°
            'next',      // ä¸‹ä¸€ä¸ªå­—æ¯
            'word',      // å­—æ¯å¯¹åº”å•è¯
            'case'       // å¤§å°å†™è½¬æ¢
        ];
        
        // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
        function initSpeechSynthesis() {
            if ('speechSynthesis' in window) {
                const loadVoices = () => {
                    voices = speechSynthesis.getVoices();
                    englishVoice = voices.find(voice => 
                        voice.lang.includes('en') && 
                        (voice.name.includes('English') || voice.lang === 'en-US')
                    ) || voices[0];
                    console.log('é€‰æ‹©è‹±è¯­è¯­éŸ³:', englishVoice?.name);
                };

                if (voices.length === 0) {
                    speechSynthesis.onvoiceschanged = loadVoices;
                } else {
                    loadVoices();
                }
            }
        }

        // æ’­æ”¾è‹±æ–‡å‘éŸ³
        function speakLetter(text, rate = 0.8) {
            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                speechSynthesis.speak(utterance);
            }, 100);
        }
        
        // æ’­æ”¾å½“å‰é¢˜ç›®çš„å‘éŸ³
        function playCurrentLetterSound() {
            if (currentLetter) {
                if (currentQuestionType === 'sound') {
                    // å¬å‘éŸ³é¢˜å‹ï¼šæ’­æ”¾å­—æ¯å‘éŸ³
                    speakLetter(currentLetter);
                } else if (currentQuestionType === 'word') {
                    // å•è¯é¢˜å‹ï¼šæ’­æ”¾å•è¯å‘éŸ³
                    speakLetter(letterWords[currentLetter]);
                } else {
                    // å…¶ä»–é¢˜å‹ï¼šæ’­æ”¾å­—æ¯å‘éŸ³
                    speakLetter(currentLetter);
                }
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        // é€‰æ‹©éš¾åº¦
        function selectDifficulty(difficulty) {
            currentDifficulty = difficulty;
            
            // é‡ç½®æ‰€æœ‰æŒ‰é’®æ ·å¼
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-primary');
            });
            
            // é«˜äº®é€‰ä¸­çš„æŒ‰é’®
            event.target.closest('.difficulty-btn').classList.add('ring-4', 'ring-primary');
            
            // å¯ç”¨å¼€å§‹æŒ‰é’®
            const startBtn = document.getElementById('start-game-btn');
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
        
        function startGame() {
            if (!currentDifficulty) {
                alert('è¯·å…ˆé€‰æ‹©éš¾åº¦ï¼');
                return;
            }
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            currentLevel = 1;
            currentQuestion = 0;
            score = 0;
            combo = 0;
            maxCombo = 0;
            correctAnswers = 0;
            totalAnswers = 0;
            learnedLetters.clear();
            learnedWords.clear();
            gameRunning = true;
            
            // åˆå§‹åŒ–è¯­éŸ³
            initSpeechSynthesis();
            
            updateUI();
            nextQuestion();
            startTimer();
        }
        
        // ç”Ÿæˆä¸‹ä¸€ä¸ªé—®é¢˜
        function nextQuestion() {
            if (!gameRunning) return;
            
            if (currentQuestion >= questionsPerLevel) {
                levelComplete();
                return;
            }
            
            currentQuestion++;
            timeLeft = Math.max(10, 18 - currentLevel); // éšå…³å¡å¢åŠ éš¾åº¦ï¼Œç¼©çŸ­æ—¶é—´
            
            // åªæœ‰ä¸€ç§é¢˜å‹ï¼šå¬å‘éŸ³é€‰å­—æ¯
            currentQuestionType = 'sound';
            
            // æ ¹æ®éš¾åº¦é€‰æ‹©å­—æ¯èŒƒå›´
            let letterRange;
            switch (currentDifficulty) {
                case 'easy':
                    letterRange = 8;  // A-H
                    break;
                case 'medium':
                    letterRange = 16; // A-P
                    break;
                case 'hard':
                default:
                    letterRange = 26; // A-Z
                    break;
            }
            
            const letterIndex = Math.floor(Math.random() * letterRange);
            currentLetter = letters[letterIndex];
            
            generateQuestion();
            updateUI();
            
            // ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾æŒ‰é’®
        }
        
        // ç”Ÿæˆé—®é¢˜å’Œé€‰é¡¹
        function generateQuestion() {
            const questionElement = document.getElementById('question-type');
            const hintElement = document.getElementById('target-hint');
            const pronunciationText = document.getElementById('pronunciation-text');
            const referenceLetter = document.getElementById('reference-letter');
            const optionsContainer = document.getElementById('options-container');
            
            optionsContainer.innerHTML = '';
            
            let correctAnswer = '';
            let options = [];
            
            // ç»Ÿä¸€å¸ƒå±€ï¼šä¸Šé¢å§‹ç»ˆæ˜¾ç¤ºå‘éŸ³åŒºåŸŸï¼Œä¸‹é¢æ˜¾ç¤ºå­—æ¯é€‰é¡¹
            switch (currentQuestionType) {
                case 'sound':
                    // å¬å‘éŸ³é€‰å­—æ¯ - ä¸»è¦é¢˜å‹
                    questionElement.textContent = 'å¬å‘éŸ³ï¼Œé€‰æ‹©å¯¹åº”çš„å­—æ¯';
                    pronunciationText.textContent = letterSounds[currentLetter];
                    referenceLetter.style.display = 'none';  // éšè—å‚è€ƒå­—æ¯
                    hintElement.textContent = 'ç‚¹å‡»æ’­æ”¾å‘éŸ³ï¼Œç„¶åä»ä¸‹é¢é€‰æ‹©å¯¹åº”çš„å­—æ¯';
                    correctAnswer = currentLetter;
                    options = generateLetterOptions(currentLetter);
                    break;
                    
                case 'identify':
                    // çœ‹å­—æ¯é€‰å­—æ¯åç§°
                    questionElement.textContent = 'è¿™ä¸ªå­—æ¯å«ä»€ä¹ˆï¼Ÿ';
                    pronunciationText.textContent = 'ç‚¹å‡»æ’­æ”¾å¬å­—æ¯åç§°';
                    referenceLetter.style.display = 'block';
                    referenceLetter.textContent = currentLetter;
                    hintElement.textContent = 'ä¸Šé¢æ˜¾ç¤ºå­—æ¯ï¼Œç‚¹å‡»æ’­æ”¾å¬å‘éŸ³ï¼Œç„¶åä»ä¸‹é¢é€‰æ‹©æ­£ç¡®çš„å­—æ¯åç§°';
                    correctAnswer = letterSounds[currentLetter];
                    options = generateSoundOptions(currentLetter);
                    break;
                    
                case 'next':
                    // ä¸‹ä¸€ä¸ªå­—æ¯
                    questionElement.textContent = 'ä¸‹ä¸€ä¸ªå­—æ¯æ˜¯ä»€ä¹ˆï¼Ÿ';
                    pronunciationText.textContent = 'ç‚¹å‡»æ’­æ”¾å¬å½“å‰å­—æ¯';
                    referenceLetter.style.display = 'block';
                    referenceLetter.textContent = currentLetter;
                    hintElement.textContent = 'ä¸Šé¢æ˜¾ç¤ºå½“å‰å­—æ¯ï¼ŒæŒ‰å­—æ¯è¡¨é¡ºåºä»ä¸‹é¢é€‰æ‹©ä¸‹ä¸€ä¸ªå­—æ¯';
                    const nextIndex = letters.indexOf(currentLetter) + 1;
                    correctAnswer = nextIndex < 26 ? letters[nextIndex] : 'Z';
                    options = generateLetterOptions(correctAnswer);
                    break;
                    
                case 'word':
                    // å­—æ¯å¯¹åº”å•è¯
                    questionElement.textContent = 'è¿™ä¸ªå­—æ¯å¼€å¤´çš„å•è¯æ˜¯ï¼Ÿ';
                    pronunciationText.textContent = 'ç‚¹å‡»æ’­æ”¾å¬å­—æ¯å‘éŸ³';
                    referenceLetter.style.display = 'block';
                    referenceLetter.textContent = currentLetter;
                    hintElement.textContent = 'ä¸Šé¢æ˜¾ç¤ºå­—æ¯ï¼Œç‚¹å‡»æ’­æ”¾å‘éŸ³ï¼Œç„¶åä»ä¸‹é¢é€‰æ‹©ä»¥è¿™ä¸ªå­—æ¯å¼€å¤´çš„å•è¯';
                    correctAnswer = letterWords[currentLetter];
                    options = generateWordOptions(currentLetter);
                    break;
                    
                case 'case':
                    // å¤§å°å†™è½¬æ¢
                    const isUpper = Math.random() > 0.5;
                    questionElement.textContent = isUpper ? 'å¯¹åº”çš„å°å†™å­—æ¯æ˜¯ï¼Ÿ' : 'å¯¹åº”çš„å¤§å†™å­—æ¯æ˜¯ï¼Ÿ';
                    pronunciationText.textContent = 'ç‚¹å‡»æ’­æ”¾å¬å­—æ¯å‘éŸ³';
                    referenceLetter.style.display = 'block';
                    referenceLetter.textContent = isUpper ? currentLetter : currentLetter.toLowerCase();
                    hintElement.textContent = 'ä¸Šé¢æ˜¾ç¤ºå­—æ¯ï¼Œä»ä¸‹é¢é€‰æ‹©å¯¹åº”çš„å¤§å°å†™å½¢å¼';
                    correctAnswer = isUpper ? currentLetter.toLowerCase() : currentLetter.toUpperCase();
                    options = generateCaseOptions(currentLetter, isUpper);
                    break;
            }
            
            // ç”Ÿæˆé€‰é¡¹æŒ‰é’® - ç»Ÿä¸€æ˜¾ç¤ºåœ¨ä¸‹æ–¹
            options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn bg-white hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-300 rounded-2xl p-4 text-center font-bold transition-all duration-300 transform hover:scale-105 active:scale-95 shadow-lg';
                button.innerHTML = `<span class="text-lg">${option}</span>`;
                button.onclick = () => selectOption(option, correctAnswer, button);
                optionsContainer.appendChild(button);
            });
        }
        
        // ç”Ÿæˆå­—æ¯é€‰é¡¹
        function generateLetterOptions(correct) {
            const options = [correct];
            const usedLetters = new Set([correct]);
            
            while (options.length < 4) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                if (!usedLetters.has(randomLetter)) {
                    options.push(randomLetter);
                    usedLetters.add(randomLetter);
                }
            }
            
            return shuffleArray(options);
        }
        
        // ç”Ÿæˆå‘éŸ³é€‰é¡¹
        function generateSoundOptions(correct) {
            const correctSound = letterSounds[correct];
            const options = [correctSound];
            const usedSounds = new Set([correctSound]);
            
            while (options.length < 4) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                const randomSound = letterSounds[randomLetter];
                if (!usedSounds.has(randomSound)) {
                    options.push(randomSound);
                    usedSounds.add(randomSound);
                }
            }
            
            return shuffleArray(options);
        }
        
        // ç”Ÿæˆå­—æ¯é€‰é¡¹ - ç”¨äºnexté¢˜å‹
        function generateNextOptions(correct) {
            return generateLetterOptions(correct);
        }
        
        // ç”Ÿæˆå•è¯é€‰é¡¹
        function generateWordOptions(correct) {
            const correctWord = letterWords[correct];
            const options = [correctWord];
            const usedWords = new Set([correctWord]);
            
            while (options.length < 4) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                const randomWord = letterWords[randomLetter];
                if (!usedWords.has(randomWord)) {
                    options.push(randomWord);
                    usedWords.add(randomWord);
                }
            }
            
            return shuffleArray(options);
        }
        
        // ç”Ÿæˆå¤§å°å†™é€‰é¡¹
        function generateCaseOptions(correct, isTargetUpper) {
            const correctAnswer = isTargetUpper ? correct.toLowerCase() : correct.toUpperCase();
            const options = [correctAnswer];
            const usedOptions = new Set([correctAnswer, isTargetUpper ? correct : correct.toLowerCase()]);
            
            while (options.length < 4) {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                const option = isTargetUpper ? randomLetter.toLowerCase() : randomLetter.toUpperCase();
                if (!usedOptions.has(option)) {
                    options.push(option);
                    usedOptions.add(option);
                }
            }
            
            return shuffleArray(options);
        }
        
        // æ´—ç‰Œå‡½æ•°
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // é€‰æ‹©é€‰é¡¹
        function selectOption(selected, correct, button) {
            if (!gameRunning) return;
            
            totalAnswers++;
            button.classList.add('button-press');
            
            const isCorrect = selected === correct;
            
            if (isCorrect) {
                correctAnswers++;
                combo++;
                maxCombo = Math.max(maxCombo, combo);
                const points = 10 + combo * 2; // è¿å‡»åŠ åˆ†
                score += points;
                
                // è®°å½•å­¦ä¹ è¿›åº¦
                learnedLetters.add(currentLetter);
                if (currentQuestionType === 'word') {
                    learnedWords.add(letterWords[currentLetter]);
                }
                
                button.classList.add('correct-animation');
                showFeedback(`æ­£ç¡®ï¼+${points}åˆ†`, 'text-green-500');
                
                // ä¸è‡ªåŠ¨æ’­æ”¾åé¦ˆéŸ³
                
                setTimeout(() => {
                    nextQuestion();
                }, 1500);
            } else {
                combo = 0;
                button.classList.add('wrong-animation');
                showFeedback(`å†æƒ³æƒ³ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correct}`, 'text-red-500');
                
                // ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œç”¨æˆ·å¯æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾æŒ‰é’®
                
                setTimeout(() => {
                    nextQuestion();
                }, 2500);
            }
            
            updateUI();
        }
        
        // æ˜¾ç¤ºåé¦ˆ
        function showFeedback(message, className) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `mb-4 text-center text-2xl font-bold h-16 flex items-center justify-center ${className}`;
            
            setTimeout(() => {
                feedback.textContent = '';
                feedback.className = 'mb-4 text-center text-3xl font-bold h-16 flex items-center justify-center';
            }, 1500);
        }
        
        // å…³å¡å®Œæˆ
        function levelComplete() {
            currentLevel++;
            currentQuestion = 0;
            
            if (currentLevel > 10) { // æ¸¸æˆç»“æŸ
                gameComplete();
                return;
            }
            
            showFeedback(`å…³å¡ ${currentLevel - 1} å®Œæˆï¼`, 'text-purple-500 level-complete');
            
            setTimeout(() => {
                nextQuestion();
            }, 2000);
        }
        
        // æ¸¸æˆç»“æŸ
        function gameComplete() {
            gameRunning = false;
            clearInterval(timerInterval);
            
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            // æ›´æ–°ç»“æœç»Ÿè®¡
            const accuracy = totalAnswers > 0 ? Math.round((correctAnswers / totalAnswers) * 100) : 0;
            
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-level').textContent = currentLevel - 1;
            document.getElementById('final-accuracy').textContent = accuracy + '%';
            document.getElementById('max-combo').textContent = maxCombo;
            document.getElementById('letters-learned').textContent = learnedLetters.size;
            document.getElementById('words-learned').textContent = learnedWords.size;
            
            // è®°å½•å­¦ä¹ è¿›åº¦
            if (window.recordLearningProgress) {
                window.recordLearningProgress('english', 'letters', accuracy, 60);
            }
            
            // ç”Ÿæˆæˆå°±
            generateAchievements();
        }
        
        // ç”Ÿæˆæˆå°±å¾½ç« 
        function generateAchievements() {
            const achievements = document.getElementById('achievements');
            achievements.innerHTML = '';
            
            const achievementList = [];
            
            if (score >= 500) achievementList.push({ icon: 'ğŸ†', title: 'é«˜åˆ†è¾¾äºº', desc: 'è·å¾—500+åˆ†æ•°' });
            if (maxCombo >= 10) achievementList.push({ icon: 'ğŸ”¥', title: 'è¿å‡»ç‹', desc: 'è¿å‡»è¾¾åˆ°10æ¬¡' });
            if (learnedLetters.size >= 20) achievementList.push({ icon: 'ğŸ“š', title: 'å­—æ¯å¤§å¸ˆ', desc: 'å­¦ä¼š20ä¸ªå­—æ¯' });
            if (correctAnswers / totalAnswers >= 0.9) achievementList.push({ icon: 'ğŸ¯', title: 'å®Œç¾ä¸»ä¹‰', desc: 'æ­£ç¡®ç‡è¶…è¿‡90%' });
            
            if (achievementList.length > 0) {
                const title = document.createElement('h3');
                title.className = 'text-lg font-bold mb-4 text-accent';
                title.innerHTML = 'ğŸ… è·å¾—æˆå°±';
                achievements.appendChild(title);
                
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-2 gap-4';
                
                achievementList.forEach(achievement => {
                    const badge = document.createElement('div');
                    badge.className = 'bg-yellow-100 border-2 border-yellow-300 rounded-lg p-4 text-center';
                    badge.innerHTML = `
                        <div class="text-2xl mb-1">${achievement.icon}</div>
                        <div class="font-bold text-sm">${achievement.title}</div>
                        <div class="text-xs text-gray-600">${achievement.desc}</div>
                    `;
                    grid.appendChild(badge);
                });
                
                achievements.appendChild(grid);
            }
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
            
            // é‡ç½®éš¾åº¦é€‰æ‹©
            currentDifficulty = null;
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-primary');
            });
            const startBtn = document.getElementById('start-game-btn');
            startBtn.disabled = true;
            startBtn.classList.add('opacity-50', 'cursor-not-allowed');
        }
        
        // è®¡æ—¶å™¨
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                document.getElementById('countdown').textContent = `å€’è®¡æ—¶ ${timeLeft.toFixed(1)}`;
                
                if (timeLeft <= 0) {
                    combo = 0;
                    totalAnswers++;
                    showFeedback('æ—¶é—´åˆ°ï¼', 'text-orange-500');
                    setTimeout(() => {
                        nextQuestion();
                    }, 1500);
                }
            }, 100);
        }
        
        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('level-display').textContent = currentLevel;
            document.getElementById('combo-display').textContent = combo;
            document.getElementById('score-display').textContent = score;
            document.getElementById('progress-text').textContent = `ç¬¬${currentLevel}å…³`;
            document.getElementById('progress-percentage').textContent = `${currentQuestion}/${questionsPerLevel}`;
            
            const progressPercent = (currentQuestion / questionsPerLevel) * 100;
            document.getElementById('progress-bar').style.width = progressPercent + '%';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å­—æ¯è®¤çŸ¥æ¸¸æˆåˆå§‹åŒ–å®Œæˆ');
            initSpeechSynthesis();
            
            // å€’è®¡æ—¶å¼€å…³é€»è¾‘
            document.getElementById('timer-toggle').addEventListener('change', function() {
                // é»˜è®¤å·²å¼€å¯å€’è®¡æ—¶ï¼Œæ— éœ€é¢å¤–æ–‡å­—åˆ‡æ¢
                console.log('å€’è®¡æ—¶æ¨¡å¼:', this.checked ? 'å¼€å¯' : 'å…³é—­');
            });
        });
    </script>
</body>
</html>