<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂçïËØçËøûÁ∫øÊ∂àÊ∂à‰πê - Â≠óÊØçÊêúÁ¥¢Ê∏∏Êàè</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script defer src="./wellness.js"></script>
    
    <!-- ÈÖçÁΩÆTailwindËá™ÂÆö‰πâÈ¢úËâ≤ÂíåÂ≠ó‰Ωì -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        neutral: '#F7FFF7',
                        text: '#1F2937'
                    },
                    fontFamily: {
                        kids: ['"Comic Sans MS"', '"Marker Felt"', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .bounce-light {
                animation: bounce-light 0.5s ease infinite alternate;
            }
            .float-animation {
                animation: float 3s ease-in-out infinite;
            }
            .pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .scale-hover {
                transition: transform 0.2s;
            }
            .scale-hover:hover {
                transform: scale(1.05);
            }
            .correct-animation {
                animation: correct 0.6s ease-in-out;
            }
            .wrong-animation {
                animation: wrong 0.6s ease-in-out;
            }
            .level-complete {
                animation: levelComplete 1s ease-in-out;
            }
            .word-found {
                animation: wordFound 0.8s ease-in-out;
            }
            @keyframes bounce-light {
                from { transform: translateY(0); }
                to { transform: translateY(-5px); }
            }
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
            }
            @keyframes correct {
                0% { transform: scale(1); background-color: #10B981; }
                50% { transform: scale(1.1); background-color: #34D399; }
                100% { transform: scale(1); background-color: #10B981; }
            }
            @keyframes wrong {
                0% { transform: translateX(0); background-color: #EF4444; }
                25% { transform: translateX(-5px); background-color: #F87171; }
                75% { transform: translateX(5px); background-color: #F87171; }
                100% { transform: translateX(0); background-color: #EF4444; }
            }
            @keyframes levelComplete {
                0% { transform: scale(1) rotate(0deg); }
                25% { transform: scale(1.2) rotate(5deg); }
                75% { transform: scale(1.2) rotate(-5deg); }
                100% { transform: scale(1) rotate(0deg); }
            }
            @keyframes wordFound {
                0% { transform: scale(1); background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
                50% { transform: scale(1.2); background: linear-gradient(135deg, #34D399 0%, #10B981 100%); }
                100% { transform: scale(1); background: linear-gradient(135deg, #10B981 0%, #059669 100%); }
            }
            
            /* ÂÖ®Â±èÂ∫ÜÁ•ùÂä®Áîª */
            .celebration-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                pointer-events: none;
                z-index: 1000;
                overflow: hidden;
            }
            
            .confetti {
                position: absolute;
                width: 10px;
                height: 10px;
                background: #f39c12;
                animation: confetti-fall 3s linear forwards;
            }
            
            .confetti:nth-child(odd) {
                background: #e74c3c;
                width: 8px;
                height: 8px;
                animation-delay: 0.2s;
            }
            
            .confetti:nth-child(3n) {
                background: #3498db;
                width: 6px;
                height: 6px;
                animation-delay: 0.4s;
            }
            
            .confetti:nth-child(4n) {
                background: #2ecc71;
                width: 12px;
                height: 4px;
                animation-delay: 0.1s;
            }
            
            .confetti:nth-child(5n) {
                background: #9b59b6;
                width: 8px;
                height: 12px;
                animation-delay: 0.3s;
            }
            
            @keyframes confetti-fall {
                0% {
                    transform: translateY(-100vh) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
            
            /* ÊèêÁ§∫Ê∂àÊÅØÂä®Áîª */
            @keyframes slideInDown {
                from {
                    transform: translate(-50%, -100%);
                    opacity: 0;
                }
                to {
                    transform: translate(-50%, 0%);
                    opacity: 1;
                }
            }
            
            @keyframes slideOutUp {
                from {
                    transform: translate(-50%, 0%);
                    opacity: 1;
                }
                to {
                    transform: translate(-50%, -100%);
                    opacity: 0;
                }
            }
            
            .firework {
                position: absolute;
                width: 4px;
                height: 4px;
                border-radius: 50%;
                animation: firework 2s ease-out forwards;
            }
            
            @keyframes firework {
                0% {
                    transform: scale(1);
                    opacity: 1;
                }
                50% {
                    transform: scale(20);
                    opacity: 0.8;
                }
                100% {
                    transform: scale(40);
                    opacity: 0;
                }
            }
            
            .celebration-message {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 3rem;
                font-weight: bold;
                color: #fff;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                z-index: 1001;
                pointer-events: none;
                animation: celebration-bounce 1.5s ease-out forwards;
            }
            
            @keyframes celebration-bounce {
                0% {
                    transform: translate(-50%, -50%) scale(0) rotate(-10deg);
                    opacity: 0;
                }
                30% {
                    transform: translate(-50%, -50%) scale(1.2) rotate(5deg);
                    opacity: 1;
                }
                60% {
                    transform: translate(-50%, -50%) scale(0.9) rotate(-2deg);
                    opacity: 1;
                }
                100% {
                    transform: translate(-50%, -50%) scale(1) rotate(0deg);
                    opacity: 0;
                }
            }
            
            .letter-cell {
                width: 70px;
                height: 70px;
                user-select: none;
                touch-action: manipulation;
                transition: all 0.3s ease;
                font-size: 2rem;
                font-weight: bold;
                cursor: pointer;
                border-radius: 20px;
            }
            .letter-cell:hover {
                transform: scale(1.15);
                box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
            }
            .letter-cell.selected {
                background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%) !important;
                color: white;
                transform: scale(1.15);
                box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.4);
            }
            .letter-cell.found {
                background: linear-gradient(135deg, #10B981 0%, #059669 100%) !important;
                color: white;
                font-weight: bold;
                transform: scale(1.05);
            }
            .letter-cell.hint {
                background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%) !important;
                color: white;
                animation: bounce-light 0.8s ease infinite alternate;
                box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
            }
            
            .connection-line {
                position: absolute;
                background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
                height: 6px;
                border-radius: 3px;
                transform-origin: left center;
                opacity: 0.9;
                z-index: 10;
                pointer-events: none;
                box-shadow: 0 0 12px rgba(79, 70, 229, 0.5);
            }
            
            .word-list-item {
                transition: all 0.3s ease;
                border: 2px solid transparent;
            }
            .word-list-item.found {
                background: linear-gradient(135deg, #10B981 0%, #059669 100%);
                color: white;
                text-decoration: line-through;
                border-color: #10B981;
            }
            .word-list-item.hint-glow {
                border-color: #F59E0B;
                background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
                animation: bounce-light 0.5s ease infinite alternate;
            }
            
            .timer-bar {
                transition: width 1s linear;
                background: linear-gradient(90deg, #10B981 0%, #F59E0B 50%, #EF4444 100%);
            }
            
            /* ÂÄíËÆ°Êó∂ÂºÄÂÖ≥Ê†∑Âºè */
            .timer-toggle-bg {
                background-color: #4F46E5;
            }
            
            .timer-toggle-bg.off {
                background-color: #D1D5DB;
            }
            
            .timer-toggle-dot {
                transform: translateX(20px);
            }
            
            .timer-toggle-dot.off {
                transform: translateX(2px);
            }
            
            /* ÊåâÈíÆÊ†∑Âºè */
            .theme-btn, .difficulty-btn {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 12px 8px;
                border: 2px solid transparent;
                border-radius: 12px;
                background: #f8fafc;
                color: #64748b;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                min-height: 60px;
            }
            
            .theme-btn:hover, .difficulty-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            }
            
            .theme-btn.active, .difficulty-btn.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-color: #667eea;
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            }
            
            .float-animation {
                animation: float 3s ease-in-out infinite;
            }
            
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
            }
            
            /* ÁßªÂä®Á´Ø‰ºòÂåñ */
            @media (max-width: 768px) {
                .letter-cell {
                    width: 60px;
                    height: 60px;
                    font-size: 1.75rem;
                    border-radius: 15px;
                }
                .float-animation {
                    animation: none;
                }
            }
            
            @media (max-width: 480px) {
                .letter-cell {
                    width: 55px;
                    height: 55px;
                    font-size: 1.5rem;
                    border-radius: 12px;
                }
            }
            
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen font-kids text-text">
    
    <!-- ÂºÄÂßãÁïåÈù¢ -->
    <div id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-8 relative">
        <!-- ËøîÂõûÈ¶ñÈ°µÊåâÈíÆ -->
        <button onclick="window.location.href='index.html'" class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800 z-40">
            <i class="fa fa-home mr-2"></i>È¶ñÈ°µ
        </button>
        <div class="text-center w-full max-w-lg mx-auto bg-white rounded-3xl shadow-2xl p-6 transform transition-all duration-500">
            <h1 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary via-secondary to-accent mb-2">ÂçïËØçËøûÁ∫ø</h1>
            <p class="text-sm mb-3 text-gray-600">Â≠óÊØçÊêúÁ¥¢Ê∏∏Êàè<br>ÊâæÂá∫ÈöêËóèËã±ÊñáÂçïËØçÔºÅ</p>
            
            <div class="flex justify-center mb-4">
                <div class="w-16 h-16 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white text-2xl shadow-lg relative overflow-hidden float-animation">
                    <i class="fa fa-link"></i>
                    <div class="absolute inset-0 bg-white opacity-20 rounded-full animate-ping"></div>
                </div>
            </div>
            
            <!-- ‰∏ªÈ¢òÈÄâÊã© -->
            <div class="mb-4">
                <h3 class="text-sm font-bold mb-2">ÈÄâÊã©‰∏ªÈ¢ò</h3>
                <div class="flex justify-center gap-2">
                    <button onclick="selectTheme('animals')" class="theme-btn active" data-theme="animals">
                        <span class="text-sm">üêæ Âä®Áâ©</span>
                    </button>
                    <button onclick="selectTheme('colors')" class="theme-btn" data-theme="colors">
                        <span class="text-sm">üåà È¢úËâ≤</span>
                    </button>
                    <button onclick="selectTheme('food')" class="theme-btn" data-theme="food">
                        <span class="text-sm">üçé È£üÁâ©</span>
                    </button>
                </div>
            </div>
            
            <!-- ÈöæÂ∫¶ÈÄâÊã© -->
            <div class="mb-4">
                <h3 class="text-sm font-bold mb-2">ÈÄâÊã©ÈöæÂ∫¶</h3>
                <div class="flex justify-center gap-2">
                    <button onclick="selectDifficulty('easy')" class="difficulty-btn active" data-difficulty="easy">
                        <span class="text-base">üåü ÁÆÄÂçï</span>
                        <span class="text-[11px]">4x4ÁΩëÊ†º</span>
                    </button>
                    <button onclick="selectDifficulty('medium')" class="difficulty-btn" data-difficulty="medium">
                        <span class="text-base">‚≠ê ‰∏≠Á≠â</span>
                        <span class="text-[11px]">5x5ÁΩëÊ†º</span>
                    </button>
                    <button onclick="selectDifficulty('hard')" class="difficulty-btn" data-difficulty="hard">
                        <span class="text-base">üî• Âõ∞Èöæ</span>
                        <span class="text-[11px]">6x6ÁΩëÊ†º</span>
                    </button>
                </div>
            </div>
            
            <!-- ÂÄíËÆ°Êó∂ÂºÄÂÖ≥ -->
            <div class="mb-4 flex items-center justify-center gap-3 bg-gray-50 rounded-2xl p-2">
                <i class="fa fa-clock-o text-gray-600"></i>
                <span class="text-gray-700 font-medium text-sm">ÂÄíËÆ°Êó∂Ê®°Âºè</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="timer-mode-toggle" class="sr-only peer" checked onchange="toggleTimerMode()">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                </label>
                <span class="text-xs text-gray-500" id="timer-mode-info">Ê†πÊçÆÈöæÂ∫¶ÈôêÊó∂</span>
            </div>

            <!-- ÂæΩÁ´†È¢ÑËßà -->
            <div id="badge-preview" class="mb-5">
                <h3 class="text-sm font-bold mb-2">ÊàëÁöÑÂæΩÁ´†</h3>
                <div id="badge-preview-grid" class="flex justify-center gap-3 flex-wrap"></div>
                <div class="text-xs text-gray-400 mt-1">Êú¨Ê∏∏ÊàèÂæΩÁ´†È¢ÑËßàÔºàÂ∑≤Ëé∑È´ò‰∫ÆÔºåÊú™Ëé∑ÁÅ∞ÊòæÔºâ</div>
            </div>
            
            <button id="start-game-btn" onclick="startGame()" class="bg-accent hover:bg-yellow-400 text-white font-bold py-3 px-6 rounded-full text-lg shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                ÂºÄÂßãÊ∏∏Êàè <i class="fa fa-play ml-2"></i>
            </button>
            
            <div class="mt-4 text-xs text-gray-500">
                <p>ÈÄÇÂêàÂπ¥ÈæÑÔºö8-15Â≤Å</p>
                <p>ÁõÆÊ†áÔºöËøûÊé•Â≠óÊØçÁªÑÊàêËã±ÊñáÂçïËØçÔºÅ</p>
            </div>
        </div>
        
        <!-- Ë£ÖÈ•∞ÂÖÉÁ¥† -->
        <div class="absolute top-10 left-10 text-5xl text-primary/30">
            <i class="fa fa-star bounce-light"></i>
        </div>
        <div class="absolute bottom-10 right-10 text-5xl text-secondary/30">
            <i class="fa fa-heart bounce-light" style="animation-delay: 0.3s"></i>
        </div>
        <div class="absolute top-1/4 right-20 text-4xl text-accent/30">
            <i class="fa fa-trophy bounce-light" style="animation-delay: 0.6s"></i>
        </div>
    </div>

    <script>
    (function(){
      const GAME_KEY = 'wordConnect';
      const badgeDefs = [
        { id: 'first_word', name: 'È¶ñËØçËææÊàê', icon: 'üéØ' },
        { id: 'combo_chain', name: 'ËøûÈîÅÈ´òÊâã', icon: 'üî•' },
        { id: 'speed_solver', name: 'ÊûÅÈÄüÊâæËØç', icon: '‚ö°' },
        { id: 'level_clear', name: 'ÈóØÂÖ≥ËÉΩÊâã', icon: 'üèÜ' },
        { id: 'perfect_level', name: 'ÂÆåÁæéÂÖ≥Âç°', icon: 'üíé' }
      ];
      function getEarnedIds(){
        try { return JSON.parse(localStorage.getItem('earnedAchievements_' + GAME_KEY) || '[]'); } catch(_) { return []; }
      }
      function renderBadgePreview(){
        const grid = document.getElementById('badge-preview-grid');
        if(!grid) return;
        const owned = new Set(getEarnedIds());
        grid.innerHTML = badgeDefs.map(a => {
          const earned = owned.has(a.id);
          const base = earned ? 'from-yellow-100 to-orange-100 border-yellow-300 text-amber-900' : 'from-gray-50 to-gray-100 border-gray-200 text-gray-400 opacity-80';
          return `
            <div class="relative w-20 h-20 rounded-2xl border-2 bg-gradient-to-br ${base} shadow-sm flex flex-col items-center justify-center overflow-hidden" title="${a.name}">
              <div class="text-2xl mb-1">${a.icon}</div>
              <div class="text-[10px] font-bold text-center leading-tight px-1">${a.name}</div>
              ${earned ? '<div class=\"absolute -right-1 -top-1 bg-amber-400 text-white text-[10px] px-1 rounded-full shadow\">Â∑≤Ëé∑</div>' : ''}
            </div>`;
        }).join('');
      }
      document.addEventListener('DOMContentLoaded', renderBadgePreview);
    })();
    </script>
    
    <!-- Ê∏∏ÊàèÁïåÈù¢ -->
    <div id="game-screen" class="hidden h-screen flex flex-col">
        <!-- È°∂ÈÉ®‰ø°ÊÅØÊ†è -->
        <div class="flex justify-between items-center p-3 bg-white/80 backdrop-blur-sm shadow-md">
            <!-- Â∑¶‰æß‰ø°ÊÅØ -->
            <div class="flex items-center gap-3">
                <button onclick="backToStart()" class="bg-white/90 backdrop-blur-sm px-3 py-2 rounded-full shadow-md transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800">
                    <i class="fa fa-arrow-left mr-1"></i><span class="hidden sm:inline">ËøîÂõû</span>
                </button>
                <div class="bg-primary px-4 py-2 rounded-full text-white font-bold shadow-md">
                    <span id="theme-display">Âä®Áâ©‰∏ñÁïå</span>
                </div>
                <div class="bg-secondary px-4 py-2 rounded-full text-white font-bold shadow-md">
                    <span>ËøõÂ∫¶ </span><span id="progress-display">0/0</span>
                </div>
            </div>
            
            <!-- ‰∏≠Èó¥ËÆ°Êó∂Âô® -->
            <div class="bg-accent text-white px-6 py-3 rounded-full shadow-md">
                <i class="fa fa-clock-o mr-2"></i>
                <span class="text-sm mr-1">ÂÄíËÆ°Êó∂</span>
                <span id="time-left" class="text-xl font-bold">90.00</span>
            </div>
            
            <!-- Âè≥‰æßÂàÜÊï∞ -->
            <div class="bg-gradient-to-r from-purple-500 to-pink-500 px-4 py-2 rounded-full text-white font-bold shadow-md">
                <i class="fa fa-star mr-2"></i>
                <span id="score-display">0</span>
            </div>
        </div>
        
        
        <!-- ‰∏ªË¶ÅÊ∏∏ÊàèÂå∫Âüü -->
        <div class="flex-1 flex flex-col items-center p-6">
            <!-- Ê∏∏ÊàèËØ¥Êòé -->
            <div class="mb-4 text-center">
                <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-3 max-w-2xl mx-auto">
                    <div class="text-blue-300 text-xs font-normal">
                        üéØ <span class="font-medium">Ê∏∏ÊàèËßÑÂàô</span>ÔºöËøûÊé•Â≠óÊØçÁªÑÊàê<span class="text-blue-400 font-medium">‰ªª‰ΩïÊúâÊïàËã±ËØ≠ÂçïËØç</span>Âç≥ÂèØÂæóÂàÜÔºÅ
                        <br>
                        ‚≠ê <span class="font-medium text-orange-300">Â•ñÂä±ÊèêÁ§∫</span>ÔºöÊâæÂà∞<span id="theme-hint" class="text-green-400 font-medium">Âä®Áâ©Á±ª</span>ÂçïËØçÂèØËé∑ÂæóÂèåÂÄçÂàÜÊï∞ÔºÅ
                    </div>
                </div>
            </div>
            
            <!-- ÂèçÈ¶à‰ø°ÊÅØÂå∫Âüü - ‰øùÁïô‰ΩÜÈöêËóèÔºå‰∏ªË¶Å‰ΩøÁî®ÊµÆÂä®ÊèêÁ§∫ -->
            <div id="feedback" class="mb-2 text-center text-lg font-bold h-8 flex items-center justify-center" style="display: none;">
                <!-- ÂèçÈ¶à‰ø°ÊÅØÊòæÁ§∫Âå∫Âüü -->
            </div>
            
            <!-- Â≠óÊØçÁΩëÊ†º -->
            <div class="bg-white rounded-3xl shadow-2xl p-6 text-center mb-4 transform transition-all duration-500">
                <div id="game-grid" class="grid gap-3 justify-center" style="grid-template-columns: repeat(4, minmax(0, 1fr));">
                    <!-- Â≠óÊØçÊ†ºÂ≠êÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
            
            <!-- Â∑≤ÊâæÂà∞ÂçïËØçÊòæÁ§∫Âå∫Âüü -->
            <div id="found-words-display" class="text-center mb-6">
                <div class="flex flex-wrap justify-center gap-2 max-w-4xl mx-auto" id="found-words-list">
                    <!-- Â∑≤ÊâæÂà∞ÁöÑÂçïËØç‰ºöÊòæÁ§∫Âú®ËøôÈáå -->
                </div>
            </div>
            
            <!-- Êìç‰ΩúÊåâÈíÆÂå∫Âüü -->
            <div class="flex gap-4 mt-auto mb-4">
                <button id="submit-word-btn" onclick="submitCurrentWord()" 
                        class="bg-primary hover:bg-primary/90 text-white px-8 py-4 rounded-full text-lg font-bold shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-check mr-2"></i>Êèê‰∫§ÂçïËØç
                </button>
                <button id="clear-selection-btn" onclick="clearSelection()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-4 rounded-full text-lg font-bold shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-times mr-2"></i>Ê∏ÖÈô§ÈÄâÊã©
                </button>
                <button id="hint-btn" onclick="useHint()" 
                        class="bg-gradient-to-r from-accent to-orange-500 hover:from-orange-500 hover:to-accent text-white px-6 py-4 rounded-full text-lg font-bold shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-lightbulb mr-2"></i>ÊèêÁ§∫
                </button>
            </div>
        </div>
    </div>
    
    <!-- ÁªìÊûúÁïåÈù¢ -->
    <div id="result-screen" class="hidden flex flex-col items-center justify-center min-h-screen p-4">
        <div class="text-center max-w-xl mx-auto bg-white rounded-3xl shadow-2xl p-8 transform transition-all duration-300">
            <div id="result-icon" class="text-8xl mb-6 level-complete">üéâ</div>
            <h2 id="result-title" class="text-3xl font-bold text-primary mb-4">ÊÅ≠ÂñúÂÆåÊàêÔºÅ</h2>
            
            <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6 mb-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-primary" id="final-score">0</p>
                        <p class="text-sm text-gray-600">ÊúÄÁªàÂæóÂàÜ</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-secondary" id="final-words">0</p>
                        <p class="text-sm text-gray-600">ÊâæÂà∞ÂçïËØç</p>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-accent" id="final-time">0</p>
                        <p class="text-sm text-gray-600">Áî®Êó∂(Áßí)</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-orange-600" id="final-accuracy">100%</p>
                        <p class="text-sm text-gray-600">ÂÆåÊàêÁéá</p>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <p id="performance-text" class="text-lg font-bold text-secondary">ÂçïËØçÂ§ßÂ∏àÔºÅ</p>
                </div>
            </div>
            
            <div id="result-buttons" class="space-x-4">
                <button id="next-level-btn" onclick="nextLevel()" 
                        class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-2xl scale-hover hidden">
                    <i class="fa fa-arrow-right mr-2"></i>‰∏ã‰∏ÄÂÖ≥
                </button>
                <button id="retry-btn" onclick="retryLevel()" 
                        class="bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white px-6 py-3 rounded-2xl scale-hover">
                    <i class="fa fa-refresh mr-2"></i>ÈáçËØïÊú¨ÂÖ≥
                </button>
                <button onclick="backToStart()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-2xl scale-hover">
                    <i class="fa fa-home mr-2"></i>ËøîÂõûÂºÄÂßã
                </button>
            </div>
        </div>
    </div>

    <script>
        // Ëã±ÊñáÂçïËØçÂ∫ìÔºàÊåâ‰∏ªÈ¢òÂàÜÁ±ªÔºåÊåâÈöæÂ∫¶ÂàÜÂ±ÇÔºâ
        const validWords = {
            animals: {
                easy: ['CAT', 'DOG', 'PIG', 'COW', 'BEE', 'BAT', 'RAT', 'ANT', 'FOX', 'OWL', 'HEN', 'APE', 'YAK', 'BUG'],
                medium: ['BIRD', 'FISH', 'LION', 'BEAR', 'DUCK', 'FROG', 'GOAT', 'DEER', 'WOLF', 'SEAL', 'CRAB', 'SWAN', 'HAWK', 'MOLE', 'MULE', 'MOTH', 'WASP', 'WORM'],
                hard: ['TIGER', 'HORSE', 'SHEEP', 'RABBIT', 'MONKEY', 'SNAKE', 'MOUSE', 'ZEBRA', 'PANDA', 'KOALA', 'WHALE', 'SHARK', 'EAGLE', 'RHINO', 'HIPPO', 'CAMEL', 'SLOTH', 'HYENA', 'OTTER', 'GOOSE'],
                expert: ['ELEPHANT', 'GIRAFFE', 'LEOPARD', 'CHEETAH', 'GORILLA', 'OSTRICH', 'PENGUIN', 'DOLPHIN', 'OCTOPUS', 'PEACOCK', 'FLAMINGO', 'KANGAROO', 'CROCODILE', 'BUTTERFLY', 'CHAMELEON', 'HEDGEHOG', 'RACCOON', 'TORTOISE', 'JELLYFISH']
            },
            colors: {
                easy: ['RED', 'BLUE', 'PINK', 'GRAY', 'NAVY', 'TEAL', 'AQUA', 'MINT'],
                medium: ['GREEN', 'BLACK', 'WHITE', 'BROWN', 'CORAL', 'BEIGE', 'CREAM', 'IVORY', 'KHAKI', 'PEACH', 'OLIVE', 'PEARL', 'LILAC', 'MAUVE'],
                hard: ['YELLOW', 'PURPLE', 'ORANGE', 'VIOLET', 'INDIGO', 'BRONZE', 'COPPER', 'SALMON', 'CRIMSON', 'EMERALD', 'SIENNA', 'MAROON'],
                expert: ['SILVER', 'GOLD', 'CYAN', 'LIME', 'MAGENTA', 'TURQUOISE', 'LAVENDER', 'BURGUNDY', 'MAROON', 'SCARLET', 'CHARTREUSE', 'AMETHYST', 'CERULEAN', 'FUCHSIA', 'AQUAMARINE', 'PERIWINKLE']
            },
            food: {
                easy: ['EGG', 'PIE', 'NUT', 'HAM', 'JAM', 'TEA', 'ICE', 'YAM', 'OIL'],
                medium: ['APPLE', 'BREAD', 'CAKE', 'RICE', 'MILK', 'FISH', 'MEAT', 'SOUP', 'CORN', 'BEAN', 'PLUM', 'PEAR', 'BACON', 'SALAD', 'SUSHI', 'CHILI'],
                hard: ['PIZZA', 'JUICE', 'WATER', 'HONEY', 'GRAPE', 'LEMON', 'PEACH', 'BERRY', 'CREAM', 'SUGAR', 'FLOUR', 'ONION', 'GARLIC', 'PEPPER', 'TOMATO', 'BUTTER', 'COCOA'],
                expert: ['COOKIE', 'COFFEE', 'NOODLES', 'CHICKEN', 'SANDWICH', 'AVOCADO', 'BROCCOLI', 'CUCUMBER', 'MUSHROOM', 'PINEAPPLE', 'STRAWBERRY', 'CHOCOLATE', 'BLUEBERRY', 'WATERMELON', 'SPAGHETTI']
            }
        };
        
        // Ëé∑ÂèñÊâÄÊúâ‰∏ªÈ¢òÂçïËØçÔºà‰∏∫‰∫ÜÂÖºÂÆπÊÄßÔºâ
        function getAllThemeWords(theme) {
            const themeData = validWords[theme];
            if (!themeData) return [];
            
            // Â¶ÇÊûúÊòØÊñ∞ÁöÑÂàÜÂ±ÇÁªìÊûÑ
            if (typeof themeData === 'object' && themeData.easy) {
                return [...themeData.easy, ...themeData.medium, ...themeData.hard, ...themeData.expert];
            }
            
            // Â¶ÇÊûúÊòØÊóßÁöÑÊï∞ÁªÑÁªìÊûÑÔºàÂÖºÂÆπÊÄßÔºâ
            return Array.isArray(themeData) ? themeData : [];
        }
        
        // ‰∏≠Ëã±ÊñáÁøªËØëËØçÂÖ∏
        const wordTranslations = {
            // Âä®Áâ©Á±ª
            'CAT': 'Áå´', 'DOG': 'Áãó', 'PIG': 'Áå™', 'COW': 'Áâõ', 'BEE': 'ËúúËúÇ', 'BAT': 'ËùôËù†', 'RAT': 'ËÄÅÈº†', 'ANT': 'ËöÇËöÅ', 'FOX': 'ÁãêÁã∏', 'OWL': 'Áå´Â§¥Èπ∞',
            'BIRD': 'È∏ü', 'FISH': 'È±º', 'LION': 'ÁãÆÂ≠ê', 'BEAR': 'ÁÜä', 'DUCK': 'È∏≠Â≠ê', 'FROG': 'ÈùíËõô', 'GOAT': 'Â±±Áæä', 'DEER': 'Èπø', 'WOLF': 'Áãº', 'SEAL': 'Êµ∑Ë±π',
            'CRAB': 'ËûÉËüπ', 'SWAN': 'Â§©ÈπÖ', 'HAWK': 'Èπ∞', 'MOLE': 'ÈºπÈº†', 'TIGER': 'ËÄÅËôé', 'HORSE': 'È©¨', 'SHEEP': 'ÁªµÁæä', 'RABBIT': 'ÂÖîÂ≠ê', 'MONKEY': 'Áå¥Â≠ê',
            'SNAKE': 'Ëõá', 'MOUSE': 'ËÄÅÈº†', 'ZEBRA': 'ÊñëÈ©¨', 'PANDA': 'ÁÜäÁå´', 'KOALA': 'ËÄÉÊãâ', 'WHALE': 'È≤∏È±º', 'SHARK': 'È≤®È±º', 'EAGLE': 'Èπ∞', 'RHINO': 'ÁäÄÁâõ',
            'HIPPO': 'Ê≤≥È©¨', 'ELEPHANT': 'Â§ßË±°', 'GIRAFFE': 'ÈïøÈ¢àÈπø', 'LEOPARD': 'Ë±πÂ≠ê', 'CHEETAH': 'ÁåéË±π', 'GORILLA': 'Â§ßÁå©Áå©', 'OSTRICH': 'È∏µÈ∏ü',
            'PENGUIN': '‰ºÅÈπÖ', 'DOLPHIN': 'Êµ∑Ë±ö', 'OCTOPUS': 'Á´†È±º', 'PEACOCK': 'Â≠îÈõÄ', 'FLAMINGO': 'ÁÅ´ÁÉàÈ∏ü', 'KANGAROO': 'Ë¢ãÈº†', 'CROCODILE': 'È≥ÑÈ±º', 'BUTTERFLY': 'Ëù¥Ëù∂',
            'CHAMELEON': 'ÂèòËâ≤Èæô', 'HEDGEHOG': 'Âà∫Áå¨', 'RACCOON': 'Êµ£ÁÜä', 'TORTOISE': 'ÈôÜÈæü', 'JELLYFISH': 'Ê∞¥ÊØç', 'HYENA': 'È¨£Áãó', 'OTTER': 'Ê∞¥Áç≠', 'GOOSE': 'ÈπÖ', 'MULE': 'È™°', 'WASP': 'ÈªÑËúÇ', 'WORM': 'Ë†ïËô´',
            
            // È¢úËâ≤Á±ª
            'RED': 'Á∫¢Ëâ≤', 'BLUE': 'ËìùËâ≤', 'PINK': 'Á≤âËâ≤', 'GRAY': 'ÁÅ∞Ëâ≤', 'NAVY': 'Êµ∑ÂÜõËìù', 'TEAL': 'ËìùÁªøËâ≤', 'GREEN': 'ÁªøËâ≤', 'BLACK': 'ÈªëËâ≤', 'WHITE': 'ÁôΩËâ≤',
            'BROWN': 'Ê£ïËâ≤', 'CORAL': 'ÁèäÁëöËâ≤', 'BEIGE': 'Á±≥Ëâ≤', 'CREAM': 'Â•∂Ê≤πËâ≤', 'IVORY': 'Ë±°ÁâôËâ≤', 'KHAKI': 'Âç°ÂÖ∂Ëâ≤', 'PEACH': 'Ê°ÉËâ≤', 'YELLOW': 'ÈªÑËâ≤',
            'PURPLE': 'Á¥´Ëâ≤', 'ORANGE': 'Ê©ôËâ≤', 'VIOLET': 'Á¥´ÁΩóÂÖ∞Ëâ≤', 'INDIGO': 'ÈùõËìùËâ≤', 'BRONZE': 'ÈùíÈìúËâ≤', 'COPPER': 'ÈìúËâ≤', 'SALMON': 'È≤ëÈ±ºËâ≤', 'CRIMSON': 'Ê∑±Á∫¢Ëâ≤',
            'EMERALD': 'Áø°Áø†Ëâ≤', 'SILVER': 'Èì∂Ëâ≤', 'GOLD': 'ÈáëËâ≤', 'CYAN': 'ÈùíËâ≤', 'LIME': 'ÈÖ∏Ê©ôËâ≤', 'MAGENTA': 'Ê¥ãÁ∫¢Ëâ≤', 'TURQUOISE': 'ÁªøÊùæÁü≥Ëâ≤',
            'LAVENDER': 'Ëñ∞Ë°£ËçâËâ≤', 'BURGUNDY': 'ÈÖíÁ∫¢Ëâ≤', 'MAROON': 'Ê†óËâ≤', 'SCARLET': 'Áå©Á∫¢Ëâ≤', 'CHARTREUSE': 'ÈªÑÁªøËâ≤', 'AQUA': 'Ê∞¥Ëâ≤', 'MINT': 'ËñÑËç∑Áªø', 'OLIVE': 'Ê©ÑÊ¶ÑÁªø', 'PEARL': 'Áè†ÂÖâÁôΩ', 'LILAC': '‰∏ÅÈ¶ôÁ¥´', 'MAUVE': 'Ê∑°Á¥´Ëâ≤', 'SIENNA': 'Ëµ≠Ëâ≤', 'AMETHYST': 'Á¥´Ê∞¥Êô∂Ëâ≤', 'CERULEAN': 'ËîöËìùËâ≤', 'FUCHSIA': 'Á¥´Á∫¢Ëâ≤', 'AQUAMARINE': 'Êµ∑ËìùÂÆùÁü≥Ëâ≤', 'PERIWINKLE': 'ÈïøÊò•Ëä±Ëâ≤',
            
            // È£üÁâ©Á±ª
            'EGG': 'È∏°Ëõã', 'PIE': 'Ê¥æ', 'NUT': 'ÂùöÊûú', 'HAM': 'ÁÅ´ËÖø', 'JAM': 'ÊûúÈÖ±', 'TEA': 'Ëå∂', 'ICE': 'ÂÜ∞', 'YAM': 'Â±±ËçØ', 'OIL': 'Ê≤π', 'APPLE': 'ËãπÊûú', 'BREAD': 'Èù¢ÂåÖ', 'CAKE': 'ËõãÁ≥ï',
            'RICE': 'Á±≥È•≠', 'MILK': 'ÁâõÂ•∂', 'MEAT': 'ËÇâ', 'SOUP': 'Ê±§', 'CORN': 'ÁéâÁ±≥', 'BEAN': 'Ë±ÜÂ≠ê', 'PLUM': 'ÊùéÂ≠ê', 'PEAR': 'Ê¢®', 'PIZZA': 'Êä´Ëê®',
            'JUICE': 'ÊûúÊ±Å', 'WATER': 'Ê∞¥', 'HONEY': 'ËúÇËúú', 'GRAPE': 'Ëë°ËêÑ', 'LEMON': 'Êü†Ê™¨', 'PEACH': 'Ê°ÉÂ≠ê', 'BERRY': 'ÊµÜÊûú', 'CREAM': 'Â•∂Ê≤π',
            'SUGAR': 'Á≥ñ', 'FLOUR': 'Èù¢Á≤â', 'ONION': 'Ê¥ãËë±', 'GARLIC': 'Â§ßËíú', 'PEPPER': 'ËÉ°Ê§í', 'TOMATO': 'Ë•øÁ∫¢Êüø', 'BUTTER': 'ÈªÑÊ≤π', 'COCOA': 'ÂèØÂèØ',
            'COOKIE': 'È•ºÂπ≤', 'COFFEE': 'ÂíñÂï°', 'NOODLES': 'Èù¢Êù°', 'CHICKEN': 'È∏°ËÇâ', 'SANDWICH': '‰∏âÊòéÊ≤ª',
            'AVOCADO': 'ÁâõÊ≤πÊûú', 'BROCCOLI': 'Ë•øÂÖ∞Ëä±', 'CUCUMBER': 'ÈªÑÁìú', 'MUSHROOM': 'ËòëËèá', 'PINEAPPLE': 'Ëè†Ëêù', 'STRAWBERRY': 'ËçâËéì', 'CHOCOLATE': 'Â∑ßÂÖãÂäõ', 'BLUEBERRY': 'ËìùËéì', 'WATERMELON': 'Ë•øÁìú', 'SPAGHETTI': 'ÊÑèÂ§ßÂà©Èù¢', 'BACON': 'ÂüπÊ†π', 'SALAD': 'Ê≤ôÊãâ', 'SUSHI': 'ÂØøÂè∏', 'CHILI': 'Ëæ£Ê§í',
            
            // Â∏∏Áî®ËØçÊ±áÊâ©Â±ï
            // Âü∫Á°ÄËØçÊ±á
            'ABLE': 'ËÉΩÂ§ü', 'BACK': 'ÂêéÈù¢', 'BALL': 'ÁêÉ', 'BANK': 'Èì∂Ë°å', 'BASE': 'Âü∫Á°Ä', 'BATH': 'Ê¥óÊæ°', 'BEAR': 'ÁÜä', 'BEAT': 'ÊâìË¥•', 'BEEN': 'Â∑≤Áªè', 'BELL': 'ÈìÉ',
            'BEST': 'ÊúÄÂ•Ω', 'BIRD': 'È∏ü', 'BLOW': 'Âêπ', 'BLUE': 'ËìùËâ≤', 'BOAT': 'Ëàπ', 'BODY': 'Ë∫´‰Ωì', 'BONE': 'È™®Â§¥', 'BOOK': '‰π¶', 'BORN': 'Âá∫Áîü', 'BOTH': '‰∏§‰∏™',
            'BOYS': 'Áî∑Â≠©‰ª¨', 'BUSY': 'ÂøôÁ¢å', 'CALL': 'ÊâìÁîµËØù', 'CAME': 'Êù•‰∫Ü', 'CARD': 'Âç°Áâá', 'CARE': 'ÂÖ≥ÂøÉ', 'CASE': 'ÊÉÖÂÜµ', 'CATS': 'Áå´‰ª¨', 'CITY': 'ÂüéÂ∏Ç',
            'CLUB': '‰ø±‰πêÈÉ®', 'COAL': 'ÁÖ§', 'COAT': 'Â§ñÂ•ó', 'COLD': 'ÂÜ∑', 'COME': 'Êù•', 'COOL': 'ÈÖ∑', 'CORN': 'ÁéâÁ±≥', 'COST': 'Ë¥πÁî®', 'CUBE': 'Á´ãÊñπ‰Ωì',
            'CUPS': 'ÊùØÂ≠ê', 'DARK': 'ÈªëÊöó', 'DATA': 'Êï∞ÊçÆ', 'DATE': 'Êó•Êúü', 'DAYS': 'Â§©Êï∞', 'DEAD': 'Ê≠ªÁöÑ', 'DEAL': '‰∫§Êòì', 'DEAR': '‰∫≤Áà±ÁöÑ', 'DEEP': 'Ê∑±ÁöÑ',
            'DESK': 'Ê°åÂ≠ê', 'DICE': 'È™∞Â≠ê', 'DIED': 'Ê≠ª‰∫Ü', 'DOGS': 'Áãó‰ª¨', 'DONE': 'ÂÆåÊàê', 'DOOR': 'Èó®', 'DOWN': 'Âêë‰∏ã', 'DREW': 'Áîª‰∫Ü', 'DROP': 'ÊéâËêΩ',
            'DUCK': 'È∏≠Â≠ê', 'EACH': 'ÊØè‰∏™', 'EARS': 'ËÄ≥Êúµ', 'EAST': '‰∏úÊñπ', 'EASY': 'ÂÆπÊòì', 'EGGS': 'È∏°Ëõã', 'ELSE': 'ÂÖ∂‰ªñ', 'EVEN': 'ÁîöËá≥', 'EVER': 'ÊõæÁªè',
            'EYES': 'ÁúºÁùõ', 'FACE': 'ËÑ∏', 'FACT': '‰∫ãÂÆû', 'FAIR': 'ÂÖ¨Âπ≥', 'FALL': 'ÁßãÂ§©', 'FARM': 'ÂÜúÂú∫', 'FAST': 'Âø´ÈÄü', 'FEAR': 'ÊÅêÊÉß', 'FEET': 'ËÑö',
            'FELL': 'Ë∑åÂÄí', 'FELT': 'ÊÑüËßâ', 'FILE': 'Êñá‰ª∂', 'FILL': 'Â°´Êª°', 'FIND': 'ÊâæÂà∞', 'FINE': 'Â•ΩÁöÑ', 'FIRE': 'ÁÅ´', 'FISH': 'È±º', 'FIVE': '‰∫î',
            'FLAT': 'Âπ≥ÁöÑ', 'FLEW': 'È£û‰∫Ü', 'FOOD': 'È£üÁâ©', 'FOOT': 'ËÑö', 'FORM': 'ÂΩ¢Âºè', 'FOUR': 'Âõõ', 'FREE': 'ÂÖçË¥π', 'FROM': '‰ªé', 'FULL': 'Êª°ÁöÑ',
            'GAME': 'Ê∏∏Êàè', 'GAVE': 'Áªô‰∫Ü', 'GIRL': 'Â•≥Â≠©', 'GIVE': 'Áªô', 'GLAD': 'È´òÂÖ¥', 'GOES': 'Âéª', 'GOLD': 'Èáë', 'GONE': 'Ëµ∞‰∫Ü', 'GOOD': 'Â•ΩÁöÑ',
            'GRAY': 'ÁÅ∞Ëâ≤', 'GREW': 'ÈïøÂ§ß', 'HAIR': 'Â§¥Âèë', 'HALF': '‰∏ÄÂçä', 'HALL': 'Â§ßÂéÖ', 'HAND': 'Êâã', 'HANG': 'ÊåÇ', 'HARD': 'Âõ∞Èöæ', 'HAVE': 'Êúâ',
            'HEAD': 'Â§¥', 'HEAR': 'Âê¨Âà∞', 'HEAT': 'ÁÉ≠', 'HELD': 'ÊãøÁùÄ', 'HELP': 'Â∏ÆÂä©', 'HERE': 'ËøôÈáå', 'HIGH': 'È´ò', 'HILL': 'Â±±‰∏ò', 'HOLD': 'ÊãøÁùÄ',
            'HOLE': 'Ê¥û', 'HOME': 'ÂÆ∂', 'HOPE': 'Â∏åÊúõ', 'HOUR': 'Â∞èÊó∂', 'HUGE': 'Â∑®Â§ß', 'HUNG': 'ÊåÇ‰∫Ü', 'HURT': '‰º§ÂÆ≥', 'IDEA': 'ÊÉ≥Ê≥ï', 'INCH': 'Ëã±ÂØ∏',
            'IRON': 'ÈìÅ', 'ITEM': 'Áâ©ÂìÅ', 'JACK': 'Êù∞ÂÖã', 'JOBS': 'Â∑•‰Ωú', 'JOIN': 'Âä†ÂÖ•', 'JUMP': 'Ë∑≥', 'JUST': 'Âè™ÊòØ', 'KEEP': '‰øùÊåÅ', 'KEPT': '‰øùÁïô',
            'KEYS': 'Èí•Âåô', 'KICK': 'Ë∏¢', 'KIDS': 'Â≠©Â≠ê‰ª¨', 'KIND': 'ÂèãÂñÑ', 'KING': 'ÂõΩÁéã', 'KNEW': 'Áü•ÈÅì‰∫Ü', 'KNOW': 'Áü•ÈÅì', 'LAKE': 'Êπñ', 'LAND': 'ÂúüÂú∞',
            'LAST': 'ÊúÄÂêé', 'LATE': 'ËøüÂà∞', 'LAWS': 'Ê≥ïÂæã', 'LEAD': 'È¢ÜÂØº', 'LEFT': 'Â∑¶Ëæπ', 'LEGS': 'ËÖø', 'LESS': 'Êõ¥Â∞ë', 'LIFE': 'ÁîüÊ¥ª', 'LIKE': 'ÂñúÊ¨¢',
            'LINE': 'Á∫ø', 'LIST': 'ÂàóË°®', 'LIVE': 'ÁîüÊ¥ª', 'LONG': 'ÈïøÁöÑ', 'LOOK': 'Áúã', 'LORD': '‰∏ª', 'LOSE': '‰∏¢Â§±', 'LOST': 'Ëø∑Ë∑Ø', 'LOTS': 'ÂæàÂ§ö',
            'LOVE': 'Áà±', 'MADE': 'Âà∂‰Ωú', 'MAIN': '‰∏ªË¶Å', 'MAKE': 'Âà∂‰Ωú', 'MANY': 'ÂæàÂ§ö', 'MARS': 'ÁÅ´Êòü', 'MASS': 'Ë¥®Èáè', 'MATH': 'Êï∞Â≠¶', 'MEAL': 'È§ê',
            'MEAN': 'ÊÑèÊÄù', 'MEAT': 'ËÇâ', 'MEET': 'ÈÅáËßÅ', 'MICE': 'ËÄÅÈº†‰ª¨', 'MILE': 'Ëã±Èáå', 'MILK': 'ÁâõÂ•∂', 'MIND': 'ÊÄùÊÉ≥', 'MINE': 'ÊàëÁöÑ', 'MISS': 'ÊÉ≥Âøµ',
            'MOOD': 'ÂøÉÊÉÖ', 'MOON': 'Êúà‰∫Æ', 'MORE': 'Êõ¥Â§ö', 'MOST': 'ÊúÄÂ§ö', 'MOVE': 'ÁßªÂä®', 'MUCH': 'ÂæàÂ§ö', 'MUST': 'ÂøÖÈ°ª', 'NAME': 'ÂêçÂ≠ó', 'NEAR': 'ÈôÑËøë',
            'NECK': 'ËÑñÂ≠ê', 'NEED': 'ÈúÄË¶Å', 'NEWS': 'Êñ∞Èóª', 'NEXT': '‰∏ã‰∏Ä‰∏™', 'NICE': 'Â•ΩÁöÑ', 'NINE': '‰πù', 'NODE': 'ËäÇÁÇπ', 'NOON': '‰∏≠Âçà', 'NOTE': 'Á¨îËÆ∞',
            'NUTS': 'ÂùöÊûú', 'ONCE': '‰∏ÄÊ¨°', 'ONLY': 'Âè™Êúâ', 'OPEN': 'ÊâìÂºÄ', 'OVER': 'ÁªìÊùü', 'PAID': '‰ªòË¥π', 'PAIR': '‰∏ÄÂØπ', 'PARK': 'ÂÖ¨Âõ≠', 'PART': 'ÈÉ®ÂàÜ',
            'PASS': 'ÈÄöËøá', 'PATH': 'Ë∑ØÂæÑ', 'PICK': 'ÈÄâÊã©', 'PINK': 'Á≤âËâ≤', 'PLAN': 'ËÆ°Âàí', 'PLAY': 'Áé©', 'PLOT': 'ÊÉÖËäÇ', 'PLUS': 'Âä†', 'POEM': 'ËØó',
            'POOL': 'Ê±†Â≠ê', 'POOR': 'Á©∑ÁöÑ', 'POST': 'Â∏ñÂ≠ê', 'PULL': 'Êãâ', 'PURE': 'Á∫ØÂáÄ', 'PUSH': 'Êé®', 'QUIZ': 'ÊµãËØï', 'RACE': 'ÊØîËµõ', 'RAIN': 'Èõ®',
            'RANG': 'Âìç‰∫Ü', 'RANK': 'ÊéíÂêç', 'RATE': 'ÊØîÁéá', 'READ': 'ËØª', 'REAL': 'ÁúüÂÆû', 'RICH': 'ÂØåÊúâ', 'RIDE': 'È™ë', 'RING': 'ÊàíÊåá', 'RISE': '‰∏äÂçá',
            'ROAD': 'Ë∑Ø', 'ROCK': 'Áü≥Â§¥', 'ROLE': 'ËßíËâ≤', 'ROOM': 'ÊàøÈó¥', 'ROOT': 'Ê†π', 'ROSE': 'Áé´Áë∞', 'RULE': 'ËßÑÂàô', 'RUNS': 'Ë∑ë', 'SAFE': 'ÂÆâÂÖ®',
            'SAID': 'ËØ¥‰∫Ü', 'SALE': 'ÈîÄÂîÆ', 'SAME': 'Áõ∏Âêå', 'SAND': 'Ê≤ôÂ≠ê', 'SAVE': '‰øùÂ≠ò', 'SAYS': 'ËØ¥', 'SEAL': 'ÂØÜÂ∞Å', 'SEAT': 'Â∫ß‰Ωç', 'SEED': 'ÁßçÂ≠ê',
            'SEEM': '‰ºº‰πé', 'SEEN': 'ÁúãËßÅ', 'SELF': 'Ëá™Â∑±', 'SELL': 'Âçñ', 'SEND': 'ÂèëÈÄÅ', 'SENT': 'ÂèëÈÄÅ‰∫Ü', 'SHIP': 'Ëàπ', 'SHOP': 'ÂïÜÂ∫ó', 'SHOT': 'Â∞ÑÂáª',
            'SHOW': 'Â±ïÁ§∫', 'SHUT': 'ÂÖ≥Èó≠', 'SICK': 'ÁîüÁóÖ', 'SIDE': 'Ëæπ', 'SING': 'Âî±Ê≠å', 'SIZE': 'Â∞∫ÂØ∏', 'SKIN': 'ÁöÆËÇ§', 'SLIP': 'ÊªëÂÄí', 'SLOW': 'ÊÖ¢ÁöÑ',
            'SNOW': 'Èõ™', 'SOAP': 'ËÇ•ÁöÇ', 'SOFT': 'ËΩØÁöÑ', 'SOIL': 'ÂúüÂ£§', 'SOLD': 'Âçñ‰∫Ü', 'SOME': '‰∏Ä‰∫õ', 'SONG': 'Ê≠åÊõ≤', 'SOON': 'ÂæàÂø´', 'SORT': 'ÊéíÂ∫è',
            'SOUL': 'ÁÅµÈ≠Ç', 'SPOT': 'Âú∞ÁÇπ', 'STAR': 'ÊòüÊòü', 'STAY': 'ÂÅúÁïô', 'STEP': 'Ê≠•È™§', 'STOP': 'ÂÅúÊ≠¢', 'SUCH': 'Â¶ÇÊ≠§', 'SUIT': 'Ë•øË£Ö', 'SURE': 'Á°ÆÂÆö',
            'TAKE': 'Êãø', 'TALK': 'Ë∞àËØù', 'TALL': 'È´òÁöÑ', 'TAPE': 'ËÉ∂Â∏¶', 'TASK': '‰ªªÂä°', 'TEAM': 'Âõ¢Èòü', 'TELL': 'ÂëäËØâ', 'TEND': 'Ë∂ãÂêë', 'TERM': 'Â≠¶Êúü',
            'TEST': 'ÊµãËØï', 'TEXT': 'ÊñáÊú¨', 'THAN': 'ÊØî', 'THAT': 'ÈÇ£‰∏™', 'THEN': 'ÁÑ∂Âêé', 'THEY': '‰ªñ‰ª¨', 'THIS': 'Ëøô‰∏™', 'TIME': 'Êó∂Èó¥', 'TINY': 'Â∞èÁöÑ',
            'TOLD': 'ÂëäËØâ‰∫Ü', 'TONE': 'Èü≥Ë∞É', 'TOOK': 'Êãø‰∫Ü', 'TOOL': 'Â∑•ÂÖ∑', 'TOPS': 'È°∂ÈÉ®', 'TOWN': 'ÂüéÈïá', 'TREE': 'Ê†ë', 'TRIP': 'ÊóÖË°å', 'TRUE': 'ÁúüÁöÑ',
            'TUBE': 'ÁÆ°Â≠ê', 'TUNE': 'Ë∞ÉÂ≠ê', 'TURN': 'ËΩ¨ÂºØ', 'TYPE': 'Á±ªÂûã', 'UNIT': 'Âçï‰Ωç', 'UPON': 'Âú®...‰∏ä', 'USED': '‰ΩøÁî®‰∫Ü', 'USER': 'Áî®Êà∑', 'VARY': 'ÂèòÂåñ',
            'VAST': 'Â∑®Â§ß', 'VERB': 'Âä®ËØç', 'VERY': 'ÈùûÂ∏∏', 'VIEW': 'ËßÜÂõæ', 'VOTE': 'ÊäïÁ•®', 'WAIT': 'Á≠âÂæÖ', 'WAKE': 'ÈÜíÊù•', 'WALK': 'Ëµ∞Ë∑Ø', 'WALL': 'Â¢ô',
            'WANT': 'ÊÉ≥Ë¶Å', 'WARM': 'Ê∏©Êöñ', 'WARS': 'Êàò‰∫â', 'WASH': 'Ê¥ó', 'WAVE': 'Ê≥¢Êµ™', 'WAYS': 'ÊñπÊ≥ï', 'WEAK': 'Âº±ÁöÑ', 'WEAR': 'Á©ø', 'WEEK': 'ÊòüÊúü',
            'WELL': 'Â•Ω', 'WENT': 'Âéª‰∫Ü', 'WERE': 'ÊòØ', 'WEST': 'Ë•øÊñπ', 'WHAT': '‰ªÄ‰πà', 'WHEN': '‰ΩïÊó∂', 'WIDE': 'ÂÆΩÁöÑ', 'WIFE': 'Â¶ªÂ≠ê', 'WILD': 'ÈáéÁîü',
            'WILL': 'Â∞ÜË¶Å', 'WIND': 'È£é', 'WINE': 'ÈÖí', 'WINS': 'Ëµ¢', 'WIRE': 'ÁîµÁ∫ø', 'WISE': 'ËÅ™Êòé', 'WISH': 'ÊÑøÊúõ', 'WITH': 'Âíå', 'WOOD': 'Êú®Â§¥',
            'WORD': 'ÂçïËØç', 'WORK': 'Â∑•‰Ωú', 'YEAR': 'Âπ¥', 'ZERO': 'Èõ∂', 'ZONE': 'Âå∫Âüü'
        };
        
        // Ëé∑ÂèñÂçïËØçÁöÑ‰∏≠ÊñáÁøªËØëÂíåÊ∏∏ÊàèÂåñÂ§ÑÁêÜ
        function getWordTranslation(word) {
            const upperWord = word.toUpperCase();
            return wordTranslations[upperWord] || '';
        }
        
        // Ê∏∏ÊàèÂåñÂ§ÑÁêÜÊú™Áü•ÂçïËØç
        function getWordDisplay(word) {
            const translation = getWordTranslation(word);
            if (translation) {
                return {
                    text: `${word} ${translation}`,
                    isUnknown: false,
                    bonusScore: 0
                };
            } else {
                return {
                    text: `${word} ‚≠ê`,
                    isUnknown: true,
                    bonusScore: 10,
                    message: 'ÂèëÁé∞Êñ∞ÂçïËØçÔºÅ'
                };
            }
        }
        
        // Ê†πÊçÆÂÖ≥Âç°ÂíåÈöæÂ∫¶Ëé∑ÂèñÂçïËØçÈõÜÂêà
        function getWordsForLevel(theme, difficulty, level) {
            const themeData = validWords[theme];
            if (!themeData || typeof themeData !== 'object' || !themeData.easy) {
                return getAllThemeWords(theme); // ÂÖºÂÆπÊóßÁªìÊûÑ
            }
            
            let availableWords = [];
            
            // Ê†πÊçÆÈöæÂ∫¶ÂíåÂÖ≥Âç°ÈÄêÊ∏êËß£ÈîÅÂçïËØç
            if (level >= 1) availableWords = [...availableWords, ...themeData.easy];
            if (level >= 3 || difficulty !== 'easy') availableWords = [...availableWords, ...themeData.medium];
            if (level >= 5 || difficulty === 'hard') availableWords = [...availableWords, ...themeData.hard];
            if (level >= 7 || difficulty === 'hard') availableWords = [...availableWords, ...themeData.expert];
            
            return availableWords;
        }

        // ÈÄöÁî®Ëã±ËØ≠ÂçïËØçËØçÂÖ∏ÔºàÁî®‰∫éÈ™åËØÅÁî®Êà∑ËæìÂÖ•ÁöÑÂçïËØçÔºâ
        const commonEnglishWords = [
            // 3Â≠óÊØçÂçïËØç
            'CAT', 'DOG', 'BAT', 'RAT', 'HAT', 'MAT', 'SAT', 'FAT', 'EAT', 'SIT', 'HIT', 'BIT', 'FIT', 'PIT', 'WIT', 'LIT',
            'CUT', 'BUT', 'PUT', 'NUT', 'HOT', 'NOT', 'GOT', 'LOT', 'POT', 'ROT', 'TOP', 'MOP', 'HOP', 'POP', 'COP', 'SOB',
            'JOB', 'MOB', 'ROB', 'BAD', 'DAD', 'HAD', 'MAD', 'PAD', 'SAD', 'BED', 'RED', 'LED', 'FED', 'WED', 'BIG', 'DIG',
            'FIG', 'JIG', 'PIG', 'WIG', 'BAG', 'RAG', 'TAG', 'WAG', 'LAG', 'SAG', 'JAG', 'BUG', 'HUG', 'JUG', 'MUG', 'RUG',
            'TUG', 'DUG', 'LOG', 'HOG', 'FOG', 'COG', 'JOG', 'BOX', 'FOX', 'SIX', 'MIX', 'FIX', 'WAX', 'TAX', 'MAX', 'AXE',
            'ICE', 'AGE', 'APE', 'ARE', 'ATE', 'AWE', 'EYE', 'ORE', 'OWE', 'USE', 'YES', 'YET', 'YOU', 'ZOO', 'ADD', 'ALL',
            'AND', 'ANY', 'ASK', 'BAR', 'BEE', 'BOY', 'BUS', 'BUY', 'CAN', 'CAR', 'CRY', 'CUP', 'DAY', 'DID', 'END', 'FAR',
            'FOR', 'FUN', 'GET', 'GOD', 'GUN', 'HAD', 'HER', 'HIM', 'HIS', 'HOW', 'ITS', 'LET', 'MAN', 'MAY', 'NEW', 'NOW',
            'OLD', 'ONE', 'OUR', 'OUT', 'OWN', 'RUN', 'SAW', 'SAY', 'SEE', 'SHE', 'THE', 'TOO', 'TWO', 'WAR', 'WAY', 'WHO',
            'WHY', 'WIN', 'WON', 'SUN', 'SON', 'PEN', 'TEN', 'MEN', 'HEN', 'DEN', 'WET', 'NET', 'PET', 'JET', 'SET', 'GET',
            'LET', 'MET', 'VET', 'BET', 'SEW', 'NEW', 'FEW', 'DEW', 'MEW', 'PEW', 'YEW', 'COW', 'HOW', 'NOW', 'BOW', 'LOW',
            'ROW', 'SOW', 'TOW', 'WOW', 'TOY', 'BOY', 'JOY', 'SOY', 'COY', 'SKY', 'TRY', 'FLY', 'DRY', 'CRY', 'SPY', 'SHY',
            
            // 4Â≠óÊØçÂçïËØç
            'ABLE', 'BACK', 'BALL', 'BANK', 'BASE', 'BATH', 'BEAR', 'BEAT', 'BEEN', 'BELL', 'BEST', 'BIRD', 'BLOW', 'BLUE',
            'BOAT', 'BODY', 'BONE', 'BOOK', 'BORN', 'BOTH', 'BOYS', 'BRING', 'BUSY', 'CALL', 'CAME', 'CARD', 'CARE', 'CASE',
            'CATS', 'CITY', 'CLUB', 'COAL', 'COAT', 'COLD', 'COME', 'COOL', 'CORN', 'COST', 'CUBE', 'CUPS', 'DARK', 'DATA',
            'DATE', 'DAYS', 'DEAD', 'DEAL', 'DEAR', 'DEEP', 'DESK', 'DICE', 'DIED', 'DOGS', 'DONE', 'DOOR', 'DOWN', 'DREW',
            'DROP', 'DUCK', 'DUNE', 'EACH', 'EARS', 'EAST', 'EASY', 'EGGS', 'ELSE', 'EVEN', 'EVER', 'EYES', 'FACE', 'FACT',
            'FAIR', 'FALL', 'FARM', 'FAST', 'FEAR', 'FEET', 'FELL', 'FELT', 'FILE', 'FILL', 'FIND', 'FINE', 'FIRE', 'FISH',
            'FIVE', 'FLAT', 'FLEW', 'FOOD', 'FOOT', 'FORM', 'FOUR', 'FREE', 'FROM', 'FULL', 'GAME', 'GAVE', 'GIRL', 'GIVE',
            'GLAD', 'GOES', 'GOLD', 'GONE', 'GOOD', 'GRAY', 'GREW', 'HAIR', 'HALF', 'HALL', 'HAND', 'HANG', 'HARD', 'HAVE',
            'HEAD', 'HEAR', 'HEAT', 'HELD', 'HELP', 'HERE', 'HIGH', 'HILL', 'HOLD', 'HOLE', 'HOME', 'HOPE', 'HOUR', 'HUGE',
            'HUNG', 'HURT', 'IDEA', 'INCH', 'IRON', 'ITEM', 'JACK', 'JOBS', 'JOIN', 'JUMP', 'JUST', 'KEEP', 'KEPT', 'KEYS',
            'KICK', 'KIDS', 'KIND', 'KING', 'KNEW', 'KNOW', 'LAKE', 'LAND', 'LAST', 'LATE', 'LAWS', 'LEAD', 'LEFT', 'LEGS',
            'LESS', 'LIFE', 'LIKE', 'LINE', 'LIST', 'LIVE', 'LONG', 'LOOK', 'LORD', 'LOSE', 'LOST', 'LOTS', 'LOVE', 'MADE',
            'MAIN', 'MAKE', 'MANY', 'MARS', 'MASS', 'MATH', 'MEAL', 'MEAN', 'MEAT', 'MEET', 'MICE', 'MILE', 'MILK', 'MIND',
            'MINE', 'MISS', 'MOOD', 'MOON', 'MORE', 'MOST', 'MOVE', 'MUCH', 'MUST', 'NAME', 'NEAR', 'NECK', 'NEED', 'NEWS',
            'NEXT', 'NICE', 'NINE', 'NODE', 'NOON', 'NOTE', 'NUTS', 'ONCE', 'ONLY', 'OPEN', 'OVER', 'PAID', 'PAIR', 'PARK',
            'PART', 'PASS', 'PATH', 'PICK', 'PINK', 'PLAN', 'PLAY', 'PLOT', 'PLUS', 'POEM', 'POOL', 'POOR', 'POST', 'PULL',
            'PURE', 'PUSH', 'QUIZ', 'RACE', 'RAIN', 'RANG', 'RANK', 'RATE', 'READ', 'REAL', 'RICH', 'RIDE', 'RING', 'RISE',
            'ROAD', 'ROCK', 'ROLE', 'ROOM', 'ROOT', 'ROSE', 'RULE', 'RUNS', 'SAFE', 'SAID', 'SALE', 'SAME', 'SAND', 'SAVE',
            'SAYS', 'SEAL', 'SEAT', 'SEED', 'SEEM', 'SEEN', 'SELF', 'SELL', 'SEND', 'SENT', 'SHIP', 'SHOP', 'SHOT', 'SHOW',
            'SHUT', 'SICK', 'SIDE', 'SING', 'SIZE', 'SKIN', 'SLIP', 'SLOW', 'SNOW', 'SOAP', 'SOFT', 'SOIL', 'SOLD', 'SOME',
            'SONG', 'SOON', 'SORT', 'SOUL', 'SPOT', 'STAR', 'STAY', 'STEP', 'STOP', 'SUCH', 'SUIT', 'SURE', 'TAKE', 'TALK',
            'TALL', 'TAPE', 'TASK', 'TEAM', 'TELL', 'TEND', 'TERM', 'TEST', 'TEXT', 'THAN', 'THAT', 'THEN', 'THEY', 'THIS',
            'TIME', 'TINY', 'TOLD', 'TONE', 'TOOK', 'TOOL', 'TOPS', 'TOWN', 'TREE', 'TRIP', 'TRUE', 'TUBE', 'TUNE', 'TURN',
            'TYPE', 'UNIT', 'UPON', 'USED', 'USER', 'VARY', 'VAST', 'VERB', 'VERY', 'VIEW', 'VOTE', 'WAIT', 'WAKE', 'WALK',
            'WALL', 'WANT', 'WARM', 'WARS', 'WASH', 'WAVE', 'WAYS', 'WEAK', 'WEAR', 'WEEK', 'WELL', 'WENT', 'WERE', 'WEST',
            'WHAT', 'WHEN', 'WIDE', 'WIFE', 'WILD', 'WILL', 'WIND', 'WINE', 'WINS', 'WIRE', 'WISE', 'WISH', 'WITH', 'WOOD',
            'WORD', 'WORK', 'YEAR', 'ZERO', 'ZONE',
            
            // 5Â≠óÊØçÂçïËØç
            'ABOUT', 'ABOVE', 'ADDED', 'AFTER', 'AGAIN', 'AGREE', 'AHEAD', 'AIMED', 'ALIVE', 'ALLOW', 'ALONE', 'ALONG',
            'ALTER', 'AMONG', 'ANGEL', 'ANGER', 'ANGLE', 'ANGRY', 'APART', 'APPLE', 'APPLY', 'ARENA', 'ARGUE', 'ARISE',
            'ARMED', 'ARRAY', 'ARROW', 'ASIDE', 'ASSET', 'AUDIO', 'AVOID', 'AWAKE', 'AWARD', 'AWARE', 'BADLY', 'BASIC',
            'BEACH', 'BEGAN', 'BEGIN', 'BEING', 'BELOW', 'BENCH', 'BILLY', 'BIRTH', 'BLACK', 'BLANK', 'BLIND', 'BLOCK',
            'BLOOD', 'BOARD', 'BOOST', 'BOOTH', 'BOUND', 'BRAIN', 'BRAND', 'BRAVE', 'BREAD', 'BREAK', 'BREED', 'BRIEF',
            'BRING', 'BROAD', 'BROKE', 'BROWN', 'BUILD', 'BUILT', 'BUYER', 'CABLE', 'CALIF', 'CARRY', 'CATCH', 'CAUSE',
            'CHAIN', 'CHAIR', 'CHAOS', 'CHART', 'CHASE', 'CHEAP', 'CHECK', 'CHEST', 'CHILD', 'CHINA', 'CHOSE', 'CIVIL',
            'CLAIM', 'CLASS', 'CLEAN', 'CLEAR', 'CLICK', 'CLIMB', 'CLOCK', 'CLOSE', 'CLOUD', 'COACH', 'COAST', 'COULD',
            'COUNT', 'COURT', 'COVER', 'CRAFT', 'CRASH', 'CRAZY', 'CREAM', 'CRIME', 'CROSS', 'CROWD', 'CROWN', 'CRUDE',
            'CURVE', 'CYCLE', 'DAILY', 'DANCE', 'DATED', 'DEALT', 'DEATH', 'DEBUG', 'DELAY', 'DEPTH', 'DOING', 'DOUBT',
            'DOZEN', 'DRAFT', 'DRAMA', 'DRANK', 'DRAWN', 'DREAM', 'DRESS', 'DRILL', 'DRINK', 'DRIVE', 'DROVE', 'DYING',
            'EAGER', 'EARLY', 'EARTH', 'EIGHT', 'ELITE', 'EMPTY', 'ENEMY', 'ENJOY', 'ENTER', 'ENTRY', 'EQUAL', 'ERROR',
            'EVENT', 'EVERY', 'EXACT', 'EXIST', 'EXTRA', 'FAITH', 'FALSE', 'FAULT', 'FIBER', 'FIELD', 'FIFTH', 'FIFTY',
            'FIGHT', 'FINAL', 'FIRST', 'FIXED', 'FLASH', 'FLEET', 'FLOOR', 'FLUID', 'FOCUS', 'FORCE', 'FORTH', 'FORTY',
            'FORUM', 'FOUND', 'FRAME', 'FRANK', 'FRAUD', 'FRESH', 'FRONT', 'FRUIT', 'FULLY', 'FUNNY', 'GIANT', 'GIVEN',
            'GLASS', 'GLOBE', 'GOING', 'GRACE', 'GRADE', 'GRAND', 'GRANT', 'GRASS', 'GRAVE', 'GREAT', 'GREEN', 'GROSS',
            'GROUP', 'GROWN', 'GUARD', 'GUESS', 'GUEST', 'GUIDE', 'HAPPY', 'HARRY', 'HEART', 'HEAVY', 'HENCE', 'HENRY',
            'HORSE', 'HOTEL', 'HOUSE', 'HUMAN', 'HURRY', 'IMAGE', 'INDEX', 'INNER', 'INPUT', 'ISSUE', 'JAPAN', 'JIMMY',
            'JOINT', 'JONES', 'JUDGE', 'KNOWN', 'LABEL', 'LARGE', 'LASER', 'LATER', 'LAUGH', 'LAYER', 'LEARN', 'LEASE',
            'LEAST', 'LEAVE', 'LEGAL', 'LEVEL', 'LEWIS', 'LIGHT', 'LIMIT', 'LINKS', 'LIVES', 'LOCAL', 'LOGIC', 'LOOSE',
            'LOWER', 'LUCKY', 'LUNCH', 'LYING', 'MAGIC', 'MAJOR', 'MAKER', 'MARCH', 'MARIA', 'MATCH', 'MAYBE', 'MAYOR',
            'MEANT', 'MEDIA', 'METAL', 'MIGHT', 'MINOR', 'MINUS', 'MIXED', 'MODEL', 'MONEY', 'MONTH', 'MORAL', 'MOTOR',
            'MOUNT', 'MOUSE', 'MOUTH', 'MOVED', 'MOVIE', 'MUSIC', 'NEEDS', 'NEVER', 'NEWLY', 'NIGHT', 'NOISE', 'NORTH',
            'NOTED', 'NOVEL', 'NURSE', 'OCCUR', 'OCEAN', 'OFFER', 'OFTEN', 'ORDER', 'OTHER', 'OUGHT', 'PAINT', 'PANEL',
            'PAPER', 'PARTY', 'PEACE', 'PEDRO', 'PHASE', 'PHONE', 'PHOTO', 'PIANO', 'PICKED', 'PIECE', 'PILOT', 'PITCH',
            'PLACE', 'PLAIN', 'PLANE', 'PLANT', 'PLATE', 'POINT', 'POUND', 'POWER', 'PRESS', 'PRICE', 'PRIDE', 'PRIME',
            'PRINT', 'PRIOR', 'PRIZE', 'PROOF', 'PROUD', 'PROVE', 'QUEEN', 'QUICK', 'QUIET', 'QUITE', 'RADIO', 'RAISE',
            'RANGE', 'RAPID', 'RATIO', 'REACH', 'READY', 'REALM', 'REBEL', 'REFER', 'RELAX', 'RELAY', 'RESET', 'RIGHT',
            'RIGID', 'RIVER', 'ROBIN', 'ROGER', 'ROMAN', 'ROUGH', 'ROUND', 'ROUTE', 'ROYAL', 'RURAL', 'SCALE', 'SCENE',
            'SCOPE', 'SCORE', 'SENSE', 'SERVE', 'SETUP', 'SEVEN', 'SHALL', 'SHAPE', 'SHARE', 'SHARP', 'SHEET', 'SHELF',
            'SHELL', 'SHIFT', 'SHINE', 'SHIRT', 'SHOCK', 'SHOOT', 'SHORT', 'SHOWN', 'SIDES', 'SIGHT', 'SILLY', 'SINCE',
            'SIXTH', 'SIXTY', 'SIZED', 'SKILL', 'SLEEP', 'SLIDE', 'SMALL', 'SMART', 'SMILE', 'SMITH', 'SMOKE', 'SNAKE',
            'SNOW', 'SOLID', 'SOLVE', 'SORRY', 'SOUND', 'SOUTH', 'SPACE', 'SPARE', 'SPEAK', 'SPEED', 'SPEND', 'SPENT',
            'SPLIT', 'SPOKE', 'SPORT', 'STAFF', 'STAGE', 'STAKE', 'STAND', 'START', 'STATE', 'STEAM', 'STEEL', 'STEEP',
            'STEER', 'STICK', 'STILL', 'STOCK', 'STONE', 'STOOD', 'STORE', 'STORM', 'STORY', 'STRIP', 'STUCK', 'STUDY',
            'STUFF', 'STYLE', 'SUGAR', 'SUITE', 'SUPER', 'SWEET', 'TABLE', 'TAKEN', 'TASTE', 'TAXES', 'TEACH', 'TEETH',
            'TERRY', 'TEXAS', 'THANK', 'THEFT', 'THEIR', 'THERE', 'THESE', 'THICK', 'THING', 'THINK', 'THIRD', 'THOSE',
            'THREE', 'THREW', 'THROW', 'THUMB', 'TIGHT', 'TIMER', 'TIRED', 'TITLE', 'TODAY', 'TOKEN', 'TOPIC', 'TOTAL',
            'TOUCH', 'TOUGH', 'TOWER', 'TRACK', 'TRADE', 'TRAIN', 'TRASH', 'TREAT', 'TREND', 'TRIAL', 'TRIBE', 'TRICK',
            'TRIED', 'TRIES', 'TRUCK', 'TRULY', 'TRUNK', 'TRUST', 'TRUTH', 'TWICE', 'TWIST', 'TYLER', 'UNCLE', 'UNCUT',
            'UNDER', 'UNDUE', 'UNION', 'UNITY', 'UNTIL', 'UPPER', 'UPSET', 'URBAN', 'USAGE', 'USUAL', 'VALID', 'VALUE',
            'VIDEO', 'VIRUS', 'VISIT', 'VITAL', 'VOCAL', 'VOICE', 'WASTE', 'WATCH', 'WATER', 'WHEEL', 'WHERE', 'WHICH',
            'WHILE', 'WHITE', 'WHOLE', 'WHOSE', 'WOMAN', 'WORLD', 'WORRY', 'WORSE', 'WORST', 'WORTH', 'WOULD', 'WRITE',
            'WRONG', 'WROTE', 'YIELD', 'YOUNG', 'YOUTH'
        ];

        // Ê£ÄÊü•ÂçïËØçÊòØÂê¶ÊúâÊïà
        function isValidEnglishWord(word) {
            const upperWord = word.toUpperCase();
            
            // Âü∫Êú¨ÈïøÂ∫¶ÈôêÂà∂
            if (upperWord.length < 3) {
                return false;
            }
            
            // 1) ËØçÂÖ∏ÂåπÈÖç
            if (commonEnglishWords.includes(upperWord)) return true;
            
            // 2) ‰∏ªÈ¢òËØçÂåπÈÖçÔºàÂΩìÂâç‰∏ªÈ¢ò‰ºòÂÖàÔºâ
            if (currentTheme) {
                const currentThemeWords = getAllThemeWords(currentTheme);
                if (currentThemeWords.includes(upperWord)) return true;
            }
            for (const theme in validWords) {
                const themeWords = getAllThemeWords(theme);
                if (themeWords.includes(upperWord)) return true;
            }
            
            // 3) ÂÆΩÊùæÊ†°È™åÔºöÂÖÅËÆ∏Êõ¥Â§öÁúüÂÆûËã±ËØ≠ÂçïËØçÈÄöËøáÔºàÁ¶ªÁ∫øÁéØÂ¢ÉÔºâ
            // ÂøÖÈ°ªÂåÖÂê´ÂÖÉÈü≥‰∏îËá≥Â∞ë‰∏Ä‰∏™ËæÖÈü≥Ôºå‰∏îÂè™ÂåÖÂê´Â≠óÊØç
            if (!/^[A-Z]+$/.test(upperWord)) return false;
            const hasVowel = /[AEIOU]/.test(upperWord);
            const hasConsonant = /[BCDFGHJKLMNPQRSTVWXYZ]/.test(upperWord);
            return hasVowel && hasConsonant;
        }

        // Ê∏∏Êàè‰∏ªÈ¢òÈÖçÁΩÆ
        const gameThemes = {
            animals: { name: 'Âä®Áâ©‰∏ñÁïå', emoji: 'üêæ' },
            colors: { name: 'Áº§Á∫∑Ëâ≤ÂΩ©', emoji: 'üåà' },
            food: { name: 'ÁæéÂë≥È£üÁâ©', emoji: 'üçé' }
        };

        // ÈöæÂ∫¶ËÆæÁΩÆ - ÈÄÇÂêàÂ∞èÊúãÂèãÁöÑÊ†ºÂ≠êÊï∞Èáè
        const difficultySettings = {
            easy: { 
                gridSize: 4, timeLimit: 90, hints: 3,
                wordsPerLevel: [2, 3, 3, 4, 4] // ÊØèÂÖ≥ÁöÑÂçïËØçÊï∞
            },
            medium: { 
                gridSize: 5, timeLimit: 120, hints: 2,
                wordsPerLevel: [3, 4, 4, 5, 5, 5, 6, 6] 
            },
            hard: { 
                gridSize: 6, timeLimit: 180, hints: 1,
                wordsPerLevel: [4, 5, 5, 6, 6, 6, 7, 7, 8, 8] 
            }
        };

        // Ê∏∏ÊàèÁä∂ÊÄÅ
        let currentTheme = null;
        let currentDifficulty = null;
        let gameGrid = [];
        let foundWords = []; // Áî®Êà∑ÊàêÂäüËøûÂá∫ÁöÑÂçïËØç
        let targetWords = []; // Êú¨ÂÖ≥ÈúÄË¶ÅÊâæÂà∞ÁöÑÂçïËØç
        let wordPositions = {}; // ‰øùÂ≠òÂçïËØçÂú®ÁΩëÊ†º‰∏≠ÁöÑ‰ΩçÁΩÆ‰ø°ÊÅØ
        let score = 0;
        let timeLeft = 90;
        let timeLeftDecimal = 90.0; // Á≤æÁ°ÆÂà∞Â∞èÊï∞ÁÇπÂêé‰∏§‰ΩçÁöÑÊó∂Èó¥
        let hintsLeft = 3;
        let timerModeEnabled = true; // ÂÄíËÆ°Êó∂Ê®°ÂºèÂºÄÂÖ≥
        let gameTimer = null;
        // ÂÖ≥Âç°ÂÆåÊàêÂª∂ËøüË∑≥ËΩ¨ÁöÑÂÆöÊó∂Âô®ÔºàÁî®‰∫éÈÅøÂÖçË∑®ÂÖ≥Âç°ÈÅóÁïôËß¶ÂèëÔºâ
        let levelCompleteTimeout = null;
        
        // ÂçïËØç‰ΩøÁî®ÂéÜÂè≤ËÆ∞ÂΩïÔºàÈÅøÂÖçËøëÊúüÈáçÂ§çÔºâ
        let recentlyUsedWords = new Set();
        
        // ÂÖ≥Âç°Á≥ªÁªü
        let currentLevel = 1; // ÂΩìÂâçÂÖ≥Âç°
        let maxLevels = { easy: 5, medium: 8, hard: 10 }; // ÊØè‰∏™ÈõæÂ∫¶ÁöÑÊúÄÂ§ßÂÖ≥Âç°Êï∞
        let isSelecting = false;
        let selectedCells = [];
        let connectionLines = [];
        let currentWord = ''; // ÂΩìÂâçÊ≠£Âú®ËøûÊé•ÁöÑÂçïËØç

        // ÂÆåÂÖ®ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
        function resetGameState() {
            // ÂÅúÊ≠¢Áé∞ÊúâËÆ°Êó∂Âô®
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            // ÂÅúÊ≠¢ÂÖ≥Âç°ÂÆåÊàêÁöÑÂª∂ËøüËß¶ÂèëÔºåÈÅøÂÖçË∑®ÂÖ≥Âç°ËØØËß¶
            if (levelCompleteTimeout) {
                clearTimeout(levelCompleteTimeout);
                levelCompleteTimeout = null;
            }
            
            // Ê∏ÖÈô§ÊâÄÊúâÂ∫ÜÁ•ùÂä®ÁîªÂÖÉÁ¥†ÔºàÁ´ãÂç≥Ê∏ÖÈô§Ôºå‰∏çÁ≠âÂæÖË∂ÖÊó∂Ôºâ
            clearCelebrationElements();
            
            // ÈáçÁΩÆÊâÄÊúâÊ∏∏ÊàèÂèòÈáè
            foundWords = [];
            targetWords = [];
            wordPositions = {};
            score = 0;
            selectedCells = [];
            currentWord = '';
            timeLeftDecimal = timeLeft;
            
            // Ê∏ÖÈô§ÊâÄÊúâËøûÊé•Á∫ø
            clearConnectionLines();
            
            // Ê∏ÖÈô§Ê∏∏ÊàèÁΩëÊ†º‰∏≠ÁöÑÊâÄÊúâËßÜËßâÁä∂ÊÄÅ
            clearGridVisualStates();
            
            // ÈáçÁΩÆÂ∑≤ÊâæÂà∞ÂçïËØçÊòæÁ§∫Âå∫ÂüüÔºàÊ∑±Â∫¶Ê∏ÖÁêÜÔºâ
            resetFoundWordsDisplay();
            
            // Ê∏ÖÈô§ÂèçÈ¶à‰ø°ÊÅØÂíåÊâÄÊúâÂä®ÁîªÁ±ª
            clearFeedbackArea();
            
            // ÈáçÁΩÆËÆ°Êó∂Âô®ÊòæÁ§∫Áä∂ÊÄÅ
            resetTimerDisplay();
        }
        
        // Ê∏ÖÈô§Ê∏∏ÊàèÁΩëÊ†º‰∏≠ÁöÑÊâÄÊúâËßÜËßâÁä∂ÊÄÅ
        function clearGridVisualStates() {
            const allCells = document.querySelectorAll('.letter-cell');
            allCells.forEach(cell => {
                // ÁßªÈô§ÊâÄÊúâÂèØËÉΩÁöÑÊ∏∏ÊàèÁä∂ÊÄÅÁ±ªÔºàÂåÖÊã¨Âä®ÁîªÁ±ªÔºâ
                cell.classList.remove(
                    'selected', 'found', 'hint', 'correct-animation', 
                    'wrong-animation', 'word-found', 'level-complete',
                    'bounce-light', 'pulse-slow', 'scale-hover', 'hint-glow'
                );
                
                // Ê∏ÖÈô§‰ªª‰ΩïÂÜÖËÅîÊ†∑Âºè
                cell.style.cssText = '';
                
                // ÈáçÁΩÆ‰∏∫ÈªòËÆ§Ê†∑Âºè
                cell.className = 'letter-cell bg-blue-100 flex items-center justify-center shadow-lg border-2 border-white/50';
            });
            
            // ÂêåÊó∂Ê∏ÖÁêÜÂèØËÉΩÂ≠òÂú®ÁöÑËØçÊ±áÂàóË°®È°πÁöÑÁä∂ÊÄÅ
            const wordListItems = document.querySelectorAll('.word-list-item');
            wordListItems.forEach(item => {
                item.classList.remove('found', 'hint-glow');
                item.style.cssText = '';
            });
        }
        
        // ÈáçÁΩÆÂ∑≤ÊâæÂà∞ÂçïËØçÊòæÁ§∫Âå∫Âüü
        function resetFoundWordsDisplay() {
            const container = document.getElementById('found-words-list');
            if (container) {
                // ÁâπÂà´Ê∏ÖÈô§Ê†áËÆ∞‰∏∫ÈúÄË¶ÅÊ∏ÖÁêÜÁöÑÂÖÉÁ¥†
                const markedElements = document.querySelectorAll('[data-cleanup-target]');
                markedElements.forEach(el => {
                    if (el && el.parentNode) {
                        el.remove();
                    }
                });
                
                // Ê∏ÖÈô§‰ªª‰Ωïmissed wordsÊòæÁ§∫ÂÖÉÁ¥†
                const missedWordsElements = document.querySelectorAll('.missed-words-display');
                missedWordsElements.forEach(el => {
                    if (el && el.parentNode) {
                        el.remove();
                    }
                });
                
                // ÁßªÈô§ÊâÄÊúâÂ≠êÂÖÉÁ¥†ÔºàÂåÖÊã¨‰∫ã‰ª∂ÁõëÂê¨Âô®Ôºâ
                while (container.firstChild) {
                    container.removeChild(container.firstChild);
                }
                
                // Ê∏ÖÈô§ÊâÄÊúâÂèØËÉΩÁöÑCSSÁ±ª
                container.className = '';
                
                // Á°Æ‰øùÂÆπÂô®ÂõûÂà∞ÂàùÂßãÁä∂ÊÄÅ
                container.innerHTML = '';
            }
        }
        
        // Ê∏ÖÈô§ÊâÄÊúâÂ∫ÜÁ•ùÂä®ÁîªÂÖÉÁ¥†
        function clearCelebrationElements() {
            // Ê∏ÖÈô§Â∫ÜÁ•ùË¶ÜÁõñÂ±Ç
            const celebrationOverlays = document.querySelectorAll('.celebration-overlay');
            celebrationOverlays.forEach(el => {
                if (el && el.parentNode) {
                    el.remove();
                }
            });
            
            // Ê∏ÖÈô§Â∫ÜÁ•ùÊ∂àÊÅØ
            const celebrationMessages = document.querySelectorAll('.celebration-message');
            celebrationMessages.forEach(el => {
                if (el && el.parentNode) {
                    el.remove();
                }
            });
            
            // Ê∏ÖÈô§‰ªª‰ΩïÊÆãÁïôÁöÑconfettiÂíåfireworkÂÖÉÁ¥†
            const confettiElements = document.querySelectorAll('.confetti, .firework');
            confettiElements.forEach(el => {
                if (el && el.parentNode) {
                    el.remove();
                }
            });
        }
        
        // Ê∏ÖÈô§ÂèçÈ¶à‰ø°ÊÅØÂå∫Âüü
        function clearFeedbackArea() {
            const feedback = document.getElementById('feedback');
            if (feedback) {
                // Ê∏ÖÈô§ÂÜÖÂÆπ
                feedback.innerHTML = '';
                
                // ÈáçÁΩÆÊâÄÊúâÂèØËÉΩÁöÑCSSÁ±ªÔºå‰øùÁïôÂü∫Á°ÄÁ±ª
                feedback.className = 'mb-4 text-center text-2xl font-bold h-12 flex items-center justify-center';
                
                // Ê∏ÖÈô§ÂèØËÉΩÊ∑ªÂä†ÁöÑÂä®ÁîªÁ±ª
                feedback.classList.remove(
                    'correct-animation', 'wrong-animation', 'level-complete',
                    'word-found', 'bounce-light', 'pulse-slow', 'text-green-500',
                    'text-red-500', 'text-yellow-500'
                );
            }
        }
        
        // ÈáçÁΩÆËÆ°Êó∂Âô®ÊòæÁ§∫Áä∂ÊÄÅ
        function resetTimerDisplay() {
            const timerElement = document.querySelector('.bg-accent');
            if (timerElement && timerElement.querySelector('#time-left')) {
                // Ê†πÊçÆÂÄíËÆ°Êó∂Ê®°ÂºèËÆæÁΩÆÊ≠£Á°ÆÁöÑÊòæÁ§∫Áä∂ÊÄÅ
                if (timerModeEnabled) {
                    timerElement.style.display = 'flex';
                } else {
                    timerElement.style.display = 'none';
                }
                
                // ÈáçÁΩÆËÆ°Êó∂Âô®ÊñáÊú¨
                const timeLeftElement = document.getElementById('time-left');
                if (timeLeftElement) {
                    const settings = difficultySettings[currentDifficulty] || difficultySettings['easy'];
                    timeLeftElement.textContent = settings.timeLimit.toFixed(2);
                }
            }
        }

        // ÂàáÊç¢ÂÄíËÆ°Êó∂Ê®°Âºè
        function toggleTimerMode() {
            const toggle = document.getElementById('timer-mode-toggle');
            const timerInfo = document.getElementById('timer-mode-info');
            
            timerModeEnabled = toggle.checked;
            
            if (timerModeEnabled) {
                timerInfo.textContent = 'Ê†πÊçÆÈöæÂ∫¶ÈôêÊó∂';
                timerInfo.className = 'text-xs text-gray-500';
            } else {
                timerInfo.textContent = '‰∏çÈôêÊó∂Ê®°Âºè';
                timerInfo.className = 'text-xs text-green-600';
            }
        }

        // ÂàùÂßãÂåñÊ∏∏ÊàèÈÄâÊã©ÈÄªËæë
        // Ê≥®ÊÑèÔºöËøôÈáåÈáçÊñ∞ÂÆö‰πâ‰∫ÜcurrentThemeÂíåcurrentDifficultyÔºå‰ΩÜ‰∏ç‰ºöË¶ÜÁõñ‰πãÂâçÁöÑÂÆö‰πâ
        
        // ‰∏ªÈ¢òÈÄâÊã©ÂáΩÊï∞
        function selectTheme(theme) {
            console.log('ÈÄâÊã©‰∏ªÈ¢ò:', theme);
            currentTheme = theme;
            // ÁßªÈô§ÊâÄÊúâactiveÁ±ª
            document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            // Ê∑ªÂä†ÂΩìÂâçÊåâÈíÆactiveÁ±ª
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
            // Ê£ÄÊü•ÂºÄÂßãÊåâÈíÆÁä∂ÊÄÅ
            checkStartButton();
        }
        
        // ÈöæÂ∫¶ÈÄâÊã©ÂáΩÊï∞
        function selectDifficulty(difficulty) {
            console.log('ÈÄâÊã©ÈöæÂ∫¶:', difficulty);
            currentDifficulty = difficulty;
            // ÁßªÈô§ÊâÄÊúâactiveÁ±ª
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            // Ê∑ªÂä†ÂΩìÂâçÊåâÈíÆactiveÁ±ª
            document.querySelector(`[data-difficulty="${difficulty}"]`).classList.add('active');
            // Ê£ÄÊü•ÂºÄÂßãÊåâÈíÆÁä∂ÊÄÅ
            checkStartButton();
        }
        
        
        // ÂàùÂßãÂåñÈÄâÊã©ÊåâÈíÆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMÂ∑≤Âä†ËΩΩÔºåÂºÄÂßãÂàùÂßãÂåñ...');
            // ÂàùÂßãÂåñÈªòËÆ§ÈÄâÊã©
            initializeDefaults();
            
            // ‰∏∫‰∫ÜÁ°Æ‰øùÊåâÈíÆËÉΩÁÇπÂáªÔºåÈ¢ùÂ§ñÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    console.log('‰∏ªÈ¢òÊåâÈíÆË¢´ÁÇπÂáª:', this.dataset.theme);
                    selectTheme(this.dataset.theme);
                });
            });
            
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    console.log('ÈöæÂ∫¶ÊåâÈíÆË¢´ÁÇπÂáª:', this.dataset.difficulty);
                    selectDifficulty(this.dataset.difficulty);
                });
            });
            
            console.log('ÂàùÂßãÂåñÂÆåÊàê');
        });

        // Â∫ÜÁ•ùÂä®ÁîªÂáΩÊï∞
        function createCelebration(message = 'üéâ ÊâæÂà∞ÂçïËØçÔºÅ') {
            // ÂàõÂª∫Â∫ÜÁ•ùË¶ÜÁõñÂ±Ç
            const celebrationOverlay = document.createElement('div');
            celebrationOverlay.className = 'celebration-overlay';
            
            // ÂàõÂª∫Â∫ÜÁ•ùÊ∂àÊÅØ
            const celebrationMessage = document.createElement('div');
            celebrationMessage.className = 'celebration-message';
            celebrationMessage.textContent = message;
            document.body.appendChild(celebrationMessage);
            
            // ÂàõÂª∫ÂΩ©Á∫∏ÊïàÊûú
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                celebrationOverlay.appendChild(confetti);
            }
            
            // ÂàõÂª∫ÁÉüËä±ÊïàÊûú
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 80 + 10 + 'vw';
                    firework.style.top = Math.random() * 50 + 20 + 'vh';
                    firework.style.background = ['#e74c3c', '#f39c12', '#2ecc71', '#3498db', '#9b59b6'][Math.floor(Math.random() * 5)];
                    celebrationOverlay.appendChild(firework);
                    
                    setTimeout(() => firework.remove(), 2000);
                }, i * 200);
            }
            
            document.body.appendChild(celebrationOverlay);
            
            // Ê∏ÖÁêÜÂ∫ÜÁ•ùÊïàÊûú
            setTimeout(() => {
                celebrationOverlay.remove();
                celebrationMessage.remove();
            }, 3000);
        }
        
        function showWordFoundFeedback(word) {
            // Ëé∑ÂèñÊ∏∏ÊàèÁΩëÊ†ºÂÆπÂô®‰ΩçÁΩÆ
            const gameGrid = document.querySelector('.bg-white.rounded-3xl.shadow-2xl');
            if (!gameGrid) return;
            
            const gridRect = gameGrid.getBoundingClientRect();
            const wordDisplay = getWordDisplay(word);
            
            // ÂàõÂª∫ÊøÄÂä±ËØ≠ÊòæÁ§∫ÔºàÊîæÂú®ÁΩëÊ†ºÊ≠£‰∏äÊñπÔºâ
            const floatingFeedback = document.createElement('div');
            
            // Ê†πÊçÆÊòØÂê¶‰∏∫Êú™Áü•ÂçïËØç‰ΩøÁî®‰∏çÂêåÊ†∑Âºè
            if (wordDisplay.isUnknown) {
                floatingFeedback.className = 'fixed z-50 bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-3 rounded-xl shadow-lg font-bold text-lg transform transition-all duration-500 text-center border-2 border-yellow-300';
            } else {
                floatingFeedback.className = 'fixed z-50 bg-green-500 text-white px-6 py-3 rounded-xl shadow-lg font-bold text-lg transform transition-all duration-500 text-center';
            }
            
            floatingFeedback.style.left = (gridRect.left + gridRect.width / 2) + 'px';
            floatingFeedback.style.top = (gridRect.top - 80) + 'px';
            floatingFeedback.style.transform = 'translateX(-50%) translateY(-20px) scale(0)';
            
            // ÊòæÁ§∫‰∏çÂêåÁöÑÊ∂àÊÅØ
            const displayMessage = wordDisplay.isUnknown ? 
                `üåü ${wordDisplay.message} ${wordDisplay.text} (+${wordDisplay.bonusScore}ÂàÜ)` : 
                `üéâ ÊâæÂà∞ÂçïËØç: ${wordDisplay.text}!`;
            floatingFeedback.innerHTML = displayMessage;
            
            document.body.appendChild(floatingFeedback);
            
            // Âä®ÁîªÊòæÁ§∫Ôºà‰ªé‰∏äÊñπÊªëÂÖ•Ôºâ
            setTimeout(() => {
                floatingFeedback.style.transform = 'translateX(-50%) translateY(0) scale(1)';
            }, 10);
            
            // 2ÁßíÂêéÊ∑°Âá∫ÁßªÈô§
            setTimeout(() => {
                if (floatingFeedback.parentNode) {
                    floatingFeedback.style.opacity = '0';
                    floatingFeedback.style.transform = 'translateX(-50%) translateY(-20px) scale(0.8)';
                    setTimeout(() => floatingFeedback.remove(), 300);
                }
            }, 2000);
        }

        // Ê∏∏ÊàèÁÆ°ÁêÜÂô®
        class WordConnectGame {
            constructor() {
                this.initSpeechSynthesis();
            }

            // ÂàùÂßãÂåñËØ≠Èü≥ÂêàÊàê
            initSpeechSynthesis() {
                this.voices = [];
                this.englishVoice = null;
                
                if ('speechSynthesis' in window) {
                    const loadVoices = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(voice => 
                            voice.lang.includes('en') && 
                            (voice.name.includes('English') || voice.lang === 'en-US')
                        ) || this.voices[0];
                    };

                    if (this.voices.length === 0) {
                        speechSynthesis.onvoiceschanged = loadVoices;
                    } else {
                        loadVoices();
                    }
                }
            }

            // Êí≠ÊîæËã±ÊñáÂèëÈü≥
            speak(text, rate = 0.8) {
                if (!('speechSynthesis' in window) || !this.englishVoice) {
                    return;
                }

                const utterance = new SpeechSynthesisUtterance(text.toLowerCase());
                utterance.voice = this.englishVoice;
                utterance.rate = rate;
                utterance.pitch = 1.0;
                utterance.volume = 0.9;
                utterance.lang = 'en-US';

                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            }

            // ËÆ∞ÂΩïÂ≠¶‰π†ËøõÂ∫¶
            recordProgress() {
                const accuracy = targetWords.length > 0 ? (foundWords.length / targetWords.length) * 100 : 0;
                const points = Math.round(score * (accuracy / 100));

                if (window.recordLearningProgress) {
                    window.recordLearningProgress('english', 'wordConnect', points, 120);
                }
            }
        }

        const gameManager = new WordConnectGame();

        // Ê£ÄÊü•ÂºÄÂßãÊåâÈíÆÁä∂ÊÄÅ
        function checkStartButton() {
            const startBtn = document.getElementById('start-game-btn');
            if (startBtn) {
                if (currentTheme && currentDifficulty) {
                    startBtn.disabled = false;
                    startBtn.style.opacity = '1';
                    startBtn.style.cursor = 'pointer';
                    startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    console.log('ÂºÄÂßãÊåâÈíÆÂ∑≤ÂêØÁî® - ‰∏ªÈ¢ò:', currentTheme, 'ÈöæÂ∫¶:', currentDifficulty);
                } else {
                    startBtn.disabled = true;
                    startBtn.style.opacity = '0.5';
                    startBtn.style.cursor = 'not-allowed';
                    startBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    console.log('ÂºÄÂßãÊåâÈíÆÂ∑≤Á¶ÅÁî® - ‰∏ªÈ¢ò:', currentTheme, 'ÈöæÂ∫¶:', currentDifficulty);
                }
            } else {
                console.error('Êâæ‰∏çÂà∞ÂºÄÂßãÊåâÈíÆÔºÅ');
            }
        }
        
        // ÂàùÂßãÂåñÈªòËÆ§ÈÄâÊã©
        function initializeDefaults() {
            console.log('ÂàùÂßãÂåñÈªòËÆ§ÈÄâÊã©');
            // ËÆæÁΩÆÈªòËÆ§ÂÄº
            currentTheme = 'animals';
            currentDifficulty = 'easy';
            
            // Êõ¥Êñ∞ÊåâÈíÆËßÜËßâÁä∂ÊÄÅ
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.theme === currentTheme) {
                    btn.classList.add('active');
                    console.log('ËÆæÁΩÆ‰∏ªÈ¢òÊåâÈíÆ‰∏∫Ê¥ªË∑É:', btn.dataset.theme);
                }
            });
            
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.difficulty === currentDifficulty) {
                    btn.classList.add('active');
                    console.log('ËÆæÁΩÆÈöæÂ∫¶ÊåâÈíÆ‰∏∫Ê¥ªË∑É:', btn.dataset.difficulty);
                }
            });
            
            checkStartButton();
        }

        // ÂºÄÂßãÊ∏∏Êàè
        function startGame() {
            console.log('ÂºÄÂßãÊ∏∏ÊàèË¢´Ë∞ÉÁî®', {currentTheme, currentDifficulty});
            if (!currentTheme || !currentDifficulty) {
                alert('ËØ∑ÂÖàÈÄâÊã©‰∏ªÈ¢òÂíåÈöæÂ∫¶ÔºÅ');
                return;
            }

            // ÂÆåÂÖ®ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            resetGameState();
            
            // Â¶ÇÊûúÊòØ‰ªéÂºÄÂßãÁïåÈù¢Êù•ÁöÑÔºåÈáçÁΩÆÂÖ≥Âç°‰∏∫1
            if (document.getElementById('start-screen').classList.contains('hidden') === false) {
                currentLevel = 1;
            }
            
            const settings = difficultySettings[currentDifficulty];
            timeLeft = settings.timeLimit;
            timeLeftDecimal = timeLeft;
            hintsLeft = settings.hints;
            
            // ÁîüÊàêÊ∏∏ÊàèÁΩëÊ†º
            generateGameGrid();
            
            // ÂàáÊç¢ÁïåÈù¢
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            // Êõ¥Êñ∞ÁïåÈù¢
            updateGameInterface();
            
            // ÂºÄÂßãËÆ°Êó∂ÔºàÊ†πÊçÆÊ®°ÂºèÂÜ≥ÂÆöÊòØÂê¶ÊòæÁ§∫ÂíåÂêØÂä®ËÆ°Êó∂Âô®Ôºâ
            startTimer();
        }

        // ÁîüÊàêÊ∏∏ÊàèÁΩëÊ†º
        function generateGameGrid() {
            const settings = difficultySettings[currentDifficulty];
            const gridSize = settings.gridSize;
            
            // ÂàùÂßãÂåñÁ©∫ÁΩëÊ†º
            gameGrid = Array(gridSize).fill().map(() => Array(gridSize).fill(''));
            
            // Ê†πÊçÆÈöæÂ∫¶ÂíåÂΩìÂâçÂÖ≥Âç°ÂÜ≥ÂÆöÊîæÁΩÆÂ§öÂ∞ë‰∏™ÂçïËØç
            const levelIndex = currentLevel - 1; // Êï∞ÁªÑ‰ªé0ÂºÄÂßã
            let targetWordCount = settings.wordsPerLevel[levelIndex] || settings.wordsPerLevel[settings.wordsPerLevel.length - 1];
            
            // Ê†πÊçÆÂÖ≥Âç°ÂíåÈöæÂ∫¶Ëé∑ÂèñÂçïËØçÈõÜÂêà
            const availableWords = getWordsForLevel(currentTheme, currentDifficulty, currentLevel);
            const selectedWords = [];
            
            // ËøáÊª§ÈÄÇÂêàÁΩëÊ†ºÂ§ßÂ∞èÁöÑÂçïËØç
            const maxWordLength = Math.min(gridSize - 1, currentDifficulty === 'easy' ? 4 : currentDifficulty === 'medium' ? 5 : 6);
            let suitableWords = availableWords.filter(word => 
                word.length >= 3 && word.length <= maxWordLength
            );
            
            // ‰ºòÂÖàÈÄâÊã©ÊúÄËøëÊ≤°Êúâ‰ΩøÁî®ËøáÁöÑÂçïËØç
            const freshWords = suitableWords.filter(word => !recentlyUsedWords.has(word));
            if (freshWords.length >= targetWordCount) {
                suitableWords = freshWords;
            }
            
            // ÈÄâÊã©ÂçïËØçÔºåÈÅøÂÖçÈáçÂ§ç
            const shuffledWords = [...suitableWords].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < Math.min(targetWordCount, shuffledWords.length); i++) {
                const word = shuffledWords[i];
                selectedWords.push(word);
                
                // ËÆ∞ÂΩïÂ∑≤‰ΩøÁî®ÁöÑÂçïËØç
                recentlyUsedWords.add(word);
            }
            
            // ‰øùÊåÅÊúÄËøë‰ΩøÁî®ÂéÜÂè≤Âú®ÂêàÁêÜËåÉÂõ¥ÂÜÖÔºàÊúÄÂ§ö30‰∏™Ôºâ
            if (recentlyUsedWords.size > 30) {
                const wordsArray = Array.from(recentlyUsedWords);
                recentlyUsedWords = new Set(wordsArray.slice(-20)); // ‰øùÁïôÊúÄËøë20‰∏™
            }
            
            // Âú®ÁΩëÊ†º‰∏≠ÊîæÁΩÆÈÄâ‰∏≠ÁöÑÂçïËØç
            selectedWords.forEach(word => {
                placeWordInGrid(word, gridSize);
            });
            
            // ‰øùÂ≠òÁõÆÊ†áÂçïËØçÂàóË°®
            targetWords = [...selectedWords];
            
            // Áî®ÈöèÊú∫Â≠óÊØçÂ°´ÂÖÖÁ©∫ÁôΩ‰ΩçÁΩÆ
            fillEmptySpaces(gridSize);
            
            // ÂàõÂª∫DOMÁΩëÊ†º
            createDOMGrid(gridSize);
            
            console.log('Â∑≤ÊîæÁΩÆÂçïËØç:', selectedWords);
            console.log('ÁõÆÊ†áÂçïËØçÊï∞Èáè:', targetWords.length);
        }

        // Âú®ÁΩëÊ†º‰∏≠ÊîæÁΩÆÂçï‰∏™ÂçïËØç
        function placeWordInGrid(word, gridSize) {
            const directions = [
                [0, 1],   // Ê®™Âêë
                [1, 0],   // Á∫µÂêë
                [1, 1],   // ÊñúÂêëÂè≥‰∏ã
                [1, -1]   // ÊñúÂêëÂ∑¶‰∏ã
            ];
            
            let placed = false;
            let attempts = 0;
            
            while (!placed && attempts < 50) {
                const direction = directions[Math.floor(Math.random() * directions.length)];
                const [dx, dy] = direction;
                
                let startRow, startCol;
                
                // Ê†πÊçÆÊñπÂêëËÆ°ÁÆóËµ∑Âßã‰ΩçÁΩÆ
                if (dx === 0) { // Ê®™Âêë
                    startRow = Math.floor(Math.random() * gridSize);
                    startCol = Math.floor(Math.random() * Math.max(1, gridSize - word.length + 1));
                } else if (dy === 0) { // Á∫µÂêë
                    startRow = Math.floor(Math.random() * Math.max(1, gridSize - word.length + 1));
                    startCol = Math.floor(Math.random() * gridSize);
                } else if (dy === 1) { // ÊñúÂêëÂè≥‰∏ã
                    startRow = Math.floor(Math.random() * Math.max(1, gridSize - word.length + 1));
                    startCol = Math.floor(Math.random() * Math.max(1, gridSize - word.length + 1));
                } else { // ÊñúÂêëÂ∑¶‰∏ã
                    startRow = Math.floor(Math.random() * Math.max(1, gridSize - word.length + 1));
                    startCol = Math.floor(Math.random() * word.length) + word.length - 1;
                    if (startCol >= gridSize) startCol = gridSize - 1;
                }
                
                // Ê£ÄÊü•ËæπÁïå
                if (startRow < 0 || startCol < 0) {
                    attempts++;
                    continue;
                }
                
                // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•ÊîæÁΩÆ
                let canPlace = true;
                for (let i = 0; i < word.length; i++) {
                    const row = startRow + i * dx;
                    const col = startCol + i * dy;
                    
                    if (row < 0 || row >= gridSize || col < 0 || col >= gridSize) {
                        canPlace = false;
                        break;
                    }
                    
                    if (gameGrid[row][col] !== '' && gameGrid[row][col] !== word[i]) {
                        canPlace = false;
                        break;
                    }
                }
                
                // ÊîæÁΩÆÂçïËØç
                if (canPlace) {
                    for (let i = 0; i < word.length; i++) {
                        const row = startRow + i * dx;
                        const col = startCol + i * dy;
                        gameGrid[row][col] = word[i];
                    }
                    placed = true;
                }
                
                attempts++;
            }
        }

        // Â°´ÂÖÖÁ©∫ÁôΩÁ©∫Ê†º
        function fillEmptySpaces(gridSize) {
            const vowels = 'AEIOU';
            const consonants = 'BCDFGHJKLMNPQRSTVWXYZ';
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    if (gameGrid[row][col] === '') {
                        // 30% Ê¶ÇÁéáÂÖÉÈü≥Ôºå70% Ê¶ÇÁéáËæÖÈü≥
                        if (Math.random() < 0.3) {
                            gameGrid[row][col] = vowels[Math.floor(Math.random() * vowels.length)];
                        } else {
                            gameGrid[row][col] = consonants[Math.floor(Math.random() * consonants.length)];
                        }
                    }
                }
            }
        }

        // ÂàõÂª∫DOMÁΩëÊ†º
        function createDOMGrid(gridSize) {
            const grid = document.getElementById('game-grid');
            
            // ÂÖàÊ∏ÖÈô§Áé∞ÊúâÁΩëÊ†ºÂíåÊâÄÊúâ‰∫ã‰ª∂ÁõëÂê¨Âô®
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${gridSize}, minmax(0, 1fr))`;
            
            // Á°Æ‰øùÊ∏ÖÈô§‰ªª‰ΩïÊÆãÁïôÁöÑËøûÊé•Á∫ø
            clearConnectionLines();
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'letter-cell bg-blue-100 flex items-center justify-center shadow-lg border-2 border-white/50';
                    cell.textContent = gameGrid[row][col];
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂ÁõëÂê¨
                    cell.addEventListener('click', toggleCellSelection);
                    
                    grid.appendChild(cell);
                }
            }
        }

        // ÁÇπÂáªÂàáÊç¢ÂçïÂÖÉÊ†ºÈÄâÊã©Áä∂ÊÄÅ
        function toggleCellSelection(event) {
            const cell = event.target;
            if (!cell.classList.contains('letter-cell')) {
                return;
            }
            
            // ÂÖÅËÆ∏ÈáçÂ§ç‰ΩøÁî®Â∑≤ÊâæÂà∞ÁöÑÂ≠óÊØç
            
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÈÄâÊã©‰∫ÜËøô‰∏™ÂçïÂÖÉÊ†º
            const existingIndex = selectedCells.findIndex(c => c.row === row && c.col === col);
            
            if (existingIndex !== -1) {
                // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÊúÄÂêé‰∏Ä‰∏™ÈÄâÊã©ÁöÑÂçïÂÖÉÊ†ºÔºåÁßªÈô§ÂÆÉ
                if (existingIndex === selectedCells.length - 1) {
                    removeCellFromSelection(existingIndex);
                } else {
                    // Â¶ÇÊûúÁÇπÂáªÁöÑ‰∏çÊòØÊúÄÂêé‰∏Ä‰∏™ÔºåÈáçÊñ∞ÂºÄÂßãÈÄâÊã©
                    clearSelection();
                    addCellToSelection(cell, row, col);
                }
            } else {
                // Áõ¥Êé•Ê∑ªÂä†Âà∞ÈÄâÊã©Ôºå‰∏çÈôêÂà∂Áõ∏ÈÇª
                addCellToSelection(cell, row, col);
            }
        }

        // Ê∑ªÂä†ÂçïÂÖÉÊ†ºÂà∞ÈÄâÊã©
        function addCellToSelection(cell, row, col) {
            selectedCells.push({row, col, element: cell});
            cell.classList.add('selected');
            
            // ÁªòÂà∂ËøûÊé•Á∫ø
            if (selectedCells.length > 1) {
                drawConnectionLine(selectedCells[selectedCells.length - 2], selectedCells[selectedCells.length - 1]);
            }
            
            // Êõ¥Êñ∞ÂΩìÂâçÂçïËØçÊòæÁ§∫
            updateCurrentWord();
        }

        // ‰ªéÈÄâÊã©‰∏≠ÁßªÈô§ÂçïÂÖÉÊ†º
        function removeCellFromSelection(index) {
            const cell = selectedCells[index];
            cell.element.classList.remove('selected');
            selectedCells.splice(index, 1);
            
            // ÈáçÁªòËøûÊé•Á∫ø
            clearConnectionLines();
            for (let i = 1; i < selectedCells.length; i++) {
                drawConnectionLine(selectedCells[i-1], selectedCells[i]);
            }
            
            // Êõ¥Êñ∞ÂΩìÂâçÂçïËØçÊòæÁ§∫
            updateCurrentWord();
        }

        // Êõ¥Êñ∞ÂΩìÂâçÂçïËØçÊòæÁ§∫
        function updateCurrentWord() {
            if (selectedCells.length === 0) {
                currentWord = '';
                return;
            }
            
            currentWord = selectedCells.map(cell => gameGrid[cell.row][cell.col]).join('');
        }

        // ÊâãÂä®Êèê‰∫§ÂΩìÂâçÂçïËØç
        function submitCurrentWord() {
            if (selectedCells.length === 0) {
                return;
            }
            checkSelectedWord();
        }

        // Ê£ÄÊü•ËøûÊé•ÊòØÂê¶ÊúâÊïà
        function isValidConnection(cell1, cell2) {
            const deltaRow = Math.abs(cell1.row - cell2.row);
            const deltaCol = Math.abs(cell1.col - cell2.col);
            
            // ÂÖÅËÆ∏Ê®™Âêë„ÄÅÁ∫µÂêë„ÄÅÊñúÂêëËøûÊé•
            return (deltaRow <= 1 && deltaCol <= 1) && !(deltaRow === 0 && deltaCol === 0);
        }

        // ÁªòÂà∂ËøûÊé•Á∫ø
        function drawConnectionLine(cell1, cell2) {
            const rect1 = cell1.element.getBoundingClientRect();
            const rect2 = cell2.element.getBoundingClientRect();
            
            const x1 = rect1.left + rect1.width / 2;
            const y1 = rect1.top + rect1.height / 2;
            const x2 = rect2.left + rect2.width / 2;
            const y2 = rect2.top + rect2.height / 2;
            
            const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            
            const line = document.createElement('div');
            line.className = 'connection-line';
            line.style.left = x1 + 'px';
            line.style.top = y1 + 'px';
            line.style.width = length + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            
            document.body.appendChild(line);
            connectionLines.push(line);
        }

        // Ê∏ÖÈô§ËøûÊé•Á∫ø
        function clearConnectionLines() {
            // Ê∏ÖÈô§ËÆ∞ÂΩïÁöÑËøûÊé•Á∫ø
            connectionLines.forEach(line => {
                if (line && line.parentNode) {
                    line.remove();
                }
            });
            connectionLines = [];
            
            // Ê∏ÖÈô§ÈÄâÊã©Áä∂ÊÄÅ
            document.querySelectorAll('.letter-cell.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // Êõ¥ÂÖ®Èù¢Âú∞Ê∏ÖÈô§‰ªª‰ΩïÂèØËÉΩÊÆãÁïôÁöÑËøûÊé•Á∫øÂÖÉÁ¥†
            const remainingLines = document.querySelectorAll('.connection-line');
            remainingLines.forEach(line => {
                if (line && line.parentNode) {
                    line.remove();
                }
            });
            
            // Ê∏ÖÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÂÖ∂‰ªñËßÜËßâËøûÊé•ÂÖÉÁ¥†
            const otherConnections = document.querySelectorAll('[class*="connection"], [class*="line"]');
            otherConnections.forEach(el => {
                if (el.className.includes('connection-line') || 
                    el.className.includes('word-connection') ||
                    el.style.position === 'absolute' && el.style.height === '6px') {
                    el.remove();
                }
            });
            
            // ÈáçÁΩÆÈÄâ‰∏≠ÂçïÂÖÉÊ†ºÊï∞ÁªÑ
            selectedCells = [];
            currentWord = '';
        }

        // Ê£ÄÊü•ÈÄâ‰∏≠ÁöÑÂçïËØç
        function checkSelectedWord() {
            if (selectedCells.length < 3) { // Ëá≥Â∞ë3‰∏™Â≠óÊØçÊâçËÉΩÁªÑÊàêÊúâÊïàÂçïËØç
                clearSelection();
                return;
            }
            
            const selectedWord = selectedCells.map(cell => gameGrid[cell.row][cell.col]).join('');
            const reverseWord = selectedWord.split('').reverse().join('');
            
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÊúâÊïàËã±ËØ≠ÂçïËØç‰∏îÊú™ÊâæÂà∞Ëøá
            const isSelectedWordValid = isValidEnglishWord(selectedWord);
            const isReverseWordValid = isValidEnglishWord(reverseWord);
            const isValidWord = isSelectedWordValid || isReverseWordValid;
            const finalWord = isSelectedWordValid ? selectedWord : reverseWord;
            
            if (isValidWord && !foundWords.includes(finalWord)) {
                // ÊâæÂà∞ÊúâÊïàÂçïËØç - Ëß¶ÂèëÂ∫ÜÁ•ùÂä®Áîª
                foundWords.push(finalWord);
                
                // ÊòæÁ§∫Â∫ÜÁ•ùÂä®ÁîªÂíåÂèçÈ¶à
                const wordDisplay = getWordDisplay(finalWord);
                const celebrationMessage = wordDisplay.isUnknown ? 
                    `üåü ${wordDisplay.message} ${wordDisplay.text}!` : 
                    `üéâ ÊâæÂà∞ÂçïËØç: ${wordDisplay.text}!`;
                createCelebration(celebrationMessage);
                showWordFoundFeedback(finalWord);
                
                // Â¶ÇÊûúÊòØÁõÆÊ†áÂçïËØçÔºåÁªô‰∫àÈ¢ùÂ§ñÂä†ÂàÜ
                const isTargetWord = targetWords.includes(finalWord);
                if (isTargetWord) {
                    // Âú®ÁΩëÊ†º‰∏äÊñπÊòæÁ§∫È¢ùÂ§ñÂä†ÂàÜÊèêÁ§∫
                    setTimeout(() => {
                        const gameGrid = document.querySelector('.bg-white.rounded-3xl.shadow-2xl');
                        if (gameGrid) {
                            const gridRect = gameGrid.getBoundingClientRect();
                            const bonusMessage = document.createElement('div');
                            bonusMessage.className = 'fixed z-50 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg font-bold text-sm transform transition-all duration-300 text-center';
                            bonusMessage.style.left = (gridRect.left + gridRect.width / 2) + 'px';
                            bonusMessage.style.top = (gridRect.top - 40) + 'px';
                            bonusMessage.style.transform = 'translateX(-50%) scale(0)';
                            bonusMessage.innerHTML = '‚≠ê ÁõÆÊ†áÂçïËØçÂä†ÂàÜ!';
                            
                            document.body.appendChild(bonusMessage);
                            
                            setTimeout(() => {
                                bonusMessage.style.transform = 'translateX(-50%) scale(1)';
                            }, 10);
                            
                            setTimeout(() => {
                                if (bonusMessage.parentNode) {
                                    bonusMessage.style.opacity = '0';
                                    setTimeout(() => bonusMessage.remove(), 300);
                                }
                            }, 1500);
                        }
                    }, 500);
                }
                
                // Ê†áËÆ∞ÊâæÂà∞ÁöÑÂ≠óÊØç
                selectedCells.forEach(cell => {
                    cell.element.classList.remove('selected');
                    cell.element.classList.add('found', 'word-found');
                });
                
                // Ê∑ªÂä†Âà∞Â∑≤ÊâæÂà∞ÂçïËØçÂàóË°®
                addFoundWord(finalWord);
                
                // ËÆ°ÁÆóÂæóÂàÜÔºàÁõÆÊ†áÂçïËØçÂä†ÂàÜ + Êú™Áü•ÂçïËØçÂ•ñÂä±Ôºâ
                const baseScore = finalWord.length * 10 + (timeLeft > 0 ? Math.floor(timeLeft / 10) : 0);
                let bonusMultiplier = isTargetWord ? 2 : 1; // ÁõÆÊ†áÂçïËØçÂèåÂÄçÂä†ÂàÜ
                let unknownWordBonus = wordDisplay.isUnknown ? wordDisplay.bonusScore : 0; // Êú™Áü•ÂçïËØçÂ•ñÂä±
                const wordScore = baseScore * bonusMultiplier + unknownWordBonus;
                score += wordScore;
                
            // Êí≠ÊîæÊàêÂäüÈü≥Êïà‰∏éÂçïËØçËØªÈü≥ÔºàÁ°Æ‰øùËØ≠Èü≥Â∑≤ÂàùÂßãÂåñÔºâ
            setTimeout(() => {
                gameManager.speak('Excellent!');
                setTimeout(() => gameManager.speak(finalWord), 400);
            }, 0);
                
                // Ê∏ÖÈô§ÂΩìÂâçÈÄâÊã©Áä∂ÊÄÅÔºåÂáÜÂ§á‰∏ã‰∏Ä‰∏™ÂçïËØç
                clearConnectionLines();
                selectedCells = [];
                
                // Êõ¥Êñ∞ÁïåÈù¢
                updateGameInterface();
                
            } else {
                // ‰∏çÊòØÊúâÊïàÂçïËØçÊàñÂ∑≤ÊâæÂà∞Ëøá
                selectedCells.forEach(cell => {
                    cell.element.classList.remove('selected');
                    cell.element.classList.add('wrong-animation');
                    setTimeout(() => cell.element.classList.remove('wrong-animation'), 600);
                });
                
                // ÊòæÁ§∫ÈîôËØØÊèêÁ§∫
                if (selectedWord.length >= 3) {
                    if (!isValidEnglishWord(selectedWord) && !isValidEnglishWord(reverseWord)) {
                        showHintMessage(`‚ùå "${selectedWord}" ‰∏çÊòØÊúâÊïàÁöÑËã±ËØ≠ÂçïËØç`, 'warning');
                    } else {
                        showHintMessage(`‚úÖ "${finalWord}" ÊòØÊúâÊïàÂçïËØçÔºå‰ΩÜÂ∑≤ÁªèÊâæËøá‰∫ÜÔºÅ`, 'warning');
                    }
                }
                
                // Ê∏ÖÁêÜÈîôËØØÈÄâÊã©
                setTimeout(() => {
                    clearConnectionLines();
                    selectedCells = [];
                }, 600);
            }
        }

        // Ê∏ÖÈô§ÈÄâÊã©Áä∂ÊÄÅ
        function clearSelection() {
            selectedCells.forEach(cell => {
                cell.element.classList.remove('selected');
            });
            clearConnectionLines();
            selectedCells = [];
        }

        // Ê∑ªÂä†ÊâæÂà∞ÁöÑÂçïËØçÂà∞ÂàóË°®
        function addFoundWord(word) {
            console.log('Ë∞ÉÁî® addFoundWord:', word); // Ë∞ÉËØï‰ø°ÊÅØ
            const container = document.getElementById('found-words-list');
            console.log('ÊâæÂà∞ÂÆπÂô®:', container); // Ë∞ÉËØï‰ø°ÊÅØ
            
            if (!container) {
                console.error('Êâæ‰∏çÂà∞ found-words-list ÂÆπÂô®ÔºÅ');
                return;
            }
            
            // Â¶ÇÊûúÊòØÁ¨¨‰∏Ä‰∏™ÂçïËØçÔºåÊ∏ÖÈô§ÊèêÁ§∫ÊñáÊú¨
            if (foundWords.length === 1) {
                container.innerHTML = '';
            }
            
            const wordDisplay = getWordDisplay(word);
            const wordItem = document.createElement('span');
            
            // Ê†πÊçÆÊòØÂê¶‰∏∫Êú™Áü•ÂçïËØç‰ΩøÁî®‰∏çÂêåÊ†∑Âºè
            if (wordDisplay.isUnknown) {
                // Êú™Áü•ÂçïËØç‰ΩøÁî®ÈáëËâ≤Ê∏êÂèòÂíåÁâπÊÆäÊ†∑Âºè
                wordItem.className = 'inline-flex items-center bg-gradient-to-r from-yellow-400 to-orange-500 text-white font-bold rounded-full px-3 py-2 m-1 text-sm shadow-lg word-found border-2 border-yellow-300';
            } else {
                // Â∑≤Áü•ÂçïËØç‰ΩøÁî®ÂéüÊù•ÁöÑÁªøËâ≤Ê†∑Âºè
                wordItem.className = 'inline-flex items-center bg-gradient-to-r from-secondary to-green-600 text-white font-bold rounded-full px-3 py-2 m-1 text-sm shadow-lg word-found';
            }
            
            wordItem.innerHTML = `
                <span class="mr-2">${wordDisplay.text}</span>
                <button onclick="gameManager.speak('${word}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full w-6 h-6 flex items-center justify-center text-xs transition-all duration-200 hover:scale-110" title="ÁÇπÂáªÂèëÈü≥">
                    <i class="fa fa-volume-up"></i>
                </button>
            `;
            container.appendChild(wordItem);
            console.log('Â∑≤Ê∑ªÂä†ÂçïËØçÊ†áÁ≠æ:', wordItem); // Ë∞ÉËØï‰ø°ÊÅØ
        }

        // Êõ¥Êñ∞Ê∏∏ÊàèÁïåÈù¢
        function updateGameInterface() {
            // Êõ¥Êñ∞‰∏ªÈ¢òÊòæÁ§∫
            const themeElement = document.getElementById('theme-display');
            if (themeElement && gameThemes[currentTheme]) {
                const totalLevels = maxLevels[currentDifficulty];
                themeElement.textContent = `${gameThemes[currentTheme].name} - Á¨¨${currentLevel}ÂÖ≥/ÂÖ±${totalLevels}ÂÖ≥`;
            }
            
            // Êõ¥Êñ∞‰∏ªÈ¢òÊèêÁ§∫
            const themeHintElement = document.getElementById('theme-hint');
            if (themeHintElement && gameThemes[currentTheme]) {
                const themeNames = {
                    'animals': 'Âä®Áâ©Á±ª',
                    'colors': 'È¢úËâ≤Á±ª', 
                    'food': 'È£üÁâ©Á±ª'
                };
                themeHintElement.textContent = themeNames[currentTheme] || '‰∏ªÈ¢òÁ±ª';
            }
            
            // Êõ¥Êñ∞ÂàÜÊï∞ÊòæÁ§∫
            const scoreElement = document.getElementById('score-display');
            if (scoreElement) scoreElement.textContent = score;
            
            // Êõ¥Êñ∞ËøõÂ∫¶ÊòæÁ§∫ÔºàÊòæÁ§∫ÂÆûÈôÖÈúÄË¶ÅÊâæÂà∞ÁöÑÂçïËØçÊï∞Ôºâ
            const progressElement = document.getElementById('progress-display');
            if (progressElement) {
                const settings = difficultySettings[currentDifficulty];
                const requiredWordsCount = settings.wordsPerLevel[currentLevel - 1] || settings.wordsPerLevel[settings.wordsPerLevel.length - 1];
                progressElement.textContent = `${foundWords.length}/${requiredWordsCount}`;
            }
            
            // Êõ¥Êñ∞ËÆ°Êó∂Âô®ÊòæÁ§∫
            const timeElement = document.getElementById('time-left');
            if (timeElement) timeElement.textContent = timeLeftDecimal.toFixed(2);
            
            // Ê£ÄÊü•ÊòØÂê¶ÂÆåÊàêÊ∏∏ÊàèÔºàÊâæÂà∞Ë∂≥Â§üÊï∞ÈáèÁöÑÂçïËØçÂç≥ÂèØÔºâ
            const settings = difficultySettings[currentDifficulty];
            const requiredWordsCount = settings.wordsPerLevel[currentLevel - 1] || settings.wordsPerLevel[settings.wordsPerLevel.length - 1];
            
            if (foundWords.length >= requiredWordsCount) {
                // ÈÅøÂÖçÈáçÂ§çËß¶ÂèëÔºöÂÖàÊ∏ÖÈô§‰∏ä‰∏ÄÊ¨°ÁöÑÂª∂Ëøü
                if (levelCompleteTimeout) {
                    clearTimeout(levelCompleteTimeout);
                }
                levelCompleteTimeout = setTimeout(() => {
                    // Ëã•ÁªìÊûúÈ°µÂ∑≤ÊòæÁ§∫ÊàñÁä∂ÊÄÅÂ∑≤ÈáçÁΩÆÔºå‰∏çÂÜçËß¶Âèë
                    const resultHidden = document.getElementById('result-screen').classList.contains('hidden');
                    if (resultHidden) {
                        gameComplete();
                    }
                }, 800); // Êõ¥Áü≠Âª∂ËøüÔºåÂáèÂ∞ëË∑®ÂÖ≥Âç°ÈÅóÁïô
            }
        }

        // ÂºÄÂßãËÆ°Êó∂
        function startTimer() {
            if (!timerModeEnabled) {
                // ÂÄíËÆ°Êó∂Ê®°ÂºèÂÖ≥Èó≠Êó∂ÔºåÈöêËóèËÆ°Êó∂Âô®ÊòæÁ§∫
                const timerElement = document.querySelector('.bg-accent');
                if (timerElement && timerElement.querySelector('#time-left')) {
                    timerElement.style.display = 'none';
                }
                return;
            }
            
            // ÂÄíËÆ°Êó∂Ê®°ÂºèÂºÄÂêØÊó∂ÔºåÊòæÁ§∫ËÆ°Êó∂Âô®
            const timerElement = document.querySelector('.bg-accent');
            if (timerElement && timerElement.querySelector('#time-left')) {
                timerElement.style.display = 'flex';
            }
            
            gameTimer = setInterval(() => {
                timeLeftDecimal -= 0.01; // ÊØè10ÊØ´ÁßíÂáèÂ∞ë0.01Áßí
                timeLeft = Math.floor(timeLeftDecimal); // ‰øùÊåÅÊï¥Êï∞ÁâàÊú¨Áî®‰∫éÈÄªËæëÂà§Êñ≠
                updateGameInterface();
                
                if (timeLeftDecimal <= 0) {
                    clearInterval(gameTimer);
                    gameTimeout();
                }
            }, 10);
        }

        // ÊâæÂà∞ÁΩëÊ†º‰∏≠ÁöÑÂçïËØç‰ΩçÁΩÆ
        function findWordInGrid(word) {
            const gridSize = gameGrid.length;
            const directions = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],           [0, 1],
                [1, -1],  [1, 0],  [1, 1]
            ];
            
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    // Ê£ÄÊü•Ê≠£ÂêëÂíåÂèçÂêë
                    for (let [dx, dy] of directions) {
                        if (checkWordAtPosition(word, row, col, dx, dy)) {
                            return getWordPath(word, row, col, dx, dy);
                        }
                        if (checkWordAtPosition(word.split('').reverse().join(''), row, col, dx, dy)) {
                            return getWordPath(word.split('').reverse().join(''), row, col, dx, dy);
                        }
                    }
                }
            }
            return null;
        }
        
        function checkWordAtPosition(word, startRow, startCol, dx, dy) {
            const gridSize = gameGrid.length;
            
            for (let i = 0; i < word.length; i++) {
                const row = startRow + i * dx;
                const col = startCol + i * dy;
                
                if (row < 0 || row >= gridSize || col < 0 || col >= gridSize) {
                    return false;
                }
                
                if (gameGrid[row][col].toLowerCase() !== word[i].toLowerCase()) {
                    return false;
                }
            }
            return true;
        }
        
        function getWordPath(word, startRow, startCol, dx, dy) {
            const path = [];
            for (let i = 0; i < word.length; i++) {
                const row = startRow + i * dx;
                const col = startCol + i * dy;
                path.push({ row, col });
            }
            return path;
        }

        // ÊîπËøõÁöÑÊèêÁ§∫Á≥ªÁªü
        function useHint() {
            if (hintsLeft <= 0) {
                showHintMessage('üí° Ê≤°ÊúâÂâ©‰ΩôÊèêÁ§∫‰∫ÜÔºÅ', 'warning');
                return;
            }
            
            // ÊâæÂà∞ËøòÊú™ÊâæÂà∞ÁöÑÂçïËØç
            const remainingWords = targetWords.filter(word => !foundWords.includes(word));
            
            if (remainingWords.length === 0) {
                showHintMessage('üéâ ÊâÄÊúâÁõÆÊ†áÂçïËØçÈÉΩÂ∑≤ÊâæÂà∞ÔºÅ', 'success');
                return;
            }
            
            // ÈÄâÊã©‰∏Ä‰∏™ËøòÊú™ÊâæÂà∞ÁöÑÂçïËØçËøõË°åÊèêÁ§∫
            const hintWord = remainingWords[Math.floor(Math.random() * remainingWords.length)];
            const wordPath = findWordInGrid(hintWord);
            
            if (wordPath) {
                // Ê†πÊçÆÂâ©‰ΩôÊèêÁ§∫Ê¨°Êï∞ÂÜ≥ÂÆöÊèêÁ§∫Á®ãÂ∫¶
                let hintCellsCount;
                let hintMessage;
                if (hintsLeft === 3) {
                    // Á¨¨‰∏ÄÊ¨°ÊèêÁ§∫ÔºöÊòæÁ§∫Á¨¨‰∏Ä‰∏™Â≠óÊØç
                    hintCellsCount = 1;
                    hintMessage = `üí° ÊèêÁ§∫: ÊâæÊâæ‰ª• "${hintWord[0].toUpperCase()}" ÂºÄÂ§¥ÁöÑÂçïËØç`;
                } else if (hintsLeft === 2) {
                    // Á¨¨‰∫åÊ¨°ÊèêÁ§∫ÔºöÊòæÁ§∫Ââç‰∏§‰∏™Â≠óÊØç
                    hintCellsCount = Math.min(2, hintWord.length);
                    hintMessage = `üí° ÊèêÁ§∫: ÊâæÊâæ‰ª• "${hintWord.substring(0, hintCellsCount).toUpperCase()}" ÂºÄÂ§¥ÁöÑÂçïËØç`;
                } else {
                    // ÊúÄÂêé‰∏ÄÊ¨°ÊèêÁ§∫ÔºöÊòæÁ§∫Êï¥‰∏™ÂçïËØçÁöÑ‰ΩçÁΩÆ
                    hintCellsCount = hintWord.length;
                    hintMessage = `üí° ÊèêÁ§∫: ÂçïËØç "${hintWord.toUpperCase()}" ÁöÑÂÆåÊï¥‰ΩçÁΩÆ`;
                }
                
                showHintMessage(hintMessage, 'info');
                
                // È´ò‰∫ÆÊèêÁ§∫ÁöÑÂ≠óÊØçÊ†ºÂ≠ê
                for (let i = 0; i < hintCellsCount; i++) {
                    const { row, col } = wordPath[i];
                    const cellElement = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    if (cellElement && !cellElement.classList.contains('found')) {
                        cellElement.classList.add('hint');
                        setTimeout(() => cellElement.classList.remove('hint'), 4000);
                    }
                }
            } else {
                // Â¶ÇÊûúÊâæ‰∏çÂà∞ÂçïËØçÂú®ÁΩëÊ†º‰∏≠ÁöÑ‰ΩçÁΩÆÔºåÂè™ÊòæÁ§∫ÂçïËØçÊèêÁ§∫
                showHintMessage(`üí° ÊèêÁ§∫: ËØïËØïÊâæÊâæÂçïËØç "${hintWord.toUpperCase()}"Ôºà${hintWord.length} ‰∏™Â≠óÊØçÔºâ`, 'info');
            }
            
            hintsLeft--;
            updateGameInterface();
        }
        
        // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØÁöÑÂáΩÊï∞
        function showHintMessage(message, type = 'info') {
            // ÁßªÈô§Â∑≤Â≠òÂú®ÁöÑÊèêÁ§∫Ê∂àÊÅØ
            const existingHint = document.querySelector('.hint-message');
            if (existingHint) {
                existingHint.remove();
            }
            
            // Âú®ÁΩëÊ†ºÂ∑¶‰æßÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØ
            const gameGrid = document.querySelector('.bg-white.rounded-3xl.shadow-2xl');
            let hintDiv;
            
            if (gameGrid) {
                const gridRect = gameGrid.getBoundingClientRect();
                hintDiv = document.createElement('div');
                hintDiv.className = 'hint-message fixed z-50 px-4 py-3 rounded-xl shadow-lg font-bold text-sm max-w-xs';
                hintDiv.style.left = Math.max(20, gridRect.left - 250) + 'px';
                hintDiv.style.top = (gridRect.top + 20) + 'px';
            } else {
                // Â¶ÇÊûúÊâæ‰∏çÂà∞ÁΩëÊ†ºÔºå‰ΩøÁî®ÈªòËÆ§‰ΩçÁΩÆ
                hintDiv = document.createElement('div');
                hintDiv.className = 'hint-message fixed top-20 left-1/2 transform -translate-x-1/2 z-50 px-4 py-3 rounded-xl shadow-lg font-bold text-sm max-w-sm text-center';
            }
            
            // Ê†πÊçÆÁ±ªÂûãËÆæÁΩÆ‰∏çÂêåÊ†∑Âºè
            switch (type) {
                case 'success':
                    hintDiv.className += ' bg-green-500 text-white';
                    break;
                case 'warning':
                    hintDiv.className += ' bg-orange-500 text-white';
                    break;
                case 'info':
                default:
                    hintDiv.className += ' bg-blue-500 text-white';
                    break;
            }
            
            hintDiv.innerHTML = message;
            hintDiv.style.opacity = '0';
            hintDiv.style.transform = 'translateX(-20px)';
            hintDiv.style.transition = 'all 0.3s ease-out';
            
            document.body.appendChild(hintDiv);
            
            // Âä®ÁîªÊòæÁ§∫
            setTimeout(() => {
                hintDiv.style.opacity = '1';
                hintDiv.style.transform = 'translateX(0)';
            }, 10);
            
            // 3ÁßíÂêéËá™Âä®ÁßªÈô§
            setTimeout(() => {
                if (hintDiv.parentNode) {
                    hintDiv.style.opacity = '0';
                    hintDiv.style.transform = 'translateX(-20px)';
                    setTimeout(() => hintDiv.remove(), 300);
                }
            }, 3000);
        }

        // Ê∏∏ÊàèË∂ÖÊó∂
        function gameTimeout() {
            clearInterval(gameTimer);
            const settings = difficultySettings[currentDifficulty];
            const requiredWordsCount = settings.wordsPerLevel[currentLevel - 1] || settings.wordsPerLevel[settings.wordsPerLevel.length - 1];
            const accuracy = (foundWords.length / requiredWordsCount) * 100;
            const hasMoreLevels = currentLevel < maxLevels[currentDifficulty];
            const usedTime = settings.timeLimit - timeLeft;
            
            // Áõ¥Êé•ÊòæÁ§∫ÁªìÊûúÔºå‰∏çÂú®Ê∏∏ÊàèÈ°µÈù¢ÊòæÁ§∫Á≠îÊ°à
            showResult(foundWords.length >= requiredWordsCount, accuracy, usedTime, hasMoreLevels);
        }

        // ÊòæÁ§∫Êú™ÊâæÂà∞ÁöÑÂçïËØç
        function showMissedWords() {
            const missedWords = targetWords.filter(word => {
                const upperWord = word.toUpperCase();
                return !foundWords.some(found => found.toUpperCase() === upperWord);
            });
            
            // Âú®ÁΩëÊ†º‰∏≠È´ò‰∫ÆÊú™ÊâæÂà∞ÁöÑÂçïËØç
            highlightMissedWordsInGrid(missedWords);
            
            // Âú®ÁΩëÊ†ºÂè≥‰æßÊòæÁ§∫Á≠îÊ°àÊèêÁ§∫
            const gameGrid = document.querySelector('.bg-white.rounded-3xl.shadow-2xl');
            if (!gameGrid) return;
            
            const gridRect = gameGrid.getBoundingClientRect();
            const answerDiv = document.createElement('div');
            answerDiv.className = 'fixed z-40 bg-red-50 border-2 border-red-300 rounded-xl shadow-lg p-4 missed-words-display max-w-xs';
            answerDiv.setAttribute('data-cleanup-target', 'missed-words');
            
            // ‰ΩçÁΩÆÂú®ÁΩëÊ†ºÂè≥‰æß
            answerDiv.style.left = Math.min(window.innerWidth - 320, gridRect.right + 20) + 'px';
            answerDiv.style.top = gridRect.top + 'px';
            answerDiv.style.transform = 'scale(0)';
            answerDiv.style.transformOrigin = 'top left';
            answerDiv.style.transition = 'all 0.3s ease-out';
            
            answerDiv.innerHTML = `
                <h4 class="text-red-700 font-bold mb-3 text-center text-sm">‚è∞ Êó∂Èó¥Âà∞ÔºÅËøòÊúâËøô‰∫õÁõÆÊ†áÂçïËØçÔºö</h4>
                <div class="flex flex-wrap gap-2">
                    ${missedWords.map(word => `
                        <span class="inline-flex items-center bg-red-100 text-red-700 px-2 py-1 rounded-lg font-bold text-xs">
                            <span class="mr-1">${word}</span>
                            <button onclick="gameManager.speak('${word}')" class="bg-red-200 hover:bg-red-300 rounded-full w-5 h-5 flex items-center justify-center text-xs transition-all duration-200 hover:scale-110" title="ÁÇπÂáªÂèëÈü≥">
                                <i class="fa fa-volume-up" style="font-size: 8px;"></i>
                            </button>
                        </span>
                    `).join('')}
                </div>
            `;
            
            document.body.appendChild(answerDiv);
            
            // Âä®ÁîªÊòæÁ§∫
            setTimeout(() => {
                answerDiv.style.transform = 'scale(1)';
            }, 10);
        }

        // Âú®ÁΩëÊ†º‰∏≠È´ò‰∫ÆÊòæÁ§∫Êú™ÊâæÂà∞ÁöÑÂçïËØç
        function highlightMissedWordsInGrid(missedWords) {
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÈÄªËæëÊù•È´ò‰∫ÆÊòæÁ§∫ÁΩëÊ†º‰∏≠ÁöÑÂçïËØç‰ΩçÁΩÆ
            // Áî±‰∫éÂçïËØç‰ΩçÁΩÆ‰ø°ÊÅØÂú®ÊîæÁΩÆÊó∂Ê≤°Êúâ‰øùÂ≠òÔºåËøôÈáåÁÆÄÂåñÂ§ÑÁêÜ
            console.log('Êú™ÊâæÂà∞ÁöÑÂçïËØç:', missedWords);
        }

        // Ê∏∏ÊàèÂÆåÊàêÔºàÊâæÂà∞ÊâÄÊúâÁõÆÊ†áÂçïËØçÊàñÊó∂Èó¥Âà∞‰∫ÜÔºâ
        function gameComplete() {
            clearInterval(gameTimer);
            gameManager.recordProgress();
            
            const settings = difficultySettings[currentDifficulty];
            const usedTime = settings.timeLimit - timeLeft;
            const requiredWordsCount = settings.wordsPerLevel[currentLevel - 1] || settings.wordsPerLevel[settings.wordsPerLevel.length - 1];
            const accuracy = (foundWords.length / requiredWordsCount) * 100;
            const completed = foundWords.length >= requiredWordsCount;
            
            // Ê£ÄÊü•ÊòØÂê¶ËøòÊúâÊõ¥Â§öÂÖ≥Âç°
            const hasMoreLevels = currentLevel < maxLevels[currentDifficulty];
            
            showResult(completed, accuracy, usedTime, hasMoreLevels);
        }

        // ÊòæÁ§∫ÁªìÊûú
        function showResult(completed, accuracy, usedTime = 0, hasMoreLevels = false) {
            const settings = difficultySettings[currentDifficulty];
            const totalTime = settings.timeLimit - timeLeft;
            
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-words').textContent = foundWords.length;
            document.getElementById('final-time').textContent = totalTime;
            document.getElementById('final-accuracy').textContent = Math.round(accuracy) + '%';
            
            // ËØÑ‰º∞Ë°®Áé∞ÂíåËÆæÁΩÆÊ†áÈ¢ò
            let performance = '';
            let icon = '';
            let title = '';
            
            if (completed && accuracy === 100) {
                if (hasMoreLevels) {
                    title = `ÊÅ≠ÂñúÈÄöËøáÁ¨¨${currentLevel}ÂÖ≥ÔºÅ`;
                    if (usedTime < settings.timeLimit * 0.6) {
                        performance = 'ÂçïËØçÂ§ßÂ∏àÔºÅÂÆåÁæéË°®Áé∞ÔºÅ';
                        icon = 'üèÜ';
                    } else {
                        performance = 'Â§™Ê£í‰∫ÜÔºÅÂÖ®ÈÉ®ÊâæÂà∞ÔºÅ';
                        icon = 'üåü';
                    }
                } else {
                    title = 'ÊÅ≠ÂñúÂÆåÊàêÊâÄÊúâÂÖ≥Âç°ÔºÅ';
                    performance = 'ÂçïËØçÂ§ßÂ∏àÔºÅ‰Ω†Â∑≤ÁªèÂæÅÊúç‰∫ÜÊâÄÊúâÊåëÊàòÔºÅ';
                    icon = 'üëë';
                }
            } else if (accuracy >= 80) {
                title = hasMoreLevels ? `Á¨¨${currentLevel}ÂÖ≥ÂÆåÊàê` : 'Ê∏∏ÊàèÁªìÊùü';
                performance = 'ÂæàÂ•ΩÔºÅÁªßÁª≠Âä™ÂäõÔºÅ';
                icon = 'üëç';
            } else if (accuracy >= 60) {
                title = hasMoreLevels ? `Á¨¨${currentLevel}ÂÖ≥ÂÆåÊàê` : 'Ê∏∏ÊàèÁªìÊùü';
                performance = '‰∏çÈîôÔºÅÂÜçÊé•ÂÜçÂéâÔºÅ';
                icon = 'üí™';
            } else {
                title = hasMoreLevels ? `Á¨¨${currentLevel}ÂÖ≥ÁªìÊùü` : 'Ê∏∏ÊàèÁªìÊùü';
                performance = 'Âä†Ê≤πÔºÅÂ§öÁªÉ‰π†ÂçïËØçÔºÅ';
                icon = 'üìö';
            }
            
            document.getElementById('result-title').textContent = title;
            document.getElementById('result-icon').textContent = icon;
            document.getElementById('performance-text').textContent = performance;
            
            // Âú®ÁªìÊûúÈ°µÈù¢ÊòæÁ§∫Êú™ÊâæÂà∞ÁöÑÂçïËØç
            showMissedWordsInResult();
            
            // Êõ¥Êñ∞ÊåâÈíÆÊòæÁ§∫
            updateResultButtons(completed, hasMoreLevels);
            
            // ÂàáÊç¢Âà∞ÁªìÊûúÁïåÈù¢
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
        }
        
        // Âú®ÁªìÊûúÈ°µÈù¢ÊòæÁ§∫Êú™ÊâæÂà∞ÁöÑÂçïËØç
        function showMissedWordsInResult() {
            const settings = difficultySettings[currentDifficulty];
            const requiredWordsCount = settings.wordsPerLevel[currentLevel - 1] || settings.wordsPerLevel[settings.wordsPerLevel.length - 1];
            
            console.log('ÁªìÊûúÈ°µÈù¢ - ÁõÆÊ†áÂçïËØç:', targetWords, targetWords.length);
            console.log('ÁªìÊûúÈ°µÈù¢ - Â∑≤ÊâæÂà∞ÂçïËØç:', foundWords, foundWords.length);
            console.log('ÁªìÊûúÈ°µÈù¢ - Ë¶ÅÊ±ÇÂçïËØçÊï∞:', requiredWordsCount);
            
            // Â¶ÇÊûúÁî®Êà∑Â∑≤ÁªèÊâæÂà∞Ë∂≥Â§üÊï∞ÈáèÁöÑÂçïËØçÔºåÂ∞±‰∏çÊòæÁ§∫Êú™ÊâæÂà∞ÁöÑÁõÆÊ†áÂçïËØç
            if (foundWords.length >= requiredWordsCount) {
                console.log('Áî®Êà∑Â∑≤ÂÆåÊàê‰ªªÂä°Ôºå‰∏çÊòæÁ§∫Êú™ÊâæÂà∞ÁöÑÁõÆÊ†áÂçïËØç');
                return;
            }
            
            // Âè™ÊúâÂú®Êú™ÂÆåÊàê‰ªªÂä°Êó∂ÊâçÊòæÁ§∫ÁõÆÊ†áÂçïËØçÊèêÁ§∫
            const missedWords = targetWords.filter(word => {
                const upperWord = word.toUpperCase();
                return !foundWords.some(found => found.toUpperCase() === upperWord);
            });
            console.log('Êú™ÊâæÂà∞ÁöÑÁõÆÊ†áÂçïËØç:', missedWords);
            
            if (missedWords.length === 0) {
                console.log('Ê≤°ÊúâÈÅóÊºèÂçïËØçÔºå‰∏çÊòæÁ§∫');
                return; // Â¶ÇÊûúÊ≤°ÊúâÈÅóÊºèÂçïËØçÔºå‰∏çÊòæÁ§∫
            }
            
            // Èò≤Ê≠¢ÈáçÂ§çÂàõÂª∫ - ÂÖàÂà†Èô§Â∑≤Â≠òÂú®ÁöÑ
            const existingMissed = document.querySelectorAll('.missed-words-result');
            existingMissed.forEach(el => el.remove());
            
            // Âú®ÁªìÊûúÈ°µÈù¢ÁöÑÊÄßËÉΩËØÑ‰º∞‰∏ãÊñπÊ∑ªÂä†Êú™ÊâæÂà∞ÁöÑÂçïËØç
            const performanceDiv = document.getElementById('performance-text').parentNode;
            
            const missedDiv = document.createElement('div');
            missedDiv.className = 'mt-4 p-4 bg-blue-50 border-2 border-blue-200 rounded-xl missed-words-result';
            missedDiv.innerHTML = `
                <h4 class="text-blue-700 font-bold mb-3 text-center">üéØ ËøòÈúÄË¶ÅÊâæÂà∞Ëøô‰∫õÁõÆÊ†áÂçïËØçÔºö</h4>
                <div class="flex flex-wrap justify-center gap-2">
                    ${missedWords.map(word => `
                        <span class="inline-flex items-center bg-blue-100 text-blue-700 px-3 py-2 rounded-lg font-bold text-sm">
                            <span class="mr-2">${word}</span>
                            <button onclick="gameManager.speak('${word}')" class="bg-blue-200 hover:bg-blue-300 rounded-full w-6 h-6 flex items-center justify-center text-xs transition-all duration-200 hover:scale-110" title="ÁÇπÂáªÂèëÈü≥">
                                <i class="fa fa-volume-up"></i>
                            </button>
                        </span>
                    `).join('')}
                </div>
            `;
            
            performanceDiv.appendChild(missedDiv);
        }

        // Êõ¥Êñ∞ÁªìÊûúÁïåÈù¢ÊåâÈíÆÊòæÁ§∫
        function updateResultButtons(completed, hasMoreLevels) {
            const nextLevelBtn = document.getElementById('next-level-btn');
            const retryBtn = document.getElementById('retry-btn');
            
            if (completed && hasMoreLevels) {
                // ÂÆåÊàêÂΩìÂâçÂÖ≥Âç°‰∏îÊúâÊõ¥Â§öÂÖ≥Âç°ÔºåÊòæÁ§∫"‰∏ã‰∏ÄÂÖ≥"ÊåâÈíÆ
                nextLevelBtn.classList.remove('hidden');
                retryBtn.innerHTML = '<i class="fa fa-refresh mr-2"></i>ÈáçËØïÊú¨ÂÖ≥';
            } else if (hasMoreLevels) {
                // Êú™ÂÆåÊàêÂΩìÂâçÂÖ≥Âç°‰ΩÜÊúâÊõ¥Â§öÂÖ≥Âç°ÔºåÈöêËóè"‰∏ã‰∏ÄÂÖ≥"ÊåâÈíÆ
                nextLevelBtn.classList.add('hidden');
                retryBtn.innerHTML = '<i class="fa fa-refresh mr-2"></i>ÈáçËØïÊú¨ÂÖ≥';
            } else {
                // Â∑≤ÁªèÊòØÊúÄÂêé‰∏ÄÂÖ≥ÔºåÈöêËóè"‰∏ã‰∏ÄÂÖ≥"ÊåâÈíÆ
                nextLevelBtn.classList.add('hidden');
                retryBtn.innerHTML = '<i class="fa fa-refresh mr-2"></i>ÂÜçÁé©‰∏ÄÊ¨°';
            }
        }
        
        // ËøõÂÖ•‰∏ã‰∏ÄÂÖ≥
        function nextLevel() {
            if (currentLevel < maxLevels[currentDifficulty]) {
                currentLevel++;
                startGame();
            }
        }
        
        // ÈáçËØïÂΩìÂâçÂÖ≥Âç°
        function retryLevel() {
            // Á°Æ‰øùÂÆåÂÖ®ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            resetGameState();
            startGame();
        }

        // ËøîÂõûÂºÄÂßãÁïåÈù¢
        function backToStart() {
            // ÂÆåÂÖ®ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            resetGameState();
            
            // ÈáçÁΩÆÂÖ≥Âç°‰∏∫Á¨¨‰∏ÄÂÖ≥
            currentLevel = 1;
            
            // Ê∏ÖÁ©∫ÂçïËØç‰ΩøÁî®ÂéÜÂè≤ÔºàÊñ∞Ê∏∏ÊàèÂºÄÂßãÔºâ
            recentlyUsedWords.clear();
            
            // Ê∏ÖÈô§‰ªª‰ΩïÂ∫ÜÁ•ùÂä®ÁîªÂÖÉÁ¥†
            const celebrationElements = document.querySelectorAll('.celebration-overlay, .celebration-message');
            celebrationElements.forEach(el => el.remove());
            
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
        }

        // Èò≤Ê≠¢È°µÈù¢ÊªöÂä®
        document.addEventListener('touchmove', function(e) {
            if (isSelecting) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>