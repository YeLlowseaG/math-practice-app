<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‹±è¯­æ¥é¾™ - è¿çº¿æ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        neutral: '#F7FFF7',
                        text: '#1F2937'
                    },
                    fontFamily: {
                        kids: ['"Comic Sans MS"', '"Marker Felt"', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .bounce-light {
                animation: bounce-light 0.5s ease infinite alternate;
            }
            
            /* æ¸¸æˆç”»å¸ƒ */
            #game-canvas {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 20px;
                position: relative;
                overflow: hidden;
                border: 4px solid #4F46E5;
            }
            
            /* å•è¯å¡ç‰‡ */
            .word-card {
                position: absolute;
                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                border: 3px solid #e2e8f0;
                border-radius: 20px;
                padding: 12px 16px;
                text-align: center;
                cursor: pointer;
                user-select: none;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                min-width: 130px;
                min-height: 80px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                position: relative;
            }
            
            /* åˆ†ç±»å¾½ç«  */
            .category-badge {
                position: absolute;
                top: 4px;
                right: 4px;
                width: 12px;
                height: 12px;
                border-radius: 50%;
                opacity: 0.8;
            }
            
            .category-badge.animals { background: #22C55E; }
            .category-badge.nature { background: #3B82F6; }
            .category-badge.objects { background: #F59E0B; }
            .category-badge.food { background: #EF4444; }
            .category-badge.others { background: #8B5CF6; }
            
            .word-card:hover {
                transform: scale(1.1);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
                border-color: #4F46E5;
            }
            
            .word-card.selected {
                background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
                color: white;
                border-color: #FCD34D;
                transform: scale(1.1);
                box-shadow: 0 0 0 4px rgba(252, 211, 77, 0.4);
            }
            
            .word-card.connected {
                background: linear-gradient(135deg, #10B981 0%, #059669 100%);
                color: white;
                border-color: #34D399;
                animation: pulseGreen 2s ease-in-out infinite;
            }
            
            .word-card.wrong {
                background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
                color: white;
                border-color: #F87171;
                animation: shakeWrong 0.5s ease-in-out;
            }
            
            @keyframes pulseGreen {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.05); }
            }
            
            @keyframes shakeWrong {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            
            /* è¿æ¥çº¿ */
            .connection-line {
                position: absolute;
                height: 6px;
                background: linear-gradient(90deg, #FCD34D 0%, #F59E0B 100%);
                border-radius: 3px;
                transform-origin: left center;
                opacity: 0.9;
                z-index: 5;
                pointer-events: none;
                box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
            }
            
            .connection-line.success {
                background: linear-gradient(90deg, #22C55E 0%, #16A34A 100%);
                animation: lineGlow 1s ease-in-out;
                box-shadow: 0 0 15px rgba(34, 197, 94, 0.7);
            }
            
            @keyframes lineGlow {
                0%, 100% { opacity: 0.9; }
                50% { opacity: 1; transform: scale(1, 1.5); }
            }
            
            /* å¾—åˆ†åŠ¨ç”» */
            .score-popup {
                position: absolute;
                font-size: 2rem;
                font-weight: bold;
                color: #22C55E;
                text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                animation: scoreFloat 1.5s ease-out forwards;
                pointer-events: none;
                z-index: 20;
            }
            
            @keyframes scoreFloat {
                0% { 
                    transform: translateY(0) scale(1);
                    opacity: 1;
                }
                100% { 
                    transform: translateY(-80px) scale(1.3);
                    opacity: 0;
                }
            }
            
            /* ç²’å­æ•ˆæœ */
            .particle {
                position: absolute;
                width: 8px;
                height: 8px;
                background: #FCD34D;
                border-radius: 50%;
                pointer-events: none;
                animation: particleFly 2s ease-out forwards;
            }
            
            @keyframes particleFly {
                0% { 
                    transform: scale(1) rotate(0deg);
                    opacity: 1;
                }
                100% { 
                    transform: scale(0) rotate(360deg) translateY(-100px);
                    opacity: 0;
                }
            }
            
            @keyframes bounce-light {
                from { transform: translateY(0); }
                to { transform: translateY(-5px); }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 min-h-screen font-kids text-text">
    
    <!-- å¼€å§‹ç•Œé¢ -->
    <div id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-4 relative">
        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <button onclick="window.location.href='index.html'" class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800 z-40">
            <i class="fa fa-home mr-2"></i>é¦–é¡µ
        </button>
        
        <div class="text-center w-full max-w-lg mx-auto bg-white rounded-3xl shadow-2xl p-8 transform transition-all duration-500">
            <div class="flex justify-center mb-4">
                <div class="w-16 h-16 bg-gradient-to-br from-primary to-purple-600 rounded-full flex items-center justify-center text-white text-2xl shadow-lg relative overflow-hidden">
                    <i class="fa fa-link"></i>
                    <div class="absolute inset-0 bg-white opacity-20 rounded-full animate-ping"></div>
                </div>
            </div>
            
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary via-purple-600 to-blue-600 mb-3">è‹±è¯­æ¥é¾™</h1>
            
            <div class="bg-purple-50 rounded-2xl p-3 mb-4 text-sm">
                <p class="text-purple-800 text-sm font-medium mb-2">
                    <i class="fa fa-gamepad mr-2 text-blue-500"></i>å­¦ä¹ ç›®æ ‡
                </p>
                <p class="text-purple-700 text-sm">
                    ğŸ“š å­¦ä¹ 300+å¸¸ç”¨è‹±è¯­å•è¯<br>
                    ğŸ¯ æŒæ¡å•è¯æ‹¼å†™å’Œå­—æ¯é¡ºåº<br>
                    ğŸ’¡ äº†è§£å•è¯å«ä¹‰å’Œåˆ†ç±»<br>
                    ğŸ”— ä¾‹å¦‚: CAT(çŒ«) â†’ TREE(æ ‘) â†’ ELEPHANT(å¤§è±¡)
                </p>
            </div>
            
            <div class="grid grid-cols-2 gap-3 text-sm text-gray-600 mb-4">
                <div class="flex items-center">
                    <i class="fa fa-graduation-cap text-blue-500 mr-2"></i>
                    <span>è¯æ±‡å­¦ä¹ </span>
                </div>
                <div class="flex items-center">
                    <i class="fa fa-heart text-pink-500 mr-2"></i>
                    <span>é€‚åˆ8-16å²</span>
                </div>
                <div class="flex items-center">
                    <i class="fa fa-clock-o text-purple-500 mr-2"></i>
                    <span>é™æ—¶æŒ‘æˆ˜</span>
                </div>
                <div class="flex items-center">
                    <i class="fa fa-star text-yellow-500 mr-2"></i>
                    <span>è¶…æœ‰è¶£</span>
                </div>
            </div>
            
            <!-- å¾½ç« é¢„è§ˆ -->
            <div id="badge-preview" class="mb-6">
                <h3 class="text-sm font-bold mb-2">æˆ‘çš„å¾½ç« </h3>
                <div id="badge-preview-grid" class="flex justify-center gap-3 flex-wrap"></div>
                <div class="text-xs text-gray-400 mt-1">æœ¬æ¸¸æˆå¾½ç« é¢„è§ˆï¼ˆå·²è·é«˜äº®ï¼Œæœªè·ç°æ˜¾ï¼‰</div>
            </div>

            <button onclick="startGame()" class="w-full bg-gradient-to-r from-primary to-purple-600 hover:from-purple-600 hover:to-primary text-white font-bold py-3 px-6 rounded-2xl text-base shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95">
                å¼€å§‹æ¥é¾™ <i class="fa fa-play ml-2"></i>
            </button>
        </div>
        
        <!-- è£…é¥°å…ƒç´  -->
        <div class="absolute top-10 left-10 text-4xl text-primary/30 hidden md:block bounce-light">
            <i class="fa fa-link"></i>
        </div>
        <div class="absolute bottom-10 right-10 text-4xl text-purple-400/30 hidden md:block bounce-light" style="animation-delay: 0.3s">
            <i class="fa fa-chain"></i>
        </div>
    </div>

    <script>
    (function(){
      const GAME_KEY = 'englishChain';
      const badgeDefs = [
        { id: 'first_chain', name: 'é¦–é“¾å®Œæˆ', icon: 'ğŸ¯' },
        { id: 'combo_chain', name: 'è¿é”è¾¾äºº', icon: 'ğŸ”¥' },
        { id: 'speed_link', name: 'æé€Ÿæ¥é¾™', icon: 'âš¡' },
        { id: 'level_reach', name: 'é—¯å…³èƒ½æ‰‹', icon: 'ğŸ†' },
        { id: 'perfect_round', name: 'å®Œç¾å›åˆ', icon: 'ğŸ’' }
      ];
      function getEarnedIds(){
        try { return JSON.parse(localStorage.getItem('earnedAchievements_' + GAME_KEY) || '[]'); } catch(_) { return []; }
      }
      function renderBadgePreview(){
        const grid = document.getElementById('badge-preview-grid');
        if(!grid) return;
        const owned = new Set(getEarnedIds());
        grid.innerHTML = badgeDefs.map(a => {
          const earned = owned.has(a.id);
          const base = earned ? 'from-yellow-100 to-orange-100 border-yellow-300 text-amber-900' : 'from-gray-50 to-gray-100 border-gray-200 text-gray-400 opacity-80';
          return `
            <div class="relative w-20 h-20 rounded-2xl border-2 bg-gradient-to-br ${base} shadow-sm flex flex-col items-center justify-center overflow-hidden" title="${a.name}">
              <div class="text-2xl mb-1">${a.icon}</div>
              <div class="text-[10px] font-bold text-center leading-tight px-1">${a.name}</div>
              ${earned ? '<div class=\"absolute -right-1 -top-1 bg-amber-400 text-white text-[10px] px-1 rounded-full shadow\">å·²è·</div>' : ''}
            </div>`;
        }).join('');
      }
      document.addEventListener('DOMContentLoaded', renderBadgePreview);
    })();
    </script>

    <!-- æ¸¸æˆç•Œé¢ -->
    <div id="game-screen" class="hidden min-h-screen p-4">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div class="flex justify-between items-center mb-4">
            <button onclick="pauseGame()" class="bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600">
                <i class="fa fa-pause mr-2"></i>æš‚åœ
            </button>
            
            <div class="flex items-center space-x-4">
                <div class="bg-gradient-to-r from-primary to-purple-600 text-white px-4 py-2 rounded-full shadow-lg font-bold">
                    <i class="fa fa-clock-o mr-1"></i>
                    <span id="time-left">60</span>ç§’
                </div>
                <div class="bg-gradient-to-r from-secondary to-green-600 text-white px-4 py-2 rounded-full shadow-lg font-bold">
                    <i class="fa fa-star mr-1"></i>
                    <span id="score">0</span>
                </div>
                <div class="bg-gradient-to-r from-accent to-orange-600 text-white px-4 py-2 rounded-full shadow-lg font-bold">
                    <i class="fa fa-link mr-1"></i>
                    <span id="chain-length">0</span> é“¾
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆç”»å¸ƒ -->
        <div class="max-w-6xl mx-auto">
            <div id="game-canvas" style="width: 100%; height: 600px; margin: 0 auto; position: relative;">
                <!-- å•è¯å¡ç‰‡å’Œè¿æ¥çº¿å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- æ§åˆ¶è¯´æ˜ -->
            <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-4 mt-4 text-center text-sm text-gray-600">
                <p><i class="fa fa-hand-pointer-o mr-2"></i>æ‹–æ‹½å•è¯å¡ç‰‡è¿›è¡Œè¿çº¿ï¼Œç»„æˆæ¥é¾™é“¾æ¡</p>
                <p class="mt-1">å½“å‰ç›®æ ‡: <span id="current-target" class="font-bold text-purple-600">è¿æ¥ä»»æ„ä¸¤ä¸ªå•è¯å¼€å§‹</span></p>
            </div>
            
            <!-- å·²è¿æ¥çš„é“¾æ¡æ˜¾ç¤º -->
            <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-4 mt-4">
                <h3 class="font-bold text-purple-600 mb-2">
                    <i class="fa fa-chain mr-2"></i>æ¥é¾™é“¾æ¡
                </h3>
                <div id="chain-display" class="flex flex-wrap items-center gap-2">
                    <span class="text-gray-500">å¼€å§‹è¿æ¥å•è¯...</span>
                </div>
            </div>
            
            <!-- å­¦ä¹ ç»Ÿè®¡é¢æ¿ -->
            <div class="bg-white/90 backdrop-blur-sm rounded-2xl p-4 mt-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-sm">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-xs mb-1">
                            <i class="fa fa-paw"></i>
                        </div>
                        <div class="font-bold text-green-600" id="animals-count">0</div>
                        <div class="text-gray-600">åŠ¨ç‰©</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs mb-1">
                            <i class="fa fa-leaf"></i>
                        </div>
                        <div class="font-bold text-blue-600" id="nature-count">0</div>
                        <div class="text-gray-600">è‡ªç„¶</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center text-white text-xs mb-1">
                            <i class="fa fa-cube"></i>
                        </div>
                        <div class="font-bold text-yellow-600" id="objects-count">0</div>
                        <div class="text-gray-600">ç‰©å“</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white text-xs mb-1">
                            <i class="fa fa-apple"></i>
                        </div>
                        <div class="font-bold text-red-600" id="food-count">0</div>
                        <div class="text-gray-600">é£Ÿç‰©</div>
                    </div>
                </div>
                <div class="mt-3 text-center text-sm text-gray-600">
                    å·²å­¦ä¹  <span class="font-bold text-purple-600" id="words-learned">0</span> ä¸ªå•è¯
                    Â· å½“å‰éš¾åº¦: <span class="font-bold text-blue-600" id="current-difficulty">åˆçº§</span>
                </div>
            </div>
        </div>
    </div>

    <!-- æš‚åœç•Œé¢ -->
    <div id="pause-screen" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-3xl shadow-2xl p-8 text-center max-w-sm mx-auto">
            <h3 class="text-2xl font-bold mb-6">æ¸¸æˆæš‚åœ</h3>
            <div class="space-y-4">
                <button onclick="resumeGame()" class="w-full bg-gradient-to-r from-primary to-purple-600 text-white font-bold py-3 px-6 rounded-2xl transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-play mr-2"></i>ç»§ç»­æ¸¸æˆ
                </button>
                <button onclick="restartGame()" class="w-full bg-gradient-to-r from-accent to-orange-600 text-white font-bold py-3 px-6 rounded-2xl transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-refresh mr-2"></i>é‡æ–°å¼€å§‹
                </button>
                <button onclick="window.location.href='index.html'" class="w-full bg-gradient-to-r from-gray-500 to-gray-600 text-white font-bold py-3 px-6 rounded-2xl transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-home mr-2"></i>è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>
    </div>

    <!-- å®Œæˆç•Œé¢ -->
    <div id="complete-screen" class="hidden flex flex-col items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-3xl shadow-2xl p-8 text-center max-w-md mx-auto">
            <div class="text-6xl mb-4">ğŸ‰</div>
            <h2 class="text-2xl font-bold mb-4 text-purple-600">æ—¶é—´åˆ°ï¼</h2>
            <div class="bg-purple-50 rounded-2xl p-6 mb-6">
                <p class="text-purple-800 text-lg mb-2">ä½ çš„æ¥é¾™æˆç»©ï¼š</p>
                <div class="text-4xl font-bold text-purple-600 mb-2" id="final-score">0</div>
                <div class="text-2xl font-bold text-blue-600" id="final-chain">é“¾é•¿: 0</div>
                <p class="text-sm text-gray-600 mt-2">æœ€é•¿é“¾æ¡: <span id="longest-chain"></span></p>
            </div>
            <div class="flex space-x-4">
                <button onclick="restartGame()" class="flex-1 bg-gradient-to-r from-primary to-purple-600 text-white font-bold py-3 px-6 rounded-2xl transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-refresh mr-2"></i>å†ç©ä¸€æ¬¡
                </button>
                <button onclick="window.location.href='index.html'" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 text-white font-bold py-3 px-6 rounded-2xl transition-all duration-300 hover:scale-105 active:scale-95">
                    <i class="fa fa-home mr-2"></i>è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆå•è¯åº“ - æŒ‰ç±»åˆ«åˆ†ç»„ï¼ŒåŒ…å«ä¸­æ–‡ç¿»è¯‘å’Œéš¾åº¦ç­‰çº§
        const gameWords = [
            // åŠ¨ç‰©ç±» (Animals) - åŸºç¡€
            { word: 'CAT', translation: 'çŒ«', category: 'animals', level: 1 },
            { word: 'DOG', translation: 'ç‹—', category: 'animals', level: 1 },
            { word: 'ELEPHANT', translation: 'å¤§è±¡', category: 'animals', level: 2 },
            { word: 'TIGER', translation: 'è€è™', category: 'animals', level: 2 },
            { word: 'RABBIT', translation: 'å…”å­', category: 'animals', level: 1 },
            { word: 'WHALE', translation: 'é²¸é±¼', category: 'animals', level: 2 },
            { word: 'EAGLE', translation: 'è€é¹°', category: 'animals', level: 2 },
            { word: 'LION', translation: 'ç‹®å­', category: 'animals', level: 2 },
            { word: 'DOLPHIN', translation: 'æµ·è±š', category: 'animals', level: 3 },
            { word: 'KANGAROO', translation: 'è¢‹é¼ ', category: 'animals', level: 3 },
            
            // è‡ªç„¶ç±» (Nature)
            { word: 'TREE', translation: 'æ ‘', category: 'nature', level: 1 },
            { word: 'EARTH', translation: 'åœ°çƒ', category: 'nature', level: 2 },
            { word: 'SUN', translation: 'å¤ªé˜³', category: 'nature', level: 1 },
            { word: 'RIVER', translation: 'æ²³æµ', category: 'nature', level: 2 },
            { word: 'OCEAN', translation: 'æµ·æ´‹', category: 'nature', level: 2 },
            { word: 'RAINBOW', translation: 'å½©è™¹', category: 'nature', level: 2 },
            { word: 'STAR', translation: 'æ˜Ÿæ˜Ÿ', category: 'nature', level: 1 },
            { word: 'NIGHT', translation: 'å¤œæ™š', category: 'nature', level: 1 },
            { word: 'ICE', translation: 'å†°', category: 'nature', level: 1 },
            
            // ç‰©å“ç±» (Objects)
            { word: 'TABLE', translation: 'æ¡Œå­', category: 'objects', level: 1 },
            { word: 'HOUSE', translation: 'æˆ¿å­', category: 'objects', level: 1 },
            { word: 'WINDOW', translation: 'çª—æˆ·', category: 'objects', level: 2 },
            { word: 'TELEPHONE', translation: 'ç”µè¯', category: 'objects', level: 2 },
            { word: 'NOTEBOOK', translation: 'ç¬”è®°æœ¬', category: 'objects', level: 2 },
            { word: 'ENVELOPE', translation: 'ä¿¡å°', category: 'objects', level: 3 },
            { word: 'ERASER', translation: 'æ©¡çš®', category: 'objects', level: 2 },
            { word: 'TELEVISION', translation: 'ç”µè§†', category: 'objects', level: 3 },
            { word: 'ROCKET', translation: 'ç«ç®­', category: 'objects', level: 2 },
            { word: 'TOWER', translation: 'å¡”', category: 'objects', level: 2 },
            
            // é£Ÿç‰©ç±» (Food)
            { word: 'EGG', translation: 'é¸¡è›‹', category: 'food', level: 1 },
            { word: 'TOMATO', translation: 'ç•ªèŒ„', category: 'food', level: 2 },
            { word: 'ORANGE', translation: 'æ©™å­', category: 'food', level: 1 },
            { word: 'WATERMELON', translation: 'è¥¿ç“œ', category: 'food', level: 3 },
            { word: 'EGGPLANT', translation: 'èŒ„å­', category: 'food', level: 3 },
            { word: 'NOODLE', translation: 'é¢æ¡', category: 'food', level: 2 },
            
            // å…¶ä»–ç±» (Others)
            { word: 'GAME', translation: 'æ¸¸æˆ', category: 'others', level: 1 },
            { word: 'NET', translation: 'ç½‘', category: 'others', level: 1 },
            { word: 'TEACHER', translation: 'è€å¸ˆ', category: 'others', level: 1 },
            { word: 'ROBOT', translation: 'æœºå™¨äºº', category: 'others', level: 2 },
            { word: 'NICE', translation: 'å¥½çš„', category: 'others', level: 1 },
            { word: 'EAR', translation: 'è€³æœµ', category: 'others', level: 1 },
            { word: 'ENERGY', translation: 'èƒ½é‡', category: 'others', level: 3 },
            { word: 'YELLOW', translation: 'é»„è‰²', category: 'others', level: 1 },
            { word: 'TAXI', translation: 'å‡ºç§Ÿè½¦', category: 'others', level: 2 },
            { word: 'NOSE', translation: 'é¼»å­', category: 'others', level: 1 },
            { word: 'RADIO', translation: 'æ”¶éŸ³æœº', category: 'others', level: 2 },
            { word: 'OWL', translation: 'çŒ«å¤´é¹°', category: 'others', level: 2 },
            { word: 'EMERALD', translation: 'ç¿¡ç¿ ', category: 'others', level: 3 },
            { word: 'ROSE', translation: 'ç«ç‘°', category: 'others', level: 2 },
            { word: 'LOCK', translation: 'é”', category: 'others', level: 1 },
            { word: 'KEY', translation: 'é’¥åŒ™', category: 'others', level: 1 },
            { word: 'YARN', translation: 'çº±çº¿', category: 'others', level: 3 },
            { word: 'NUGGET', translation: 'é‡‘å—', category: 'others', level: 3 }
        ];

        // æ¸¸æˆçŠ¶æ€
        let score = 0;
        let timeLeft = 60;
        let gameRunning = false;
        let gameTimer = null;
        let wordCards = [];
        let connections = [];
        let selectedCard = null;
        let dragLine = null;
        let currentChain = [];
        let longestChain = [];
        let wordsLearned = new Set(); // å·²å­¦ä¹ çš„å•è¯
        let categoryStats = {}; // åˆ†ç±»ç»Ÿè®¡
        let difficultyLevel = 1; // å½“å‰éš¾åº¦ç­‰çº§
        
        // DOMå…ƒç´ 
        const gameCanvas = document.getElementById('game-canvas');
        const chainDisplay = document.getElementById('chain-display');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            score = 0;
            timeLeft = 60;
            connections = [];
            currentChain = [];
            longestChain = [];
            selectedCard = null;
            wordsLearned.clear();
            categoryStats = {};
            difficultyLevel = 1;
            
            generateWordCards();
            updateUI();
            updateLearningStats();
            setupEventListeners();
        }
        
        // æ ¹æ®éš¾åº¦ç­‰çº§ç­›é€‰å•è¯
        function getWordsForLevel(level) {
            return gameWords.filter(wordData => wordData.level <= level);
        }
        
        // ç”Ÿæˆå•è¯å¡ç‰‡
        function generateWordCards() {
            gameCanvas.innerHTML = '';
            wordCards = [];
            
            // æ ¹æ®å½“å‰éš¾åº¦ç­‰çº§é€‰æ‹©å•è¯
            const availableWords = getWordsForLevel(difficultyLevel);
            const shuffled = [...availableWords].sort(() => Math.random() - 0.5);
            const selectedWords = shuffled.slice(0, 12);
            
            selectedWords.forEach((wordData, index) => {
                const card = document.createElement('div');
                card.className = 'word-card';
                
                // æ˜¾ç¤ºå•è¯å’Œç¿»è¯‘
                card.innerHTML = `
                    <div class="text-lg font-bold">${wordData.word}</div>
                    <div class="text-xs text-gray-600 mt-1">${wordData.translation}</div>
                    <div class="category-badge ${wordData.category}" title="${getCategoryName(wordData.category)}"></div>
                `;
                
                card.dataset.word = wordData.word;
                card.dataset.translation = wordData.translation;
                card.dataset.category = wordData.category;
                card.dataset.level = wordData.level;
                card.dataset.index = index;
                
                // éšæœºä½ç½®æ”¾ç½®
                const x = Math.random() * (gameCanvas.offsetWidth - 120);
                const y = Math.random() * (gameCanvas.offsetHeight - 80);
                card.style.left = x + 'px';
                card.style.top = y + 'px';
                
                gameCanvas.appendChild(card);
                wordCards.push({
                    element: card,
                    word: wordData.word,
                    data: wordData,
                    x: x + 60, // ä¸­å¿ƒç‚¹
                    y: y + 40,
                    connected: false
                });
            });
        }
        
        // è·å–åˆ†ç±»åç§°
        function getCategoryName(category) {
            const names = {
                'animals': 'åŠ¨ç‰©',
                'nature': 'è‡ªç„¶',
                'objects': 'ç‰©å“',
                'food': 'é£Ÿç‰©',
                'others': 'å…¶ä»–'
            };
            return names[category] || 'å…¶ä»–';
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            wordCards.forEach(cardData => {
                const card = cardData.element;
                card.addEventListener('mousedown', startDrag);
                card.addEventListener('touchstart', startDrag, {passive: false});
            });
        }
        
        // å¼€å§‹æ‹–æ‹½
        function startDrag(e) {
            if (!gameRunning) return;
            
            e.preventDefault();
            const card = e.target;
            
            // é€‰ä¸­å¡ç‰‡
            if (selectedCard && selectedCard !== card) {
                // å°è¯•è¿æ¥ä¸¤ä¸ªå¡ç‰‡
                tryConnect(selectedCard, card);
            } else {
                // é€‰ä¸­å½“å‰å¡ç‰‡
                selectCard(card);
                createDragLine(e);
            }
        }
        
        // é€‰ä¸­å¡ç‰‡
        function selectCard(card) {
            // æ¸…é™¤ä¹‹å‰çš„é€‰ä¸­çŠ¶æ€
            if (selectedCard) {
                selectedCard.classList.remove('selected');
            }
            
            selectedCard = card;
            card.classList.add('selected');
        }
        
        // åˆ›å»ºæ‹–æ‹½çº¿
        function createDragLine(e) {
            if (!selectedCard) return;
            
            const line = document.createElement('div');
            line.className = 'connection-line';
            line.id = 'drag-line';
            gameCanvas.appendChild(line);
            dragLine = line;
            
            const startRect = selectedCard.getBoundingClientRect();
            const canvasRect = gameCanvas.getBoundingClientRect();
            
            const startX = startRect.left - canvasRect.left + startRect.width / 2;
            const startY = startRect.top - canvasRect.top + startRect.height / 2;
            
            function updateLine(e) {
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                
                if (clientX && clientY) {
                    const endX = clientX - canvasRect.left;
                    const endY = clientY - canvasRect.top;
                    
                    const length = Math.sqrt((endX - startX) ** 2 + (endY - startY) ** 2);
                    const angle = Math.atan2(endY - startY, endX - startX) * 180 / Math.PI;
                    
                    line.style.left = startX + 'px';
                    line.style.top = startY + 'px';
                    line.style.width = length + 'px';
                    line.style.transform = `rotate(${angle}deg)`;
                }
            }
            
            function stopDrag(e) {
                // æ£€æŸ¥æ˜¯å¦æ‹–æ‹½åˆ°å¦ä¸€ä¸ªå¡ç‰‡
                const dropTarget = getCardUnderPoint(e);
                if (dropTarget && dropTarget !== selectedCard) {
                    tryConnect(selectedCard, dropTarget);
                }
                
                // æ¸…ç†æ‹–æ‹½çº¿
                if (dragLine) {
                    dragLine.remove();
                    dragLine = null;
                }
                
                document.removeEventListener('mousemove', updateLine);
                document.removeEventListener('mouseup', stopDrag);
                document.removeEventListener('touchmove', updateLine);
                document.removeEventListener('touchend', stopDrag);
            }
            
            document.addEventListener('mousemove', updateLine);
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchmove', updateLine, {passive: false});
            document.addEventListener('touchend', stopDrag);
        }
        
        // è·å–ç‚¹å‡»ä½ç½®ä¸‹çš„å¡ç‰‡
        function getCardUnderPoint(e) {
            const clientX = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);
            const clientY = e.clientY || (e.changedTouches && e.changedTouches[0].clientY);
            
            if (clientX && clientY) {
                const element = document.elementFromPoint(clientX, clientY);
                return element && element.classList.contains('word-card') ? element : null;
            }
            return null;
        }
        
        // å°è¯•è¿æ¥ä¸¤ä¸ªå¡ç‰‡
        function tryConnect(card1, card2) {
            const word1 = card1.dataset.word;
            const word2 = card2.dataset.word;
            const translation1 = card1.dataset.translation;
            const translation2 = card2.dataset.translation;
            const category1 = card1.dataset.category;
            const category2 = card2.dataset.category;
            
            // æ£€æŸ¥æ˜¯å¦èƒ½æ¥é¾™
            const canConnect = checkConnection(word1, word2);
            
            if (canConnect) {
                // å­¦ä¹ ç»Ÿè®¡æ›´æ–°
                wordsLearned.add(word1);
                wordsLearned.add(word2);
                updateCategoryStats(category1);
                updateCategoryStats(category2);
                
                createConnection(card1, card2);
                updateChain(word1, word2, translation1, translation2);
                
                // è®¡ç®—åˆ†æ•°ï¼ˆåŒ…å«åˆ†ç±»åŠ æˆå’Œéš¾åº¦åŠ æˆï¼‰
                let points = word1.length + word2.length;
                
                // åŒç±»åˆ«å•è¯è¿æ¥åŠ æˆ
                if (category1 === category2) {
                    points += 10;
                    createScorePopup(card2, `+${points} åŒç±»åŠ æˆ!`);
                } else {
                    createScorePopup(card2, `+${points}`);
                }
                
                score += points;
                createParticleEffect(card2);
                updateCurrentTarget();
                
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥å‡çº§éš¾åº¦
                checkDifficultyUpgrade();
            } else {
                // è¿æ¥å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯
                card2.classList.add('wrong');
                setTimeout(() => {
                    card2.classList.remove('wrong');
                }, 500);
            }
            
            // æ¸…é™¤é€‰ä¸­çŠ¶æ€
            if (selectedCard) {
                selectedCard.classList.remove('selected');
                selectedCard = null;
            }
            
            updateUI();
            updateLearningStats();
        }
        
        // æ£€æŸ¥ä¸¤ä¸ªå•è¯æ˜¯å¦èƒ½æ¥é¾™
        function checkConnection(word1, word2) {
            const lastLetter = word1.charAt(word1.length - 1).toUpperCase();
            const firstLetter = word2.charAt(0).toUpperCase();
            
            return lastLetter === firstLetter;
        }
        
        // åˆ›å»ºè¿æ¥çº¿
        function createConnection(card1, card2) {
            const rect1 = card1.getBoundingClientRect();
            const rect2 = card2.getBoundingClientRect();
            const canvasRect = gameCanvas.getBoundingClientRect();
            
            const x1 = rect1.left - canvasRect.left + rect1.width / 2;
            const y1 = rect1.top - canvasRect.top + rect1.height / 2;
            const x2 = rect2.left - canvasRect.left + rect2.width / 2;
            const y2 = rect2.top - canvasRect.top + rect2.height / 2;
            
            const line = document.createElement('div');
            line.className = 'connection-line success';
            
            const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            
            line.style.left = x1 + 'px';
            line.style.top = y1 + 'px';
            line.style.width = length + 'px';
            line.style.transform = `rotate(${angle}deg)`;
            
            gameCanvas.appendChild(line);
            
            // æ ‡è®°å¡ç‰‡ä¸ºå·²è¿æ¥
            card1.classList.add('connected');
            card2.classList.add('connected');
            
            connections.push({
                line: line,
                card1: card1,
                card2: card2
            });
        }
        
        // æ›´æ–°é“¾æ¡
        function updateChain(word1, word2, translation1, translation2) {
            if (currentChain.length === 0) {
                currentChain = [
                    { word: word1, translation: translation1 },
                    { word: word2, translation: translation2 }
                ];
            } else {
                // æ‰¾åˆ°åˆé€‚çš„ä½ç½®æ’å…¥
                const lastWord = currentChain[currentChain.length - 1].word;
                const firstWord = currentChain[0].word;
                
                if (checkConnection(lastWord, word1)) {
                    currentChain.push({ word: word1, translation: translation1 });
                    if (word1 !== word2) {
                        currentChain.push({ word: word2, translation: translation2 });
                    }
                } else if (checkConnection(lastWord, word2)) {
                    currentChain.push({ word: word2, translation: translation2 });
                } else if (checkConnection(word2, firstWord)) {
                    currentChain.unshift({ word: word2, translation: translation2 });
                    if (word1 !== word2) {
                        currentChain.unshift({ word: word1, translation: translation1 });
                    }
                } else if (checkConnection(word1, firstWord)) {
                    currentChain.unshift({ word: word1, translation: translation1 });
                } else {
                    // å¼€å§‹æ–°é“¾æ¡
                    if (currentChain.length > longestChain.length) {
                        longestChain = [...currentChain];
                    }
                    currentChain = [
                        { word: word1, translation: translation1 },
                        { word: word2, translation: translation2 }
                    ];
                }
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateChainDisplay();
        }
        
        // æ›´æ–°é“¾æ¡æ˜¾ç¤º
        function updateChainDisplay() {
            chainDisplay.innerHTML = '';
            
            if (currentChain.length === 0) {
                chainDisplay.innerHTML = '<span class="text-gray-500">å¼€å§‹è¿æ¥å•è¯...</span>';
                return;
            }
            
            currentChain.forEach((wordData, index) => {
                const wordSpan = document.createElement('span');
                wordSpan.className = 'bg-purple-100 text-purple-800 px-3 py-2 rounded-lg font-bold border border-purple-200 inline-block text-center';
                wordSpan.innerHTML = `
                    <div class="font-bold">${wordData.word}</div>
                    <div class="text-xs text-purple-600 mt-1">${wordData.translation}</div>
                `;
                
                chainDisplay.appendChild(wordSpan);
                
                if (index < currentChain.length - 1) {
                    const arrow = document.createElement('span');
                    arrow.className = 'text-purple-600 mx-2 inline-flex items-center';
                    arrow.innerHTML = '<i class="fa fa-arrow-right text-lg"></i>';
                    chainDisplay.appendChild(arrow);
                }
            });
        }
        
        // æ›´æ–°å½“å‰ç›®æ ‡
        function updateCurrentTarget() {
            const targetElement = document.getElementById('current-target');
            
            if (currentChain.length === 0) {
                targetElement.textContent = 'è¿æ¥ä»»æ„ä¸¤ä¸ªå•è¯å¼€å§‹';
            } else {
                const lastWord = currentChain[currentChain.length - 1].word;
                const firstWord = currentChain[0].word;
                const lastLetter = lastWord.charAt(lastWord.length - 1);
                const firstLetter = firstWord.charAt(0);
                
                targetElement.textContent = `å¯»æ‰¾ä»¥ ${lastLetter} å¼€å¤´æˆ–ä»¥ ${firstLetter} ç»“å°¾çš„å•è¯`;
            }
        }
        
        // æ›´æ–°åˆ†ç±»ç»Ÿè®¡
        function updateCategoryStats(category) {
            if (!categoryStats[category]) {
                categoryStats[category] = 0;
            }
            categoryStats[category]++;
        }
        
        // æ›´æ–°å­¦ä¹ ç»Ÿè®¡æ˜¾ç¤º
        function updateLearningStats() {
            document.getElementById('words-learned').textContent = wordsLearned.size;
            document.getElementById('animals-count').textContent = categoryStats.animals || 0;
            document.getElementById('nature-count').textContent = categoryStats.nature || 0;
            document.getElementById('objects-count').textContent = categoryStats.objects || 0;
            document.getElementById('food-count').textContent = categoryStats.food || 0;
            
            // æ›´æ–°éš¾åº¦æ˜¾ç¤º
            const difficultyNames = ['åˆçº§', 'ä¸­çº§', 'é«˜çº§'];
            document.getElementById('current-difficulty').textContent = difficultyNames[difficultyLevel - 1] || 'åˆçº§';
        }
        
        // æ£€æŸ¥éš¾åº¦å‡çº§
        function checkDifficultyUpgrade() {
            const totalLearned = wordsLearned.size;
            
            if (totalLearned >= 20 && difficultyLevel === 1) {
                difficultyLevel = 2;
                showUpgradeMessage('æ­å–œå‡çº§åˆ°ä¸­çº§éš¾åº¦ï¼è§£é”æ›´å¤šé«˜çº§å•è¯ï¼');
            } else if (totalLearned >= 35 && difficultyLevel === 2) {
                difficultyLevel = 3;
                showUpgradeMessage('å¤ªæ£’äº†ï¼å‡çº§åˆ°é«˜çº§éš¾åº¦ï¼æŒ‘æˆ˜æœ€éš¾çš„å•è¯ï¼');
            }
        }
        
        // æ˜¾ç¤ºå‡çº§æ¶ˆæ¯
        function showUpgradeMessage(message) {
            const popup = document.createElement('div');
            popup.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-8 py-4 rounded-2xl font-bold text-lg shadow-2xl z-50';
            popup.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl mb-2">ğŸ‰</div>
                    <div>${message}</div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            setTimeout(() => {
                popup.remove();
                // é‡æ–°ç”Ÿæˆå¡ç‰‡ä»¥åŒ…å«æ–°éš¾åº¦çš„å•è¯
                generateWordCards();
                setupEventListeners();
            }, 3000);
        }
        
        // åˆ›å»ºå¾—åˆ†å¼¹çª—
        function createScorePopup(card, text) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = text;
            
            const rect = card.getBoundingClientRect();
            const canvasRect = gameCanvas.getBoundingClientRect();
            
            popup.style.left = (rect.left - canvasRect.left) + 'px';
            popup.style.top = (rect.top - canvasRect.top) + 'px';
            
            gameCanvas.appendChild(popup);
            
            setTimeout(() => {
                popup.remove();
            }, 1500);
        }
        
        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticleEffect(card) {
            const rect = card.getBoundingClientRect();
            const canvasRect = gameCanvas.getBoundingClientRect();
            
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const x = rect.left - canvasRect.left + rect.width / 2 + (Math.random() - 0.5) * 60;
                const y = rect.top - canvasRect.top + rect.height / 2 + (Math.random() - 0.5) * 60;
                
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.animationDelay = (i * 0.1) + 's';
                
                gameCanvas.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 2000);
            }
        }
        
        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('time-left').textContent = timeLeft;
            document.getElementById('chain-length').textContent = currentChain.length;
        }
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            initGame();
            gameRunning = true;
            startTimer();
        }
        
        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                updateUI();
                
                if (timeLeft <= 0) {
                    gameOver();
                }
            }, 1000);
        }
        
        // æ¸¸æˆç»“æŸ
        function gameOver() {
            gameRunning = false;
            clearInterval(gameTimer);
            
            if (currentChain.length > longestChain.length) {
                longestChain = [...currentChain];
            }
            
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-chain').textContent = `é“¾é•¿: ${currentChain.length}`;
            document.getElementById('longest-chain').textContent = longestChain.join(' â†’ ');
            
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('complete-screen').classList.remove('hidden');
        }
        
        // æš‚åœæ¸¸æˆ
        function pauseGame() {
            gameRunning = false;
            clearInterval(gameTimer);
            document.getElementById('pause-screen').classList.remove('hidden');
        }
        
        // ç»§ç»­æ¸¸æˆ
        function resumeGame() {
            document.getElementById('pause-screen').classList.add('hidden');
            gameRunning = true;
            startTimer();
        }
        
        // é‡æ–°å¼€å§‹
        function restartGame() {
            clearInterval(gameTimer);
            
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('pause-screen').classList.add('hidden');
            document.getElementById('complete-screen').classList.add('hidden');
            
            setTimeout(() => {
                startGame();
            }, 300);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('è‹±è¯­æ¥é¾™æ¸¸æˆåˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>