<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>单词记忆游戏 - 英文单词学习</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        neutral: '#F7FFF7',
                        text: '#1F2937'
                    },
                    fontFamily: {
                        kids: ['"Comic Sans MS"', '"Marker Felt"', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .bounce-light {
                animation: bounce-light 0.5s ease infinite alternate;
            }
            .pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .scale-hover {
                transition: transform 0.2s;
            }
            .scale-hover:hover {
                transform: scale(1.05);
            }
            .correct-animation {
                animation: correct 0.6s ease-in-out;
            }
            .wrong-animation {
                animation: wrong 0.6s ease-in-out;
            }
            .level-complete {
                animation: levelComplete 1s ease-in-out;
            }
            @keyframes bounce-light {
                from { transform: translateY(0); }
                to { transform: translateY(-5px); }
            }
            @keyframes correct {
                0% { transform: scale(1); background-color: #10B981; }
                50% { transform: scale(1.1); background-color: #34D399; }
                100% { transform: scale(1); background-color: #10B981; }
            }
            @keyframes wrong {
                0% { transform: translateX(0); background-color: #EF4444; }
                25% { transform: translateX(-5px); background-color: #F87171; }
                75% { transform: translateX(5px); background-color: #F87171; }
                100% { transform: translateX(0); background-color: #EF4444; }
            }
            @keyframes levelComplete {
                0% { transform: scale(1) rotate(0deg); }
                25% { transform: scale(1.2) rotate(5deg); }
                75% { transform: scale(1.2) rotate(-5deg); }
                100% { transform: scale(1) rotate(0deg); }
            }
            @keyframes button-press {
                0% { transform: scale(1); }
                50% { transform: scale(0.95); }
                100% { transform: scale(1); }
            }
            
            .button-press {
                animation: button-press 0.2s ease-in-out;
            }
            
            .word-card {
                /* 固定方格尺寸，避免翻面后高度跳动 */
                aspect-ratio: 1 / 1;
                height: auto;
                transition: all 0.3s ease;
                border: 3px solid transparent;
            }
            .word-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
            }
            .word-card.flipped {
                background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            }
            .word-card.matched {
                background: linear-gradient(135deg, #10B981 0%, #059669 100%);
                border-color: #10B981;
            }
            .word-card.wrong {
                background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
                border-color: #EF4444;
                animation: wrong 0.6s ease-in-out;
            }
            
            /* 移动端优化 */
            @media (max-width: 768px) {
                .word-card {
                    font-size: 1rem;
                    padding: 12px 8px;
                }
                .float-animation {
                    animation: none;
                }
            }
            
            @media (max-width: 480px) {
                .word-card {
                    font-size: 0.9rem;
                    padding: 10px 6px;
                }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen font-kids text-text">
    
    <!-- 开始界面 -->
    <div id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-8 relative">
        <!-- 返回首页按钮 -->
        <button onclick="window.location.href='index.html'" class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800 z-40">
            <i class="fa fa-home mr-2"></i>首页
        </button>
        
        <div class="text-center w-full max-w-sm mx-auto bg-white rounded-3xl shadow-2xl p-6 transform transition-all duration-500">
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary via-secondary to-accent mb-3">单词记忆</h1>
            <p class="text-base mb-4 text-gray-600">翻牌配对游戏<br>记住单词配对！</p>
            
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white text-3xl shadow-lg relative overflow-hidden float-animation">
                    <i class="fa fa-puzzle-piece"></i>
                    <div class="absolute inset-0 bg-white opacity-20 rounded-full animate-ping"></div>
                </div>
            </div>
            
            <!-- 难度选择 -->
            <div class="mb-5">
                <h3 class="text-base font-bold mb-3">选择难度</h3>
                <div class="grid grid-cols-1 gap-3">
                    <button onclick="selectDifficulty('easy')" 
                            class="difficulty-btn bg-secondary/10 border-2 border-secondary/20 hover:border-secondary/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">🌟</div>
                                <div>
                                    <h4 class="font-bold text-secondary text-left">简单</h4>
                                    <p class="text-xs text-gray-600 text-left">3×2 基础单词</p>
                                </div>
                            </div>
                            <div class="text-sm text-secondary">6张</div>
                        </div>
                    </button>
                    <button onclick="selectDifficulty('medium')" 
                            class="difficulty-btn bg-accent/10 border-2 border-accent/20 hover:border-accent/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">⭐⭐</div>
                                <div>
                                    <h4 class="font-bold text-accent text-left">中等</h4>
                                    <p class="text-xs text-gray-600 text-left">4×3 常用单词</p>
                                </div>
                            </div>
                            <div class="text-sm text-accent">12张</div>
                        </div>
                    </button>
                    <button onclick="selectDifficulty('hard')" 
                            class="difficulty-btn bg-danger/10 border-2 border-danger/20 hover:border-danger/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">⭐⭐⭐</div>
                                <div>
                                    <h4 class="font-bold text-danger text-left">困难</h4>
                                    <p class="text-xs text-gray-600 text-left">4×4 进阶单词</p>
                                </div>
                            </div>
                            <div class="text-sm text-danger">16张</div>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- 倒计时开关 -->
            <div class="mb-5 flex items-center justify-center gap-4 bg-gray-50 rounded-2xl p-3">
                <i class="fa fa-clock-o text-gray-600"></i>
                <span class="text-gray-700 font-medium">倒计时模式</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="timer-toggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
                <span class="text-xs text-gray-500" id="timer-description">不限时游戏</span>
            </div>
            
            <!-- 游戏说明 -->
            <div class="mb-5">
                <div class="bg-gradient-to-r from-primary/5 to-secondary/5 rounded-xl p-4 text-sm">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="flex items-center">
                            <span class="text-lg mr-2">👆</span>
                            <span class="text-gray-700">翻开卡片</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">🎯</span>
                            <span class="text-gray-700">找到配对</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">🔊</span>
                            <span class="text-gray-700">听发音</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">🏆</span>
                            <span class="text-gray-700">完成挑战</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 开始游戏按钮 -->
            <button id="start-game-btn" onclick="startGame()" disabled
                    class="w-full bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white font-bold py-3 px-6 rounded-2xl shadow-lg transform transition-all duration-300 scale-hover disabled:opacity-50 disabled:cursor-not-allowed">
                开始游戏 <i class="fa fa-play ml-2"></i>
            </button>
        </div>
    </div>
    
    <!-- 游戏界面 -->
    <div id="game-screen" class="hidden flex flex-col min-h-screen p-4">
        <!-- 游戏头部 -->
        <div class="bg-white rounded-2xl shadow-lg p-4 mb-4">
            <div class="flex justify-between items-center">
                <button onclick="backToStart()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-full scale-hover">
                    <i class="fa fa-arrow-left mr-2"></i>返回
                </button>
                <div class="text-center">
                    <h2 class="text-xl font-bold text-gray-800">🧩 单词记忆</h2>
                    <p class="text-sm text-gray-600">翻牌配对游戏</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">得分</p>
                    <p id="game-score" class="text-xl font-bold text-primary">0</p>
                </div>
            </div>
            <div class="flex justify-center items-center mt-3 space-x-6">
                <div class="text-center">
                    <p class="text-xs text-gray-500">已配对</p>
                    <p id="matched-pairs" class="text-lg font-bold text-secondary">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-500">总对数</p>
                    <p id="total-pairs" class="text-lg font-bold text-gray-700">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-500">翻牌次数</p>
                    <p id="flip-count" class="text-lg font-bold text-accent">0</p>
                </div>
            </div>
        </div>
        
        <!-- 游戏区域 -->
        <div class="flex-1 flex items-center justify-center">
            <div id="game-board" class="grid gap-3 bg-white rounded-2xl shadow-lg p-6">
                <!-- 卡片将动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- 结果界面 -->
    <div id="result-screen" class="hidden flex flex-col items-center justify-center min-h-screen p-4">
        <div class="text-center max-w-xl mx-auto bg-white rounded-3xl shadow-2xl p-8 transform transition-all duration-300">
            <div id="result-icon" class="text-8xl mb-6 level-complete">🎉</div>
            <h2 id="result-title" class="text-3xl font-bold text-primary mb-4">恭喜完成！</h2>
            
            <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6 mb-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-primary" id="final-score">0</p>
                        <p class="text-sm text-gray-600">最终得分</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-secondary" id="final-flips">0</p>
                        <p class="text-sm text-gray-600">翻牌次数</p>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <p id="performance-text" class="text-lg font-bold text-accent">表现优秀！</p>
                </div>
            </div>
            
            <div class="space-x-4">
                <button onclick="startGame()" 
                        class="bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white px-6 py-3 rounded-2xl scale-hover">
                    <i class="fa fa-refresh mr-2"></i>再玩一次
                </button>
                <button onclick="backToStart()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-2xl scale-hover">
                    <i class="fa fa-home mr-2"></i>返回开始
                </button>
            </div>
        </div>
    </div>

    <script>
        // 游戏数据 - 300个单词库
        const wordData = {
            // 简单难度：100个基础单词（3-4个字母，日常物品）
            easy: [
                // 动物类
                'cat', 'dog', 'pig', 'cow', 'fox', 'rat', 'bat', 'bee', 'ant', 'bug',
                'owl', 'hen', 'ram', 'yak', 'elk', 'ape', 'doe', 'cub', 'kid', 'pup',
                // 食物类
                'egg', 'pie', 'jam', 'tea', 'ice', 'ham', 'nut', 'fig', 'yam', 'pea',
                'bun', 'gum', 'cod', 'rye', 'oat', 'soy', 'ale', 'rum', 'gin', 'dip',
                // 物品类
                'pen', 'cup', 'pot', 'pan', 'bag', 'box', 'key', 'toy', 'hat', 'cap',
                'map', 'web', 'net', 'rod', 'axe', 'saw', 'pin', 'mat', 'rug', 'bed',
                // 自然类
                'sun', 'sky', 'sea', 'mud', 'dew', 'fog', 'ice', 'gem', 'ore', 'oil',
                'bay', 'dam', 'pit', 'den', 'log', 'oak', 'ivy', 'fir', 'ash', 'elm',
                // 身体类
                'eye', 'ear', 'arm', 'leg', 'toe', 'jaw', 'gut', 'rib', 'hip', 'lip',
                // 颜色/形状
                'red', 'big', 'hot', 'new', 'old', 'wet', 'dry', 'fat', 'raw', 'odd'
            ],
            
            // 中等难度：100个常用单词（4-6个字母，生活场景）
            medium: [
                // 家庭生活
                'house', 'table', 'chair', 'window', 'kitchen', 'bedroom', 'garden', 'family', 'mother', 'father',
                'sister', 'brother', 'dinner', 'breakfast', 'shower', 'toilet', 'carpet', 'picture', 'mirror', 'drawer',
                // 学校教育
                'school', 'teacher', 'student', 'lesson', 'pencil', 'paper', 'ruler', 'eraser', 'crayon', 'marker',
                'book', 'page', 'story', 'letter', 'number', 'color', 'shape', 'circle', 'square', 'triangle',
                // 食物饮料
                'water', 'juice', 'milk', 'bread', 'butter', 'cheese', 'banana', 'apple', 'orange', 'grape',
                'cookie', 'candy', 'pizza', 'burger', 'french', 'salad', 'soup', 'rice', 'pasta', 'chicken',
                // 交通工具
                'car', 'bus', 'train', 'plane', 'boat', 'bike', 'truck', 'taxi', 'metro', 'rocket',
                // 动物扩展
                'horse', 'sheep', 'goat', 'duck', 'fish', 'bird', 'mouse', 'rabbit', 'tiger', 'lion',
                // 时间天气
                'today', 'tomorrow', 'morning', 'evening', 'sunny', 'cloudy', 'rainy', 'windy', 'snowy', 'storm',
                // 运动娱乐
                'game', 'sport', 'music', 'dance', 'sing', 'play', 'run', 'jump', 'swim', 'climb'
            ],
            
            // 困难难度：100个进阶单词（6+个字母，复杂概念）
            hard: [
                // 科技数码
                'computer', 'keyboard', 'monitor', 'printer', 'scanner', 'camera', 'television', 'telephone', 'internet', 'website',
                'software', 'hardware', 'digital', 'wireless', 'bluetooth', 'satellite', 'algorithm', 'database', 'password', 'download',
                // 自然地理
                'mountain', 'volcano', 'earthquake', 'hurricane', 'tornado', 'desert', 'forest', 'jungle', 'waterfall', 'glacier',
                'continent', 'peninsula', 'archipelago', 'plateau', 'canyon', 'valley', 'meadow', 'prairie', 'tundra', 'savanna',
                // 身体健康
                'skeleton', 'muscle', 'nervous', 'digestive', 'respiratory', 'circulatory', 'medicine', 'hospital', 'doctor', 'nurse',
                'vitamin', 'protein', 'calcium', 'exercise', 'nutrition', 'surgery', 'therapy', 'treatment', 'diagnosis', 'symptom',
                // 社会文化
                'government', 'democracy', 'election', 'president', 'parliament', 'constitution', 'citizenship', 'community', 'society', 'culture',
                'tradition', 'festival', 'ceremony', 'celebration', 'anniversary', 'graduation', 'wedding', 'birthday', 'holiday', 'vacation',
                // 科学概念
                'chemistry', 'physics', 'biology', 'mathematics', 'geometry', 'algebra', 'microscope', 'telescope', 'laboratory', 'experiment',
                'hypothesis', 'theory', 'discovery', 'invention', 'evolution', 'genetics', 'molecule', 'element', 'compound', 'reaction'
            ]
        };

        // 游戏状态
        let currentDifficulty = null;
        let gameBoard = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let totalPairs = 0;
        let score = 0;
        let flipCount = 0;

        // 游戏管理器
        class WordMemoryGame {
            constructor() {
                this.initSpeechSynthesis();
            }

            // 初始化语音合成
            initSpeechSynthesis() {
                this.voices = [];
                this.englishVoice = null;
                
                if ('speechSynthesis' in window) {
                    const loadVoices = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(voice => 
                            voice.lang.includes('en') && 
                            (voice.name.includes('English') || voice.lang === 'en-US')
                        ) || this.voices[0];
                        console.log('选择英语语音:', this.englishVoice?.name);
                    };

                    if (this.voices.length === 0) {
                        speechSynthesis.onvoiceschanged = loadVoices;
                    } else {
                        loadVoices();
                    }
                }
            }

            // 播放英文发音  
            speak(text, rate = 0.85) {
                if (!('speechSynthesis' in window)) return;
                // 尽量使用已加载的英语语音
                const speakNow = () => {
                    const utterance = new SpeechSynthesisUtterance(text.toLowerCase());
                    utterance.voice = this.englishVoice || null;
                    utterance.lang = 'en-US';
                    utterance.rate = rate;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.95;
                    speechSynthesis.cancel();
                    speechSynthesis.speak(utterance);
                };
                if (!this.englishVoice) {
                    // 等待voices加载再播，避免静音
                    const tryOnce = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(v => v.lang.includes('en') && (v.name.includes('English') || v.lang === 'en-US')) || this.voices[0];
                        speakNow();
                    };
                    if (speechSynthesis.getVoices().length === 0) {
                        speechSynthesis.onvoiceschanged = tryOnce;
                        // 超时兜底
                        setTimeout(speakNow, 300);
                    } else {
                        tryOnce();
                    }
                } else {
                    speakNow();
                }
            }

            // 记录学习进度
            recordProgress(completed) {
                if (completed) {
                    const points = Math.max(100 - flipCount * 2, 20); // 翻牌越少得分越高
                    score += points;
                }

                // 调用进度记录系统
                if (window.recordLearningProgress) {
                    window.recordLearningProgress('english', 'memory', score, 60);
                }
            }
        }

        const gameManager = new WordMemoryGame();
        
        // 倒计时开关逻辑
        document.getElementById('timer-toggle').addEventListener('change', function() {
            const description = document.getElementById('timer-description');
            if (this.checked) {
                description.textContent = '根据难度限时';
            } else {
                description.textContent = '不限时游戏';
            }
        });

        // 选择难度
        function selectDifficulty(difficulty) {
            currentDifficulty = difficulty;
            
            // 重置所有按钮样式
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-primary');
            });
            
            // 高亮选中的按钮
            event.target.closest('.difficulty-btn').classList.add('ring-4', 'ring-primary');
            
            // 启用开始按钮
            const startBtn = document.getElementById('start-game-btn');
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // 开始游戏
        function startGame() {
            if (!currentDifficulty) {
                alert('请先选择难度！');
                return;
            }

            // 重置游戏状态
            flippedCards = [];
            matchedPairs = 0;
            score = 0;
            flipCount = 0;

            // 生成游戏板
            generateGameBoard();
            
            // 切换界面
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            updateGameStats();
        }

        // 从单词库中随机选择单词
        function getRandomWords(difficulty, count) {
            const allWords = wordData[difficulty];
            const shuffled = [...allWords].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }
        
        // 生成游戏板
        function generateGameBoard() {
            const boardSize = {
                easy: { cols: 3, rows: 2 },
                medium: { cols: 4, rows: 3 },
                hard: { cols: 4, rows: 4 }
            };

            const { cols, rows } = boardSize[currentDifficulty];
            totalPairs = (cols * rows) / 2;
            
            // 从单词库随机选择需要的单词数量
            const selectedWords = getRandomWords(currentDifficulty, totalPairs);
            
            // 创建卡片对
            const cardPairs = [];
            selectedWords.forEach(word => {
                cardPairs.push(word, word); // 每个单词创建两张卡片
            });
            
            // 打乱卡片
            gameBoard = cardPairs.sort(() => Math.random() - 0.5);
            
            // 创建游戏板DOM
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            board.className = `grid gap-3 bg-white rounded-2xl shadow-lg p-6 grid-cols-${cols}`;
            board.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
            
            gameBoard.forEach((word, index) => {
                const card = document.createElement('div');
                card.className = 'word-card bg-gradient-to-br from-primary to-purple-600 text-white rounded-xl cursor-pointer flex flex-col items-center justify-center p-4 text-center scale-hover';
                card.innerHTML = `
                    <div class="card-front flex flex-col items-center justify-center h-full">
                        <i class="fa fa-question text-3xl mb-2"></i>
                        <p class="text-sm">点击翻开</p>
                    </div>
                    <div class="card-back hidden flex-col items-center justify-center h-full">
                        <p class="text-xl font-bold mb-2">${word}</p>
                        <button onclick="gameManager.speak('${word}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-1 text-sm">
                            <i class="fa fa-volume-up"></i>
                        </button>
                    </div>
                `;
                card.dataset.word = word;
                card.dataset.index = index;
                card.onclick = () => flipCard(index);
                board.appendChild(card);
            });
        }

        // 翻牌
        function flipCard(index) {
            if (flippedCards.length >= 2) return;
            
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card.classList.contains('flipped') || card.classList.contains('matched')) return;
            
            // 翻开卡片
            card.classList.add('flipped');
            card.querySelector('.card-front').classList.add('hidden');
            card.querySelector('.card-back').classList.remove('hidden');
            flippedCards.push({ index, word: gameBoard[index], element: card });
            
            flipCount++;
            updateGameStats();
            
            // 不自动播放，让用户点击卡片上的播放按钮
            
            // 检查配对
            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 1000);
            }
        }

        // 检查配对
        function checkMatch() {
            const [card1, card2] = flippedCards;
            
            if (card1.word === card2.word) {
                // 配对成功
                card1.element.classList.add('matched', 'correct-animation');
                card2.element.classList.add('matched', 'correct-animation');
                
                matchedPairs++;
                score += Math.max(50 - flipCount, 10);
                
                // 不自动播放成功音效
                
                // 检查游戏结束
                if (matchedPairs === totalPairs) {
                    setTimeout(gameComplete, 1500);
                }
            } else {
                // 配对失败
                card1.element.classList.add('wrong-animation');
                card2.element.classList.add('wrong-animation');
                
                setTimeout(() => {
                    // 翻回去
                    card1.element.classList.remove('flipped', 'wrong-animation');
                    card1.element.querySelector('.card-front').classList.remove('hidden');
                    card1.element.querySelector('.card-back').classList.add('hidden');
                    
                    card2.element.classList.remove('flipped', 'wrong-animation');
                    card2.element.querySelector('.card-front').classList.remove('hidden');
                    card2.element.querySelector('.card-back').classList.add('hidden');
                }, 800);
            }
            
            flippedCards = [];
            updateGameStats();
        }

        // 更新游戏统计
        function updateGameStats() {
            document.getElementById('game-score').textContent = score;
            document.getElementById('matched-pairs').textContent = matchedPairs;
            document.getElementById('total-pairs').textContent = totalPairs;
            document.getElementById('flip-count').textContent = flipCount;
        }

        // 游戏完成
        function gameComplete() {
            gameManager.recordProgress(true);
            
            // 显示结果
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-flips').textContent = flipCount;
            
            // 评估表现
            let performance = '';
            const efficiency = flipCount / (totalPairs * 2); // 理想翻牌次数的比率
            
            if (efficiency <= 1.2) {
                performance = '完美！记忆力超强！';
                document.getElementById('result-icon').textContent = '🏆';
            } else if (efficiency <= 1.5) {
                performance = '优秀！表现很棒！';
                document.getElementById('result-icon').textContent = '🌟';
            } else if (efficiency <= 2.0) {
                performance = '良好！继续练习！';
                document.getElementById('result-icon').textContent = '👍';
            } else {
                performance = '加油！多练习记忆力！';
                document.getElementById('result-icon').textContent = '💪';
            }
            
            document.getElementById('performance-text').textContent = performance;
            
            // 切换到结果界面
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
        }

        // 返回开始界面
        function backToStart() {
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
        }
    </script>
</body>
</html>