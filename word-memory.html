<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å•è¯è®°å¿†æ¸¸æˆ - è‹±æ–‡å•è¯å­¦ä¹ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        danger: '#EF4444',
                        neutral: '#F7FFF7',
                        text: '#1F2937'
                    },
                    fontFamily: {
                        kids: ['"Comic Sans MS"', '"Marker Felt"', 'Arial', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .bounce-light {
                animation: bounce-light 0.5s ease infinite alternate;
            }
            .pulse-slow {
                animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .scale-hover {
                transition: transform 0.2s;
            }
            .scale-hover:hover {
                transform: scale(1.05);
            }
            .correct-animation {
                animation: correct 0.6s ease-in-out;
            }
            .wrong-animation {
                animation: wrong 0.6s ease-in-out;
            }
            .level-complete {
                animation: levelComplete 1s ease-in-out;
            }
            @keyframes bounce-light {
                from { transform: translateY(0); }
                to { transform: translateY(-5px); }
            }
            @keyframes correct {
                0% { transform: scale(1); background-color: #10B981; }
                50% { transform: scale(1.1); background-color: #34D399; }
                100% { transform: scale(1); background-color: #10B981; }
            }
            @keyframes wrong {
                0% { transform: translateX(0); background-color: #EF4444; }
                25% { transform: translateX(-5px); background-color: #F87171; }
                75% { transform: translateX(5px); background-color: #F87171; }
                100% { transform: translateX(0); background-color: #EF4444; }
            }
            @keyframes levelComplete {
                0% { transform: scale(1) rotate(0deg); }
                25% { transform: scale(1.2) rotate(5deg); }
                75% { transform: scale(1.2) rotate(-5deg); }
                100% { transform: scale(1) rotate(0deg); }
            }
            @keyframes button-press {
                0% { transform: scale(1); }
                50% { transform: scale(0.95); }
                100% { transform: scale(1); }
            }
            
            .button-press {
                animation: button-press 0.2s ease-in-out;
            }
            
            .word-card {
                /* å›ºå®šæ–¹æ ¼å°ºå¯¸ï¼Œé¿å…ç¿»é¢åé«˜åº¦è·³åŠ¨ */
                aspect-ratio: 1 / 1;
                height: auto;
                transition: all 0.3s ease;
                border: 3px solid transparent;
            }
            .word-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
            }
            .word-card.flipped {
                background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            }
            .word-card.matched {
                background: linear-gradient(135deg, #10B981 0%, #059669 100%);
                border-color: #10B981;
            }
            .word-card.wrong {
                background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
                border-color: #EF4444;
                animation: wrong 0.6s ease-in-out;
            }
            
            /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
            @media (max-width: 768px) {
                .word-card {
                    font-size: 1rem;
                    padding: 12px 8px;
                }
                .float-animation {
                    animation: none;
                }
            }
            
            @media (max-width: 480px) {
                .word-card {
                    font-size: 0.9rem;
                    padding: 10px 6px;
                }
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen font-kids text-text">
    
    <!-- å¼€å§‹ç•Œé¢ -->
    <div id="start-screen" class="flex flex-col items-center justify-center min-h-screen p-8 relative">
        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <button onclick="window.location.href='index.html'" class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-4 py-2 rounded-full shadow-lg transition-all duration-300 hover:scale-105 active:scale-95 text-sm font-bold text-gray-600 hover:text-gray-800 z-40">
            <i class="fa fa-home mr-2"></i>é¦–é¡µ
        </button>
        
        <div class="text-center w-full max-w-sm mx-auto bg-white rounded-3xl shadow-2xl p-6 transform transition-all duration-500">
            <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary via-secondary to-accent mb-3">å•è¯è®°å¿†</h1>
            <p class="text-base mb-4 text-gray-600">ç¿»ç‰Œé…å¯¹æ¸¸æˆ<br>è®°ä½å•è¯é…å¯¹ï¼</p>
            
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center text-white text-3xl shadow-lg relative overflow-hidden float-animation">
                    <i class="fa fa-puzzle-piece"></i>
                    <div class="absolute inset-0 bg-white opacity-20 rounded-full animate-ping"></div>
                </div>
            </div>
            
            <!-- éš¾åº¦é€‰æ‹© -->
            <div class="mb-5">
                <h3 class="text-base font-bold mb-3">é€‰æ‹©éš¾åº¦</h3>
                <div class="grid grid-cols-1 gap-3">
                    <button onclick="selectDifficulty('easy')" 
                            class="difficulty-btn bg-secondary/10 border-2 border-secondary/20 hover:border-secondary/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">ğŸŒŸ</div>
                                <div>
                                    <h4 class="font-bold text-secondary text-left">ç®€å•</h4>
                                    <p class="text-xs text-gray-600 text-left">3Ã—2 åŸºç¡€å•è¯</p>
                                </div>
                            </div>
                            <div class="text-sm text-secondary">6å¼ </div>
                        </div>
                    </button>
                    <button onclick="selectDifficulty('medium')" 
                            class="difficulty-btn bg-accent/10 border-2 border-accent/20 hover:border-accent/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">â­â­</div>
                                <div>
                                    <h4 class="font-bold text-accent text-left">ä¸­ç­‰</h4>
                                    <p class="text-xs text-gray-600 text-left">4Ã—3 å¸¸ç”¨å•è¯</p>
                                </div>
                            </div>
                            <div class="text-sm text-accent">12å¼ </div>
                        </div>
                    </button>
                    <button onclick="selectDifficulty('hard')" 
                            class="difficulty-btn bg-danger/10 border-2 border-danger/20 hover:border-danger/40 p-3 rounded-2xl text-center scale-hover transition-all duration-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="text-2xl mr-3">â­â­â­</div>
                                <div>
                                    <h4 class="font-bold text-danger text-left">å›°éš¾</h4>
                                    <p class="text-xs text-gray-600 text-left">4Ã—4 è¿›é˜¶å•è¯</p>
                                </div>
                            </div>
                            <div class="text-sm text-danger">16å¼ </div>
                        </div>
                    </button>
                </div>
            </div>
            
            <!-- å€’è®¡æ—¶å¼€å…³ -->
            <div class="mb-5 flex items-center justify-center gap-4 bg-gray-50 rounded-2xl p-3">
                <i class="fa fa-clock-o text-gray-600"></i>
                <span class="text-gray-700 font-medium">å€’è®¡æ—¶æ¨¡å¼</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="timer-toggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
                <span class="text-xs text-gray-500" id="timer-description">ä¸é™æ—¶æ¸¸æˆ</span>
            </div>
            
            <!-- æ¸¸æˆè¯´æ˜ -->
            <div class="mb-5">
                <div class="bg-gradient-to-r from-primary/5 to-secondary/5 rounded-xl p-4 text-sm">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="flex items-center">
                            <span class="text-lg mr-2">ğŸ‘†</span>
                            <span class="text-gray-700">ç¿»å¼€å¡ç‰‡</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">ğŸ¯</span>
                            <span class="text-gray-700">æ‰¾åˆ°é…å¯¹</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">ğŸ”Š</span>
                            <span class="text-gray-700">å¬å‘éŸ³</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-lg mr-2">ğŸ†</span>
                            <span class="text-gray-700">å®ŒæˆæŒ‘æˆ˜</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å¼€å§‹æ¸¸æˆæŒ‰é’® -->
            <button id="start-game-btn" onclick="startGame()" disabled
                    class="w-full bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white font-bold py-3 px-6 rounded-2xl shadow-lg transform transition-all duration-300 scale-hover disabled:opacity-50 disabled:cursor-not-allowed">
                å¼€å§‹æ¸¸æˆ <i class="fa fa-play ml-2"></i>
            </button>
        </div>
    </div>
    
    <!-- æ¸¸æˆç•Œé¢ -->
    <div id="game-screen" class="hidden flex flex-col min-h-screen p-4">
        <!-- æ¸¸æˆå¤´éƒ¨ -->
        <div class="bg-white rounded-2xl shadow-lg p-4 mb-4">
            <div class="flex justify-between items-center">
                <button onclick="backToStart()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-full scale-hover">
                    <i class="fa fa-arrow-left mr-2"></i>è¿”å›
                </button>
                <div class="text-center">
                    <h2 class="text-xl font-bold text-gray-800">ğŸ§© å•è¯è®°å¿†</h2>
                    <p class="text-sm text-gray-600">ç¿»ç‰Œé…å¯¹æ¸¸æˆ</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">å¾—åˆ†</p>
                    <p id="game-score" class="text-xl font-bold text-primary">0</p>
                </div>
            </div>
            <div class="flex justify-center items-center mt-3 space-x-6">
                <div class="text-center">
                    <p class="text-xs text-gray-500">å·²é…å¯¹</p>
                    <p id="matched-pairs" class="text-lg font-bold text-secondary">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-500">æ€»å¯¹æ•°</p>
                    <p id="total-pairs" class="text-lg font-bold text-gray-700">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-500">ç¿»ç‰Œæ¬¡æ•°</p>
                    <p id="flip-count" class="text-lg font-bold text-accent">0</p>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="flex-1 flex items-center justify-center">
            <div id="game-board" class="grid gap-3 bg-white rounded-2xl shadow-lg p-6">
                <!-- å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- ç»“æœç•Œé¢ -->
    <div id="result-screen" class="hidden flex flex-col items-center justify-center min-h-screen p-4">
        <div class="text-center max-w-xl mx-auto bg-white rounded-3xl shadow-2xl p-8 transform transition-all duration-300">
            <div id="result-icon" class="text-8xl mb-6 level-complete">ğŸ‰</div>
            <h2 id="result-title" class="text-3xl font-bold text-primary mb-4">æ­å–œå®Œæˆï¼</h2>
            
            <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-6 mb-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="text-center">
                        <p class="text-2xl font-bold text-primary" id="final-score">0</p>
                        <p class="text-sm text-gray-600">æœ€ç»ˆå¾—åˆ†</p>
                    </div>
                    <div class="text-center">
                        <p class="text-2xl font-bold text-secondary" id="final-flips">0</p>
                        <p class="text-sm text-gray-600">ç¿»ç‰Œæ¬¡æ•°</p>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <p id="performance-text" class="text-lg font-bold text-accent">è¡¨ç°ä¼˜ç§€ï¼</p>
                </div>
            </div>
            
            <div class="space-x-4">
                <button onclick="startGame()" 
                        class="bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white px-6 py-3 rounded-2xl scale-hover">
                    <i class="fa fa-refresh mr-2"></i>å†ç©ä¸€æ¬¡
                </button>
                <button onclick="backToStart()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-2xl scale-hover">
                    <i class="fa fa-home mr-2"></i>è¿”å›å¼€å§‹
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ® - 300ä¸ªå•è¯åº“
        const wordData = {
            // ç®€å•éš¾åº¦ï¼š100ä¸ªåŸºç¡€å•è¯ï¼ˆ3-4ä¸ªå­—æ¯ï¼Œæ—¥å¸¸ç‰©å“ï¼‰
            easy: [
                // åŠ¨ç‰©ç±»
                'cat', 'dog', 'pig', 'cow', 'fox', 'rat', 'bat', 'bee', 'ant', 'bug',
                'owl', 'hen', 'ram', 'yak', 'elk', 'ape', 'doe', 'cub', 'kid', 'pup',
                // é£Ÿç‰©ç±»
                'egg', 'pie', 'jam', 'tea', 'ice', 'ham', 'nut', 'fig', 'yam', 'pea',
                'bun', 'gum', 'cod', 'rye', 'oat', 'soy', 'ale', 'rum', 'gin', 'dip',
                // ç‰©å“ç±»
                'pen', 'cup', 'pot', 'pan', 'bag', 'box', 'key', 'toy', 'hat', 'cap',
                'map', 'web', 'net', 'rod', 'axe', 'saw', 'pin', 'mat', 'rug', 'bed',
                // è‡ªç„¶ç±»
                'sun', 'sky', 'sea', 'mud', 'dew', 'fog', 'ice', 'gem', 'ore', 'oil',
                'bay', 'dam', 'pit', 'den', 'log', 'oak', 'ivy', 'fir', 'ash', 'elm',
                // èº«ä½“ç±»
                'eye', 'ear', 'arm', 'leg', 'toe', 'jaw', 'gut', 'rib', 'hip', 'lip',
                // é¢œè‰²/å½¢çŠ¶
                'red', 'big', 'hot', 'new', 'old', 'wet', 'dry', 'fat', 'raw', 'odd'
            ],
            
            // ä¸­ç­‰éš¾åº¦ï¼š100ä¸ªå¸¸ç”¨å•è¯ï¼ˆ4-6ä¸ªå­—æ¯ï¼Œç”Ÿæ´»åœºæ™¯ï¼‰
            medium: [
                // å®¶åº­ç”Ÿæ´»
                'house', 'table', 'chair', 'window', 'kitchen', 'bedroom', 'garden', 'family', 'mother', 'father',
                'sister', 'brother', 'dinner', 'breakfast', 'shower', 'toilet', 'carpet', 'picture', 'mirror', 'drawer',
                // å­¦æ ¡æ•™è‚²
                'school', 'teacher', 'student', 'lesson', 'pencil', 'paper', 'ruler', 'eraser', 'crayon', 'marker',
                'book', 'page', 'story', 'letter', 'number', 'color', 'shape', 'circle', 'square', 'triangle',
                // é£Ÿç‰©é¥®æ–™
                'water', 'juice', 'milk', 'bread', 'butter', 'cheese', 'banana', 'apple', 'orange', 'grape',
                'cookie', 'candy', 'pizza', 'burger', 'french', 'salad', 'soup', 'rice', 'pasta', 'chicken',
                // äº¤é€šå·¥å…·
                'car', 'bus', 'train', 'plane', 'boat', 'bike', 'truck', 'taxi', 'metro', 'rocket',
                // åŠ¨ç‰©æ‰©å±•
                'horse', 'sheep', 'goat', 'duck', 'fish', 'bird', 'mouse', 'rabbit', 'tiger', 'lion',
                // æ—¶é—´å¤©æ°”
                'today', 'tomorrow', 'morning', 'evening', 'sunny', 'cloudy', 'rainy', 'windy', 'snowy', 'storm',
                // è¿åŠ¨å¨±ä¹
                'game', 'sport', 'music', 'dance', 'sing', 'play', 'run', 'jump', 'swim', 'climb'
            ],
            
            // å›°éš¾éš¾åº¦ï¼š100ä¸ªè¿›é˜¶å•è¯ï¼ˆ6+ä¸ªå­—æ¯ï¼Œå¤æ‚æ¦‚å¿µï¼‰
            hard: [
                // ç§‘æŠ€æ•°ç 
                'computer', 'keyboard', 'monitor', 'printer', 'scanner', 'camera', 'television', 'telephone', 'internet', 'website',
                'software', 'hardware', 'digital', 'wireless', 'bluetooth', 'satellite', 'algorithm', 'database', 'password', 'download',
                // è‡ªç„¶åœ°ç†
                'mountain', 'volcano', 'earthquake', 'hurricane', 'tornado', 'desert', 'forest', 'jungle', 'waterfall', 'glacier',
                'continent', 'peninsula', 'archipelago', 'plateau', 'canyon', 'valley', 'meadow', 'prairie', 'tundra', 'savanna',
                // èº«ä½“å¥åº·
                'skeleton', 'muscle', 'nervous', 'digestive', 'respiratory', 'circulatory', 'medicine', 'hospital', 'doctor', 'nurse',
                'vitamin', 'protein', 'calcium', 'exercise', 'nutrition', 'surgery', 'therapy', 'treatment', 'diagnosis', 'symptom',
                // ç¤¾ä¼šæ–‡åŒ–
                'government', 'democracy', 'election', 'president', 'parliament', 'constitution', 'citizenship', 'community', 'society', 'culture',
                'tradition', 'festival', 'ceremony', 'celebration', 'anniversary', 'graduation', 'wedding', 'birthday', 'holiday', 'vacation',
                // ç§‘å­¦æ¦‚å¿µ
                'chemistry', 'physics', 'biology', 'mathematics', 'geometry', 'algebra', 'microscope', 'telescope', 'laboratory', 'experiment',
                'hypothesis', 'theory', 'discovery', 'invention', 'evolution', 'genetics', 'molecule', 'element', 'compound', 'reaction'
            ]
        };

        // æ¸¸æˆçŠ¶æ€
        let currentDifficulty = null;
        let gameBoard = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let totalPairs = 0;
        let score = 0;
        let flipCount = 0;

        // æ¸¸æˆç®¡ç†å™¨
        class WordMemoryGame {
            constructor() {
                this.initSpeechSynthesis();
            }

            // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
            initSpeechSynthesis() {
                this.voices = [];
                this.englishVoice = null;
                
                if ('speechSynthesis' in window) {
                    const loadVoices = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(voice => 
                            voice.lang.includes('en') && 
                            (voice.name.includes('English') || voice.lang === 'en-US')
                        ) || this.voices[0];
                        console.log('é€‰æ‹©è‹±è¯­è¯­éŸ³:', this.englishVoice?.name);
                    };

                    if (this.voices.length === 0) {
                        speechSynthesis.onvoiceschanged = loadVoices;
                    } else {
                        loadVoices();
                    }
                }
            }

            // æ’­æ”¾è‹±æ–‡å‘éŸ³  
            speak(text, rate = 0.85) {
                if (!('speechSynthesis' in window)) return;
                // å°½é‡ä½¿ç”¨å·²åŠ è½½çš„è‹±è¯­è¯­éŸ³
                const speakNow = () => {
                    const utterance = new SpeechSynthesisUtterance(text.toLowerCase());
                    utterance.voice = this.englishVoice || null;
                    utterance.lang = 'en-US';
                    utterance.rate = rate;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.95;
                    speechSynthesis.cancel();
                    speechSynthesis.speak(utterance);
                };
                if (!this.englishVoice) {
                    // ç­‰å¾…voicesåŠ è½½å†æ’­ï¼Œé¿å…é™éŸ³
                    const tryOnce = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(v => v.lang.includes('en') && (v.name.includes('English') || v.lang === 'en-US')) || this.voices[0];
                        speakNow();
                    };
                    if (speechSynthesis.getVoices().length === 0) {
                        speechSynthesis.onvoiceschanged = tryOnce;
                        // è¶…æ—¶å…œåº•
                        setTimeout(speakNow, 300);
                    } else {
                        tryOnce();
                    }
                } else {
                    speakNow();
                }
            }

            // è®°å½•å­¦ä¹ è¿›åº¦
            recordProgress(completed) {
                if (completed) {
                    const points = Math.max(100 - flipCount * 2, 20); // ç¿»ç‰Œè¶Šå°‘å¾—åˆ†è¶Šé«˜
                    score += points;
                }

                // è°ƒç”¨è¿›åº¦è®°å½•ç³»ç»Ÿ
                if (window.recordLearningProgress) {
                    window.recordLearningProgress('english', 'memory', score, 60);
                }
            }
        }

        const gameManager = new WordMemoryGame();
        
        // å€’è®¡æ—¶å¼€å…³é€»è¾‘
        document.getElementById('timer-toggle').addEventListener('change', function() {
            const description = document.getElementById('timer-description');
            if (this.checked) {
                description.textContent = 'æ ¹æ®éš¾åº¦é™æ—¶';
            } else {
                description.textContent = 'ä¸é™æ—¶æ¸¸æˆ';
            }
        });

        // é€‰æ‹©éš¾åº¦
        function selectDifficulty(difficulty) {
            currentDifficulty = difficulty;
            
            // é‡ç½®æ‰€æœ‰æŒ‰é’®æ ·å¼
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('ring-4', 'ring-primary');
            });
            
            // é«˜äº®é€‰ä¸­çš„æŒ‰é’®
            event.target.closest('.difficulty-btn').classList.add('ring-4', 'ring-primary');
            
            // å¯ç”¨å¼€å§‹æŒ‰é’®
            const startBtn = document.getElementById('start-game-btn');
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (!currentDifficulty) {
                alert('è¯·å…ˆé€‰æ‹©éš¾åº¦ï¼');
                return;
            }

            // é‡ç½®æ¸¸æˆçŠ¶æ€
            flippedCards = [];
            matchedPairs = 0;
            score = 0;
            flipCount = 0;

            // ç”Ÿæˆæ¸¸æˆæ¿
            generateGameBoard();
            
            // åˆ‡æ¢ç•Œé¢
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            updateGameStats();
        }

        // ä»å•è¯åº“ä¸­éšæœºé€‰æ‹©å•è¯
        function getRandomWords(difficulty, count) {
            const allWords = wordData[difficulty];
            const shuffled = [...allWords].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }
        
        // ç”Ÿæˆæ¸¸æˆæ¿
        function generateGameBoard() {
            const boardSize = {
                easy: { cols: 3, rows: 2 },
                medium: { cols: 4, rows: 3 },
                hard: { cols: 4, rows: 4 }
            };

            const { cols, rows } = boardSize[currentDifficulty];
            totalPairs = (cols * rows) / 2;
            
            // ä»å•è¯åº“éšæœºé€‰æ‹©éœ€è¦çš„å•è¯æ•°é‡
            const selectedWords = getRandomWords(currentDifficulty, totalPairs);
            
            // åˆ›å»ºå¡ç‰‡å¯¹
            const cardPairs = [];
            selectedWords.forEach(word => {
                cardPairs.push(word, word); // æ¯ä¸ªå•è¯åˆ›å»ºä¸¤å¼ å¡ç‰‡
            });
            
            // æ‰“ä¹±å¡ç‰‡
            gameBoard = cardPairs.sort(() => Math.random() - 0.5);
            
            // åˆ›å»ºæ¸¸æˆæ¿DOM
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            board.className = `grid gap-3 bg-white rounded-2xl shadow-lg p-6 grid-cols-${cols}`;
            board.style.gridTemplateColumns = `repeat(${cols}, minmax(0, 1fr))`;
            
            gameBoard.forEach((word, index) => {
                const card = document.createElement('div');
                card.className = 'word-card bg-gradient-to-br from-primary to-purple-600 text-white rounded-xl cursor-pointer flex flex-col items-center justify-center p-4 text-center scale-hover';
                card.innerHTML = `
                    <div class="card-front flex flex-col items-center justify-center h-full">
                        <i class="fa fa-question text-3xl mb-2"></i>
                        <p class="text-sm">ç‚¹å‡»ç¿»å¼€</p>
                    </div>
                    <div class="card-back hidden flex-col items-center justify-center h-full">
                        <p class="text-xl font-bold mb-2">${word}</p>
                        <button onclick="gameManager.speak('${word}')" class="bg-white bg-opacity-20 hover:bg-opacity-30 rounded-full p-1 text-sm">
                            <i class="fa fa-volume-up"></i>
                        </button>
                    </div>
                `;
                card.dataset.word = word;
                card.dataset.index = index;
                card.onclick = () => flipCard(index);
                board.appendChild(card);
            });
        }

        // ç¿»ç‰Œ
        function flipCard(index) {
            if (flippedCards.length >= 2) return;
            
            const card = document.querySelector(`[data-index="${index}"]`);
            if (card.classList.contains('flipped') || card.classList.contains('matched')) return;
            
            // ç¿»å¼€å¡ç‰‡
            card.classList.add('flipped');
            card.querySelector('.card-front').classList.add('hidden');
            card.querySelector('.card-back').classList.remove('hidden');
            flippedCards.push({ index, word: gameBoard[index], element: card });
            
            flipCount++;
            updateGameStats();
            
            // ä¸è‡ªåŠ¨æ’­æ”¾ï¼Œè®©ç”¨æˆ·ç‚¹å‡»å¡ç‰‡ä¸Šçš„æ’­æ”¾æŒ‰é’®
            
            // æ£€æŸ¥é…å¯¹
            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 1000);
            }
        }

        // æ£€æŸ¥é…å¯¹
        function checkMatch() {
            const [card1, card2] = flippedCards;
            
            if (card1.word === card2.word) {
                // é…å¯¹æˆåŠŸ
                card1.element.classList.add('matched', 'correct-animation');
                card2.element.classList.add('matched', 'correct-animation');
                
                matchedPairs++;
                score += Math.max(50 - flipCount, 10);
                
                // ä¸è‡ªåŠ¨æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
                
                // æ£€æŸ¥æ¸¸æˆç»“æŸ
                if (matchedPairs === totalPairs) {
                    setTimeout(gameComplete, 1500);
                }
            } else {
                // é…å¯¹å¤±è´¥
                card1.element.classList.add('wrong-animation');
                card2.element.classList.add('wrong-animation');
                
                setTimeout(() => {
                    // ç¿»å›å»
                    card1.element.classList.remove('flipped', 'wrong-animation');
                    card1.element.querySelector('.card-front').classList.remove('hidden');
                    card1.element.querySelector('.card-back').classList.add('hidden');
                    
                    card2.element.classList.remove('flipped', 'wrong-animation');
                    card2.element.querySelector('.card-front').classList.remove('hidden');
                    card2.element.querySelector('.card-back').classList.add('hidden');
                }, 800);
            }
            
            flippedCards = [];
            updateGameStats();
        }

        // æ›´æ–°æ¸¸æˆç»Ÿè®¡
        function updateGameStats() {
            document.getElementById('game-score').textContent = score;
            document.getElementById('matched-pairs').textContent = matchedPairs;
            document.getElementById('total-pairs').textContent = totalPairs;
            document.getElementById('flip-count').textContent = flipCount;
        }

        // æ¸¸æˆå®Œæˆ
        function gameComplete() {
            gameManager.recordProgress(true);
            
            // æ˜¾ç¤ºç»“æœ
            document.getElementById('final-score').textContent = score;
            document.getElementById('final-flips').textContent = flipCount;
            
            // è¯„ä¼°è¡¨ç°
            let performance = '';
            const efficiency = flipCount / (totalPairs * 2); // ç†æƒ³ç¿»ç‰Œæ¬¡æ•°çš„æ¯”ç‡
            
            if (efficiency <= 1.2) {
                performance = 'å®Œç¾ï¼è®°å¿†åŠ›è¶…å¼ºï¼';
                document.getElementById('result-icon').textContent = 'ğŸ†';
            } else if (efficiency <= 1.5) {
                performance = 'ä¼˜ç§€ï¼è¡¨ç°å¾ˆæ£’ï¼';
                document.getElementById('result-icon').textContent = 'ğŸŒŸ';
            } else if (efficiency <= 2.0) {
                performance = 'è‰¯å¥½ï¼ç»§ç»­ç»ƒä¹ ï¼';
                document.getElementById('result-icon').textContent = 'ğŸ‘';
            } else {
                performance = 'åŠ æ²¹ï¼å¤šç»ƒä¹ è®°å¿†åŠ›ï¼';
                document.getElementById('result-icon').textContent = 'ğŸ’ª';
            }
            
            document.getElementById('performance-text').textContent = performance;
            
            // åˆ‡æ¢åˆ°ç»“æœç•Œé¢
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
        }

        // è¿”å›å¼€å§‹ç•Œé¢
        function backToStart() {
            document.getElementById('start-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
        }
    </script>
</body>
</html>