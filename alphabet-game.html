<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­—æ¯è®¤çŸ¥æ¸¸æˆ - è‹±æ–‡å­—æ¯å­¦ä¹ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        .game-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .letter-card {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .letter-card:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }
        .letter-card.selected {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transform: scale(1.05);
        }
        .alphabet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 10px;
            padding: 20px;
        }
        .success-animation {
            animation: success-bounce 0.6s ease-in-out;
        }
        @keyframes success-bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .floating-points {
            position: absolute;
            color: #4facfe;
            font-weight: bold;
            font-size: 1.5rem;
            animation: float-up 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }
        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .game-progress {
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 1s ease-in-out;
        }
    </style>
</head>
<body class="p-4">
    <!-- é¦–é¡µç•Œé¢ -->
    <div id="home-screen" class="max-w-4xl mx-auto">
        <div class="game-card p-8 mb-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">ğŸ”¤ å­—æ¯è®¤çŸ¥æ¸¸æˆ</h1>
                <p class="text-lg text-gray-600 mb-6">å­¦ä¹ 26ä¸ªè‹±æ–‡å­—æ¯çš„å‘éŸ³ï¼Œé€‚åˆ4-6å²å„¿ç«¥</p>
                <button onclick="window.location.href='index.html'" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-full mb-4">
                    <i class="fa fa-home mr-2"></i>è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>

        <!-- æ¸¸æˆè¯´æ˜ -->
        <div class="game-card p-6 mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ¯ æ¸¸æˆè¯´æ˜</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center p-4">
                    <div class="text-3xl mb-2">ğŸ‘‚</div>
                    <h4 class="font-bold text-gray-700 mb-2">å¬å‘éŸ³</h4>
                    <p class="text-sm text-gray-600">ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¬å­—æ¯å‘éŸ³</p>
                </div>
                <div class="text-center p-4">
                    <div class="text-3xl mb-2">ğŸ‘†</div>
                    <h4 class="font-bold text-gray-700 mb-2">é€‰å­—æ¯</h4>
                    <p class="text-sm text-gray-600">ä»å››ä¸ªé€‰é¡¹ä¸­é€‰æ‹©æ­£ç¡®å­—æ¯</p>
                </div>
                <div class="text-center p-4">
                    <div class="text-3xl mb-2">ğŸ‰</div>
                    <h4 class="font-bold text-gray-700 mb-2">å¾—åˆ†æ•°</h4>
                    <p class="text-sm text-gray-600">ç­”å¯¹å¾—åˆ†ï¼Œå®ŒæˆæŒ‘æˆ˜</p>
                </div>
            </div>
        </div>

        <!-- éš¾åº¦é€‰æ‹© -->
        <div class="game-card p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“š é€‰æ‹©å­¦ä¹ å†…å®¹</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-200 hover:border-blue-400 cursor-pointer transition-colors" onclick="selectMode('easy')">
                    <div class="flex items-center mb-3">
                        <i class="fa fa-star text-yellow-500 text-xl mr-3"></i>
                        <h4 class="font-bold text-blue-700">åŸºç¡€å­—æ¯ (A-M)</h4>
                    </div>
                    <p class="text-sm text-gray-600">å­¦ä¹ å‰13ä¸ªå­—æ¯ï¼Œé€‚åˆåˆå­¦è€…</p>
                    <div class="mt-2 text-xs text-blue-600">åŒ…å«ï¼šA B C D E F G H I J K L M</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200 hover:border-green-400 cursor-pointer transition-colors" onclick="selectMode('hard')">
                    <div class="flex items-center mb-3">
                        <i class="fa fa-star text-yellow-500 text-xl mr-3"></i>
                        <i class="fa fa-star text-yellow-500 text-xl mr-3"></i>
                        <h4 class="font-bold text-green-700">è¿›é˜¶å­—æ¯ (N-Z)</h4>
                    </div>
                    <p class="text-sm text-gray-600">å­¦ä¹ å13ä¸ªå­—æ¯ï¼Œéœ€è¦ä¸€å®šåŸºç¡€</p>
                    <div class="mt-2 text-xs text-green-600">åŒ…å«ï¼šN O P Q R S T U V W X Y Z</div>
                </div>
            </div>
            <div class="text-center">
                <button id="start-btn" onclick="startGame()" disabled
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-lg shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                    å¼€å§‹æ¸¸æˆ <i class="fa fa-play ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç•Œé¢ -->
    <div id="game-screen" class="hidden max-w-4xl mx-auto">
        <!-- æ¸¸æˆå¤´éƒ¨ -->
        <div class="game-card p-4 mb-6">
            <div class="flex justify-between items-center">
                <button onclick="backToHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-full">
                    <i class="fa fa-arrow-left mr-2"></i>è¿”å›
                </button>
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800">ğŸ”¤ å­—æ¯è®¤çŸ¥æ¸¸æˆ</h2>
                    <p class="text-sm text-gray-600">å¬å‘éŸ³ï¼Œé€‰æ‹©æ­£ç¡®çš„å­—æ¯</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">å¾—åˆ†</p>
                    <p id="game-score" class="text-2xl font-bold text-blue-600">0</p>
                </div>
            </div>
            <!-- è¿›åº¦æ¡ -->
            <div class="game-progress mt-4">
                <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
            </div>
            <p class="text-center text-sm text-gray-600 mt-2">
                <span id="current-progress">0</span> / <span id="total-progress">10</span>
            </p>
        </div>

        <!-- æ¸¸æˆå†…å®¹åŒº -->
        <div id="game-content" class="game-card p-6">
            <!-- å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- ç»“æœåé¦ˆ -->
        <div id="feedback" class="hidden game-card p-6 mt-4">
            <div class="text-center">
                <div id="feedback-icon" class="text-6xl mb-4"></div>
                <h3 id="feedback-title" class="text-2xl font-bold mb-2"></h3>
                <p id="feedback-message" class="text-gray-600 mb-4"></p>
                <button id="next-button" onclick="nextQuestion()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                    ä¸‹ä¸€é¢˜ <i class="fa fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        const alphabetData = {
            easy: 'ABCDEFGHIJKLM'.split(''),
            hard: 'NOPQRSTUVWXYZ'.split('')
        };

        // æ¸¸æˆçŠ¶æ€
        let currentMode = null;
        let currentQuestion = 0;
        let totalQuestions = 10;
        let score = 0;
        let gameQuestions = [];
        let selectedAnswer = null;

        // æ¸¸æˆç®¡ç†å™¨
        class AlphabetGameManager {
            constructor() {
                this.initSpeechSynthesis();
            }

            // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
            initSpeechSynthesis() {
                this.voices = [];
                this.englishVoice = null;
                
                if ('speechSynthesis' in window) {
                    const loadVoices = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(voice => 
                            voice.lang.includes('en') && 
                            (voice.name.includes('English') || voice.lang === 'en-US')
                        ) || this.voices[0];
                        console.log('é€‰æ‹©è‹±è¯­è¯­éŸ³:', this.englishVoice?.name);
                    };

                    if (this.voices.length === 0) {
                        speechSynthesis.onvoiceschanged = loadVoices;
                    } else {
                        loadVoices();
                    }
                }
            }

            // æ’­æ”¾è‹±æ–‡å‘éŸ³
            speak(text, rate = 0.8) {
                if (!('speechSynthesis' in window) || !this.englishVoice) {
                    console.log('è¯­éŸ³ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºæ–‡å­—:', text);
                    return;
                }

                // å¤„ç†å­—æ¯å‘éŸ³ï¼Œé¿å…è¯»å‡º "Capital"
                let speakText = text;
                if (text.length === 1 && /[A-Z]/.test(text)) {
                    // å•ä¸ªå¤§å†™å­—æ¯ï¼Œè½¬æ¢ä¸ºå°å†™é¿å…è¯»"Capital"
                    speakText = text.toLowerCase();
                }

                const utterance = new SpeechSynthesisUtterance(speakText);
                utterance.voice = this.englishVoice;
                utterance.rate = rate;
                utterance.pitch = 1.0;
                utterance.volume = 0.9;
                utterance.lang = 'en-US';

                console.log(`ğŸ”Š æ’­æ”¾å‘éŸ³: "${text}" -> "${speakText}"`);

                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            }

            // æ˜¾ç¤ºæµ®åŠ¨å¾—åˆ†
            showFloatingPoints(points, x, y) {
                const element = document.createElement('div');
                element.className = 'floating-points';
                element.textContent = `+${points}`;
                element.style.left = x + 'px';
                element.style.top = y + 'px';
                document.body.appendChild(element);

                setTimeout(() => {
                    element.remove();
                }, 1500);
            }

            // è®°å½•å­¦ä¹ è¿›åº¦
            recordProgress(correct) {
                const points = correct ? 10 : 0;
                score += points;
                document.getElementById('game-score').textContent = score;

                // è°ƒç”¨è¿›åº¦è®°å½•ç³»ç»Ÿ
                if (window.recordLearningProgress) {
                    window.recordLearningProgress('english', 'alphabet', points, 30);
                }
            }
        }

        const gameManager = new AlphabetGameManager();

        // é€‰æ‹©æ¸¸æˆæ¨¡å¼
        function selectMode(mode) {
            currentMode = mode;
            
            // é‡ç½®æ‰€æœ‰å¡ç‰‡æ ·å¼
            document.querySelectorAll('.bg-blue-50, .bg-green-50').forEach(card => {
                card.classList.remove('ring-4', 'ring-blue-400', 'ring-green-400');
            });
            
            // é«˜äº®é€‰ä¸­çš„å¡ç‰‡
            const selectedCard = document.querySelector(mode === 'easy' ? '.bg-blue-50' : '.bg-green-50');
            selectedCard.classList.add('ring-4', mode === 'easy' ? 'ring-blue-400' : 'ring-green-400');
            
            // å¯ç”¨å¼€å§‹æŒ‰é’®
            const startBtn = document.getElementById('start-btn');
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (!currentMode) {
                alert('è¯·å…ˆé€‰æ‹©å­¦ä¹ å†…å®¹ï¼');
                return;
            }

            currentQuestion = 0;
            score = 0;
            selectedAnswer = null;

            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('feedback').classList.add('hidden');

            document.getElementById('game-score').textContent = score;

            // ç”Ÿæˆæ¸¸æˆé¢˜ç›®
            generateQuestions();
            showQuestion();
        }

        // ç”Ÿæˆé¢˜ç›®
        function generateQuestions() {
            gameQuestions = [];
            const letters = alphabetData[currentMode];
            const shuffledLetters = [...letters].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < Math.min(totalQuestions, letters.length); i++) {
                const targetLetter = shuffledLetters[i];
                const options = generateAlphabetOptions(targetLetter);
                
                gameQuestions.push({
                    target: targetLetter,
                    options: options
                });
            }
            
            totalQuestions = gameQuestions.length;
            document.getElementById('total-progress').textContent = totalQuestions;
        }

        // ç”Ÿæˆå­—æ¯é€‰é¡¹
        function generateAlphabetOptions(correct) {
            const allLetters = [...alphabetData.easy, ...alphabetData.hard];
            const options = [correct];
            
            while(options.length < 4) {
                const random = allLetters[Math.floor(Math.random() * allLetters.length)];
                if(!options.includes(random)) {
                    options.push(random);
                }
            }
            
            return options.sort(() => Math.random() - 0.5);
        }

        // æ˜¾ç¤ºå½“å‰é¢˜ç›®
        function showQuestion() {
            if(currentQuestion >= totalQuestions) {
                showGameComplete();
                return;
            }

            const question = gameQuestions[currentQuestion];
            const content = document.getElementById('game-content');
            selectedAnswer = null;

            // æ›´æ–°è¿›åº¦
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('current-progress').textContent = currentQuestion + 1;

            content.innerHTML = `
                <div class="text-center mb-8">
                    <div class="text-8xl font-bold text-blue-600 mb-6">${question.target}</div>
                    <button onclick="gameManager.speak('${question.target}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-full text-xl">
                        <i class="fa fa-volume-up mr-2"></i>æ’­æ”¾å‘éŸ³
                    </button>
                    <p class="text-gray-600 mt-4">å¬å‘éŸ³ï¼Œé€‰æ‹©æ­£ç¡®çš„å­—æ¯</p>
                </div>
                <div class="alphabet-grid">
                    ${question.options.map(letter => `
                        <div class="letter-card" onclick="selectAlphabet('${letter}', this)">
                            ${letter}
                        </div>
                    `).join('')}
                </div>
                <div class="text-center mt-6">
                    <button onclick="checkAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full text-lg">
                        ç¡®è®¤ç­”æ¡ˆ <i class="fa fa-check ml-2"></i>
                    </button>
                </div>
            `;
            
            // è‡ªåŠ¨æ’­æ”¾ä¸€æ¬¡
            setTimeout(() => gameManager.speak(question.target), 500);
        }

        // é€‰æ‹©å­—æ¯
        function selectAlphabet(letter, element) {
            document.querySelectorAll('.letter-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedAnswer = letter;
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            if (!selectedAnswer) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå­—æ¯ï¼');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = selectedAnswer === question.target;
            
            showFeedback(isCorrect, question.target);
            gameManager.recordProgress(isCorrect);
        }

        // æ˜¾ç¤ºåé¦ˆ
        function showFeedback(isCorrect, correctAnswer) {
            const feedback = document.getElementById('feedback');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const message = document.getElementById('feedback-message');

            if (isCorrect) {
                icon.textContent = 'ğŸ‰';
                title.textContent = 'å¤ªæ£’äº†ï¼';
                title.className = 'text-2xl font-bold mb-2 text-green-600';
                message.textContent = `æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correctAnswer}`;
                
                // æ’­æ”¾æˆåŠŸéŸ³æ•ˆï¼ˆç”¨è¯­éŸ³ä»£æ›¿ï¼‰
                setTimeout(() => gameManager.speak('Excellent!'), 100);
            } else {
                icon.textContent = 'ğŸ˜…';
                title.textContent = 'å†è¯•è¯•ï¼';
                title.className = 'text-2xl font-bold mb-2 text-orange-600';
                message.textContent = `æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correctAnswer}`;
                
                // æ’­æ”¾æ­£ç¡®ç­”æ¡ˆå‘éŸ³
                setTimeout(() => gameManager.speak(correctAnswer), 100);
            }

            feedback.classList.remove('hidden');
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            document.getElementById('feedback').classList.add('hidden');
            currentQuestion++;
            showQuestion();
        }

        // æ¸¸æˆå®Œæˆ
        function showGameComplete() {
            const content = document.getElementById('game-content');
            const accuracy = Math.round((score / (totalQuestions * 10)) * 100);
            
            let performance = '';
            let performanceIcon = '';
            
            if (accuracy >= 90) {
                performance = 'ä¼˜ç§€ï¼å­—æ¯è®¤çŸ¥å¾ˆæ£’ï¼';
                performanceIcon = 'ğŸ†';
            } else if (accuracy >= 70) {
                performance = 'è‰¯å¥½ï¼ç»§ç»­ç»ƒä¹ ä¼šæ›´å¥½ï¼';
                performanceIcon = 'â­';
            } else if (accuracy >= 50) {
                performance = 'ç»§ç»­åŠ æ²¹ï¼å¤šå¬å¤šç»ƒï¼';
                performanceIcon = 'ğŸ‘';
            } else {
                performance = 'éœ€è¦æ›´å¤šç»ƒä¹ ï¼';
                performanceIcon = 'ğŸ’ª';
            }

            content.innerHTML = `
                <div class="text-center">
                    <div class="text-8xl mb-6">${performanceIcon}</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">æ¸¸æˆå®Œæˆï¼</h2>
                    <div class="bg-blue-50 rounded-lg p-6 mb-6">
                        <p class="text-xl mb-2">æ€»å¾—åˆ†: <span class="font-bold text-blue-600">${score}</span></p>
                        <p class="text-xl mb-2">æ­£ç¡®ç‡: <span class="font-bold text-green-600">${accuracy}%</span></p>
                        <p class="text-lg text-gray-600">${performance}</p>
                    </div>
                    <div class="space-x-4">
                        <button onclick="startGame()" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-refresh mr-2"></i>å†ç©ä¸€æ¬¡
                        </button>
                        <button onclick="backToHome()" 
                                class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-home mr-2"></i>è¿”å›é¦–é¡µ
                        </button>
                    </div>
                </div>
            `;
        }

        // è¿”å›é¦–é¡µ
        function backToHome() {
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
        }
    </script>
</body>
</html>