<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>字母认知游戏 - 英文字母学习</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        .game-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .letter-card {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .letter-card:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }
        .letter-card.selected {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transform: scale(1.05);
        }
        .alphabet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 10px;
            padding: 20px;
        }
        .success-animation {
            animation: success-bounce 0.6s ease-in-out;
        }
        @keyframes success-bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .floating-points {
            position: absolute;
            color: #4facfe;
            font-weight: bold;
            font-size: 1.5rem;
            animation: float-up 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }
        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .game-progress {
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 1s ease-in-out;
        }
    </style>
</head>
<body class="p-4">
    <!-- 首页界面 -->
    <div id="home-screen" class="max-w-4xl mx-auto">
        <div class="game-card p-8 mb-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">🔤 字母认知游戏</h1>
                <p class="text-lg text-gray-600 mb-6">学习26个英文字母的发音，适合4-6岁儿童</p>
                <button onclick="window.location.href='index.html'" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-full mb-4">
                    <i class="fa fa-home mr-2"></i>返回首页
                </button>
            </div>
        </div>

        <!-- 游戏说明 -->
        <div class="game-card p-6 mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">🎯 游戏说明</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="text-center p-4">
                    <div class="text-3xl mb-2">👂</div>
                    <h4 class="font-bold text-gray-700 mb-2">听发音</h4>
                    <p class="text-sm text-gray-600">点击播放按钮听字母发音</p>
                </div>
                <div class="text-center p-4">
                    <div class="text-3xl mb-2">👆</div>
                    <h4 class="font-bold text-gray-700 mb-2">选字母</h4>
                    <p class="text-sm text-gray-600">从四个选项中选择正确字母</p>
                </div>
                <div class="text-center p-4">
                    <div class="text-3xl mb-2">🎉</div>
                    <h4 class="font-bold text-gray-700 mb-2">得分数</h4>
                    <p class="text-sm text-gray-600">答对得分，完成挑战</p>
                </div>
            </div>
        </div>

        <!-- 难度选择 -->
        <div class="game-card p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">📚 选择学习内容</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-200 hover:border-blue-400 cursor-pointer transition-colors" onclick="selectMode('easy')">
                    <div class="flex items-center mb-3">
                        <i class="fa fa-star text-yellow-500 text-xl mr-3"></i>
                        <h4 class="font-bold text-blue-700">基础字母 (A-M)</h4>
                    </div>
                    <p class="text-sm text-gray-600">学习前13个字母，适合初学者</p>
                    <div class="mt-2 text-xs text-blue-600">包含：A B C D E F G H I J K L M</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200 hover:border-green-400 cursor-pointer transition-colors" onclick="selectMode('hard')">
                    <div class="flex items-center mb-3">
                        <i class="fa fa-star text-yellow-500 text-xl mr-3"></i>
                        <i class="fa fa-star text-yellow-500 text-xl mr-3"></i>
                        <h4 class="font-bold text-green-700">进阶字母 (N-Z)</h4>
                    </div>
                    <p class="text-sm text-gray-600">学习后13个字母，需要一定基础</p>
                    <div class="mt-2 text-xs text-green-600">包含：N O P Q R S T U V W X Y Z</div>
                </div>
            </div>
            <div class="text-center">
                <button id="start-btn" onclick="startGame()" disabled
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-8 rounded-2xl text-lg shadow-lg transform transition-all duration-300 hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                    开始游戏 <i class="fa fa-play ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 游戏界面 -->
    <div id="game-screen" class="hidden max-w-4xl mx-auto">
        <!-- 游戏头部 -->
        <div class="game-card p-4 mb-6">
            <div class="flex justify-between items-center">
                <button onclick="backToHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-full">
                    <i class="fa fa-arrow-left mr-2"></i>返回
                </button>
                <div class="text-center">
                    <h2 class="text-2xl font-bold text-gray-800">🔤 字母认知游戏</h2>
                    <p class="text-sm text-gray-600">听发音，选择正确的字母</p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">得分</p>
                    <p id="game-score" class="text-2xl font-bold text-blue-600">0</p>
                </div>
            </div>
            <!-- 进度条 -->
            <div class="game-progress mt-4">
                <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
            </div>
            <p class="text-center text-sm text-gray-600 mt-2">
                <span id="current-progress">0</span> / <span id="total-progress">10</span>
            </p>
        </div>

        <!-- 游戏内容区 -->
        <div id="game-content" class="game-card p-6">
            <!-- 内容将动态生成 -->
        </div>

        <!-- 结果反馈 -->
        <div id="feedback" class="hidden game-card p-6 mt-4">
            <div class="text-center">
                <div id="feedback-icon" class="text-6xl mb-4"></div>
                <h3 id="feedback-title" class="text-2xl font-bold mb-2"></h3>
                <p id="feedback-message" class="text-gray-600 mb-4"></p>
                <button id="next-button" onclick="nextQuestion()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                    下一题 <i class="fa fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // 游戏数据
        const alphabetData = {
            easy: 'ABCDEFGHIJKLM'.split(''),
            hard: 'NOPQRSTUVWXYZ'.split('')
        };

        // 游戏状态
        let currentMode = null;
        let currentQuestion = 0;
        let totalQuestions = 10;
        let score = 0;
        let gameQuestions = [];
        let selectedAnswer = null;

        // 游戏管理器
        class AlphabetGameManager {
            constructor() {
                this.initSpeechSynthesis();
            }

            // 初始化语音合成
            initSpeechSynthesis() {
                this.voices = [];
                this.englishVoice = null;
                
                if ('speechSynthesis' in window) {
                    const loadVoices = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(voice => 
                            voice.lang.includes('en') && 
                            (voice.name.includes('English') || voice.lang === 'en-US')
                        ) || this.voices[0];
                        console.log('选择英语语音:', this.englishVoice?.name);
                    };

                    if (this.voices.length === 0) {
                        speechSynthesis.onvoiceschanged = loadVoices;
                    } else {
                        loadVoices();
                    }
                }
            }

            // 播放英文发音
            speak(text, rate = 0.8) {
                if (!('speechSynthesis' in window) || !this.englishVoice) {
                    console.log('语音不可用，显示文字:', text);
                    return;
                }

                // 处理字母发音，避免读出 "Capital"
                let speakText = text;
                if (text.length === 1 && /[A-Z]/.test(text)) {
                    // 单个大写字母，转换为小写避免读"Capital"
                    speakText = text.toLowerCase();
                }

                const utterance = new SpeechSynthesisUtterance(speakText);
                utterance.voice = this.englishVoice;
                utterance.rate = rate;
                utterance.pitch = 1.0;
                utterance.volume = 0.9;
                utterance.lang = 'en-US';

                console.log(`🔊 播放发音: "${text}" -> "${speakText}"`);

                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            }

            // 显示浮动得分
            showFloatingPoints(points, x, y) {
                const element = document.createElement('div');
                element.className = 'floating-points';
                element.textContent = `+${points}`;
                element.style.left = x + 'px';
                element.style.top = y + 'px';
                document.body.appendChild(element);

                setTimeout(() => {
                    element.remove();
                }, 1500);
            }

            // 记录学习进度
            recordProgress(correct) {
                const points = correct ? 10 : 0;
                score += points;
                document.getElementById('game-score').textContent = score;

                // 调用进度记录系统
                if (window.recordLearningProgress) {
                    window.recordLearningProgress('english', 'alphabet', points, 30);
                }
            }
        }

        const gameManager = new AlphabetGameManager();

        // 选择游戏模式
        function selectMode(mode) {
            currentMode = mode;
            
            // 重置所有卡片样式
            document.querySelectorAll('.bg-blue-50, .bg-green-50').forEach(card => {
                card.classList.remove('ring-4', 'ring-blue-400', 'ring-green-400');
            });
            
            // 高亮选中的卡片
            const selectedCard = document.querySelector(mode === 'easy' ? '.bg-blue-50' : '.bg-green-50');
            selectedCard.classList.add('ring-4', mode === 'easy' ? 'ring-blue-400' : 'ring-green-400');
            
            // 启用开始按钮
            const startBtn = document.getElementById('start-btn');
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // 开始游戏
        function startGame() {
            if (!currentMode) {
                alert('请先选择学习内容！');
                return;
            }

            currentQuestion = 0;
            score = 0;
            selectedAnswer = null;

            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('feedback').classList.add('hidden');

            document.getElementById('game-score').textContent = score;

            // 生成游戏题目
            generateQuestions();
            showQuestion();
        }

        // 生成题目
        function generateQuestions() {
            gameQuestions = [];
            const letters = alphabetData[currentMode];
            const shuffledLetters = [...letters].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < Math.min(totalQuestions, letters.length); i++) {
                const targetLetter = shuffledLetters[i];
                const options = generateAlphabetOptions(targetLetter);
                
                gameQuestions.push({
                    target: targetLetter,
                    options: options
                });
            }
            
            totalQuestions = gameQuestions.length;
            document.getElementById('total-progress').textContent = totalQuestions;
        }

        // 生成字母选项
        function generateAlphabetOptions(correct) {
            const allLetters = [...alphabetData.easy, ...alphabetData.hard];
            const options = [correct];
            
            while(options.length < 4) {
                const random = allLetters[Math.floor(Math.random() * allLetters.length)];
                if(!options.includes(random)) {
                    options.push(random);
                }
            }
            
            return options.sort(() => Math.random() - 0.5);
        }

        // 显示当前题目
        function showQuestion() {
            if(currentQuestion >= totalQuestions) {
                showGameComplete();
                return;
            }

            const question = gameQuestions[currentQuestion];
            const content = document.getElementById('game-content');
            selectedAnswer = null;

            // 更新进度
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('current-progress').textContent = currentQuestion + 1;

            content.innerHTML = `
                <div class="text-center mb-8">
                    <div class="text-8xl font-bold text-blue-600 mb-6">${question.target}</div>
                    <button onclick="gameManager.speak('${question.target}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-full text-xl">
                        <i class="fa fa-volume-up mr-2"></i>播放发音
                    </button>
                    <p class="text-gray-600 mt-4">听发音，选择正确的字母</p>
                </div>
                <div class="alphabet-grid">
                    ${question.options.map(letter => `
                        <div class="letter-card" onclick="selectAlphabet('${letter}', this)">
                            ${letter}
                        </div>
                    `).join('')}
                </div>
                <div class="text-center mt-6">
                    <button onclick="checkAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-full text-lg">
                        确认答案 <i class="fa fa-check ml-2"></i>
                    </button>
                </div>
            `;
            
            // 自动播放一次
            setTimeout(() => gameManager.speak(question.target), 500);
        }

        // 选择字母
        function selectAlphabet(letter, element) {
            document.querySelectorAll('.letter-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedAnswer = letter;
        }

        // 检查答案
        function checkAnswer() {
            if (!selectedAnswer) {
                alert('请先选择一个字母！');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = selectedAnswer === question.target;
            
            showFeedback(isCorrect, question.target);
            gameManager.recordProgress(isCorrect);
        }

        // 显示反馈
        function showFeedback(isCorrect, correctAnswer) {
            const feedback = document.getElementById('feedback');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const message = document.getElementById('feedback-message');

            if (isCorrect) {
                icon.textContent = '🎉';
                title.textContent = '太棒了！';
                title.className = 'text-2xl font-bold mb-2 text-green-600';
                message.textContent = `正确答案是: ${correctAnswer}`;
                
                // 播放成功音效（用语音代替）
                setTimeout(() => gameManager.speak('Excellent!'), 100);
            } else {
                icon.textContent = '😅';
                title.textContent = '再试试！';
                title.className = 'text-2xl font-bold mb-2 text-orange-600';
                message.textContent = `正确答案是: ${correctAnswer}`;
                
                // 播放正确答案发音
                setTimeout(() => gameManager.speak(correctAnswer), 100);
            }

            feedback.classList.remove('hidden');
        }

        // 下一题
        function nextQuestion() {
            document.getElementById('feedback').classList.add('hidden');
            currentQuestion++;
            showQuestion();
        }

        // 游戏完成
        function showGameComplete() {
            const content = document.getElementById('game-content');
            const accuracy = Math.round((score / (totalQuestions * 10)) * 100);
            
            let performance = '';
            let performanceIcon = '';
            
            if (accuracy >= 90) {
                performance = '优秀！字母认知很棒！';
                performanceIcon = '🏆';
            } else if (accuracy >= 70) {
                performance = '良好！继续练习会更好！';
                performanceIcon = '⭐';
            } else if (accuracy >= 50) {
                performance = '继续加油！多听多练！';
                performanceIcon = '👍';
            } else {
                performance = '需要更多练习！';
                performanceIcon = '💪';
            }

            content.innerHTML = `
                <div class="text-center">
                    <div class="text-8xl mb-6">${performanceIcon}</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">游戏完成！</h2>
                    <div class="bg-blue-50 rounded-lg p-6 mb-6">
                        <p class="text-xl mb-2">总得分: <span class="font-bold text-blue-600">${score}</span></p>
                        <p class="text-xl mb-2">正确率: <span class="font-bold text-green-600">${accuracy}%</span></p>
                        <p class="text-lg text-gray-600">${performance}</p>
                    </div>
                    <div class="space-x-4">
                        <button onclick="startGame()" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-refresh mr-2"></i>再玩一次
                        </button>
                        <button onclick="backToHome()" 
                                class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-home mr-2"></i>返回首页
                        </button>
                    </div>
                </div>
            `;
        }

        // 返回首页
        function backToHome() {
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
        }
    </script>
</body>
</html>