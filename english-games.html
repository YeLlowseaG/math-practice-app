<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语趣味学习 - 字母与单词游戏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        .game-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }
        .letter-card {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .letter-card:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }
        .letter-card.selected {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transform: scale(1.05);
        }
        .word-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .word-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }
        .alphabet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 10px;
            padding: 20px;
        }
        .word-matching-area {
            min-height: 200px;
            border: 3px dashed #ccc;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .word-matching-area.drag-over {
            border-color: #4facfe;
            background: rgba(79, 172, 254, 0.1);
        }
        .success-animation {
            animation: success-bounce 0.6s ease-in-out;
        }
        @keyframes success-bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .floating-points {
            position: absolute;
            color: #4facfe;
            font-weight: bold;
            font-size: 1.5rem;
            animation: float-up 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }
        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .game-progress {
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 1s ease-in-out;
        }
    </style>
</head>
<body class="p-4">
    <!-- 首页界面 -->
    <div id="home-screen" class="max-w-6xl mx-auto">
        <div class="game-card p-8 mb-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">🎮 英语趣味学习</h1>
                <p class="text-lg text-gray-600 mb-6">适合4-10岁儿童的英语字母和单词游戏</p>
                <button onclick="window.location.href='index.html'" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-full mb-4">
                    <i class="fa fa-home mr-2"></i>返回首页
                </button>
            </div>
        </div>

        <!-- 游戏选择 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- 字母认知游戏 -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('alphabet')">
                <div class="text-center">
                    <div class="text-6xl mb-4">🔤</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">字母认知</h3>
                    <p class="text-gray-600 text-sm mb-4">学习26个英文字母的发音和书写</p>
                    <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs">
                        适合4-6岁
                    </div>
                </div>
            </div>

            <!-- 单词拼写游戏 -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('spelling')">
                <div class="text-center">
                    <div class="text-6xl mb-4">✏️</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">单词拼写</h3>
                    <p class="text-gray-600 text-sm mb-4">听声音拼写简单的英文单词</p>
                    <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs">
                        适合6-8岁
                    </div>
                </div>
            </div>

            <!-- 单词配图游戏 -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('matching')">
                <div class="text-center">
                    <div class="text-6xl mb-4">🖼️</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">单词配图</h3>
                    <p class="text-gray-600 text-sm mb-4">将英文单词与对应图片匹配</p>
                    <div class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs">
                        适合5-8岁
                    </div>
                </div>
            </div>

            <!-- 字母排序游戏 -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('sequence')">
                <div class="text-center">
                    <div class="text-6xl mb-4">🔢</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">字母排序</h3>
                    <p class="text-gray-600 text-sm mb-4">按字母表顺序排列字母</p>
                    <div class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs">
                        适合5-7岁
                    </div>
                </div>
            </div>

            <!-- 单词记忆游戏 -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('memory')">
                <div class="text-center">
                    <div class="text-6xl mb-4">🧠</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">单词记忆</h3>
                    <p class="text-gray-600 text-sm mb-4">记忆卡片上的英文单词</p>
                    <div class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs">
                        适合6-10岁
                    </div>
                </div>
            </div>

            <!-- 发音练习游戏 -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('pronunciation')">
                <div class="text-center">
                    <div class="text-6xl mb-4">🎤</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">发音练习</h3>
                    <p class="text-gray-600 text-sm mb-4">跟读英文字母和单词发音</p>
                    <div class="bg-teal-100 text-teal-800 px-3 py-1 rounded-full text-xs">
                        适合4-8岁
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 游戏界面 -->
    <div id="game-screen" class="hidden max-w-4xl mx-auto">
        <!-- 游戏头部 -->
        <div class="game-card p-4 mb-6">
            <div class="flex justify-between items-center">
                <button onclick="backToHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-full">
                    <i class="fa fa-arrow-left mr-2"></i>返回
                </button>
                <div class="text-center">
                    <h2 id="game-title" class="text-2xl font-bold text-gray-800"></h2>
                    <p id="game-instruction" class="text-sm text-gray-600"></p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">得分</p>
                    <p id="game-score" class="text-2xl font-bold text-blue-600">0</p>
                </div>
            </div>
            <!-- 进度条 -->
            <div class="game-progress mt-4">
                <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
            </div>
            <p class="text-center text-sm text-gray-600 mt-2">
                <span id="current-progress">0</span> / <span id="total-progress">10</span>
            </p>
        </div>

        <!-- 游戏内容区 -->
        <div id="game-content" class="game-card p-6">
            <!-- 内容将根据不同游戏动态生成 -->
        </div>

        <!-- 结果反馈 -->
        <div id="feedback" class="hidden game-card p-6 mt-4">
            <div class="text-center">
                <div id="feedback-icon" class="text-6xl mb-4"></div>
                <h3 id="feedback-title" class="text-2xl font-bold mb-2"></h3>
                <p id="feedback-message" class="text-gray-600 mb-4"></p>
                <button id="next-button" onclick="nextQuestion()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                    下一题 <i class="fa fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // 游戏数据
        const gameData = {
            alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),
            words: [
                { word: 'CAT', chinese: '猫', emoji: '🐱' },
                { word: 'DOG', chinese: '狗', emoji: '🐶' },
                { word: 'BIRD', chinese: '鸟', emoji: '🐦' },
                { word: 'FISH', chinese: '鱼', emoji: '🐠' },
                { word: 'TREE', chinese: '树', emoji: '🌳' },
                { word: 'SUN', chinese: '太阳', emoji: '☀️' },
                { word: 'MOON', chinese: '月亮', emoji: '🌙' },
                { word: 'STAR', chinese: '星星', emoji: '⭐' },
                { word: 'BOOK', chinese: '书', emoji: '📚' },
                { word: 'BALL', chinese: '球', emoji: '⚽' },
                { word: 'CAR', chinese: '汽车', emoji: '🚗' },
                { word: 'HOME', chinese: '家', emoji: '🏠' },
                { word: 'APPLE', chinese: '苹果', emoji: '🍎' },
                { word: 'CAKE', chinese: '蛋糕', emoji: '🎂' },
                { word: 'MILK', chinese: '牛奶', emoji: '🥛' }
            ]
        };

        // 游戏状态
        let currentGame = null;
        let currentQuestion = 0;
        let totalQuestions = 10;
        let score = 0;
        let gameQuestions = [];
        let selectedAnswer = null;

        // 游戏管理器
        class EnglishGameManager {
            constructor() {
                this.initSpeechSynthesis();
            }

            // 初始化语音合成
            initSpeechSynthesis() {
                this.voices = [];
                this.englishVoice = null;
                
                if ('speechSynthesis' in window) {
                    const loadVoices = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(voice => 
                            voice.lang.includes('en') && 
                            (voice.name.includes('English') || voice.lang === 'en-US')
                        ) || this.voices[0];
                        console.log('选择英语语音:', this.englishVoice?.name);
                    };

                    if (this.voices.length === 0) {
                        speechSynthesis.onvoiceschanged = loadVoices;
                    } else {
                        loadVoices();
                    }
                }
            }

            // 播放英文发音
            speak(text, rate = 0.8) {
                if (!('speechSynthesis' in window) || !this.englishVoice) {
                    console.log('语音不可用，显示文字:', text);
                    return;
                }

                // 处理字母发音，避免读出 "Capital"
                let speakText = text;
                if (text.length === 1 && /[A-Z]/.test(text)) {
                    // 单个大写字母，转换为小写避免读"Capital"
                    speakText = text.toLowerCase();
                }

                const utterance = new SpeechSynthesisUtterance(speakText);
                utterance.voice = this.englishVoice;
                utterance.rate = rate;
                utterance.pitch = 1.0;
                utterance.volume = 0.9;
                utterance.lang = 'en-US';

                console.log(`🔊 播放发音: "${text}" -> "${speakText}"`);

                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            }

            // 显示浮动得分
            showFloatingPoints(points, x, y) {
                const element = document.createElement('div');
                element.className = 'floating-points';
                element.textContent = `+${points}`;
                element.style.left = x + 'px';
                element.style.top = y + 'px';
                document.body.appendChild(element);

                setTimeout(() => {
                    element.remove();
                }, 1500);
            }

            // 记录学习进度
            recordProgress(correct) {
                const points = correct ? 10 : 0;
                score += points;
                document.getElementById('game-score').textContent = score;

                // 调用进度记录系统
                if (window.recordLearningProgress) {
                    window.recordLearningProgress('english', currentGame, points, 30);
                }
            }
        }

        const gameManager = new EnglishGameManager();

        // 开始游戏
        function startGame(gameType) {
            currentGame = gameType;
            currentQuestion = 0;
            score = 0;
            selectedAnswer = null;

            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('feedback').classList.add('hidden');

            // 根据游戏类型设置标题和说明
            const gameInfo = {
                'alphabet': { title: '🔤 字母认知游戏', instruction: '点击听发音，选择对应的字母' },
                'spelling': { title: '✏️ 单词拼写游戏', instruction: '听单词发音，拼出正确的单词' },
                'matching': { title: '🖼️ 单词配图游戏', instruction: '将单词与对应的表情符号匹配' },
                'sequence': { title: '🔢 字母排序游戏', instruction: '按字母表顺序排列字母' },
                'memory': { title: '🧠 单词记忆游戏', instruction: '记住卡片上的单词位置' },
                'pronunciation': { title: '🎤 发音练习游戏', instruction: '跟读字母和单词的发音' }
            };

            document.getElementById('game-title').textContent = gameInfo[gameType].title;
            document.getElementById('game-instruction').textContent = gameInfo[gameType].instruction;
            document.getElementById('game-score').textContent = score;

            // 生成游戏题目
            generateQuestions(gameType);
            showQuestion();
        }

        // 生成题目
        function generateQuestions(gameType) {
            gameQuestions = [];
            
            switch(gameType) {
                case 'alphabet':
                    // 随机选择10个字母
                    const shuffledAlphabet = [...gameData.alphabet].sort(() => Math.random() - 0.5);
                    gameQuestions = shuffledAlphabet.slice(0, 10).map(letter => ({
                        type: 'alphabet',
                        target: letter,
                        options: generateAlphabetOptions(letter)
                    }));
                    break;
                
                case 'spelling':
                    // 随机选择单词
                    const shuffledWords = [...gameData.words].sort(() => Math.random() - 0.5);
                    gameQuestions = shuffledWords.slice(0, 10).map(wordObj => ({
                        type: 'spelling',
                        target: wordObj.word,
                        chinese: wordObj.chinese,
                        emoji: wordObj.emoji
                    }));
                    break;
                
                case 'matching':
                    // 单词配图
                    const matchWords = [...gameData.words].sort(() => Math.random() - 0.5);
                    gameQuestions = matchWords.slice(0, 10).map(wordObj => ({
                        type: 'matching',
                        target: wordObj.word,
                        chinese: wordObj.chinese,
                        emoji: wordObj.emoji,
                        options: generateMatchingOptions(wordObj)
                    }));
                    break;
                
                case 'sequence':
                    // 字母排序
                    for(let i = 0; i < 10; i++) {
                        const startIndex = Math.floor(Math.random() * 20); // A-T 范围
                        const sequence = gameData.alphabet.slice(startIndex, startIndex + 4);
                        const shuffled = [...sequence].sort(() => Math.random() - 0.5);
                        gameQuestions.push({
                            type: 'sequence',
                            target: sequence,
                            shuffled: shuffled
                        });
                    }
                    break;
                
                case 'memory':
                    // 记忆游戏
                    const memoryWords = [...gameData.words].sort(() => Math.random() - 0.5);
                    gameQuestions = memoryWords.slice(0, 10).map(wordObj => ({
                        type: 'memory',
                        target: wordObj.word,
                        chinese: wordObj.chinese,
                        emoji: wordObj.emoji
                    }));
                    break;
                
                case 'pronunciation':
                    // 发音练习
                    const pronWords = [...gameData.words].sort(() => Math.random() - 0.5);
                    gameQuestions = pronWords.slice(0, 10).map(wordObj => ({
                        type: 'pronunciation',
                        target: wordObj.word,
                        chinese: wordObj.chinese,
                        emoji: wordObj.emoji
                    }));
                    break;
            }
            
            totalQuestions = gameQuestions.length;
            document.getElementById('total-progress').textContent = totalQuestions;
        }

        // 生成字母选项
        function generateAlphabetOptions(correct) {
            const options = [correct];
            while(options.length < 4) {
                const random = gameData.alphabet[Math.floor(Math.random() * gameData.alphabet.length)];
                if(!options.includes(random)) {
                    options.push(random);
                }
            }
            return options.sort(() => Math.random() - 0.5);
        }

        // 生成配图选项
        function generateMatchingOptions(correct) {
            const options = [correct];
            while(options.length < 4) {
                const random = gameData.words[Math.floor(Math.random() * gameData.words.length)];
                if(!options.find(opt => opt.word === random.word)) {
                    options.push(random);
                }
            }
            return options.sort(() => Math.random() - 0.5);
        }

        // 显示当前题目
        function showQuestion() {
            if(currentQuestion >= totalQuestions) {
                showGameComplete();
                return;
            }

            const question = gameQuestions[currentQuestion];
            const content = document.getElementById('game-content');
            selectedAnswer = null;

            // 更新进度
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('current-progress').textContent = currentQuestion + 1;

            // 根据游戏类型生成内容
            switch(question.type) {
                case 'alphabet':
                    showAlphabetQuestion(question);
                    break;
                case 'spelling':
                    showSpellingQuestion(question);
                    break;
                case 'matching':
                    showMatchingQuestion(question);
                    break;
                case 'sequence':
                    showSequenceQuestion(question);
                    break;
                case 'memory':
                    showMemoryQuestion(question);
                    break;
                case 'pronunciation':
                    showPronunciationQuestion(question);
                    break;
            }
        }

        // 字母认知问题
        function showAlphabetQuestion(question) {
            const content = document.getElementById('game-content');
            content.innerHTML = `
                <div class="text-center mb-8">
                    <div class="text-6xl font-bold text-blue-600 mb-4">${question.target}</div>
                    <button onclick="gameManager.speak('${question.target}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-full text-xl">
                        <i class="fa fa-volume-up mr-2"></i>播放发音
                    </button>
                </div>
                <div class="alphabet-grid">
                    ${question.options.map(letter => `
                        <div class="letter-card" onclick="selectAlphabet('${letter}', this)">
                            ${letter}
                        </div>
                    `).join('')}
                </div>
                <div class="text-center mt-6">
                    <button onclick="checkAlphabetAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full">
                        确认答案
                    </button>
                </div>
            `;
            
            // 自动播放一次
            setTimeout(() => gameManager.speak(question.target), 500);
        }

        // 选择字母
        function selectAlphabet(letter, element) {
            document.querySelectorAll('.letter-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedAnswer = letter;
        }

        // 检查字母答案
        function checkAlphabetAnswer() {
            if (!selectedAnswer) {
                alert('请先选择一个字母！');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = selectedAnswer === question.target;
            
            showFeedback(isCorrect, question.target);
            gameManager.recordProgress(isCorrect);
        }

        // 单词拼写问题
        function showSpellingQuestion(question) {
            const content = document.getElementById('game-content');
            const letters = question.target.split('').map(() => '_').join(' ');
            
            content.innerHTML = `
                <div class="text-center mb-8">
                    <div class="text-6xl mb-4">${question.emoji}</div>
                    <p class="text-xl text-gray-700 mb-4">${question.chinese}</p>
                    <button onclick="gameManager.speak('${question.target}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                        <i class="fa fa-volume-up mr-2"></i>听发音
                    </button>
                </div>
                <div class="text-center mb-6">
                    <div class="text-4xl font-mono tracking-widest text-gray-400 mb-4" id="word-display">
                        ${letters}
                    </div>
                    <input type="text" id="spelling-input" 
                           class="text-2xl text-center border-2 border-gray-300 rounded-lg px-4 py-2 tracking-widest"
                           placeholder="输入单词..." maxlength="${question.target.length}">
                </div>
                <div class="text-center">
                    <button onclick="checkSpellingAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full">
                        检查拼写
                    </button>
                </div>
            `;
            
            // 自动播放发音
            setTimeout(() => gameManager.speak(question.target), 500);
        }

        // 检查拼写答案
        function checkSpellingAnswer() {
            const input = document.getElementById('spelling-input');
            const answer = input.value.toUpperCase().trim();
            
            if (!answer) {
                alert('请输入单词！');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = answer === question.target;
            
            showFeedback(isCorrect, question.target, question.emoji + ' ' + question.chinese);
            gameManager.recordProgress(isCorrect);
        }

        // 单词配图问题
        function showMatchingQuestion(question) {
            const content = document.getElementById('game-content');
            content.innerHTML = `
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">选择与单词匹配的表情</h3>
                    <div class="text-4xl font-bold text-blue-600 mb-4">${question.target}</div>
                    <button onclick="gameManager.speak('${question.target}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-full">
                        <i class="fa fa-volume-up mr-1"></i>发音
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    ${question.options.map((option, index) => `
                        <div class="word-card cursor-pointer" onclick="selectMatching('${option.word}', this)">
                            <div class="text-4xl mb-2">${option.emoji}</div>
                            <div class="font-bold">${option.chinese}</div>
                        </div>
                    `).join('')}
                </div>
                <div class="text-center mt-6">
                    <button onclick="checkMatchingAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full">
                        确认选择
                    </button>
                </div>
            `;
        }

        // 选择配图
        function selectMatching(word, element) {
            document.querySelectorAll('.word-card').forEach(card => {
                card.style.transform = 'translateY(0)';
                card.style.boxShadow = '';
            });
            element.style.transform = 'translateY(-5px)';
            element.style.boxShadow = '0 8px 25px rgba(79, 172, 254, 0.4)';
            selectedAnswer = word;
        }

        // 检查配图答案
        function checkMatchingAnswer() {
            if (!selectedAnswer) {
                alert('请选择一个答案！');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = selectedAnswer === question.target;
            
            showFeedback(isCorrect, question.target, question.emoji + ' ' + question.chinese);
            gameManager.recordProgress(isCorrect);
        }

        // 字母排序问题
        function showSequenceQuestion(question) {
            const content = document.getElementById('game-content');
            content.innerHTML = `
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">按字母表顺序排列</h3>
                    <p class="text-gray-600">目标顺序: ${question.target.join(' → ')}</p>
                </div>
                <div class="alphabet-grid justify-center">
                    ${question.shuffled.map(letter => `
                        <div class="letter-card draggable" draggable="true" 
                             ondragstart="dragStart(event, '${letter}')" 
                             onclick="toggleSequenceLetter('${letter}', this)">
                            ${letter}
                        </div>
                    `).join('')}
                </div>
                <div class="text-center mt-8">
                    <div class="text-lg text-gray-700 mb-4">你的排序:</div>
                    <div id="sequence-result" class="text-2xl font-bold text-blue-600 mb-4 min-h-[3rem] flex items-center justify-center">
                        点击字母进行排序
                    </div>
                    <button onclick="checkSequenceAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full">
                        检查顺序
                    </button>
                    <button onclick="clearSequence()" 
                            class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-full ml-4">
                        重新开始
                    </button>
                </div>
            `;

            selectedAnswer = [];
        }

        let sequenceAnswer = [];

        // 切换字母选择
        function toggleSequenceLetter(letter, element) {
            const index = sequenceAnswer.indexOf(letter);
            
            if (index > -1) {
                // 已选择，移除
                sequenceAnswer.splice(index, 1);
                element.classList.remove('selected');
            } else {
                // 未选择，添加
                sequenceAnswer.push(letter);
                element.classList.add('selected');
            }
            
            // 更新显示
            document.getElementById('sequence-result').textContent = 
                sequenceAnswer.length > 0 ? sequenceAnswer.join(' → ') : '点击字母进行排序';
        }

        // 清空排序
        function clearSequence() {
            sequenceAnswer = [];
            document.querySelectorAll('.letter-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('sequence-result').textContent = '点击字母进行排序';
        }

        // 检查排序答案
        function checkSequenceAnswer() {
            if (sequenceAnswer.length === 0) {
                alert('请选择字母进行排序！');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = JSON.stringify(sequenceAnswer) === JSON.stringify(question.target);
            
            showFeedback(isCorrect, question.target.join(' → '));
            gameManager.recordProgress(isCorrect);
        }

        // 发音练习问题
        function showPronunciationQuestion(question) {
            const content = document.getElementById('game-content');
            content.innerHTML = `
                <div class="text-center">
                    <div class="text-6xl mb-4">${question.emoji}</div>
                    <div class="text-3xl font-bold text-blue-600 mb-4">${question.target}</div>
                    <p class="text-xl text-gray-700 mb-8">${question.chinese}</p>
                    
                    <div class="space-y-4">
                        <button onclick="gameManager.speak('${question.target}')" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-full text-xl block mx-auto">
                            <i class="fa fa-volume-up mr-2"></i>听发音
                        </button>
                        
                        <p class="text-gray-600">请跟读上面的单词发音</p>
                        
                        <button onclick="pronunciationComplete(true)" 
                                class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full mr-4">
                            <i class="fa fa-check mr-2"></i>我读对了
                        </button>
                        
                        <button onclick="pronunciationComplete(false)" 
                                class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-refresh mr-2"></i>再听一遍
                        </button>
                    </div>
                </div>
            `;
            
            // 自动播放发音
            setTimeout(() => gameManager.speak(question.target), 1000);
        }

        // 发音练习完成
        function pronunciationComplete(success) {
            if (success) {
                const question = gameQuestions[currentQuestion];
                showFeedback(true, question.target, question.emoji + ' ' + question.chinese);
                gameManager.recordProgress(true);
            } else {
                const question = gameQuestions[currentQuestion];
                gameManager.speak(question.target);
            }
        }

        // 显示反馈
        function showFeedback(isCorrect, correctAnswer, extra = '') {
            const feedback = document.getElementById('feedback');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const message = document.getElementById('feedback-message');

            if (isCorrect) {
                icon.textContent = '🎉';
                title.textContent = '太棒了！';
                title.className = 'text-2xl font-bold mb-2 text-green-600';
                message.textContent = `正确答案是: ${correctAnswer} ${extra}`;
                
                // 播放成功音效（用语音代替）
                setTimeout(() => gameManager.speak('Excellent!'), 100);
            } else {
                icon.textContent = '😅';
                title.textContent = '再试试！';
                title.className = 'text-2xl font-bold mb-2 text-orange-600';
                message.textContent = `正确答案是: ${correctAnswer} ${extra}`;
                
                // 播放正确答案发音
                setTimeout(() => gameManager.speak(correctAnswer), 100);
            }

            feedback.classList.remove('hidden');
        }

        // 下一题
        function nextQuestion() {
            document.getElementById('feedback').classList.add('hidden');
            currentQuestion++;
            showQuestion();
        }

        // 游戏完成
        function showGameComplete() {
            const content = document.getElementById('game-content');
            const accuracy = Math.round((score / (totalQuestions * 10)) * 100);
            
            let performance = '';
            let performanceIcon = '';
            
            if (accuracy >= 90) {
                performance = '优秀！';
                performanceIcon = '🏆';
            } else if (accuracy >= 70) {
                performance = '良好！';
                performanceIcon = '⭐';
            } else if (accuracy >= 50) {
                performance = '继续加油！';
                performanceIcon = '👍';
            } else {
                performance = '需要更多练习！';
                performanceIcon = '💪';
            }

            content.innerHTML = `
                <div class="text-center">
                    <div class="text-6xl mb-6">${performanceIcon}</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">游戏完成！</h2>
                    <div class="bg-blue-50 rounded-lg p-6 mb-6">
                        <p class="text-xl mb-2">总得分: <span class="font-bold text-blue-600">${score}</span></p>
                        <p class="text-xl mb-2">正确率: <span class="font-bold text-green-600">${accuracy}%</span></p>
                        <p class="text-lg text-gray-600">${performance}</p>
                    </div>
                    <div class="space-x-4">
                        <button onclick="startGame('${currentGame}')" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-refresh mr-2"></i>再玩一次
                        </button>
                        <button onclick="backToHome()" 
                                class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-home mr-2"></i>返回首页
                        </button>
                    </div>
                </div>
            `;
        }

        // 返回首页
        function backToHome() {
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
        }
    </script>
</body>
</html>