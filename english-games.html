<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­è¶£å‘³å­¦ä¹  - å­—æ¯ä¸å•è¯æ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
        }
        .game-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }
        .letter-card {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        .letter-card:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
        }
        .letter-card.selected {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transform: scale(1.05);
        }
        .word-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .word-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }
        .alphabet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 10px;
            padding: 20px;
        }
        .word-matching-area {
            min-height: 200px;
            border: 3px dashed #ccc;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .word-matching-area.drag-over {
            border-color: #4facfe;
            background: rgba(79, 172, 254, 0.1);
        }
        .success-animation {
            animation: success-bounce 0.6s ease-in-out;
        }
        @keyframes success-bounce {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .floating-points {
            position: absolute;
            color: #4facfe;
            font-weight: bold;
            font-size: 1.5rem;
            animation: float-up 1.5s ease-out forwards;
            pointer-events: none;
            z-index: 1000;
        }
        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }
        .game-progress {
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 1s ease-in-out;
        }
    </style>
</head>
<body class="p-4">
    <!-- é¦–é¡µç•Œé¢ -->
    <div id="home-screen" class="max-w-6xl mx-auto">
        <div class="game-card p-8 mb-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">ğŸ® è‹±è¯­è¶£å‘³å­¦ä¹ </h1>
                <p class="text-lg text-gray-600 mb-6">é€‚åˆ4-10å²å„¿ç«¥çš„è‹±è¯­å­—æ¯å’Œå•è¯æ¸¸æˆ</p>
                <button onclick="window.location.href='index.html'" 
                        class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-2 rounded-full mb-4">
                    <i class="fa fa-home mr-2"></i>è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>

        <!-- æ¸¸æˆé€‰æ‹© -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- å­—æ¯è®¤çŸ¥æ¸¸æˆ -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('alphabet')">
                <div class="text-center">
                    <div class="text-6xl mb-4">ğŸ”¤</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">å­—æ¯è®¤çŸ¥</h3>
                    <p class="text-gray-600 text-sm mb-4">å­¦ä¹ 26ä¸ªè‹±æ–‡å­—æ¯çš„å‘éŸ³å’Œä¹¦å†™</p>
                    <div class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs">
                        é€‚åˆ4-6å²
                    </div>
                </div>
            </div>

            <!-- å•è¯æ‹¼å†™æ¸¸æˆ -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('spelling')">
                <div class="text-center">
                    <div class="text-6xl mb-4">âœï¸</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">å•è¯æ‹¼å†™</h3>
                    <p class="text-gray-600 text-sm mb-4">å¬å£°éŸ³æ‹¼å†™ç®€å•çš„è‹±æ–‡å•è¯</p>
                    <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs">
                        é€‚åˆ6-8å²
                    </div>
                </div>
            </div>

            <!-- å•è¯é…å›¾æ¸¸æˆ -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('matching')">
                <div class="text-center">
                    <div class="text-6xl mb-4">ğŸ–¼ï¸</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">å•è¯é…å›¾</h3>
                    <p class="text-gray-600 text-sm mb-4">å°†è‹±æ–‡å•è¯ä¸å¯¹åº”å›¾ç‰‡åŒ¹é…</p>
                    <div class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs">
                        é€‚åˆ5-8å²
                    </div>
                </div>
            </div>

            <!-- å­—æ¯æ’åºæ¸¸æˆ -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('sequence')">
                <div class="text-center">
                    <div class="text-6xl mb-4">ğŸ”¢</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">å­—æ¯æ’åº</h3>
                    <p class="text-gray-600 text-sm mb-4">æŒ‰å­—æ¯è¡¨é¡ºåºæ’åˆ—å­—æ¯</p>
                    <div class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs">
                        é€‚åˆ5-7å²
                    </div>
                </div>
            </div>

            <!-- å•è¯è®°å¿†æ¸¸æˆ -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('memory')">
                <div class="text-center">
                    <div class="text-6xl mb-4">ğŸ§ </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">å•è¯è®°å¿†</h3>
                    <p class="text-gray-600 text-sm mb-4">è®°å¿†å¡ç‰‡ä¸Šçš„è‹±æ–‡å•è¯</p>
                    <div class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs">
                        é€‚åˆ6-10å²
                    </div>
                </div>
            </div>

            <!-- å‘éŸ³ç»ƒä¹ æ¸¸æˆ -->
            <div class="game-card p-6 cursor-pointer" onclick="startGame('pronunciation')">
                <div class="text-center">
                    <div class="text-6xl mb-4">ğŸ¤</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">å‘éŸ³ç»ƒä¹ </h3>
                    <p class="text-gray-600 text-sm mb-4">è·Ÿè¯»è‹±æ–‡å­—æ¯å’Œå•è¯å‘éŸ³</p>
                    <div class="bg-teal-100 text-teal-800 px-3 py-1 rounded-full text-xs">
                        é€‚åˆ4-8å²
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¸¸æˆç•Œé¢ -->
    <div id="game-screen" class="hidden max-w-4xl mx-auto">
        <!-- æ¸¸æˆå¤´éƒ¨ -->
        <div class="game-card p-4 mb-6">
            <div class="flex justify-between items-center">
                <button onclick="backToHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-full">
                    <i class="fa fa-arrow-left mr-2"></i>è¿”å›
                </button>
                <div class="text-center">
                    <h2 id="game-title" class="text-2xl font-bold text-gray-800"></h2>
                    <p id="game-instruction" class="text-sm text-gray-600"></p>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">å¾—åˆ†</p>
                    <p id="game-score" class="text-2xl font-bold text-blue-600">0</p>
                </div>
            </div>
            <!-- è¿›åº¦æ¡ -->
            <div class="game-progress mt-4">
                <div id="progress-fill" class="progress-fill" style="width: 0%;"></div>
            </div>
            <p class="text-center text-sm text-gray-600 mt-2">
                <span id="current-progress">0</span> / <span id="total-progress">10</span>
            </p>
        </div>

        <!-- æ¸¸æˆå†…å®¹åŒº -->
        <div id="game-content" class="game-card p-6">
            <!-- å†…å®¹å°†æ ¹æ®ä¸åŒæ¸¸æˆåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- ç»“æœåé¦ˆ -->
        <div id="feedback" class="hidden game-card p-6 mt-4">
            <div class="text-center">
                <div id="feedback-icon" class="text-6xl mb-4"></div>
                <h3 id="feedback-title" class="text-2xl font-bold mb-2"></h3>
                <p id="feedback-message" class="text-gray-600 mb-4"></p>
                <button id="next-button" onclick="nextQuestion()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                    ä¸‹ä¸€é¢˜ <i class="fa fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // æ¸¸æˆæ•°æ®
        const gameData = {
            alphabet: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),
            words: [
                { word: 'CAT', chinese: 'çŒ«', emoji: 'ğŸ±' },
                { word: 'DOG', chinese: 'ç‹—', emoji: 'ğŸ¶' },
                { word: 'BIRD', chinese: 'é¸Ÿ', emoji: 'ğŸ¦' },
                { word: 'FISH', chinese: 'é±¼', emoji: 'ğŸ ' },
                { word: 'TREE', chinese: 'æ ‘', emoji: 'ğŸŒ³' },
                { word: 'SUN', chinese: 'å¤ªé˜³', emoji: 'â˜€ï¸' },
                { word: 'MOON', chinese: 'æœˆäº®', emoji: 'ğŸŒ™' },
                { word: 'STAR', chinese: 'æ˜Ÿæ˜Ÿ', emoji: 'â­' },
                { word: 'BOOK', chinese: 'ä¹¦', emoji: 'ğŸ“š' },
                { word: 'BALL', chinese: 'çƒ', emoji: 'âš½' },
                { word: 'CAR', chinese: 'æ±½è½¦', emoji: 'ğŸš—' },
                { word: 'HOME', chinese: 'å®¶', emoji: 'ğŸ ' },
                { word: 'APPLE', chinese: 'è‹¹æœ', emoji: 'ğŸ' },
                { word: 'CAKE', chinese: 'è›‹ç³•', emoji: 'ğŸ‚' },
                { word: 'MILK', chinese: 'ç‰›å¥¶', emoji: 'ğŸ¥›' }
            ]
        };

        // æ¸¸æˆçŠ¶æ€
        let currentGame = null;
        let currentQuestion = 0;
        let totalQuestions = 10;
        let score = 0;
        let gameQuestions = [];
        let selectedAnswer = null;

        // æ¸¸æˆç®¡ç†å™¨
        class EnglishGameManager {
            constructor() {
                this.initSpeechSynthesis();
            }

            // åˆå§‹åŒ–è¯­éŸ³åˆæˆ
            initSpeechSynthesis() {
                this.voices = [];
                this.englishVoice = null;
                
                if ('speechSynthesis' in window) {
                    const loadVoices = () => {
                        this.voices = speechSynthesis.getVoices();
                        this.englishVoice = this.voices.find(voice => 
                            voice.lang.includes('en') && 
                            (voice.name.includes('English') || voice.lang === 'en-US')
                        ) || this.voices[0];
                        console.log('é€‰æ‹©è‹±è¯­è¯­éŸ³:', this.englishVoice?.name);
                    };

                    if (this.voices.length === 0) {
                        speechSynthesis.onvoiceschanged = loadVoices;
                    } else {
                        loadVoices();
                    }
                }
            }

            // æ’­æ”¾è‹±æ–‡å‘éŸ³
            speak(text, rate = 0.8) {
                if (!('speechSynthesis' in window) || !this.englishVoice) {
                    console.log('è¯­éŸ³ä¸å¯ç”¨ï¼Œæ˜¾ç¤ºæ–‡å­—:', text);
                    return;
                }

                // å¤„ç†å­—æ¯å‘éŸ³ï¼Œé¿å…è¯»å‡º "Capital"
                let speakText = text;
                if (text.length === 1 && /[A-Z]/.test(text)) {
                    // å•ä¸ªå¤§å†™å­—æ¯ï¼Œè½¬æ¢ä¸ºå°å†™é¿å…è¯»"Capital"
                    speakText = text.toLowerCase();
                }

                const utterance = new SpeechSynthesisUtterance(speakText);
                utterance.voice = this.englishVoice;
                utterance.rate = rate;
                utterance.pitch = 1.0;
                utterance.volume = 0.9;
                utterance.lang = 'en-US';

                console.log(`ğŸ”Š æ’­æ”¾å‘éŸ³: "${text}" -> "${speakText}"`);

                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            }

            // æ˜¾ç¤ºæµ®åŠ¨å¾—åˆ†
            showFloatingPoints(points, x, y) {
                const element = document.createElement('div');
                element.className = 'floating-points';
                element.textContent = `+${points}`;
                element.style.left = x + 'px';
                element.style.top = y + 'px';
                document.body.appendChild(element);

                setTimeout(() => {
                    element.remove();
                }, 1500);
            }

            // è®°å½•å­¦ä¹ è¿›åº¦
            recordProgress(correct) {
                const points = correct ? 10 : 0;
                score += points;
                document.getElementById('game-score').textContent = score;

                // è°ƒç”¨è¿›åº¦è®°å½•ç³»ç»Ÿ
                if (window.recordLearningProgress) {
                    window.recordLearningProgress('english', currentGame, points, 30);
                }
            }
        }

        const gameManager = new EnglishGameManager();

        // å¼€å§‹æ¸¸æˆ
        function startGame(gameType) {
            currentGame = gameType;
            currentQuestion = 0;
            score = 0;
            selectedAnswer = null;

            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('feedback').classList.add('hidden');

            // æ ¹æ®æ¸¸æˆç±»å‹è®¾ç½®æ ‡é¢˜å’Œè¯´æ˜
            const gameInfo = {
                'alphabet': { title: 'ğŸ”¤ å­—æ¯è®¤çŸ¥æ¸¸æˆ', instruction: 'ç‚¹å‡»å¬å‘éŸ³ï¼Œé€‰æ‹©å¯¹åº”çš„å­—æ¯' },
                'spelling': { title: 'âœï¸ å•è¯æ‹¼å†™æ¸¸æˆ', instruction: 'å¬å•è¯å‘éŸ³ï¼Œæ‹¼å‡ºæ­£ç¡®çš„å•è¯' },
                'matching': { title: 'ğŸ–¼ï¸ å•è¯é…å›¾æ¸¸æˆ', instruction: 'å°†å•è¯ä¸å¯¹åº”çš„è¡¨æƒ…ç¬¦å·åŒ¹é…' },
                'sequence': { title: 'ğŸ”¢ å­—æ¯æ’åºæ¸¸æˆ', instruction: 'æŒ‰å­—æ¯è¡¨é¡ºåºæ’åˆ—å­—æ¯' },
                'memory': { title: 'ğŸ§  å•è¯è®°å¿†æ¸¸æˆ', instruction: 'è®°ä½å¡ç‰‡ä¸Šçš„å•è¯ä½ç½®' },
                'pronunciation': { title: 'ğŸ¤ å‘éŸ³ç»ƒä¹ æ¸¸æˆ', instruction: 'è·Ÿè¯»å­—æ¯å’Œå•è¯çš„å‘éŸ³' }
            };

            document.getElementById('game-title').textContent = gameInfo[gameType].title;
            document.getElementById('game-instruction').textContent = gameInfo[gameType].instruction;
            document.getElementById('game-score').textContent = score;

            // ç”Ÿæˆæ¸¸æˆé¢˜ç›®
            generateQuestions(gameType);
            showQuestion();
        }

        // ç”Ÿæˆé¢˜ç›®
        function generateQuestions(gameType) {
            gameQuestions = [];
            
            switch(gameType) {
                case 'alphabet':
                    // éšæœºé€‰æ‹©10ä¸ªå­—æ¯
                    const shuffledAlphabet = [...gameData.alphabet].sort(() => Math.random() - 0.5);
                    gameQuestions = shuffledAlphabet.slice(0, 10).map(letter => ({
                        type: 'alphabet',
                        target: letter,
                        options: generateAlphabetOptions(letter)
                    }));
                    break;
                
                case 'spelling':
                    // éšæœºé€‰æ‹©å•è¯
                    const shuffledWords = [...gameData.words].sort(() => Math.random() - 0.5);
                    gameQuestions = shuffledWords.slice(0, 10).map(wordObj => ({
                        type: 'spelling',
                        target: wordObj.word,
                        chinese: wordObj.chinese,
                        emoji: wordObj.emoji
                    }));
                    break;
                
                case 'matching':
                    // å•è¯é…å›¾
                    const matchWords = [...gameData.words].sort(() => Math.random() - 0.5);
                    gameQuestions = matchWords.slice(0, 10).map(wordObj => ({
                        type: 'matching',
                        target: wordObj.word,
                        chinese: wordObj.chinese,
                        emoji: wordObj.emoji,
                        options: generateMatchingOptions(wordObj)
                    }));
                    break;
                
                case 'sequence':
                    // å­—æ¯æ’åº
                    for(let i = 0; i < 10; i++) {
                        const startIndex = Math.floor(Math.random() * 20); // A-T èŒƒå›´
                        const sequence = gameData.alphabet.slice(startIndex, startIndex + 4);
                        const shuffled = [...sequence].sort(() => Math.random() - 0.5);
                        gameQuestions.push({
                            type: 'sequence',
                            target: sequence,
                            shuffled: shuffled
                        });
                    }
                    break;
                
                case 'memory':
                    // è®°å¿†æ¸¸æˆ
                    const memoryWords = [...gameData.words].sort(() => Math.random() - 0.5);
                    gameQuestions = memoryWords.slice(0, 10).map(wordObj => ({
                        type: 'memory',
                        target: wordObj.word,
                        chinese: wordObj.chinese,
                        emoji: wordObj.emoji
                    }));
                    break;
                
                case 'pronunciation':
                    // å‘éŸ³ç»ƒä¹ 
                    const pronWords = [...gameData.words].sort(() => Math.random() - 0.5);
                    gameQuestions = pronWords.slice(0, 10).map(wordObj => ({
                        type: 'pronunciation',
                        target: wordObj.word,
                        chinese: wordObj.chinese,
                        emoji: wordObj.emoji
                    }));
                    break;
            }
            
            totalQuestions = gameQuestions.length;
            document.getElementById('total-progress').textContent = totalQuestions;
        }

        // ç”Ÿæˆå­—æ¯é€‰é¡¹
        function generateAlphabetOptions(correct) {
            const options = [correct];
            while(options.length < 4) {
                const random = gameData.alphabet[Math.floor(Math.random() * gameData.alphabet.length)];
                if(!options.includes(random)) {
                    options.push(random);
                }
            }
            return options.sort(() => Math.random() - 0.5);
        }

        // ç”Ÿæˆé…å›¾é€‰é¡¹
        function generateMatchingOptions(correct) {
            const options = [correct];
            while(options.length < 4) {
                const random = gameData.words[Math.floor(Math.random() * gameData.words.length)];
                if(!options.find(opt => opt.word === random.word)) {
                    options.push(random);
                }
            }
            return options.sort(() => Math.random() - 0.5);
        }

        // æ˜¾ç¤ºå½“å‰é¢˜ç›®
        function showQuestion() {
            if(currentQuestion >= totalQuestions) {
                showGameComplete();
                return;
            }

            const question = gameQuestions[currentQuestion];
            const content = document.getElementById('game-content');
            selectedAnswer = null;

            // æ›´æ–°è¿›åº¦
            const progress = ((currentQuestion + 1) / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            document.getElementById('current-progress').textContent = currentQuestion + 1;

            // æ ¹æ®æ¸¸æˆç±»å‹ç”Ÿæˆå†…å®¹
            switch(question.type) {
                case 'alphabet':
                    showAlphabetQuestion(question);
                    break;
                case 'spelling':
                    showSpellingQuestion(question);
                    break;
                case 'matching':
                    showMatchingQuestion(question);
                    break;
                case 'sequence':
                    showSequenceQuestion(question);
                    break;
                case 'memory':
                    showMemoryQuestion(question);
                    break;
                case 'pronunciation':
                    showPronunciationQuestion(question);
                    break;
            }
        }

        // å­—æ¯è®¤çŸ¥é—®é¢˜
        function showAlphabetQuestion(question) {
            const content = document.getElementById('game-content');
            content.innerHTML = `
                <div class="text-center mb-8">
                    <div class="text-6xl font-bold text-blue-600 mb-4">${question.target}</div>
                    <button onclick="gameManager.speak('${question.target}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-full text-xl">
                        <i class="fa fa-volume-up mr-2"></i>æ’­æ”¾å‘éŸ³
                    </button>
                </div>
                <div class="alphabet-grid">
                    ${question.options.map(letter => `
                        <div class="letter-card" onclick="selectAlphabet('${letter}', this)">
                            ${letter}
                        </div>
                    `).join('')}
                </div>
                <div class="text-center mt-6">
                    <button onclick="checkAlphabetAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full">
                        ç¡®è®¤ç­”æ¡ˆ
                    </button>
                </div>
            `;
            
            // è‡ªåŠ¨æ’­æ”¾ä¸€æ¬¡
            setTimeout(() => gameManager.speak(question.target), 500);
        }

        // é€‰æ‹©å­—æ¯
        function selectAlphabet(letter, element) {
            document.querySelectorAll('.letter-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedAnswer = letter;
        }

        // æ£€æŸ¥å­—æ¯ç­”æ¡ˆ
        function checkAlphabetAnswer() {
            if (!selectedAnswer) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå­—æ¯ï¼');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = selectedAnswer === question.target;
            
            showFeedback(isCorrect, question.target);
            gameManager.recordProgress(isCorrect);
        }

        // å•è¯æ‹¼å†™é—®é¢˜
        function showSpellingQuestion(question) {
            const content = document.getElementById('game-content');
            const letters = question.target.split('').map(() => '_').join(' ');
            
            content.innerHTML = `
                <div class="text-center mb-8">
                    <div class="text-6xl mb-4">${question.emoji}</div>
                    <p class="text-xl text-gray-700 mb-4">${question.chinese}</p>
                    <button onclick="gameManager.speak('${question.target}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                        <i class="fa fa-volume-up mr-2"></i>å¬å‘éŸ³
                    </button>
                </div>
                <div class="text-center mb-6">
                    <div class="text-4xl font-mono tracking-widest text-gray-400 mb-4" id="word-display">
                        ${letters}
                    </div>
                    <input type="text" id="spelling-input" 
                           class="text-2xl text-center border-2 border-gray-300 rounded-lg px-4 py-2 tracking-widest"
                           placeholder="è¾“å…¥å•è¯..." maxlength="${question.target.length}">
                </div>
                <div class="text-center">
                    <button onclick="checkSpellingAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full">
                        æ£€æŸ¥æ‹¼å†™
                    </button>
                </div>
            `;
            
            // è‡ªåŠ¨æ’­æ”¾å‘éŸ³
            setTimeout(() => gameManager.speak(question.target), 500);
        }

        // æ£€æŸ¥æ‹¼å†™ç­”æ¡ˆ
        function checkSpellingAnswer() {
            const input = document.getElementById('spelling-input');
            const answer = input.value.toUpperCase().trim();
            
            if (!answer) {
                alert('è¯·è¾“å…¥å•è¯ï¼');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = answer === question.target;
            
            showFeedback(isCorrect, question.target, question.emoji + ' ' + question.chinese);
            gameManager.recordProgress(isCorrect);
        }

        // å•è¯é…å›¾é—®é¢˜
        function showMatchingQuestion(question) {
            const content = document.getElementById('game-content');
            content.innerHTML = `
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">é€‰æ‹©ä¸å•è¯åŒ¹é…çš„è¡¨æƒ…</h3>
                    <div class="text-4xl font-bold text-blue-600 mb-4">${question.target}</div>
                    <button onclick="gameManager.speak('${question.target}')" 
                            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-full">
                        <i class="fa fa-volume-up mr-1"></i>å‘éŸ³
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    ${question.options.map((option, index) => `
                        <div class="word-card cursor-pointer" onclick="selectMatching('${option.word}', this)">
                            <div class="text-4xl mb-2">${option.emoji}</div>
                            <div class="font-bold">${option.chinese}</div>
                        </div>
                    `).join('')}
                </div>
                <div class="text-center mt-6">
                    <button onclick="checkMatchingAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full">
                        ç¡®è®¤é€‰æ‹©
                    </button>
                </div>
            `;
        }

        // é€‰æ‹©é…å›¾
        function selectMatching(word, element) {
            document.querySelectorAll('.word-card').forEach(card => {
                card.style.transform = 'translateY(0)';
                card.style.boxShadow = '';
            });
            element.style.transform = 'translateY(-5px)';
            element.style.boxShadow = '0 8px 25px rgba(79, 172, 254, 0.4)';
            selectedAnswer = word;
        }

        // æ£€æŸ¥é…å›¾ç­”æ¡ˆ
        function checkMatchingAnswer() {
            if (!selectedAnswer) {
                alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = selectedAnswer === question.target;
            
            showFeedback(isCorrect, question.target, question.emoji + ' ' + question.chinese);
            gameManager.recordProgress(isCorrect);
        }

        // å­—æ¯æ’åºé—®é¢˜
        function showSequenceQuestion(question) {
            const content = document.getElementById('game-content');
            content.innerHTML = `
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">æŒ‰å­—æ¯è¡¨é¡ºåºæ’åˆ—</h3>
                    <p class="text-gray-600">ç›®æ ‡é¡ºåº: ${question.target.join(' â†’ ')}</p>
                </div>
                <div class="alphabet-grid justify-center">
                    ${question.shuffled.map(letter => `
                        <div class="letter-card draggable" draggable="true" 
                             ondragstart="dragStart(event, '${letter}')" 
                             onclick="toggleSequenceLetter('${letter}', this)">
                            ${letter}
                        </div>
                    `).join('')}
                </div>
                <div class="text-center mt-8">
                    <div class="text-lg text-gray-700 mb-4">ä½ çš„æ’åº:</div>
                    <div id="sequence-result" class="text-2xl font-bold text-blue-600 mb-4 min-h-[3rem] flex items-center justify-center">
                        ç‚¹å‡»å­—æ¯è¿›è¡Œæ’åº
                    </div>
                    <button onclick="checkSequenceAnswer()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full">
                        æ£€æŸ¥é¡ºåº
                    </button>
                    <button onclick="clearSequence()" 
                            class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-full ml-4">
                        é‡æ–°å¼€å§‹
                    </button>
                </div>
            `;

            selectedAnswer = [];
        }

        let sequenceAnswer = [];

        // åˆ‡æ¢å­—æ¯é€‰æ‹©
        function toggleSequenceLetter(letter, element) {
            const index = sequenceAnswer.indexOf(letter);
            
            if (index > -1) {
                // å·²é€‰æ‹©ï¼Œç§»é™¤
                sequenceAnswer.splice(index, 1);
                element.classList.remove('selected');
            } else {
                // æœªé€‰æ‹©ï¼Œæ·»åŠ 
                sequenceAnswer.push(letter);
                element.classList.add('selected');
            }
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('sequence-result').textContent = 
                sequenceAnswer.length > 0 ? sequenceAnswer.join(' â†’ ') : 'ç‚¹å‡»å­—æ¯è¿›è¡Œæ’åº';
        }

        // æ¸…ç©ºæ’åº
        function clearSequence() {
            sequenceAnswer = [];
            document.querySelectorAll('.letter-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('sequence-result').textContent = 'ç‚¹å‡»å­—æ¯è¿›è¡Œæ’åº';
        }

        // æ£€æŸ¥æ’åºç­”æ¡ˆ
        function checkSequenceAnswer() {
            if (sequenceAnswer.length === 0) {
                alert('è¯·é€‰æ‹©å­—æ¯è¿›è¡Œæ’åºï¼');
                return;
            }

            const question = gameQuestions[currentQuestion];
            const isCorrect = JSON.stringify(sequenceAnswer) === JSON.stringify(question.target);
            
            showFeedback(isCorrect, question.target.join(' â†’ '));
            gameManager.recordProgress(isCorrect);
        }

        // å‘éŸ³ç»ƒä¹ é—®é¢˜
        function showPronunciationQuestion(question) {
            const content = document.getElementById('game-content');
            content.innerHTML = `
                <div class="text-center">
                    <div class="text-6xl mb-4">${question.emoji}</div>
                    <div class="text-3xl font-bold text-blue-600 mb-4">${question.target}</div>
                    <p class="text-xl text-gray-700 mb-8">${question.chinese}</p>
                    
                    <div class="space-y-4">
                        <button onclick="gameManager.speak('${question.target}')" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 rounded-full text-xl block mx-auto">
                            <i class="fa fa-volume-up mr-2"></i>å¬å‘éŸ³
                        </button>
                        
                        <p class="text-gray-600">è¯·è·Ÿè¯»ä¸Šé¢çš„å•è¯å‘éŸ³</p>
                        
                        <button onclick="pronunciationComplete(true)" 
                                class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full mr-4">
                            <i class="fa fa-check mr-2"></i>æˆ‘è¯»å¯¹äº†
                        </button>
                        
                        <button onclick="pronunciationComplete(false)" 
                                class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-refresh mr-2"></i>å†å¬ä¸€é
                        </button>
                    </div>
                </div>
            `;
            
            // è‡ªåŠ¨æ’­æ”¾å‘éŸ³
            setTimeout(() => gameManager.speak(question.target), 1000);
        }

        // å‘éŸ³ç»ƒä¹ å®Œæˆ
        function pronunciationComplete(success) {
            if (success) {
                const question = gameQuestions[currentQuestion];
                showFeedback(true, question.target, question.emoji + ' ' + question.chinese);
                gameManager.recordProgress(true);
            } else {
                const question = gameQuestions[currentQuestion];
                gameManager.speak(question.target);
            }
        }

        // æ˜¾ç¤ºåé¦ˆ
        function showFeedback(isCorrect, correctAnswer, extra = '') {
            const feedback = document.getElementById('feedback');
            const icon = document.getElementById('feedback-icon');
            const title = document.getElementById('feedback-title');
            const message = document.getElementById('feedback-message');

            if (isCorrect) {
                icon.textContent = 'ğŸ‰';
                title.textContent = 'å¤ªæ£’äº†ï¼';
                title.className = 'text-2xl font-bold mb-2 text-green-600';
                message.textContent = `æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correctAnswer} ${extra}`;
                
                // æ’­æ”¾æˆåŠŸéŸ³æ•ˆï¼ˆç”¨è¯­éŸ³ä»£æ›¿ï¼‰
                setTimeout(() => gameManager.speak('Excellent!'), 100);
            } else {
                icon.textContent = 'ğŸ˜…';
                title.textContent = 'å†è¯•è¯•ï¼';
                title.className = 'text-2xl font-bold mb-2 text-orange-600';
                message.textContent = `æ­£ç¡®ç­”æ¡ˆæ˜¯: ${correctAnswer} ${extra}`;
                
                // æ’­æ”¾æ­£ç¡®ç­”æ¡ˆå‘éŸ³
                setTimeout(() => gameManager.speak(correctAnswer), 100);
            }

            feedback.classList.remove('hidden');
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            document.getElementById('feedback').classList.add('hidden');
            currentQuestion++;
            showQuestion();
        }

        // æ¸¸æˆå®Œæˆ
        function showGameComplete() {
            const content = document.getElementById('game-content');
            const accuracy = Math.round((score / (totalQuestions * 10)) * 100);
            
            let performance = '';
            let performanceIcon = '';
            
            if (accuracy >= 90) {
                performance = 'ä¼˜ç§€ï¼';
                performanceIcon = 'ğŸ†';
            } else if (accuracy >= 70) {
                performance = 'è‰¯å¥½ï¼';
                performanceIcon = 'â­';
            } else if (accuracy >= 50) {
                performance = 'ç»§ç»­åŠ æ²¹ï¼';
                performanceIcon = 'ğŸ‘';
            } else {
                performance = 'éœ€è¦æ›´å¤šç»ƒä¹ ï¼';
                performanceIcon = 'ğŸ’ª';
            }

            content.innerHTML = `
                <div class="text-center">
                    <div class="text-6xl mb-6">${performanceIcon}</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">æ¸¸æˆå®Œæˆï¼</h2>
                    <div class="bg-blue-50 rounded-lg p-6 mb-6">
                        <p class="text-xl mb-2">æ€»å¾—åˆ†: <span class="font-bold text-blue-600">${score}</span></p>
                        <p class="text-xl mb-2">æ­£ç¡®ç‡: <span class="font-bold text-green-600">${accuracy}%</span></p>
                        <p class="text-lg text-gray-600">${performance}</p>
                    </div>
                    <div class="space-x-4">
                        <button onclick="startGame('${currentGame}')" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-refresh mr-2"></i>å†ç©ä¸€æ¬¡
                        </button>
                        <button onclick="backToHome()" 
                                class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-full">
                            <i class="fa fa-home mr-2"></i>è¿”å›é¦–é¡µ
                        </button>
                    </div>
                </div>
            `;
        }

        // è¿”å›é¦–é¡µ
        function backToHome() {
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('game-screen').classList.add('hidden');
        }
    </script>
</body>
</html>