<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ä¹ è¿›åº¦ä¸­å¿ƒ - æ™ºèƒ½åˆ†æä¸å»ºè®®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dasharray 0.35s;
            transform-origin: 50% 50%;
        }
        .ai-suggestion {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
            100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
        }
        .achievement-badge {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }
        .skill-bar {
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
            margin: 10px 0;
        }
        .skill-progress {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 10px;
            transition: width 1s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 12px;
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-6xl mx-auto">
        <!-- å¤´éƒ¨å¯¼èˆª -->
        <div class="card p-6 mb-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <button onclick="window.location.href='index.html'" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-full mr-4">
                        <i class="fa fa-home mr-2"></i>è¿”å›é¦–é¡µ
                    </button>
                    <h1 class="text-3xl font-bold text-gray-800">ğŸ“Š å­¦ä¹ è¿›åº¦ä¸­å¿ƒ</h1>
                </div>
                <div class="text-right">
                    <p class="text-sm text-gray-600">ä»Šæ—¥å­¦ä¹ æ—¶é—´</p>
                    <p class="text-2xl font-bold text-blue-600" id="today-study-time">0åˆ†é’Ÿ</p>
                </div>
            </div>
        </div>

        <!-- AI å­¦ä¹ å»ºè®®å¡ç‰‡ -->
        <div class="ai-suggestion mb-6">
            <div class="flex items-center mb-4">
                <i class="fa fa-robot text-3xl mr-3"></i>
                <h2 class="text-xl font-bold">ğŸ¤– AI å­¦ä¹ å»ºè®®</h2>
            </div>
            <div id="ai-suggestions">
                <p>æ­£åœ¨åˆ†ææ‚¨çš„å­¦ä¹ æ•°æ®ï¼Œç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®...</p>
            </div>
        </div>

        <!-- æ•°æ®ç»Ÿè®¡é¢æ¿ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <!-- æ€»ä½“è¿›åº¦ -->
            <div class="card p-6 text-center">
                <div class="relative w-24 h-24 mx-auto mb-4">
                    <svg class="progress-ring w-full h-full">
                        <circle cx="48" cy="48" r="40" stroke="#f0f0f0" stroke-width="8" fill="none"/>
                        <circle id="overall-progress-circle" cx="48" cy="48" r="40" stroke="#4facfe" 
                                stroke-width="8" fill="none" stroke-dasharray="0 251.2"/>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span id="overall-percentage" class="text-xl font-bold text-blue-600">0%</span>
                    </div>
                </div>
                <h3 class="font-bold text-gray-700">æ€»ä½“è¿›åº¦</h3>
                <p class="text-sm text-gray-500">æ‰€æœ‰ç§‘ç›®å¹³å‡</p>
            </div>

            <!-- è¿ç»­å­¦ä¹ å¤©æ•° -->
            <div class="card p-6 text-center">
                <i class="fa fa-fire text-4xl text-orange-500 mb-4"></i>
                <h3 class="text-2xl font-bold text-gray-700" id="streak-days">0</h3>
                <p class="text-sm text-gray-500">è¿ç»­å­¦ä¹ å¤©æ•°</p>
            </div>

            <!-- æœ¬å‘¨æ­£ç¡®ç‡ -->
            <div class="card p-6 text-center">
                <i class="fa fa-bullseye text-4xl text-green-500 mb-4"></i>
                <h3 class="text-2xl font-bold text-gray-700" id="weekly-accuracy">0%</h3>
                <p class="text-sm text-gray-500">æœ¬å‘¨æ­£ç¡®ç‡</p>
            </div>

            <!-- è·å¾—å¾½ç«  -->
            <div class="card p-6 text-center">
                <i class="fa fa-trophy text-4xl text-yellow-500 mb-4"></i>
                <h3 class="text-2xl font-bold text-gray-700" id="total-badges">0</h3>
                <p class="text-sm text-gray-500">è·å¾—å¾½ç« </p>
            </div>
        </div>

        <!-- å­¦ç§‘è¿›åº¦è¯¦æƒ… -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- æ‹¼éŸ³å­¦ä¹ è¿›åº¦ -->
            <div class="card p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ æ‹¼éŸ³å­¦ä¹ è¿›åº¦</h3>
                
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold">å£°æ¯æŒæ¡</span>
                        <span id="consonant-mastery">0/23</span>
                    </div>
                    <div class="skill-bar">
                        <div id="consonant-progress" class="skill-progress" style="width: 0%;">0%</div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold">éŸµæ¯æŒæ¡</span>
                        <span id="vowel-mastery">0/24</span>
                    </div>
                    <div class="skill-bar">
                        <div id="vowel-progress" class="skill-progress" style="width: 0%;">0%</div>
                    </div>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-blue-800">
                        <i class="fa fa-lightbulb mr-2"></i>
                        <span id="pinyin-tip">ç»§ç»­ç»ƒä¹ ï¼ŒæŒæ¡æ›´å¤šæ‹¼éŸ³çŸ¥è¯†ï¼</span>
                    </p>
                </div>
            </div>

            <!-- æ•°å­¦ç»ƒä¹ è¿›åº¦ -->
            <div class="card p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ”¢ æ•°å­¦ç»ƒä¹ è¿›åº¦</h3>
                
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold">åŠ æ³•ç»ƒä¹ </span>
                        <span id="addition-score">å¹³å‡åˆ†: 0</span>
                    </div>
                    <div class="skill-bar">
                        <div id="addition-progress" class="skill-progress" style="width: 0%;">0%</div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-semibold">å‡æ³•ç»ƒä¹ </span>
                        <span id="subtraction-score">å¹³å‡åˆ†: 0</span>
                    </div>
                    <div class="skill-bar">
                        <div id="subtraction-progress" class="skill-progress" style="width: 0%;">0%</div>
                    </div>
                </div>

                <div class="bg-green-50 p-4 rounded-lg">
                    <p class="text-sm text-green-800">
                        <i class="fa fa-calculator mr-2"></i>
                        <span id="math-tip">æ•°å­¦åŸºç¡€å¾ˆé‡è¦ï¼ŒåšæŒç»ƒä¹ ä¼šæœ‰è¿›æ­¥ï¼</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- æˆå°±å¾½ç« å±•ç¤º -->
        <div class="card p-6 mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ† æˆå°±å¾½ç« </h3>
            <div class="flex flex-wrap" id="achievements-container">
                <!-- å¾½ç« å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å­¦ä¹ å†å²å›¾è¡¨ -->
        <div class="card p-6 mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ˆ å­¦ä¹ å†å²</h3>
            <div class="h-64 flex items-end justify-center space-x-2" id="chart-container">
                <!-- ç®€å•çš„æŸ±çŠ¶å›¾ -->
            </div>
        </div>

        <!-- å¿«é€Ÿå¼€å§‹å­¦ä¹  -->
        <div class="card p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸš€ ç»§ç»­å­¦ä¹ </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="window.location.href='pinyin-game.html'" 
                        class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg transition-colors">
                    <i class="fa fa-book text-2xl mb-2"></i>
                    <p class="font-bold">æ‹¼éŸ³ç»ƒä¹ </p>
                    <p class="text-sm opacity-90">ç»§ç»­å­¦ä¹ å£°æ¯éŸµæ¯</p>
                </button>
                <button onclick="window.location.href='math-practice.html'" 
                        class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg transition-colors">
                    <i class="fa fa-calculator text-2xl mb-2"></i>
                    <p class="font-bold">æ•°å­¦ç»ƒä¹ </p>
                    <p class="text-sm opacity-90">åŠ å‡æ³•è®¡ç®—è®­ç»ƒ</p>
                </button>
                <button onclick="window.location.href='antonym-game.html'" 
                        class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg transition-colors">
                    <i class="fa fa-users text-2xl mb-2"></i>
                    <p class="font-bold">åä¹‰è¯å¯¹æˆ˜</p>
                    <p class="text-sm opacity-90">è¯æ±‡çŸ¥è¯†æŒ‘æˆ˜</p>
                </button>
            </div>
        </div>
    </div>

    <script>
        // å­¦ä¹ æ•°æ®ç®¡ç†ç±»
        class LearningProgressManager {
            constructor() {
                this.data = this.loadData();
                this.init();
            }

            // åŠ è½½æœ¬åœ°å­˜å‚¨æ•°æ®
            loadData() {
                const defaultData = {
                    totalStudyTime: 0,
                    todayStudyTime: 0,
                    lastStudyDate: null,
                    streakDays: 0,
                    subjects: {
                        pinyin: {
                            consonants: { completed: [], totalScore: 0, attempts: 0 },
                            vowels: { completed: [], totalScore: 0, attempts: 0 }
                        },
                        math: {
                            addition: { totalScore: 0, attempts: 0, bestStreak: 0 },
                            subtraction: { totalScore: 0, attempts: 0, bestStreak: 0 }
                        },
                        vocabulary: {
                            antonyms: { totalScore: 0, attempts: 0, wordsLearned: [] }
                        }
                    },
                    achievements: [],
                    dailyHistory: {}
                };

                const stored = localStorage.getItem('learningProgress');
                return stored ? { ...defaultData, ...JSON.parse(stored) } : defaultData;
            }

            // ä¿å­˜æ•°æ®
            saveData() {
                localStorage.setItem('learningProgress', JSON.stringify(this.data));
            }

            // åˆå§‹åŒ–ç•Œé¢
            init() {
                this.updateTodayTime();
                this.calculateOverallProgress();
                this.updateStreakDays();
                this.updateSubjectProgress();
                this.generateAchievements();
                this.generateAISuggestions();
                this.createLearningChart();
            }

            // æ›´æ–°ä»Šæ—¥å­¦ä¹ æ—¶é—´
            updateTodayTime() {
                const today = new Date().toDateString();
                const lastDate = this.data.lastStudyDate;
                
                if (lastDate !== today) {
                    this.data.todayStudyTime = 0;
                    this.data.lastStudyDate = today;
                }

                document.getElementById('today-study-time').textContent = 
                    Math.round(this.data.todayStudyTime / 60) + 'åˆ†é’Ÿ';
            }

            // è®¡ç®—æ€»ä½“è¿›åº¦
            calculateOverallProgress() {
                let totalProgress = 0;
                let subjects = 0;

                // æ‹¼éŸ³è¿›åº¦
                const consonantProgress = (this.data.subjects.pinyin.consonants.completed.length / 23) * 100;
                const vowelProgress = (this.data.subjects.pinyin.vowels.completed.length / 24) * 100;
                const pinyinProgress = (consonantProgress + vowelProgress) / 2;
                totalProgress += pinyinProgress;
                subjects++;

                // æ•°å­¦è¿›åº¦ (åŸºäºæ­£ç¡®ç‡)
                const mathSubjects = this.data.subjects.math;
                let mathProgress = 0;
                let mathCount = 0;
                
                Object.values(mathSubjects).forEach(subject => {
                    if (subject.attempts > 0) {
                        mathProgress += (subject.totalScore / subject.attempts);
                        mathCount++;
                    }
                });
                
                if (mathCount > 0) {
                    totalProgress += (mathProgress / mathCount);
                    subjects++;
                }

                const overallProgress = subjects > 0 ? (totalProgress / subjects) : 0;
                
                // æ›´æ–°ç¯å½¢è¿›åº¦æ¡
                this.updateCircularProgress('overall-progress-circle', overallProgress);
                document.getElementById('overall-percentage').textContent = 
                    Math.round(overallProgress) + '%';
            }

            // æ›´æ–°ç¯å½¢è¿›åº¦æ¡
            updateCircularProgress(elementId, percentage) {
                const circle = document.getElementById(elementId);
                const radius = 40;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (percentage / 100 * circumference);
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
            }

            // æ›´æ–°è¿ç»­å­¦ä¹ å¤©æ•°
            updateStreakDays() {
                // è®¡ç®—è¿ç»­å­¦ä¹ å¤©æ•°çš„é€»è¾‘
                document.getElementById('streak-days').textContent = this.data.streakDays;
                
                // è®¡ç®—æœ¬å‘¨æ­£ç¡®ç‡
                const weeklyAccuracy = this.calculateWeeklyAccuracy();
                document.getElementById('weekly-accuracy').textContent = Math.round(weeklyAccuracy) + '%';
            }

            // è®¡ç®—æœ¬å‘¨æ­£ç¡®ç‡
            calculateWeeklyAccuracy() {
                // ç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…åº”è¯¥åŸºäºæœ€è¿‘7å¤©çš„æ•°æ®
                let totalScore = 0;
                let totalAttempts = 0;

                Object.values(this.data.subjects).forEach(subject => {
                    Object.values(subject).forEach(activity => {
                        if (activity.totalScore !== undefined) {
                            totalScore += activity.totalScore;
                            totalAttempts += activity.attempts;
                        }
                    });
                });

                return totalAttempts > 0 ? (totalScore / totalAttempts) * 100 : 0;
            }

            // æ›´æ–°å­¦ç§‘è¿›åº¦
            updateSubjectProgress() {
                // æ‹¼éŸ³è¿›åº¦
                const consonants = this.data.subjects.pinyin.consonants;
                const vowels = this.data.subjects.pinyin.vowels;
                
                const consonantPercent = (consonants.completed.length / 23) * 100;
                const vowelPercent = (vowels.completed.length / 24) * 100;
                
                document.getElementById('consonant-mastery').textContent = 
                    `${consonants.completed.length}/23`;
                document.getElementById('consonant-progress').style.width = consonantPercent + '%';
                document.getElementById('consonant-progress').textContent = 
                    Math.round(consonantPercent) + '%';
                
                document.getElementById('vowel-mastery').textContent = 
                    `${vowels.completed.length}/24`;
                document.getElementById('vowel-progress').style.width = vowelPercent + '%';
                document.getElementById('vowel-progress').textContent = 
                    Math.round(vowelPercent) + '%';

                // æ•°å­¦è¿›åº¦
                const math = this.data.subjects.math;
                
                Object.keys(math).forEach(subject => {
                    const data = math[subject];
                    const avgScore = data.attempts > 0 ? (data.totalScore / data.attempts) : 0;
                    const percentage = Math.min(avgScore, 100);
                    
                    document.getElementById(`${subject}-score`).textContent = 
                        `å¹³å‡åˆ†: ${Math.round(avgScore)}`;
                    document.getElementById(`${subject}-progress`).style.width = percentage + '%';
                    document.getElementById(`${subject}-progress`).textContent = 
                        Math.round(percentage) + '%';
                });
            }

            // ç”Ÿæˆæˆå°±å¾½ç« 
            generateAchievements() {
                const achievements = [
                    { id: 'first_game', icon: 'ğŸ®', name: 'åˆæ¬¡ä½“éªŒ', condition: () => true },
                    { id: 'pinyin_beginner', icon: 'ğŸ“', name: 'æ‹¼éŸ³å…¥é—¨', 
                      condition: () => this.data.subjects.pinyin.consonants.completed.length >= 5 },
                    { id: 'math_star', icon: 'â­', name: 'æ•°å­¦ä¹‹æ˜Ÿ', 
                      condition: () => this.data.subjects.math.addition.attempts >= 10 },
                    { id: 'consistent_learner', icon: 'ğŸ”¥', name: 'åšæŒå­¦ä¹ ', 
                      condition: () => this.data.streakDays >= 3 },
                    { id: 'speed_master', icon: 'âš¡', name: 'é€Ÿåº¦å¤§å¸ˆ', 
                      condition: () => this.data.subjects.math.addition.bestStreak >= 5 }
                ];

                const container = document.getElementById('achievements-container');
                container.innerHTML = '';

                achievements.forEach(achievement => {
                    const earned = achievement.condition();
                    const badge = document.createElement('div');
                    badge.className = `achievement-badge ${earned ? '' : 'opacity-30'}`;
                    badge.innerHTML = `${achievement.icon}`;
                    badge.title = achievement.name;
                    container.appendChild(badge);
                });

                // æ›´æ–°å¾½ç« æ€»æ•°
                const earnedBadges = achievements.filter(a => a.condition()).length;
                document.getElementById('total-badges').textContent = earnedBadges;
            }

            // ç”ŸæˆAIå­¦ä¹ å»ºè®®
            generateAISuggestions() {
                const suggestions = [];
                
                // åŸºäºæ‹¼éŸ³è¿›åº¦çš„å»ºè®®
                const consonantProgress = this.data.subjects.pinyin.consonants.completed.length;
                const vowelProgress = this.data.subjects.pinyin.vowels.completed.length;
                
                if (consonantProgress < 10) {
                    suggestions.push("ğŸ¯ å»ºè®®é‡ç‚¹ç»ƒä¹ å£°æ¯ï¼Œç›®å‰æŒæ¡åº¦è¾ƒä½ã€‚å¯ä»¥æ¯å¤©ç»ƒä¹ 5ä¸ªå£°æ¯ã€‚");
                }
                
                if (vowelProgress < 12) {
                    suggestions.push("ğŸ“š éŸµæ¯å­¦ä¹ éœ€è¦åŠ å¼ºï¼Œå»ºè®®ç»“åˆå®é™…æ±‰å­—ç»ƒä¹ ã€‚");
                }

                // åŸºäºæ•°å­¦æˆç»©çš„å»ºè®®
                const mathData = this.data.subjects.math;
                if (mathData.addition.attempts > 0) {
                    const additionAvg = mathData.addition.totalScore / mathData.addition.attempts;
                    if (additionAvg < 70) {
                        suggestions.push("ğŸ”¢ åŠ æ³•ç»ƒä¹ éœ€è¦æ›´å¤šæ—¶é—´ï¼Œå»ºè®®ä»å°æ•°å­—å¼€å§‹ç»ƒä¹ ã€‚");
                    }
                }

                // åŸºäºå­¦ä¹ é¢‘ç‡çš„å»ºè®®
                if (this.data.streakDays < 2) {
                    suggestions.push("ğŸ“… å»ºè®®å»ºç«‹æ¯æ—¥å­¦ä¹ ä¹ æƒ¯ï¼Œæ¯å¤©15-20åˆ†é’Ÿæ•ˆæœæœ€ä½³ã€‚");
                }

                // ä¸ªæ€§åŒ–æ¨è
                if (consonantProgress > vowelProgress) {
                    suggestions.push("âœ¨ ä½ åœ¨å£°æ¯å­¦ä¹ ä¸Šè¡¨ç°å¾ˆå¥½ï¼å¯ä»¥å°è¯•æ›´æœ‰æŒ‘æˆ˜çš„æ‹¼éŸ³ç»„åˆç»ƒä¹ ã€‚");
                }

                // é»˜è®¤å»ºè®®
                if (suggestions.length === 0) {
                    suggestions.push("ğŸŒŸ å­¦ä¹ è¿›åº¦è‰¯å¥½ï¼å»ºè®®ä¿æŒå½“å‰çš„å­¦ä¹ èŠ‚å¥ï¼Œç»§ç»­åŠ æ²¹ï¼");
                }

                const container = document.getElementById('ai-suggestions');
                container.innerHTML = suggestions.map(s => 
                    `<div class="mb-2 p-3 bg-white bg-opacity-20 rounded-lg">${s}</div>`
                ).join('');
            }

            // åˆ›å»ºå­¦ä¹ å†å²å›¾è¡¨
            createLearningChart() {
                const container = document.getElementById('chart-container');
                container.innerHTML = '';
                
                // ç”Ÿæˆæœ€è¿‘7å¤©çš„æ¨¡æ‹Ÿæ•°æ®
                const days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
                const data = [20, 35, 15, 40, 25, 30, 45]; // åˆ†é’Ÿæ•°

                days.forEach((day, index) => {
                    const bar = document.createElement('div');
                    const height = Math.max(data[index] * 4, 10); // æœ€å°é«˜åº¦10px
                    
                    bar.className = 'flex flex-col items-center';
                    bar.innerHTML = `
                        <div style="height: ${height}px; width: 30px;" 
                             class="bg-gradient-to-t from-blue-400 to-blue-600 rounded-t-lg mb-2 flex items-end justify-center text-white text-xs font-bold pb-1">
                            ${data[index]}
                        </div>
                        <span class="text-xs text-gray-600">${day}</span>
                    `;
                    
                    container.appendChild(bar);
                });
            }

            // è®°å½•å­¦ä¹ æ´»åŠ¨
            recordActivity(subject, activity, score, timeSpent = 0) {
                const subjectData = this.data.subjects[subject];
                if (subjectData && subjectData[activity]) {
                    subjectData[activity].totalScore += score;
                    subjectData[activity].attempts += 1;
                }
                
                this.data.totalStudyTime += timeSpent;
                this.data.todayStudyTime += timeSpent;
                
                this.saveData();
                this.init(); // é‡æ–°åˆå§‹åŒ–æ˜¾ç¤º
            }
        }

        // å…¨å±€è¿›åº¦ç®¡ç†å™¨å®ä¾‹
        let progressManager;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            progressManager = new LearningProgressManager();
            
            // æ¨¡æ‹Ÿä¸€äº›å­¦ä¹ æ•°æ®ï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰
            if (progressManager.data.subjects.pinyin.consonants.completed.length === 0) {
                // æ·»åŠ ä¸€äº›ç¤ºä¾‹æ•°æ®
                progressManager.data.subjects.pinyin.consonants.completed = ['b', 'p', 'm', 'f', 'd'];
                progressManager.data.subjects.pinyin.vowels.completed = ['a', 'o', 'e', 'i'];
                progressManager.data.subjects.math.addition.totalScore = 850;
                progressManager.data.subjects.math.addition.attempts = 12;
                progressManager.data.streakDays = 3;
                progressManager.data.todayStudyTime = 900; // 15åˆ†é’Ÿ
                progressManager.saveData();
                progressManager.init();
            }
        });

        // å¯¼å‡ºç»™å…¶ä»–é¡µé¢ä½¿ç”¨çš„å‡½æ•°
        window.recordLearningProgress = function(subject, activity, score, timeSpent = 0) {
            if (progressManager) {
                progressManager.recordActivity(subject, activity, score, timeSpent);
            }
        };
    </script>
</body>
</html>